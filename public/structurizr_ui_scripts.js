!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],r=Object.getPrototypeOf,s=t.slice,g=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},u=t.push,i=t.indexOf,n={},o=n.toString,y=n.hasOwnProperty,a=y.toString,l=a.call(Object),v={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},x=function(e){return null!=e&&e===e.window},S=C.document,c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||S).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.6.3",E=function(e,t){return new E.fn.init(e,t)};function p(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}E.fn=E.prototype={jquery:f,constructor:E,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=E.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return E.each(this,e)},map:function(n){return this.pushStack(E.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(E.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(E.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},E.extend=E.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(E.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||E.isPlainObject(n)?n:{},i=!1,a[t]=E.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},E.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=y.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(p(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(p(Object(e))?E.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(p(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:v}),"function"==typeof Symbol&&(E.fn[Symbol.iterator]=t[Symbol.iterator]),E.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var d=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,S,y,s,c,v,E="sizzle"+1*new Date,p=n.document,k=0,r=0,m=ue(),x=ue(),A=ue(),N=ue(),j=function(e,t){return e===t&&(l=!0),0},D={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",$=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(p.childNodes),p.childNodes),t[p.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(T(e),e=e||C,S)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&v(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!N[t+" "]&&(!y||!y.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&(U.test(t)||z.test(t))){(f=ee.test(t)&&ve(e.parentNode)||e)===e&&d.scope||((s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=E)),o=(l=h(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+xe(l[o]);c=l.join(",")}try{if(d.cssSupportsSelector&&!CSS.supports("selector(:is("+c+"))"))throw new Error;return H.apply(n,f.querySelectorAll(c)),n}catch(e){N(t,!0)}finally{s===E&&e.removeAttribute("id")}}}return g(t.replace(B,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[E]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ye(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ve(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:p;return r!=C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,S=!i(C),p!=C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.scope=ce(function(e){return a.appendChild(e).appendChild(C.createElement("div")),"undefined"!=typeof e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),d.cssSupportsSelector=ce(function(){return CSS.supports("selector(*)")&&C.querySelectorAll(":is(:jqfake)")&&!CSS.supports("selector(:is(*,:jqfake))")}),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=E,!C.getElementsByName||!C.getElementsByName(E).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&S){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&S){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&S)return t.getElementsByClassName(e)},s=[],y=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){var t;a.appendChild(e).innerHTML="<a id='"+E+"'></a><select id='"+E+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||y.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+E+"-]").length||y.push("~="),(t=C.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||y.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||y.push(":checked"),e.querySelectorAll("a#"+E+"+*").length||y.push(".#.+[+~]"),e.querySelectorAll("\\\f"),y.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&y.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&y.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&y.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),y.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",F)}),d.cssSupportsSelector||y.push(":has"),y=y.length&&new RegExp(y.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),v=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType&&e.documentElement||e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},j=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e==C||e.ownerDocument==p&&v(p,e)?-1:t==C||t.ownerDocument==p&&v(p,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==C?-1:t==C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]==p?-1:s[r]==p?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(T(e),d.matchesSelector&&S&&!N[t+" "]&&(!s||!s.test(t))&&(!y||!y.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){N(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!=C&&T(e),v(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&D.call(b.attrHandle,t.toLowerCase())?n(e,t,!S):void 0;return void 0!==r?r:d.attributes||!S?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(j),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=m[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&m(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace($," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,y){var v="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===y?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=v!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(v){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[E]||(a[E]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[k,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[E]||(a[E]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===k&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[E]||(a[E]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[k,d]),a===e))break;return(d-=y)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[E]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace(B,"$1"));return s[E]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=S?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ye(function(){return[0]}),last:ye(function(e,t){return[t-1]}),eq:ye(function(e,t,n){return[n<0?n+t:n]}),even:ye(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ye(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ye(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ye(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[k,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[E]||(e[E]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===k&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,y,v,e){return y&&!y[E]&&(y=Ce(y)),v&&!v[E]&&(v=Ce(v,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?v||(e?d:l||y)?[]:t:f;if(g&&g(f,p,n,r),y){i=Te(p,u),y(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(v||d){if(v){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);v(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=v?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),v?v(null,t,p,r):H.apply(t,p)})}function Se(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[E]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(B,"$1"),t,s<n&&Se(e.slice(s,n)),n<r&&Se(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(B," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,y,v,m,x,r,i=[],o=[],a=A[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Se(t[n]))[E]?i.push(a):o.push(a);(a=A(e,(y=o,m=0<(v=i).length,x=0<y.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=k+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==C||(T(o),n=!S);while(s=y[a++])if(s(o,t||C,n)){r.push(o);break}i&&(k=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=v[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+v.length&&se.uniqueSort(r)}return i&&(k=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&S&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ve(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!S,n,!t||ee.test(e)&&ve(t.parentNode)||t),n},d.sortStable=E.split("").sort(j).join("")===E,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);E.find=d,E.expr=d.selectors,E.expr[":"]=E.expr.pseudos,E.uniqueSort=E.unique=d.uniqueSort,E.text=d.getText,E.isXMLDoc=d.isXML,E.contains=d.contains,E.escapeSelector=d.escape;var h=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&E(e).is(n))break;r.push(e)}return r},T=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=E.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?E.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?E.grep(e,function(e){return e===n!==r}):"string"!=typeof n?E.grep(e,function(e){return-1<i.call(n,e)!==r}):E.filter(n,e,r)}E.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?E.find.matchesSelector(r,e)?[r]:[]:E.find.matches(e,E.grep(t,function(e){return 1===e.nodeType}))},E.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(E(e).filter(function(){for(t=0;t<r;t++)if(E.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)E.find(e,i[t],n);return 1<r?E.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?E(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(E.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof E?t[0]:t,E.merge(this,E.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:S,!0)),N.test(r[1])&&E.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=S.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(E):E.makeArray(e,this)}).prototype=E.fn,D=E(S);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){while((e=e[t])&&1!==e.nodeType);return e}E.fn.extend({has:function(e){var t=E(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(E.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&E(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&E.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?E.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(E(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(E.uniqueSort(E.merge(this.get(),E(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),E.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return h(e,"parentNode")},parentsUntil:function(e,t,n){return h(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return h(e,"nextSibling")},prevAll:function(e){return h(e,"previousSibling")},nextUntil:function(e,t,n){return h(e,"nextSibling",n)},prevUntil:function(e,t,n){return h(e,"previousSibling",n)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),E.merge([],e.childNodes))}},function(r,i){E.fn[r]=function(e,t){var n=E.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=E.filter(t,n)),1<this.length&&(H[r]||E.uniqueSort(n),L.test(r)&&n.reverse()),this.pushStack(n)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}E.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},E.each(e.match(P)||[],function(e,t){n[t]=!0}),n):E.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){E.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return E.each(arguments,function(e,t){var n;while(-1<(n=E.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<E.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},E.extend({Deferred:function(e){var o=[["notify","progress",E.Callbacks("memory"),E.Callbacks("memory"),2],["resolve","done",E.Callbacks("once memory"),E.Callbacks("once memory"),0,"resolved"],["reject","fail",E.Callbacks("once memory"),E.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var i=arguments;return E.Deferred(function(r){E.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,R,s),l(u,o,M,s)):(u++,t.call(e,l(u,o,R,s),l(u,o,M,s),l(u,o,R,o.notifyWith))):(a!==R&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){E.Deferred.exceptionHook&&E.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==M&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(E.Deferred.getStackHook&&(t.stackTrace=E.Deferred.getStackHook()),C.setTimeout(t))}}return E.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:R,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:R)),o[2][3].add(l(0,e,m(n)?n:M))}).promise()},promise:function(e){return null!=e?E.extend(e,a):a}},s={};return E.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=E.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(I(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)I(i[t],a(t),o.reject);return o.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;E.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&W.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},E.readyException=function(e){C.setTimeout(function(){throw e})};var F=E.Deferred();function $(){S.removeEventListener("DOMContentLoaded",$),C.removeEventListener("load",$),E.ready()}E.fn.ready=function(e){return F.then(e)["catch"](function(e){E.readyException(e)}),this},E.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--E.readyWait:E.isReady)||(E.isReady=!0)!==e&&0<--E.readyWait||F.resolveWith(S,[E])}}),E.ready.then=F.then,"complete"===S.readyState||"loading"!==S.readyState&&!S.documentElement.doScroll?C.setTimeout(E.ready):(S.addEventListener("DOMContentLoaded",$),C.addEventListener("load",$));var B=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)B(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(E(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=E.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;while(n--)delete r[t[n]]}(void 0===t||E.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!E.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:J.test(i)?JSON.parse(i):i)}catch(e){}Q.set(e,t,n)}else n=void 0;return n}E.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),E.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){Q.set(this,n)}):B(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=Q.get(o,n))?t:void 0!==(t=Z(o,n))?t:void 0;this.each(function(){Q.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),E.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,E.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=E.queue(e,t),r=n.length,i=n.shift(),o=E._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){E.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:E.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),E.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?E.queue(this[0],t):void 0===n?this:this.each(function(){var e=E.queue(this,t,n);E._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&E.dequeue(this,t)})},dequeue:function(e){return this.each(function(){E.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=E.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=S.documentElement,ie=function(e){return E.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return E.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===E.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return E.css(e,t,"")},u=s(),l=n&&n[3]||(E.cssNumber[t]?"":"px"),c=e.nodeType&&(E.cssNumber[t]||"px"!==l&&+u)&&te.exec(E.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)E.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,E.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Y.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ae(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ue[s])||(o=a.body.appendChild(a.createElement(s)),u=E.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ue[s]=u)))):"none"!==n&&(l[c]="none",Y.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}E.fn.extend({show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?E(this).show():E(this).hide()})}});var ce,fe,pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i;ce=S.createDocumentFragment().appendChild(S.createElement("div")),(fe=S.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),ce.appendChild(fe),v.checkClone=ce.cloneNode(!0).cloneNode(!0).lastChild.checked,ce.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!ce.cloneNode(!0).lastChild.defaultValue,ce.innerHTML="<option></option>",v.option=!!ce.lastChild;var ge={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ye(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?E.merge([e],n):n}function ve(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td,v.option||(ge.optgroup=ge.option=[1,"<select multiple='multiple'>","</select>"]);var me=/<|&#?\w+;/;function xe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))E.merge(p,o.nodeType?[o]:o);else if(me.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+E.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;E.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<E.inArray(o,r))i&&i.push(o);else if(l=ie(o),a=ye(f.appendChild(o),"script"),l&&ve(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}var be=/^([^.]*)(?:\.(.+)|)/;function we(){return!0}function Te(){return!1}function Ce(e,t){return e===function(){try{return S.activeElement}catch(e){}}()==("focus"===t)}function Se(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Se(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Te;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return E().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=E.guid++)),e.each(function(){E.event.add(this,t,i,r,n)})}function Ee(e,i,o){o?(Y.set(e,i,!1),E.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Y.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(E.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Y.set(this,i,r),t=o(this,i),this[i](),r!==(n=Y.get(this,i))||t?Y.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(Y.set(this,i,{value:E.event.trigger(E.extend(r[0],E.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,i)&&E.event.add(e,i,we)}E.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=Y.get(t);if(V(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&E.find.matchesSelector(re,i),n.guid||(n.guid=E.guid++),(u=y.events)||(u=y.events=Object.create(null)),(a=y.handle)||(a=y.handle=function(e){return"undefined"!=typeof E&&E.event.triggered!==e.type?E.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(P)||[""]).length;while(l--)d=g=(s=be.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=E.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=E.event.special[d]||{},c=E.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&E.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),E.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,y=Y.hasData(e)&&Y.get(e);if(y&&(u=y.events)){l=(t=(t||"").match(P)||[""]).length;while(l--)if(d=g=(s=be.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=E.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,y.handle)||E.removeEvent(e,d,y.handle),delete u[d])}else for(d in u)E.event.remove(e,d+t[l],n,r,!0);E.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=E.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=E.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=E.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((E.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<E(i,this).index(l):E.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(E.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[E.expando]?e:new E.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Ee(t,"click",we),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&Ee(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},E.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},E.Event=function(e,t){if(!(this instanceof E.Event))return new E.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?we:Te,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&E.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[E.expando]=!0},E.Event.prototype={constructor:E.Event,isDefaultPrevented:Te,isPropagationStopped:Te,isImmediatePropagationStopped:Te,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=we,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=we,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=we,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},E.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},E.event.addProp),E.each({focus:"focusin",blur:"focusout"},function(t,e){E.event.special[t]={setup:function(){return Ee(this,t,Ce),!1},trigger:function(){return Ee(this,t),!0},_default:function(e){return Y.get(e.target,t)},delegateType:e}}),E.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){E.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||E.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),E.fn.extend({on:function(e,t,n,r){return Se(this,e,t,n,r)},one:function(e,t,n,r){return Se(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,E(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Te),this.each(function(){E.event.remove(this,e,n,t)})}});var ke=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function je(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&E(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function qe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Le(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)E.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=E.extend({},o),Q.set(t,a))}}function He(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!v.checkClone&&Ae.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),He(t,r,i,o)});if(f&&(t=(e=xe(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=E.map(ye(e,"script"),De)).length;c<f;c++)u=e,c!==p&&(u=E.clone(u,!0,!0),s&&E.merge(a,ye(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,E.map(a,qe),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Y.access(u,"globalEval")&&E.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?E._evalUrl&&!u.noModule&&E._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):b(u.textContent.replace(Ne,""),u,l))}return n}function Oe(e,t,n){for(var r,i=t?E.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||E.cleanData(ye(r)),r.parentNode&&(n&&ie(r)&&ve(ye(r,"script")),r.parentNode.removeChild(r));return e}E.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(v.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||E.isXMLDoc(e)))for(a=ye(c),r=0,i=(o=ye(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ye(e),a=a||ye(c),r=0,i=o.length;r<i;r++)Le(o[r],a[r]);else Le(e,c);return 0<(a=ye(c,"script")).length&&ve(a,!f&&ye(e,"script")),c},cleanData:function(e){for(var t,n,r,i=E.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?E.event.remove(n,r):E.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),E.fn.extend({detach:function(e){return Oe(this,e,!0)},remove:function(e){return Oe(this,e)},text:function(e){return B(this,function(e){return void 0===e?E.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return He(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||je(this,e).appendChild(e)})},prepend:function(){return He(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=je(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return He(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(E.cleanData(ye(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return E.clone(this,e,t)})},html:function(e){return B(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ke.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=E.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(E.cleanData(ye(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return He(this,arguments,function(e){var t=this.parentNode;E.inArray(this,n)<0&&(E.cleanData(ye(this)),t&&t.replaceChild(e,this))},n)}}),E.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){E.fn[e]=function(e){for(var t,n=[],r=E(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),E(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var Pe=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Re=/^--/,Me=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Ie=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},We=new RegExp(ne.join("|"),"i"),Fe="[\\x20\\t\\r\\n\\f]",$e=new RegExp("^"+Fe+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Fe+"+$","g");function Be(e,t,n){var r,i,o,a,s=Re.test(t),u=e.style;return(n=n||Me(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace($e,"$1")||void 0),""!==a||ie(e)||(a=E.style(e,t)),!v.pixelBoxStyles()&&Pe.test(a)&&We.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+"":a}function _e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(u).appendChild(l);var e=C.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),re.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=S.createElement("div"),l=S.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle="content-box"===l.style.backgroundClip,E.extend(v,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=S.createElement("table"),t=S.createElement("tr"),n=S.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),r=C.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),a}}))}();var ze=["Webkit","Moz","ms"],Ue=S.createElement("div").style,Xe={};function Ve(e){var t=E.cssProps[e]||Xe[e];return t||(e in Ue?e:Xe[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=ze.length;while(n--)if((e=ze[n]+t)in Ue)return e}(e)||e)}var Ge=/^(none|table(?!-c[ea]).+)/,Ye={position:"absolute",visibility:"hidden",display:"block"},Qe={letterSpacing:"0",fontWeight:"400"};function Je(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ke(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=E.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=E.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=E.css(e,"border"+ne[a]+"Width",!0,i))):(u+=E.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=E.css(e,"border"+ne[a]+"Width",!0,i):s+=E.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Ze(e,t,n){var r=Me(e),i=(!v.boxSizingReliable()||n)&&"border-box"===E.css(e,"boxSizing",!1,r),o=i,a=Be(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Pe.test(a)){if(!n)return a;a="auto"}return(!v.boxSizingReliable()&&i||!v.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===E.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===E.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Ke(e,t,n||(i?"border":"content"),o,r,a)+"px"}function et(e,t,n,r,i){return new et.prototype.init(e,t,n,r,i)}E.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Be(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Re.test(t),l=e.style;if(u||(t=Ve(s)),a=E.cssHooks[t]||E.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(E.cssNumber[s]?"":"px")),v.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Re.test(t)||(t=Ve(s)),(a=E.cssHooks[t]||E.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Be(e,t,r)),"normal"===i&&t in Qe&&(i=Qe[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),E.each(["height","width"],function(e,u){E.cssHooks[u]={get:function(e,t,n){if(t)return!Ge.test(E.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Ze(e,u,n):Ie(e,Ye,function(){return Ze(e,u,n)})},set:function(e,t,n){var r,i=Me(e),o=!v.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===E.css(e,"boxSizing",!1,i),s=n?Ke(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-Ke(e,u,"border",!1,i)-.5)),s&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=E.css(e,u)),Je(0,t,s)}}}),E.cssHooks.marginLeft=_e(v.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Be(e,"marginLeft"))||e.getBoundingClientRect().left-Ie(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),E.each({margin:"",padding:"",border:"Width"},function(i,o){E.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(E.cssHooks[i+o].set=Je)}),E.fn.extend({css:function(e,t){return B(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Me(e),i=t.length;a<i;a++)o[t[a]]=E.css(e,t[a],!1,r);return o}return void 0!==n?E.style(e,t,n):E.css(e,t)},e,t,1<arguments.length)}}),((E.Tween=et).prototype={constructor:et,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||E.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(E.cssNumber[n]?"":"px")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,n=et.propHooks[this.prop];return this.options.duration?this.pos=t=E.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):et.propHooks._default.set(this),this}}).init.prototype=et.prototype,(et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=E.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){E.fx.step[e.prop]?E.fx.step[e.prop](e):1!==e.elem.nodeType||!E.cssHooks[e.prop]&&null==e.elem.style[Ve(e.prop)]?e.elem[e.prop]=e.now:E.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},E.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},E.fx=et.prototype.init,E.fx.step={};var tt,nt,rt,it,ot=/^(?:toggle|show|hide)$/,at=/queueHooks$/;function st(){nt&&(!1===S.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(st):C.setTimeout(st,E.fx.interval),E.fx.tick())}function ut(){return C.setTimeout(function(){tt=void 0}),tt=Date.now()}function lt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ct(e,t,n){for(var r,i=(ft.tweeners[t]||[]).concat(ft.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function ft(o,e,t){var n,a,r=0,i=ft.prefilters.length,s=E.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=tt||ut(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:E.extend({},e),opts:E.extend(!0,{specialEasing:{},easing:E.easing._default},t),originalProperties:e,originalOptions:t,startTime:tt||ut(),duration:t.duration,tweens:[],createTween:function(e,t){var n=E.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=E.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=ft.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(E._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return E.map(c,ct,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),E.fx.timer(E.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}E.Animation=E.extend(ft,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],ft.tweeners[n]=ft.tweeners[n]||[],ft.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),y=Y.get(e,"fxshow");for(r in n.queue||(null==(a=E._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,E.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],ot.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!y||void 0===y[r])continue;g=!0}d[r]=y&&y[r]||E.style(e,r)}if((u=!E.isEmptyObject(t))||!E.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=y&&y.display)&&(l=Y.get(e,"display")),"none"===(c=E.css(e,"display"))&&(l?c=l:(le([e],!0),l=e.style.display||l,c=E.css(e,"display"),le([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===E.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(y?"hidden"in y&&(g=y.hidden):y=Y.access(e,"fxshow",{display:l}),o&&(y.hidden=!g),g&&le([e],!0),p.done(function(){for(r in g||le([e]),Y.remove(e,"fxshow"),d)E.style(e,r,d[r])})),u=ct(g?y[r]:0,r,p),r in y||(y[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?ft.prefilters.unshift(e):ft.prefilters.push(e)}}),E.speed=function(e,t,n){var r=e&&"object"==typeof e?E.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return E.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in E.fx.speeds?r.duration=E.fx.speeds[r.duration]:r.duration=E.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&E.dequeue(this,r.queue)},r},E.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=E.isEmptyObject(t),o=E.speed(e,n,r),a=function(){var e=ft(this,E.extend({},t),o);(i||Y.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=E.timers,r=Y.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&at.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||E.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Y.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=E.timers,o=n?n.length:0;for(t.finish=!0,E.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),E.each(["toggle","show","hide"],function(e,r){var i=E.fn[r];E.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(lt(r,!0),e,t,n)}}),E.each({slideDown:lt("show"),slideUp:lt("hide"),slideToggle:lt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){E.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),E.timers=[],E.fx.tick=function(){var e,t=0,n=E.timers;for(tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||E.fx.stop(),tt=void 0},E.fx.timer=function(e){E.timers.push(e),E.fx.start()},E.fx.interval=13,E.fx.start=function(){nt||(nt=!0,st())},E.fx.stop=function(){nt=null},E.fx.speeds={slow:600,fast:200,_default:400},E.fn.delay=function(r,e){return r=E.fx&&E.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},rt=S.createElement("input"),it=S.createElement("select").appendChild(S.createElement("option")),rt.type="checkbox",v.checkOn=""!==rt.value,v.optSelected=it.selected,(rt=S.createElement("input")).value="t",rt.type="radio",v.radioValue="t"===rt.value;var pt,dt=E.expr.attrHandle;E.fn.extend({attr:function(e,t){return B(this,E.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){E.removeAttr(this,e)})}}),E.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?E.prop(e,t,n):(1===o&&E.isXMLDoc(e)||(i=E.attrHooks[t.toLowerCase()]||(E.expr.match.bool.test(t)?pt:void 0)),void 0!==n?null===n?void E.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=E.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!v.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),pt={set:function(e,t,n){return!1===t?E.removeAttr(e,n):e.setAttribute(n,n),n}},E.each(E.expr.match.bool.source.match(/\w+/g),function(e,t){var a=dt[t]||E.find.attr;dt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=dt[o],dt[o]=r,r=null!=a(e,t,n)?o:null,dt[o]=i),r}});var ht=/^(?:input|select|textarea|button)$/i,gt=/^(?:a|area)$/i;function yt(e){return(e.match(P)||[]).join(" ")}function vt(e){return e.getAttribute&&e.getAttribute("class")||""}function mt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}E.fn.extend({prop:function(e,t){return B(this,E.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[E.propFix[e]||e]})}}),E.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&E.isXMLDoc(e)||(t=E.propFix[t]||t,i=E.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=E.find.attr(e,"tabindex");return t?parseInt(t,10):ht.test(e.nodeName)||gt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),v.optSelected||(E.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),E.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){E.propFix[this.toLowerCase()]=this}),E.fn.extend({addClass:function(t){var e,n,r,i,o,a;return m(t)?this.each(function(e){E(this).addClass(t.call(this,e,vt(this)))}):(e=mt(t)).length?this.each(function(){if(r=vt(this),n=1===this.nodeType&&" "+yt(r)+" "){for(o=0;o<e.length;o++)i=e[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ");a=yt(n),r!==a&&this.setAttribute("class",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return m(t)?this.each(function(e){E(this).removeClass(t.call(this,e,vt(this)))}):arguments.length?(e=mt(t)).length?this.each(function(){if(r=vt(this),n=1===this.nodeType&&" "+yt(r)+" "){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(" "+i+" "))n=n.replace(" "+i+" "," ")}a=yt(n),r!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s="string"===a||Array.isArray(t);return m(t)?this.each(function(e){E(this).toggleClass(t.call(this,e,vt(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=mt(t),this.each(function(){if(s)for(o=E(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&"boolean"!==a||((r=vt(this))&&Y.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":Y.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+yt(vt(n))+" ").indexOf(t))return!0;return!1}});var xt=/\r/g;E.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,E(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=E.map(t,function(e){return null==e?"":e+""})),(r=E.valHooks[this.type]||E.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=E.valHooks[t.type]||E.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(xt,""):null==e?"":e:void 0}}),E.extend({valHooks:{option:{get:function(e){var t=E.find.attr(e,"value");return null!=t?t:yt(E.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=E(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=E.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<E.inArray(E.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),E.each(["radio","checkbox"],function(){E.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<E.inArray(E(e).val(),t)}},v.checkOn||(E.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),v.focusin="onfocusin"in C;var bt=/^(?:focusinfocus|focusoutblur)$/,wt=function(e){e.stopPropagation()};E.extend(E.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||S],d=y.call(e,"type")?e.type:e,h=y.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||S,3!==n.nodeType&&8!==n.nodeType&&!bt.test(d+E.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[E.expando]?e:new E.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:E.makeArray(t,[e]),c=E.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,bt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||S)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Y.get(o,"events")||Object.create(null))[e.type]&&Y.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&V(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!V(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),E.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,wt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,wt),E.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=E.extend(new E.Event,n,{type:e,isSimulated:!0});E.event.trigger(r,null,t)}}),E.fn.extend({trigger:function(e,t){return this.each(function(){E.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return E.event.trigger(e,t,n,!0)}}),v.focusin||E.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){E.event.simulate(r,e.target,E.event.fix(e))};E.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r);t||e.addEventListener(n,i,!0),Y.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=Y.access(e,r)-1;t?Y.access(e,r,t):(e.removeEventListener(n,i,!0),Y.remove(e,r))}}});var Tt=C.location,Ct={guid:Date.now()},St=/\?/;E.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||E.error("Invalid XML: "+(n?E.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Et=/\[\]$/,kt=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,Nt=/^(?:input|select|textarea|keygen)/i;function jt(n,e,r,i){var t;if(Array.isArray(e))E.each(e,function(e,t){r||Et.test(n)?i(n,t):jt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)jt(n+"["+t+"]",e[t],r,i)}E.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!E.isPlainObject(e))E.each(e,function(){i(this.name,this.value)});else for(n in e)jt(n,e[n],t,i);return r.join("&")},E.fn.extend({serialize:function(){return E.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=E.prop(this,"elements");return e?E.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!E(this).is(":disabled")&&Nt.test(this.nodeName)&&!At.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=E(this).val();return null==n?null:Array.isArray(n)?E.map(n,function(e){return{name:t.name,value:e.replace(kt,"\r\n")}}):{name:t.name,value:n.replace(kt,"\r\n")}}).get()}});var Dt=/%20/g,qt=/#.*$/,Lt=/([?&])_=[^&]*/,Ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ot=/^(?:GET|HEAD)$/,Pt=/^\/\//,Rt={},Mt={},It="*/".concat("*"),Wt=S.createElement("a");function Ft(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(P)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function $t(t,i,o,a){var s={},u=t===Mt;function l(e){var r;return s[e]=!0,E.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Bt(e,t){var n,r,i=E.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&E.extend(!0,e,r),e}Wt.href=Tt.href,E.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Tt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Tt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":It,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":E.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Bt(Bt(e,E.ajaxSettings),t):Bt(E.ajaxSettings,e)},ajaxPrefilter:Ft(Rt),ajaxTransport:Ft(Mt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,y=E.ajaxSetup({},t),v=y.context||y,m=y.context&&(v.nodeType||v.jquery)?E(v):E.event,x=E.Deferred(),b=E.Callbacks("once memory"),w=y.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Ht.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(y.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),y.url=((e||y.url||Tt.href)+"").replace(Pt,Tt.protocol+"//"),y.type=t.method||t.type||y.method||y.type,y.dataTypes=(y.dataType||"*").toLowerCase().match(P)||[""],null==y.crossDomain){r=S.createElement("a");try{r.href=y.url,r.href=r.href,y.crossDomain=Wt.protocol+"//"+Wt.host!=r.protocol+"//"+r.host}catch(e){y.crossDomain=!0}}if(y.data&&y.processData&&"string"!=typeof y.data&&(y.data=E.param(y.data,y.traditional)),$t(Rt,y,t,T),h)return T;for(i in(g=E.event&&y.global)&&0==E.active++&&E.event.trigger("ajaxStart"),y.type=y.type.toUpperCase(),y.hasContent=!Ot.test(y.type),f=y.url.replace(qt,""),y.hasContent?y.data&&y.processData&&0===(y.contentType||"").indexOf("application/x-www-form-urlencoded")&&(y.data=y.data.replace(Dt,"+")):(o=y.url.slice(f.length),y.data&&(y.processData||"string"==typeof y.data)&&(f+=(St.test(f)?"&":"?")+y.data,delete y.data),!1===y.cache&&(f=f.replace(Lt,"$1"),o=(St.test(f)?"&":"?")+"_="+Ct.guid+++o),y.url=f+o),y.ifModified&&(E.lastModified[f]&&T.setRequestHeader("If-Modified-Since",E.lastModified[f]),E.etag[f]&&T.setRequestHeader("If-None-Match",E.etag[f])),(y.data&&y.hasContent&&!1!==y.contentType||t.contentType)&&T.setRequestHeader("Content-Type",y.contentType),T.setRequestHeader("Accept",y.dataTypes[0]&&y.accepts[y.dataTypes[0]]?y.accepts[y.dataTypes[0]]+("*"!==y.dataTypes[0]?", "+It+"; q=0.01":""):y.accepts["*"]),y.headers)T.setRequestHeader(i,y.headers[i]);if(y.beforeSend&&(!1===y.beforeSend.call(v,T,y)||h))return T.abort();if(u="abort",b.add(y.complete),T.done(y.success),T.fail(y.error),c=$t(Mt,y,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,y]),h)return T;y.async&&0<y.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},y.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(y,T,n)),!i&&-1<E.inArray("script",y.dataTypes)&&E.inArray("json",y.dataTypes)<0&&(y.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(y,s,T,i),i?(y.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(E.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(E.etag[f]=u)),204===e||"HEAD"===y.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(v,[o,l,T]):x.rejectWith(v,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,y,i?o:a]),b.fireWith(v,[T,l]),g&&(m.trigger("ajaxComplete",[T,y]),--E.active||E.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return E.get(e,t,n,"json")},getScript:function(e,t){return E.get(e,void 0,t,"script")}}),E.each(["get","post"],function(e,i){E[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),E.ajax(E.extend({url:e,type:i,dataType:r,data:t,success:n},E.isPlainObject(e)&&e))}}),E.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),E._evalUrl=function(e,t,n){return E.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){E.globalEval(e,t,n)}})},E.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=E(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){E(this).wrapInner(n.call(this,e))}):this.each(function(){var e=E(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){E(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){E(this).replaceWith(this.childNodes)}),this}}),E.expr.pseudos.hidden=function(e){return!E.expr.pseudos.visible(e)},E.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},E.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var _t={0:200,1223:204},zt=E.ajaxSettings.xhr();v.cors=!!zt&&"withCredentials"in zt,v.ajax=zt=!!zt,E.ajaxTransport(function(i){var o,a;if(v.cors||zt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(_t[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),E.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),E.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return E.globalEval(e),e}}}),E.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),E.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=E("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),S.head.appendChild(r[0])},abort:function(){i&&i()}}});var Ut,Xt=[],Vt=/(=)\?(?=&|$)|\?\?/;E.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Xt.pop()||E.expando+"_"+Ct.guid++;return this[e]=!0,e}}),E.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Vt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Vt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Vt,"$1"+r):!1!==e.jsonp&&(e.url+=(St.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||E.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?E(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Xt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),v.createHTMLDocument=((Ut=S.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Ut.childNodes.length),E.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(v.createHTMLDocument?((r=(t=S.implementation.createHTMLDocument("")).createElement("base")).href=S.location.href,t.head.appendChild(r)):t=S),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=xe([e],t,o),o&&o.length&&E(o).remove(),E.merge([],i.childNodes)));var r,i,o},E.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=yt(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&E.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?E("<div>").append(E.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},E.expr.pseudos.animated=function(t){return E.grep(E.timers,function(e){return t===e.elem}).length},E.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=E.css(e,"position"),c=E(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=E.css(e,"top"),u=E.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,E.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},E.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){E.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===E.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===E.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=E(e).offset()).top+=E.css(e,"borderTopWidth",!0),i.left+=E.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-E.css(r,"marginTop",!0),left:t.left-i.left-E.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===E.css(e,"position"))e=e.offsetParent;return e||re})}}),E.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;E.fn[t]=function(e){return B(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),E.each(["top","left"],function(e,n){E.cssHooks[n]=_e(v.pixelPosition,function(e,t){if(t)return t=Be(e,n),Pe.test(t)?E(e).position()[n]+"px":t})}),E.each({Height:"height",Width:"width"},function(a,s){E.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){E.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return B(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?E.css(e,t,i):E.style(e,t,n,i)},s,n?e:void 0,n)}})}),E.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){E.fn[t]=function(e){return this.on(t,e)}}),E.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),E.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){E.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Gt=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;E.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||E.guid++,i},E.holdReady=function(e){e?E.readyWait++:E.ready(!0)},E.isArray=Array.isArray,E.parseJSON=JSON.parse,E.nodeName=A,E.isFunction=m,E.isWindow=x,E.camelCase=X,E.type=w,E.now=Date.now,E.isNumeric=function(e){var t=E.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},E.trim=function(e){return null==e?"":(e+"").replace(Gt,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return E});var Yt=C.jQuery,Qt=C.$;return E.noConflict=function(e){return C.$===E&&(C.$=Qt),e&&C.jQuery===E&&(C.jQuery=Yt),E},"undefined"==typeof e&&(C.jQuery=C.$=E),E});(function(){var undefined;var VERSION="4.17.21";var LARGE_ARRAY_SIZE=200;var CORE_ERROR_TEXT="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",FUNC_ERROR_TEXT="Expected a function",INVALID_TEMPL_VAR_ERROR_TEXT="Invalid `variable` option passed into `_.template`";var HASH_UNDEFINED="__lodash_hash_undefined__";var MAX_MEMOIZE_SIZE=500;var PLACEHOLDER="__lodash_placeholder__";var CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4;var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;var WRAP_BIND_FLAG=1,WRAP_BIND_KEY_FLAG=2,WRAP_CURRY_BOUND_FLAG=4,WRAP_CURRY_FLAG=8,WRAP_CURRY_RIGHT_FLAG=16,WRAP_PARTIAL_FLAG=32,WRAP_PARTIAL_RIGHT_FLAG=64,WRAP_ARY_FLAG=128,WRAP_REARG_FLAG=256,WRAP_FLIP_FLAG=512;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=800,HOT_SPAN=16;var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3;var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=17976931348623157e292,NAN=0/0;var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var wrapFlags=[["ary",WRAP_ARY_FLAG],["bind",WRAP_BIND_FLAG],["bindKey",WRAP_BIND_KEY_FLAG],["curry",WRAP_CURRY_FLAG],["curryRight",WRAP_CURRY_RIGHT_FLAG],["flip",WRAP_FLIP_FLAG],["partial",WRAP_PARTIAL_FLAG],["partialRight",WRAP_PARTIAL_RIGHT_FLAG],["rearg",WRAP_REARG_FLAG]];var argsTag="[object Arguments]",arrayTag="[object Array]",asyncTag="[object AsyncFunction]",boolTag="[object Boolean]",dateTag="[object Date]",domExcTag="[object DOMException]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",nullTag="[object Null]",objectTag="[object Object]",promiseTag="[object Promise]",proxyTag="[object Proxy]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",undefinedTag="[object Undefined]",weakMapTag="[object WeakMap]",weakSetTag="[object WeakSet]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);var reTrimStart=/^\s+/;var reWhitespace=/\s/;var reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /;var reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var reForbiddenIdentifierChars=/[()=,{}\[\]\/\s]/;var reEscapeChar=/\\(\\)?/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange;var rsApos="['â]",rsAstral="["+rsAstralRange+"]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d";var rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",rsOptContrLower="(?:"+rsApos+"(?:d|ll|m|re|s|t|ve))?",rsOptContrUpper="(?:"+rsApos+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsOrdLower="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rsOrdUpper="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var reApos=RegExp(rsApos,"g");var reComboMark=RegExp(rsCombo,"g");var reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");var reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptContrLower+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+"+rsOptContrUpper+"(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+"+rsOptContrLower,rsUpper+"+"+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join("|"),"g");var reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+"]");var reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var deburredLetters={"Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã":"C","Ã§":"c","Ã":"D","Ã°":"d","Ã":"E","Ã":"E","Ã":"E","Ã":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","Ã":"I","Ã":"I","Ã":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã":"N","Ã±":"n","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã":"U","Ã":"U","Ã":"U","Ã":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã":"Ae","Ã¦":"ae","Ã":"Th","Ã¾":"th","Ã":"ss","Ä":"A","Ä":"A","Ä":"A","Ä":"a","Ä":"a","Ä":"a","Ä":"C","Ä":"C","Ä":"C","Ä":"C","Ä":"c","Ä":"c","Ä":"c","Ä":"c","Ä":"D","Ä":"D","Ä":"d","Ä":"d","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"E","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"e","Ä":"G","Ä":"G","Ä ":"G","Ä¢":"G","Ä":"g","Ä":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å":"l","Å":"l","Å":"N","Å":"N","Å":"N","Å":"N","Å":"n","Å":"n","Å":"n","Å":"n","Å":"O","Å":"O","Å":"O","Å":"o","Å":"o","Å":"o","Å":"R","Å":"R","Å":"R","Å":"r","Å":"r","Å":"r","Å":"S","Å":"S","Å":"S","Å ":"S","Å":"s","Å":"s","Å":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å":"Oe","Å":"oe","Å":"'n","Å¿":"s"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeParseFloat=parseFloat,freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var freeProcess=moduleExports&&freeGlobal.process;var nodeUtil=function(){try{var types=freeModule&&freeModule.require&&freeModule.require("util").types;if(types){return types}return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();var nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array==null?0:array.length;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){var index=-1,length=array==null?0:array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array==null?0:array.length;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value}}return result}function arrayIncludes(array,value){var length=array==null?0:array.length;return!!length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){var index=-1,length=array==null?0:array.length;while(++index<length){if(comparator(value,array[index])){return true}}return false}function arrayMap(array,iteratee){var index=-1,length=array==null?0:array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array==null?0:array.length;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array==null?0:array.length;if(initAccum&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}var asciiSize=baseProperty("length");function asciiToArray(string){return string.split("")}function asciiWords(string){return string.match(reAsciiWord)||[]}function baseFindKey(collection,predicate,eachFunc){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=key;return false}});return result}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index}}return-1}function baseIsNaN(value){return value!==value}function baseMean(array,iteratee){var length=array==null?0:array.length;return length?baseSum(array,iteratee)/length:NAN}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyOf(object){return function(key){return object==null?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection)});return accumulator}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);if(current!==undefined){result=result===undefined?current:result+current}}return result}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseTrim(string){return string?string.slice(0,trimmedEndIndex(string)+1).replace(reTrimStart,""):string}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function countHolders(array,placeholder){var length=array.length,result=0;while(length--){if(array[length]===placeholder){++result}}return result}var deburrLetter=basePropertyOf(deburredLetters);var escapeHtmlChar=basePropertyOf(htmlEscapes);function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function getValue(object,key){return object==null?undefined:object[key]}function hasUnicode(string){return reHasUnicode.test(string)}function hasUnicodeWord(string){return reHasUnicodeWord.test(string)}function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done){result.push(data.value)}return result}function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value===placeholder||value===PLACEHOLDER){array[index]=PLACEHOLDER;result[resIndex++]=index}}return result}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}function setToPairs(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=[value,value]});return result}function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function strictLastIndexOf(array,value,fromIndex){var index=fromIndex+1;while(index--){if(array[index]===value){return index}}return index}function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}function stringToArray(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string)}function trimmedEndIndex(string){var index=string.length;while(index--&&reWhitespace.test(string.charAt(index))){}return index}var unescapeHtmlChar=basePropertyOf(htmlUnescapes);function unicodeSize(string){var result=reUnicode.lastIndex=0;while(reUnicode.test(string)){++result}return result}function unicodeToArray(string){return string.match(reUnicode)||[]}function unicodeWords(string){return string.match(reUnicodeWord)||[]}var runInContext=function runInContext(context){context=context==null?root:_.defaults(root.Object(),context,_.pick(root,contextProps));var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=context["__core-js_shared__"];var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var nativeObjectToString=objectProto.toString;var objectCtorString=funcToString.call(Object);var oldDash=root._;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Buffer=moduleExports?context.Buffer:undefined,Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined,symIterator=Symbol?Symbol.iterator:undefined,symToStringTag=Symbol?Symbol.toStringTag:undefined;var defineProperty=function(){try{var func=getNative(Object,"defineProperty");func({},"",{});return func}catch(e){}}();var ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout;var nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse;var DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create");var metaMap=WeakMap&&new WeakMap;var realNames={};var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto)){return{}}if(objectCreate){return objectCreate(proto)}object.prototype=proto;var result=new object;object.prototype=undefined;return result}}();function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value;this.__actions__=[];this.__chain__=!!chainAll;this.__index__=0;this.__values__=undefined}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};lodash.prototype=baseLodash.prototype;lodash.prototype.constructor=lodash;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=MAX_ARRAY_LENGTH;this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=copyArray(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=copyArray(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=copyArray(this.__views__);return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length){return baseWrapperValue(array,this.__actions__)}var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}result[resIndex++]=value}return result}LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0}function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[];this.size=0}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}--this.size;return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.size=0;this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){var result=getMapData(this,key)["delete"](key);this.size-=result?1:0;return result}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new MapCache;while(++index<length){this.add(values[index])}}function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this}function setCacheHas(value){return this.__data__.has(value)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function stackClear(){this.__data__=new ListCache;this.size=0}function stackDelete(key){var data=this.__data__,result=data["delete"](key);this.size=data.size;return result}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this}data=this.__data__=new MapCache(pairs)}data.set(key,value);this.size=data.size;return this}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isBuff&&(key=="offset"||key=="parent")||isType&&(key=="buffer"||key=="byteLength"||key=="byteOffset")||isIndex(key,length)))){result.push(key)}}return result}function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:undefined}function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length))}function arrayShuffle(array){return shuffleSelf(copyArray(array))}function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)});return accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignIn(object,source){return object&&copyObject(source,keysIn(source),object)}function baseAssignValue(object,key,value){if(key=="__proto__"&&defineProperty){defineProperty(object,key,{configurable:true,enumerable:true,value:value,writable:true})}else{object[key]=value}}function baseAt(object,paths){var index=-1,length=paths.length,result=Array(length),skip=object==null;while(++index<length){result[index]=skip?undefined:get(object,paths[index])}return result}function baseClamp(number,lower,upper){if(number===number){if(upper!==undefined){number=number<=upper?number:upper}if(lower!==undefined){number=number>=lower?number:lower}}return number}function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){result=isFlat||isFunc?{}:initCloneObject(value);if(!isDeep){return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);if(isSet(value)){value.forEach(function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))})}else if(isMap(value)){value.forEach(function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))})}var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys;var props=isArr?undefined:keysFunc(value);arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))});return result}function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}function baseConformsTo(object,source,props){var length=props.length;if(object==null){return!length}object=Object(object);while(length--){var key=props[length],predicate=source[key],value=object[key];if(value===undefined&&!(key in object)||!predicate(value)){return false}}return true}function baseDelay(func,wait,args){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result}if(iteratee){values=arrayMap(values,baseUnary(iteratee))}if(comparator){includes=arrayIncludesWith;isCommon=false}else if(values.length>=LARGE_ARRAY_SIZE){includes=cacheHas;isCommon=false;values=new SetCache(values)}outer:while(++index<length){var value=array[index],computed=iteratee==null?value:iteratee(value);value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer}}result.push(value)}else if(!includes(values,computed,comparator)){result.push(value)}}return result}var baseEach=createBaseEach(baseForOwn);var baseEachRight=createBaseEach(baseForOwnRight,true);function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value}}return result}function baseFill(array,value,start,end){var length=array.length;start=toInteger(start);if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:toInteger(end);if(end<0){end+=length}end=start>end?0:toLength(end);while(start<end){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}var baseFor=createBaseFor();var baseForRight=createBaseFor(true);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=castPath(path,object);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return object!=null&&hasOwnProperty.call(object,key)}function baseHasIn(object,key){return object!=null&&key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=arrayMap(array,baseUnary(iteratee))}maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer}}if(seen){seen.push(computed)}result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)});return accumulator}function baseInvoke(object,path,args){path=castPath(path,object);object=parent(object,path);var func=object==null?object:object[toKey(last(path))];return func==null?undefined:apply(func,object,args)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsArrayBuffer(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag}function baseIsDate(value){return isObjectLike(value)&&baseGetTag(value)==dateTag}function baseIsEqual(value,other,bitmask,customizer,stack){if(value===other){return true}if(value==null||other==null||!isObjectLike(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack)}function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag;othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other)){return false}objIsArr=true;objIsObj=false}if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack)}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag){return false}stack||(stack=new Stack);return equalObjects(object,other,bitmask,customizer,equalFunc,stack)}function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result)){return false}}}return true}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseIsRegExp(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag}function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity}if(typeof value=="object"){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object)}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue)}return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}baseFor(source,function(srcValue,key){stack||(stack=new Stack);if(isObject(srcValue)){baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(safeGet(object,key),srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}},keysIn)}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=safeGet(object,key),srcValue=safeGet(source,key),stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue;if(isArr||isBuff||isTyped){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else if(isBuff){isCommon=false;newValue=cloneBuffer(srcValue,true)}else if(isTyped){isCommon=false;newValue=cloneTypedArray(srcValue,true)}else{newValue=[]}}else if(isPlainObject(srcValue)||isArguments(srcValue)){newValue=objValue;if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||isFunction(objValue)){newValue=initCloneObject(srcValue)}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}function baseNth(array,n){var length=array.length;if(!length){return}n+=n<0?length:0;return isIndex(n,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){if(iteratees.length){iteratees=arrayMap(iteratees,function(iteratee){if(isArray(iteratee)){return function(value){return baseGet(value,iteratee.length===1?iteratee[0]:iteratee)}}return iteratee})}else{iteratees=[identity]}var index=-1;iteratees=arrayMap(iteratees,baseUnary(getIteratee()));var result=baseMap(collection,function(value,key,collection){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,paths){return basePickBy(object,paths,function(value,path){return hasIn(object,path)})}function basePickBy(object,paths,predicate){var index=-1,length=paths.length,result={};while(++index<length){var path=paths[index],value=baseGet(object,path);if(predicate(value,path)){baseSet(result,castPath(path,object),value)}}return result}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(array===values){values=copyArray(values)}if(iteratee){seen=arrayMap(array,baseUnary(iteratee))}while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1)}splice.call(array,fromIndex,1)}}return array}function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;if(isIndex(index)){splice.call(array,index,1)}else{baseUnset(array,index)}}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step}return result}function baseRepeat(string,n){var result="";if(!string||n<1||n>MAX_SAFE_INTEGER){return result}do{if(n%2){result+=string}n=nativeFloor(n/2);if(n){string+=string}}while(n);return result}function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}function baseSample(collection){return arraySample(values(collection))}function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length))}function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(key==="__proto__"||key==="constructor"||key==="prototype"){return object}if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};var baseSetToString=!defineProperty?identity:function(func,string){return defineProperty(func,"toString",{configurable:true,enumerable:false,value:constant(string),writable:true})};function baseShuffle(collection){return shuffleSelf(values(collection))}function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start}end=end>length?length:end;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=array==null?low:array.length;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(computed!==null&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)){low=mid+1}else{high=mid}}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){var low=0,high=array==null?0:array.length;if(high===0){return 0}value=iteratee(value);var valIsNaN=value!==value,valIsNull=value===null,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=computed===null,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN){var setLow=retHighest||othIsReflexive}else if(valIsUndefined){setLow=othIsReflexive&&(retHighest||othIsDefined)}else if(valIsNull){setLow=othIsReflexive&&othIsDefined&&(retHighest||!othIsNull)}else if(valIsSymbol){setLow=othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol)}else if(othIsNull||othIsSymbol){setLow=false}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array,iteratee){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=value===0?0:value}}return result}function baseToNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}return+value}function baseToString(value){if(typeof value=="string"){return value}if(isArray(value)){return arrayMap(value,baseToString)+""}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith}else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set)}isCommon=false;includes=cacheHas;seen=new SetCache}else{seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed)}result.push(value)}}return result}function baseUnset(object,path){path=castPath(path,object);object=parent(object,path);return object==null||delete object[toKey(last(path))]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}return arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2){return length?baseUniq(arrays[0]):[]}var index=-1,result=Array(length);while(++index<length){var array=arrays[index],othIndex=-1;while(++othIndex<length){if(othIndex!=index){result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator)}}}return baseUniq(baseFlatten(result,1),iteratee,comparator)}function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return typeof value=="function"?value:identity}function castPath(value,object){if(isArray(value)){return value}return isKey(value,object)?[value]:stringToPath(toString(value))}var castRest=baseRest;function castSlice(array,start,end){var length=array.length;end=end===undefined?length:end;return!start&&end>=length?array:baseSlice(array,start,end)}var clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id)};function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1}}return 0}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}var order=orders[index];return result*(order=="desc"?-1:1)}}return object.index-other.index}function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[holders[argsIndex]]=args[argsIndex]}}while(rangeLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength){result[argsIndex]=args[argsIndex]}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[offset+holders[holdersIndex]]=args[argsIndex++]}}return result}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;if(newValue===undefined){newValue=source[key]}if(isNew){baseAssignValue(object,key,newValue)}else{assignValue(object,key,newValue)}}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}function createBind(func,bitmask,thisArg){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=hasUnicode(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0);var trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(func,bitmask,arity){var Ctor=createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);while(index--){args[index]=arguments[index]}var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);length-=holders.length;if(length<arity){return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length)}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args)}return wrapper}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection);predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return flatRest(function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;if(fromRight){funcs.reverse()}while(index--){var func=funcs[index];if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(prereq&&!wrapper&&getFuncName(func)=="wrapper"){var wrapper=new LodashWrapper([],true)}}index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=="wrapper"?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(WRAP_ARY_FLAG|WRAP_CURRY_FLAG|WRAP_PARTIAL_FLAG|WRAP_REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3])}else{wrapper=func.length==1&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}}return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)){return wrapper.plant(value).value()}var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result)}return result}})}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&WRAP_ARY_FLAG,isBind=bitmask&WRAP_BIND_FLAG,isBindKey=bitmask&WRAP_BIND_KEY_FLAG,isCurried=bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG),isFlip=bitmask&WRAP_FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length;while(index--){args[index]=arguments[index]}if(isCurried){var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder)}if(partials){args=composeArgs(args,partials,holders,isCurried)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight,isCurried)}length-=holdersCount;if(isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;length=args.length;if(argPos){args=reorder(args,argPos)}else if(isFlip&&length>1){args.reverse()}if(isAry&&ary<length){args.length=ary}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtor(fn)}return fn.apply(thisBinding,args)}return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined){return defaultValue}if(value!==undefined){result=value}if(other!==undefined){if(result===undefined){return other}if(typeof value=="string"||typeof other=="string"){value=baseToString(value);other=baseToString(other)}else{value=baseToNumber(value);other=baseToNumber(other)}result=operator(value,other)}return result}}function createOver(arrayFunc){return flatRest(function(iteratees){iteratees=arrayMap(iteratees,baseUnary(getIteratee()));return baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(length,chars){chars=chars===undefined?" ":baseToString(chars);var charsLength=chars.length;if(charsLength<2){return charsLength?baseRepeat(chars,length):chars}var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createPartial(func,bitmask,thisArg,partials){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}return apply(fn,isBind?thisArg:this,args)}return wrapper}function createRange(fromRight){return function(start,end,step){if(step&&typeof step!="number"&&isIterateeCall(start,end,step)){end=step=undefined}start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}step=step===undefined?start<end?1:-1:toFinite(step);return baseRange(start,end,step,fromRight)}}function createRelationalOperation(operator){return function(value,other){if(!(typeof value=="string"&&typeof other=="string")){value=toNumber(value);other=toNumber(other)}return operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&WRAP_CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?WRAP_PARTIAL_FLAG:WRAP_PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?WRAP_PARTIAL_RIGHT_FLAG:WRAP_PARTIAL_FLAG);if(!(bitmask&WRAP_CURRY_BOUND_FLAG)){bitmask&=~(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG)}var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity];var result=wrapFunc.apply(undefined,newData);if(isLaziable(func)){setData(result,newData)}result.placeholder=placeholder;return setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){number=toNumber(number);precision=precision==null?0:nativeMin(toInteger(precision),292);if(precision&&nativeIsFinite(number)){var pair=(toString(number)+"e").split("e"),value=func(pair[0]+"e"+(+pair[1]+precision));pair=(toString(value)+"e").split("e");return+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY)?noop:function(values){return new Set(values)};function createToPairs(keysFunc){return function(object){var tag=getTag(object);if(tag==mapTag){return mapToArray(object)}if(tag==setTag){return setToPairs(object)}return baseToPairs(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&WRAP_BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(WRAP_PARTIAL_FLAG|WRAP_PARTIAL_RIGHT_FLAG);partials=holders=undefined}ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&WRAP_PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func);var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data)}func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]===undefined?isBindKey?0:func.length:nativeMax(newData[9]-length,0);if(!arity&&bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)){bitmask&=~(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)}if(!bitmask||bitmask==WRAP_BIND_FLAG){var result=createBind(func,bitmask,thisArg)}else if(bitmask==WRAP_CURRY_FLAG||bitmask==WRAP_CURRY_RIGHT_FLAG){result=createCurry(func,bitmask,arity)}else if((bitmask==WRAP_PARTIAL_FLAG||bitmask==(WRAP_BIND_FLAG|WRAP_PARTIAL_FLAG))&&!holders.length){result=createPartial(func,bitmask,thisArg,partials)}else{result=createHybrid.apply(undefined,newData)}var setter=data?baseSetData:setData;return setWrapToString(setter(result,newData),func,bitmask)}function customDefaultsAssignIn(objValue,srcValue,key,object){if(objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)){return srcValue}return objValue}function customDefaultsMerge(objValue,srcValue,key,object,source,stack){if(isObject(objValue)&&isObject(srcValue)){stack.set(srcValue,objValue);baseMerge(objValue,srcValue,undefined,customDefaultsMerge,stack);stack["delete"](srcValue)}return objValue}function customOmitClone(value){return isPlainObject(value)?undefined:value}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false}var arrStacked=stack.get(array);var othStacked=stack.get(other);if(arrStacked&&othStacked){return arrStacked==other&&othStacked==array}var index=-1,result=true,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:undefined;stack.set(array,other);stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack)}if(compared!==undefined){if(compared){continue}result=false;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){return seen.push(othIndex)}})){result=false;break}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){result=false;break}}stack["delete"](array);stack["delete"](other);return result}function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false}return true;case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false}var stacked=stack.get(object);if(stacked){return stacked==other}bitmask|=COMPARE_UNORDERED_FLAG;stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack["delete"](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other)}}return false}function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key))){return false}}var objStacked=stack.get(object);var othStacked=stack.get(other);if(objStacked&&othStacked){return objStacked==other&&othStacked==object}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack)}if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=false;break}skipCtor||(skipCtor=key=="constructor")}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){result=false}}stack["delete"](object);stack["delete"](other);return result}function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getFuncName(func){var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name}}return result}function getHolder(func){var object=hasOwnProperty.call(lodash,"placeholder")?lodash:func;return object.placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;result=result===iteratee?baseIteratee:result;return arguments.length?result(arguments[0],arguments[1]):result}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag}else{delete value[symToStringTag]}}return result}var getSymbols=!nativeGetSymbols?stubArray:function(object){if(object==null){return[]}object=Object(object);return arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)})};var getSymbolsIn=!nativeGetSymbols?stubArray:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object)}return result};var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}function hasPath(object,path,hasFunc){path=castPath(path,object);var index=-1,length=path.length,result=false;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result||++index!=length){return result}length=object==null?0:object.length;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}function initCloneArray(array){var length=array.length,result=new array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return new Ctor;case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return new Ctor;case symbolTag:return cloneSymbol(object)}}function insertWrapDetails(source,details){var length=details.length;if(!length){return source}var lastIndex=length-1;details[lastIndex]=(length>1?"& ":"")+details[lastIndex];details=details.join(length>2?", ":" ");return source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){var type=typeof value;length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(type=="number"||type!="symbol"&&reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!="function"||!(funcName in LazyWrapper.prototype)){return false}if(func===other){return true}var data=getData(other);return!!data&&func===data[0]}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function isStrictComparable(value){return value===value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}function memoizeCapped(func){var result=memoize(func,function(key){if(cache.size===MAX_MEMOIZE_SIZE){cache.clear()}return key});var cache=result.cache;return result}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG|WRAP_ARY_FLAG);var isCombo=srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_CURRY_FLAG||srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(WRAP_ARY_FLAG|WRAP_REARG_FLAG)&&source[7].length<=source[8]&&bitmask==WRAP_CURRY_FLAG;if(!(isCommon||isCombo)){return data}if(srcBitmask&WRAP_BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&WRAP_BIND_FLAG?0:WRAP_CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value;data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):value;data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]}value=source[7];if(value){data[7]=value}if(srcBitmask&WRAP_ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key)}}return result}function objectToString(value){return nativeObjectToString.call(value)}function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=transform(array);return apply(func,this,otherArgs)}}function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}function safeGet(object,key){if(key==="constructor"&&typeof object[key]==="function"){return}if(key=="__proto__"){return}return object[key]}var setData=shortOut(baseSetData);var setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait)};var setToString=shortOut(baseSetToString);function setWrapToString(wrapper,reference,bitmask){var source=reference+"";return setToString(wrapper,insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)))}function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0]}}else{count=0}return func.apply(undefined,arguments)}}function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;size=size===undefined?length:size;while(++index<size){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index];array[index]=value}array.length=size;return array}var stringToPath=memoizeCapped(function(string){var result=[];if(string.charCodeAt(0)===46){result.push("")}string.replace(rePropName,function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function updateWrapDetails(details,bitmask){arrayEach(wrapFlags,function(pair){var value="_."+pair[0];if(bitmask&pair[1]&&!arrayIncludes(details,value)){details.push(value)}});return details.sort()}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper){return wrapper.clone()}var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);result.__actions__=copyArray(wrapper.__actions__);result.__index__=wrapper.__index__;result.__values__=wrapper.__values__;return result}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size===undefined){size=1}else{size=nativeMax(toInteger(size),0)}var length=array==null?0:array.length;if(!length||size<1){return[]}var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length){result[resIndex++]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value){result[resIndex++]=value}}return result}function concat(){var length=arguments.length;if(!length){return[]}var args=Array(length-1),array=arguments[0],index=length;while(index--){args[index-1]=arguments[index]}return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1))}var difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true)):[]});var differenceBy=baseRest(function(array,values){var iteratee=last(values);if(isArrayLikeObject(iteratee)){iteratee=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),getIteratee(iteratee,2)):[]});var differenceWith=baseRest(function(array,values){var comparator=last(values);if(isArrayLikeObject(comparator)){comparator=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),undefined,comparator):[]});function drop(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,n<0?0:n,length)}function dropRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true,true):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true):[]}function fill(array,value,start,end){var length=array==null?0:array.length;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=length-1;if(fromIndex!==undefined){index=toInteger(fromIndex);index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)}return baseFindIndex(array,getIteratee(predicate,3),index,true)}function flatten(array){var length=array==null?0:array.length;return length?baseFlatten(array,1):[]}function flattenDeep(array){var length=array==null?0:array.length;return length?baseFlatten(array,INFINITY):[]}function flattenDepth(array,depth){var length=array==null?0:array.length;if(!length){return[]}depth=depth===undefined?1:toInteger(depth);return baseFlatten(array,depth)}function fromPairs(pairs){var index=-1,length=pairs==null?0:pairs.length,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array&&array.length?array[0]:undefined}function indexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseIndexOf(array,value,index)}function initial(array){var length=array==null?0:array.length;return length?baseSlice(array,0,-1):[]}var intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]});var intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(iteratee===last(mapped)){iteratee=undefined}else{mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]});var intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);comparator=typeof comparator=="function"?comparator:undefined;if(comparator){mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]});function join(array,separator){return array==null?"":nativeJoin.call(array,separator)}function last(array){var length=array==null?0:array.length;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=length;if(fromIndex!==undefined){index=toInteger(fromIndex);index=index<0?nativeMax(length+index,0):nativeMin(index,length-1)}return value===value?strictLastIndexOf(array,value,index):baseFindIndex(array,baseIsNaN,index,true)}function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array}function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array}var pullAt=flatRest(function(array,indexes){var length=array==null?0:array.length,result=baseAt(array,indexes);basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending));return result});function remove(array,predicate){var result=[];if(!(array&&array.length)){return result}var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index)}}basePullAt(array,indexes);return result}function reverse(array){return array==null?array:nativeReverse.call(array)}function slice(array,start,end){var length=array==null?0:array.length;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}else{start=start==null?0:toInteger(start);end=end===undefined?length:toInteger(end)}return baseSlice(array,start,end)}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))}function sortedIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value)){return index}}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,true)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),true)}function sortedLastIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value,true)-1;if(eq(array[index],value)){return index}}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]}function tail(array){var length=array==null?0:array.length;return length?baseSlice(array,1,length):[]}function take(array,n,guard){if(!(array&&array.length)){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,n<0?0:n,length)}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),false,true):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true))});var unionBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),getIteratee(iteratee,2))});var unionWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=="function"?comparator:undefined;return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),undefined,comparator)});function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]}function uniqWith(array,comparator){comparator=typeof comparator=="function"?comparator:undefined;return array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!(array&&array.length)){return[]}var length=0;array=arrayFilter(array,function(group){if(isArrayLikeObject(group)){length=nativeMax(group.length,length);return true}});return baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!(array&&array.length)){return[]}var result=unzip(array);if(iteratee==null){return result}return arrayMap(result,function(group){return apply(iteratee,undefined,group)})}var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]});var xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))});var xorBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))});var xorWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=="function"?comparator:undefined;return baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)});var zip=baseRest(unzip);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}var zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;iteratee=typeof iteratee=="function"?(arrays.pop(),iteratee):undefined;return unzipWith(arrays,iteratee)});function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor){interceptor(value);return value}function thru(value,interceptor){return interceptor(value)}var wrapperAt=flatRest(function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};if(length>1||this.__actions__.length||!(value instanceof LazyWrapper)||!isIndex(start)){return this.thru(interceptor)}value=value.slice(start,+start+(length?1:0));value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(value,this.__chain__).thru(function(array){if(length&&!array.length){array.push(undefined)}return array})});function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){if(this.__values__===undefined){this.__values__=toArray(this.value())}var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{done:done,value:value}}function wrapperToIterator(){return this}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0;clone.__values__=undefined;if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this)}wrapped=wrapped.reverse();wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined});return new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var countBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){++result[key]}else{baseAssignValue(result,key,1)}});function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3))}var find=createFind(findIndex);var findLast=createFind(findLastIndex);function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1)}function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY)}function flatMapDepth(collection,iteratee,depth){depth=depth===undefined?1:toInteger(depth);return baseFlatten(map(collection,iteratee),depth)}function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){var func=isArray(collection)?arrayEachRight:baseEachRight;return func(collection,getIteratee(iteratee,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{baseAssignValue(result,key,[value])}});function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0)}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}var invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc=typeof path=="function",result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args)});return result});var keyBy=createAggregator(function(result,value,key){baseAssignValue(result,key,value)});function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){if(collection==null){return[]}if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees]}orders=guard?undefined:orders;if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseOrderBy(collection,iteratees,orders)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,negate(getIteratee(predicate,3)))}function sample(collection){var func=isArray(collection)?arraySample:baseSample;return func(collection)}function sampleSize(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n===undefined){n=1}else{n=toInteger(n)}var func=isArray(collection)?arraySampleSize:baseSampleSize;return func(collection,n)}function shuffle(collection){var func=isArray(collection)?arrayShuffle:baseShuffle;return func(collection)}function size(collection){if(collection==null){return 0}if(isArrayLike(collection)){return isString(collection)?stringSize(collection):collection.length}var tag=getTag(collection);if(tag==mapTag||tag==setTag){return collection.size}return baseKeys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}var sortBy=baseRest(function(collection,iteratees){if(collection==null){return[]}var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[]}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees=[iteratees[0]]}return baseOrderBy(collection,baseFlatten(iteratees,1),[])});var now=ctxNow||function(){return root.Date.now()};function after(n,func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){n=guard?undefined:n;n=func&&n==null?func.length:n;return createWrap(func,WRAP_ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n>0){result=func.apply(this,arguments)}if(n<=1){func=undefined}return result}}var bind=baseRest(function(func,thisArg,partials){var bitmask=WRAP_BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(func,bitmask,thisArg,partials,holders)});var bindKey=baseRest(function(object,key,partials){var bitmask=WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(key,bitmask,object,partials,holders)});function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,timeWaiting=wait-timeSinceLastCall;return maxing?nativeMin(timeWaiting,maxWait-timeSinceLastInvoke):timeWaiting}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){clearTimeout(timerId);timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}var defer=baseRest(function(func,args){return baseDelay(func,1,args)});var delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)});function flip(func){return createWrap(func,WRAP_FLIP_FLAG)}function memoize(func,resolver){if(typeof func!="function"||resolver!=null&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}function once(func){return before(2,func)}var overArgs=castRest(function(func,transforms){transforms=transforms.length==1&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length){args[index]=transforms[index].call(this,args[index])}return apply(func,this,args)})});var partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,WRAP_PARTIAL_FLAG,undefined,partials,holders)});var partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,WRAP_PARTIAL_RIGHT_FLAG,undefined,partials,holders)});var rearg=flatRest(function(func,indexes){return createWrap(func,WRAP_REARG_FLAG,undefined,undefined,undefined,indexes)});function rest(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start===undefined?start:toInteger(start);return baseRest(func,start)}function spread(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start==null?0:nativeMax(toInteger(start),0);return baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);if(array){arrayPush(otherArgs,array)}return apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){return partial(castFunction(wrapper),value)}function castArray(){if(!arguments.length){return[]}var value=arguments[0];return isArray(value)?value:[value]}function clone(value){return baseClone(value,CLONE_SYMBOLS_FLAG)}function cloneWith(value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseClone(value,CLONE_SYMBOLS_FLAG,customizer)}function cloneDeep(value){return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}function cloneDeepWith(value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,customizer)}function conformsTo(object,source){return source==null||baseConformsTo(object,source,keys(source))}function eq(value,other){return value===other||value!==value&&other!==other}var gt=createRelationalOperation(baseGt);var gte=createRelationalOperation(function(value,other){return value>=other});var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};var isArray=Array.isArray;var isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return value===true||value===false||isObjectLike(value)&&baseGetTag(value)==boolTag}var isBuffer=nativeIsBuffer||stubFalse;var isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate;function isElement(value){return isObjectLike(value)&&value.nodeType===1&&!isPlainObject(value)}function isEmpty(value){if(value==null){return true}if(isArrayLike(value)&&(isArray(value)||typeof value=="string"||typeof value.splice=="function"||isBuffer(value)||isTypedArray(value)||isArguments(value))){return!value.length}var tag=getTag(value);if(tag==mapTag||tag==setTag){return!value.size}if(isPrototype(value)){return!baseKeys(value).length}for(var key in value){if(hasOwnProperty.call(value,key)){return false}}return true}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer=typeof customizer=="function"?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,undefined,customizer):!!result}function isError(value){if(!isObjectLike(value)){return false}var tag=baseGetTag(value);return tag==errorTag||tag==domExcTag||typeof value.message=="string"&&typeof value.name=="string"&&!isPlainObject(value)}function isFinite(value){return typeof value=="number"&&nativeIsFinite(value)}function isFunction(value){if(!isObject(value)){return false}var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}function isInteger(value){return typeof value=="number"&&value==toInteger(value)}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return value!=null&&(type=="object"||type=="function")}function isObjectLike(value){return value!=null&&typeof value=="object"}var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(isMaskable(value)){throw new Error(CORE_ERROR_TEXT)}return baseIsNative(value)}function isNull(value){return value===null}function isNil(value){return value==null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&baseGetTag(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp;function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&baseGetTag(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;function isUndefined(value){return value===undefined}function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag}function isWeakSet(value){return isObjectLike(value)&&baseGetTag(value)==weakSetTag}var lt=createRelationalOperation(baseLt);var lte=createRelationalOperation(function(value,other){return value<=other});function toArray(value){if(!value){return[]}if(isArrayLike(value)){return isString(value)?stringToArray(value):copyArray(value)}if(symIterator&&value[symIterator]){return iteratorToArray(value[symIterator]())}var tag=getTag(value),func=tag==mapTag?mapToArray:tag==setTag?setToArray:values;return func(value)}function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return value?baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER):value===0?value:0}function toString(value){return value==null?"":baseToString(value)}var assign=createAssigner(function(object,source){if(isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key])}}});var assignIn=createAssigner(function(object,source){copyObject(source,keysIn(source),object)});var assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)});var assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)});var at=flatRest(baseAt);function create(prototype,properties){var result=baseCreate(prototype);return properties==null?result:baseAssign(result,properties)}var defaults=baseRest(function(object,sources){object=Object(object);var index=-1;var length=sources.length;var guard=length>2?sources[2]:undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){length=1}while(++index<length){var source=sources[index];var props=keysIn(source);var propsIndex=-1;var propsLength=props.length;while(++propsIndex<propsLength){var key=props[propsIndex];var value=object[key];if(value===undefined||eq(value,objectProto[key])&&!hasOwnProperty.call(object,key)){object[key]=source[key]}}}return object});var defaultsDeep=baseRest(function(args){args.push(undefined,customDefaultsMerge);return apply(mergeWith,undefined,args)});function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)}function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)}function forIn(object,iteratee){return object==null?object:baseFor(object,getIteratee(iteratee,3),keysIn)}function forInRight(object,iteratee){return object==null?object:baseForRight(object,getIteratee(iteratee,3),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))}function functions(object){return object==null?[]:baseFunctions(object,keys(object))}function functionsIn(object){return object==null?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return object!=null&&hasPath(object,path,baseHas)}function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}var invert=createInverter(function(result,value,key){if(value!=null&&typeof value.toString!="function"){value=nativeObjectToString.call(value)}result[value]=key},constant(identity));var invertBy=createInverter(function(result,value,key){if(value!=null&&typeof value.toString!="function"){value=nativeObjectToString.call(value)}if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}},getIteratee);var invoke=baseRest(baseInvoke);function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object)}function mapKeys(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value)});return result}function mapValues(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))});return result}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)});var mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)});var omit=flatRest(function(object,paths){var result={};if(object==null){return result}var isDeep=false;paths=arrayMap(paths,function(path){path=castPath(path,object);isDeep||(isDeep=path.length>1);return path});copyObject(object,getAllKeysIn(object),result);if(isDeep){result=baseClone(result,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone)}var length=paths.length;while(length--){baseUnset(result,paths[length])}return result});function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)))}var pick=flatRest(function(object,paths){return object==null?{}:basePick(object,paths)});function pickBy(object,predicate){if(object==null){return{}}var props=arrayMap(getAllKeysIn(object),function(prop){return[prop]});predicate=getIteratee(predicate);return basePickBy(object,props,function(value,path){return predicate(value,path[0])})}function result(object,path,defaultValue){path=castPath(path,object);var index=-1,length=path.length;if(!length){length=1;object=undefined}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue}object=isFunction(value)?value.call(object):value}return object}function set(object,path,value){return object==null?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer)}var toPairs=createToPairs(keys);var toPairsIn=createToPairs(keysIn);function transform(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);iteratee=getIteratee(iteratee,4);if(accumulator==null){var Ctor=object&&object.constructor;if(isArrLike){accumulator=isArr?new Ctor:[]}else if(isObject(object)){accumulator=isFunction(Ctor)?baseCreate(getPrototype(object)):{}}else{accumulator={}}}(isArrLike?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function unset(object,path){return object==null?true:baseUnset(object,path)}function update(object,path,updater){return object==null?object:baseUpdate(object,path,castFunction(updater))}function updateWith(object,path,updater,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseUpdate(object,path,castFunction(updater),customizer)}function values(object){return object==null?[]:baseValues(object,keys(object))}function valuesIn(object){return object==null?[]:baseValues(object,keysIn(object))}function clamp(number,lower,upper){if(upper===undefined){upper=lower;lower=undefined}if(upper!==undefined){upper=toNumber(upper);upper=upper===upper?upper:0}if(lower!==undefined){lower=toNumber(lower);lower=lower===lower?lower:0}return baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}number=toNumber(number);return baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&typeof floating!="boolean"&&isIterateeCall(lower,upper,floating)){upper=floating=undefined}if(floating===undefined){if(typeof upper=="boolean"){floating=upper;upper=undefined}else if(typeof lower=="boolean"){floating=lower;lower=undefined}}if(lower===undefined&&upper===undefined){lower=0;upper=1}else{lower=toFinite(lower);if(upper===undefined){upper=lower;lower=0}else{upper=toFinite(upper)}}if(lower>upper){var temp=lower;lower=upper;upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?capitalize(word):word)});function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){string=toString(string);return string&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string);target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;position-=target.length;return position>=0&&string.slice(position,end)==target}function escape(string){string=toString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=toString(string);return string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});var lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()});var lowerFirst=createCaseFirst("toLowerCase");function pad(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length){return string}var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)}function padEnd(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}function padStart(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}function parseInt(string,radix,guard){if(guard||radix==null){radix=0}else if(radix){radix=+radix}return nativeParseInt(toString(string).replace(reTrimStart,""),radix||0)}function repeat(string,n,guard){if(guard?isIterateeCall(string,n,guard):n===undefined){n=1}else{n=toInteger(n)}return baseRepeat(toString(string),n)}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});function split(string,separator,limit){if(limit&&typeof limit!="number"&&isIterateeCall(string,separator,limit)){separator=limit=undefined}limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0;if(!limit){return[]}string=toString(string);if(string&&(typeof separator=="string"||separator!=null&&!isRegExp(separator))){separator=baseToString(separator);if(!separator&&hasUnicode(string)){return castSlice(stringToArray(string),0,limit)}}return string.split(separator,limit)}var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+upperFirst(word)});function startsWith(string,target,position){string=toString(string);position=position==null?0:baseClamp(toInteger(position),0,string.length);target=baseToString(target);return string.slice(position,position+target.length)==target}function template(string,options,guard){var settings=lodash.templateSettings;if(guard&&isIterateeCall(string,options,guard)){options=undefined}string=toString(string);options=assignInWith({},options,settings,customDefaultsAssignIn);var imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+(hasOwnProperty.call(options,"sourceURL")?(options.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=hasOwnProperty.call(options,"variable")&&options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}else if(reForbiddenIdentifierChars.test(variable)){throw new Error(INVALID_TEMPL_VAR_ERROR_TEXT)}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return baseTrim(string)}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars),start=charsStartIndex(strSymbols,chrSymbols),end=charsEndIndex(strSymbols,chrSymbols)+1;return castSlice(strSymbols,start,end).join("")}function trimEnd(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.slice(0,trimmedEndIndex(string)+1)}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),end=charsEndIndex(strSymbols,stringToArray(chars))+1;return castSlice(strSymbols,0,end).join("")}function trimStart(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimStart,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),start=charsStartIndex(strSymbols,stringToArray(chars));return castSlice(strSymbols,start).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length;omission="omission"in options?baseToString(options.omission):omission}string=toString(string);var strLength=string.length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength){return string}var end=length-stringSize(omission);if(end<1){return omission}var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(separator===undefined){return result+omission}if(strSymbols){end+=result.length-end}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;if(!separator.global){separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){var newEnd=match.index}result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=toString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}var upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()});var upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){string=toString(string);pattern=guard?undefined:pattern;if(pattern===undefined){return hasUnicodeWord(string)?unicodeWords(string):asciiWords(string)}return string.match(pattern)||[]}var attempt=baseRest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}});var bindAll=flatRest(function(object,methodNames){arrayEach(methodNames,function(key){key=toKey(key);baseAssignValue(object,key,bind(object[key],object))});return object});function cond(pairs){var length=pairs==null?0:pairs.length,toIteratee=getIteratee();pairs=!length?[]:arrayMap(pairs,function(pair){if(typeof pair[1]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return[toIteratee(pair[0]),pair[1]]});return baseRest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args)){return apply(pair[1],this,args)}}})}function conforms(source){return baseConforms(baseClone(source,CLONE_DEEP_FLAG))}function constant(value){return function(){return value}}function defaultTo(value,defaultValue){return value==null||value!==value?defaultValue:value}var flow=createFlow();var flowRight=createFlow(true);function identity(value){return value}function iteratee(func){return baseIteratee(typeof func=="function"?func:baseClone(func,CLONE_DEEP_FLAG))}function matches(source){return baseMatches(baseClone(source,CLONE_DEEP_FLAG))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,CLONE_DEEP_FLAG))}var method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args)}});var methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args)}});function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);if(options==null&&!(isObject(source)&&(methodNames.length||!props.length))){options=source;source=object;object=this;methodNames=baseFunctions(source,keys(source))}var chain=!(isObject(options)&&"chain"in options)||!!options.chain,isFunc=isFunction(object);arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);actions.push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}return func.apply(object,arrayPush([this.value()],arguments))}}});return object}function noConflict(){if(root._===this){root._=oldDash}return this}function noop(){}function nthArg(n){n=toInteger(n);return baseRest(function(args){return baseNth(args,n)})}var over=createOver(arrayMap);var overEvery=createOver(arrayEvery);var overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function propertyOf(object){return function(path){return object==null?undefined:baseGet(object,path)}}var range=createRange();var rangeRight=createRange(true);function stubArray(){return[]}function stubFalse(){return false}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return true}function times(n,iteratee){n=toInteger(n);if(n<1||n>MAX_SAFE_INTEGER){return[]}var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee);n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n){iteratee(index)}return result}function toPath(value){if(isArray(value)){return arrayMap(value,toKey)}return isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}var add=createMathOperation(function(augend,addend){return augend+addend},0);var ceil=createRound("ceil");var divide=createMathOperation(function(dividend,divisor){return dividend/divisor},1);var floor=createRound("floor");function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined}function mean(array){return baseMean(array,identity)}function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2))}function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined}var multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand},1);var round=createRound("round");var subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend},0);function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0}lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.assignIn=assignIn;lodash.assignInWith=assignInWith;lodash.assignWith=assignWith;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.castArray=castArray;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.concat=concat;lodash.cond=cond;lodash.conforms=conforms;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.differenceBy=differenceBy;lodash.differenceWith=differenceWith;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatMap=flatMap;lodash.flatMapDeep=flatMapDeep;lodash.flatMapDepth=flatMapDepth;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flattenDepth=flattenDepth;lodash.flip=flip;lodash.flow=flow;lodash.flowRight=flowRight;lodash.fromPairs=fromPairs;lodash.functions=functions;lodash.functionsIn=functionsIn;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.intersectionBy=intersectionBy;lodash.intersectionWith=intersectionWith;lodash.invert=invert;lodash.invertBy=invertBy;lodash.invokeMap=invokeMap;lodash.iteratee=iteratee;lodash.keyBy=keyBy;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mergeWith=mergeWith;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.negate=negate;lodash.nthArg=nthArg;lodash.omit=omit;lodash.omitBy=omitBy;lodash.once=once;lodash.orderBy=orderBy;lodash.over=over;lodash.overArgs=overArgs;lodash.overEvery=overEvery;lodash.overSome=overSome;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pickBy=pickBy;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAll=pullAll;lodash.pullAllBy=pullAllBy;lodash.pullAllWith=pullAllWith;lodash.pullAt=pullAt;lodash.range=range;lodash.rangeRight=rangeRight;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.reverse=reverse;lodash.sampleSize=sampleSize;lodash.set=set;lodash.setWith=setWith;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortedUniq=sortedUniq;lodash.sortedUniqBy=sortedUniqBy;lodash.split=split;lodash.spread=spread;lodash.tail=tail;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.toArray=toArray;lodash.toPairs=toPairs;lodash.toPairsIn=toPairsIn;lodash.toPath=toPath;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.unary=unary;lodash.union=union;lodash.unionBy=unionBy;lodash.unionWith=unionWith;lodash.uniq=uniq;lodash.uniqBy=uniqBy;lodash.uniqWith=uniqWith;lodash.unset=unset;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.update=update;lodash.updateWith=updateWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.without=without;lodash.words=words;lodash.wrap=wrap;lodash.xor=xor;lodash.xorBy=xorBy;lodash.xorWith=xorWith;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipObjectDeep=zipObjectDeep;lodash.zipWith=zipWith;lodash.entries=toPairs;lodash.entriesIn=toPairsIn;lodash.extend=assignIn;lodash.extendWith=assignInWith;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clamp=clamp;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.cloneDeepWith=cloneDeepWith;lodash.cloneWith=cloneWith;lodash.conformsTo=conformsTo;lodash.deburr=deburr;lodash.defaultTo=defaultTo;lodash.divide=divide;lodash.endsWith=endsWith;lodash.eq=eq;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.floor=floor;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.hasIn=hasIn;lodash.head=head;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isArrayBuffer=isArrayBuffer;lodash.isArrayLike=isArrayLike;lodash.isArrayLikeObject=isArrayLikeObject;lodash.isBoolean=isBoolean;lodash.isBuffer=isBuffer;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isEqualWith=isEqualWith;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isInteger=isInteger;lodash.isLength=isLength;lodash.isMap=isMap;lodash.isMatch=isMatch;lodash.isMatchWith=isMatchWith;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNil=isNil;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isObjectLike=isObjectLike;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isSafeInteger=isSafeInteger;lodash.isSet=isSet;lodash.isString=isString;lodash.isSymbol=isSymbol;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.isWeakMap=isWeakMap;lodash.isWeakSet=isWeakSet;lodash.join=join;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lowerCase=lowerCase;lodash.lowerFirst=lowerFirst;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.maxBy=maxBy;lodash.mean=mean;lodash.meanBy=meanBy;lodash.min=min;lodash.minBy=minBy;lodash.stubArray=stubArray;lodash.stubFalse=stubFalse;lodash.stubObject=stubObject;lodash.stubString=stubString;lodash.stubTrue=stubTrue;lodash.multiply=multiply;lodash.nth=nth;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padEnd=padEnd;lodash.padStart=padStart;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.replace=replace;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.sample=sample;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedIndexBy=sortedIndexBy;lodash.sortedIndexOf=sortedIndexOf;lodash.sortedLastIndex=sortedLastIndex;lodash.sortedLastIndexBy=sortedLastIndexBy;lodash.sortedLastIndexOf=sortedLastIndexOf;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.subtract=subtract;lodash.sum=sum;lodash.sumBy=sumBy;lodash.template=template;lodash.times=times;lodash.toFinite=toFinite;lodash.toInteger=toInteger;lodash.toLength=toLength;lodash.toLower=toLower;lodash.toNumber=toNumber;lodash.toSafeInteger=toSafeInteger;lodash.toString=toString;lodash.toUpper=toUpper;lodash.trim=trim;lodash.trimEnd=trimEnd;lodash.trimStart=trimStart;lodash.truncate=truncate;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.upperCase=upperCase;lodash.upperFirst=upperFirst;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.first=head;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!hasOwnProperty.call(lodash.prototype,methodName)){source[methodName]=func}});return source}(),{chain:false});lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();if(result.__filtered__){result.__takeCount__=nativeMin(n,result.__takeCount__)}else{result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}});arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type});result.__filtered__=result.__filtered__||isFilter;return result}});arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()};LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)};LazyWrapper.prototype.invokeMap=baseRest(function(path,args){if(typeof path=="function"){return new LazyWrapper(this)}return this.map(function(value){return baseInvoke(value,path,args)})});LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))};LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result)}if(start<0){result=result.takeRight(-start)}else if(start){result=result.drop(start)}if(end!==undefined){end=toInteger(end);result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()};LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+(methodName=="last"?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);if(!lodashFunc){return}lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);var interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(result,chainAll)}if(isUnwrapped&&onlyLazy){return func.apply(this,args)}result=this.thru(interceptor);return isUnwrapped?isTaker?result.value()[0]:result.value():result}});arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args)})}});baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"";if(!hasOwnProperty.call(realNames,key)){realNames[key]=[]}realNames[key].push({name:methodName,func:lodashFunc})}});realNames[createHybrid(undefined,WRAP_BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}];LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.at=wrapperAt;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.next=wrapperNext;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.first=lodash.prototype.head;if(symIterator){lodash.prototype[symIterator]=wrapperToIterator}return lodash};var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root._=_;define(function(){return _})}else if(freeModule){(freeModule.exports=_)._=_;freeExports._=_}else{root._=_}}).call(this);(function(factory){var root=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)})}else if(typeof exports!=="undefined"){var _=require("underscore"),$;try{$=require("jquery")}catch(e){}factory(root,exports,_,$)}else{root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}})(function(root,Backbone,_,$){var previousBackbone=root.Backbone;var slice=Array.prototype.slice;Backbone.VERSION="1.4.1";Backbone.$=$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={};var eventSplitter=/\s+/;var _listening;var eventsApi=function(iteratee,events,name,callback,opts){var i=0,names;if(name&&typeof name==="object"){if(callback!==void 0&&"context"in opts&&opts.context===void 0)opts.context=callback;for(names=_.keys(name);i<names.length;i++){events=eventsApi(iteratee,events,names[i],name[names[i]],opts)}}else if(name&&eventSplitter.test(name)){for(names=name.split(eventSplitter);i<names.length;i++){events=iteratee(events,names[i],callback,opts)}}else{events=iteratee(events,name,callback,opts)}return events};Events.on=function(name,callback,context){this._events=eventsApi(onApi,this._events||{},name,callback,{context:context,ctx:this,listening:_listening});if(_listening){var listeners=this._listeners||(this._listeners={});listeners[_listening.id]=_listening;_listening.interop=false}return this};Events.listenTo=function(obj,name,callback){if(!obj)return this;var id=obj._listenId||(obj._listenId=_.uniqueId("l"));var listeningTo=this._listeningTo||(this._listeningTo={});var listening=_listening=listeningTo[id];if(!listening){this._listenId||(this._listenId=_.uniqueId("l"));listening=_listening=listeningTo[id]=new Listening(this,obj)}var error=tryCatchOn(obj,name,callback,this);_listening=void 0;if(error)throw error;if(listening.interop)listening.on(name,callback);return this};var onApi=function(events,name,callback,options){if(callback){var handlers=events[name]||(events[name]=[]);var context=options.context,ctx=options.ctx,listening=options.listening;if(listening)listening.count++;handlers.push({callback:callback,context:context,ctx:context||ctx,listening:listening})}return events};var tryCatchOn=function(obj,name,callback,context){try{obj.on(name,callback,context)}catch(e){return e}};Events.off=function(name,callback,context){if(!this._events)return this;this._events=eventsApi(offApi,this._events,name,callback,{context:context,listeners:this._listeners});return this};Events.stopListening=function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var ids=obj?[obj._listenId]:_.keys(listeningTo);for(var i=0;i<ids.length;i++){var listening=listeningTo[ids[i]];if(!listening)break;listening.obj.off(name,callback,this);if(listening.interop)listening.off(name,callback)}if(_.isEmpty(listeningTo))this._listeningTo=void 0;return this};var offApi=function(events,name,callback,options){if(!events)return;var context=options.context,listeners=options.listeners;var i=0,names;if(!name&&!context&&!callback){for(names=_.keys(listeners);i<names.length;i++){listeners[names[i]].cleanup()}return}names=name?[name]:_.keys(events);for(;i<names.length;i++){name=names[i];var handlers=events[name];if(!handlers)break;var remaining=[];for(var j=0;j<handlers.length;j++){var handler=handlers[j];if(callback&&callback!==handler.callback&&callback!==handler.callback._callback||context&&context!==handler.context){remaining.push(handler)}else{var listening=handler.listening;if(listening)listening.off(name,callback)}}if(remaining.length){events[name]=remaining}else{delete events[name]}}return events};Events.once=function(name,callback,context){var events=eventsApi(onceMap,{},name,callback,this.off.bind(this));if(typeof name==="string"&&context==null)callback=void 0;return this.on(events,callback,context)};Events.listenToOnce=function(obj,name,callback){var events=eventsApi(onceMap,{},name,callback,this.stopListening.bind(this,obj));return this.listenTo(obj,events)};var onceMap=function(map,name,callback,offer){if(callback){var once=map[name]=_.once(function(){offer(name,once);callback.apply(this,arguments)});once._callback=callback}return map};Events.trigger=function(name){if(!this._events)return this;var length=Math.max(0,arguments.length-1);var args=Array(length);for(var i=0;i<length;i++)args[i]=arguments[i+1];eventsApi(triggerApi,this._events,name,void 0,args);return this};var triggerApi=function(objEvents,name,callback,args){if(objEvents){var events=objEvents[name];var allEvents=objEvents.all;if(events&&allEvents)allEvents=allEvents.slice();if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,[name].concat(args))}return objEvents};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);return}};var Listening=function(listener,obj){this.id=listener._listenId;this.listener=listener;this.obj=obj;this.interop=true;this.count=0;this._events=void 0};Listening.prototype.on=Events.on;Listening.prototype.off=function(name,callback){var cleanup;if(this.interop){this._events=eventsApi(offApi,this._events,name,callback,{context:void 0,listeners:void 0});cleanup=!this._events}else{this.count--;cleanup=this.count===0}if(cleanup)this.cleanup()};Listening.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId];if(!this.interop)delete this.obj._listeners[this.id]};Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.preinitialize.apply(this,arguments);this.cid=_.uniqueId(this.cidPrefix);this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};var defaults=_.result(this,"defaults");attrs=_.defaults(_.extend({},defaults,attrs),defaults);this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},matches:function(attrs){return!!_.iteratee(attrs,this)(this.attributes)},set:function(key,val,options){if(key==null)return this;var attrs;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;var unset=options.unset;var silent=options.silent;var changes=[];var changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}var current=this.attributes;var changed=this.changed;var prev=this._previousAttributes;for(var attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){changed[attr]=val}else{delete changed[attr]}unset?delete current[attr]:current[attr]=val}if(this.idAttribute in attrs){var prevId=this.id;this.id=this.get(this.idAttribute);this.trigger("changeId",this,prevId,options)}if(!silent){if(changes.length)this._pending=options;for(var i=0;i<changes.length;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){options=this._pending;this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var old=this._changing?this._previousAttributes:this.attributes;var changed={};var hasChanged;for(var attr in diff){var val=diff[attr];if(_.isEqual(old[attr],val))continue;changed[attr]=val;hasChanged=true}return hasChanged?changed:false},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=_.extend({parse:true},options);var model=this;var success=options.success;options.success=function(resp){var serverAttrs=options.parse?model.parse(resp,options):resp;if(!model.set(serverAttrs,options))return false;if(success)success.call(options.context,model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options=_.extend({validate:true,parse:true},options);var wait=options.wait;if(attrs&&!wait){if(!this.set(attrs,options))return false}else if(!this._validate(attrs,options)){return false}var model=this;var success=options.success;var attributes=this.attributes;options.success=function(resp){model.attributes=attributes;var serverAttrs=options.parse?model.parse(resp,options):resp;if(wait)serverAttrs=_.extend({},attrs,serverAttrs);if(serverAttrs&&!model.set(serverAttrs,options))return false;if(success)success.call(options.context,model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);if(attrs&&wait)this.attributes=_.extend({},attributes,attrs);var method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch"&&!options.attrs)options.attrs=attrs;var xhr=this.sync(method,this,options);this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var wait=options.wait;var destroy=function(){model.stopListening();model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(wait)destroy();if(success)success.call(options.context,model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};var xhr=false;if(this.isNew()){_.defer(options.success)}else{wrapError(this,options);xhr=this.sync("delete",this,options)}if(!wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;var id=this.get(this.idAttribute);return base.replace(/[^\/]$/,"$&/")+encodeURIComponent(id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend({},options,{validate:true}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options,{validationError:error}));return false}});var Collection=Backbone.Collection=function(models,options){options||(options={});this.preinitialize.apply(this,arguments);if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};var splice=function(array,insert,at){at=Math.min(Math.max(at,0),array.length);var tail=Array(array.length-at);var length=insert.length;var i;for(i=0;i<tail.length;i++)tail[i]=array[i+at];for(i=0;i<length;i++)array[i+at]=insert[i];for(i=0;i<tail.length;i++)array[i+length+at]=tail[i]};_.extend(Collection.prototype,Events,{model:Model,preinitialize:function(){},initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions))},remove:function(models,options){options=_.extend({},options);var singular=!_.isArray(models);models=singular?[models]:models.slice();var removed=this._removeModels(models,options);if(!options.silent&&removed.length){options.changes={added:[],merged:[],removed:removed};this.trigger("update",this,options)}return singular?removed[0]:removed},set:function(models,options){if(models==null)return;options=_.extend({},setOptions,options);if(options.parse&&!this._isModel(models)){models=this.parse(models,options)||[]}var singular=!_.isArray(models);models=singular?[models]:models.slice();var at=options.at;if(at!=null)at=+at;if(at>this.length)at=this.length;if(at<0)at+=this.length+1;var set=[];var toAdd=[];var toMerge=[];var toRemove=[];var modelMap={};var add=options.add;var merge=options.merge;var remove=options.remove;var sort=false;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var model,i;for(i=0;i<models.length;i++){model=models[i];var existing=this.get(model);if(existing){if(merge&&model!==existing){var attrs=this._isModel(model)?model.attributes:model;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);toMerge.push(existing);if(sortable&&!sort)sort=existing.hasChanged(sortAttr)}if(!modelMap[existing.cid]){modelMap[existing.cid]=true;set.push(existing)}models[i]=existing}else if(add){model=models[i]=this._prepareModel(model,options);if(model){toAdd.push(model);this._addReference(model,options);modelMap[model.cid]=true;set.push(model)}}}if(remove){for(i=0;i<this.length;i++){model=this.models[i];if(!modelMap[model.cid])toRemove.push(model)}if(toRemove.length)this._removeModels(toRemove,options)}var orderChanged=false;var replace=!sortable&&add&&remove;if(set.length&&replace){orderChanged=this.length!==set.length||_.some(this.models,function(m,index){return m!==set[index]});this.models.length=0;splice(this.models,set,0);this.length=this.models.length}else if(toAdd.length){if(sortable)sort=true;splice(this.models,toAdd,at==null?this.length:at);this.length=this.models.length}if(sort)this.sort({silent:true});if(!options.silent){for(i=0;i<toAdd.length;i++){if(at!=null)options.index=at+i;model=toAdd[i];model.trigger("add",model,this,options)}if(sort||orderChanged)this.trigger("sort",this,options);if(toAdd.length||toRemove.length||toMerge.length){options.changes={added:toAdd,removed:toRemove,merged:toMerge};this.trigger("update",this,options)}}return singular?models[0]:models},reset:function(models,options){options=options?_.clone(options):{};for(var i=0;i<this.models.length;i++){this._removeReference(this.models[i],options)}options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options)},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options)},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(obj==null)return void 0;return this._byId[obj]||this._byId[this.modelId(this._isModel(obj)?obj.attributes:obj,obj.idAttribute)]||obj.cid&&this._byId[obj.cid]},has:function(obj){return this.get(obj)!=null},at:function(index){if(index<0)index+=this.length;return this.models[index]},where:function(attrs,first){return this[first?"find":"filter"](attrs)},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){var comparator=this.comparator;if(!comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});var length=comparator.length;if(_.isFunction(comparator))comparator=comparator.bind(this);if(length===1||_.isString(comparator)){this.models=this.sortBy(comparator)}else{this.models.sort(comparator)}if(!options.silent)this.trigger("sort",this,options);return this},pluck:function(attr){return this.map(attr+"")},fetch:function(options){options=_.extend({parse:true},options);var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success.call(options.context,collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};var wait=options.wait;model=this._prepareModel(model,options);if(!model)return false;if(!wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(m,resp,callbackOpts){if(wait)collection.add(m,callbackOpts);if(success)success.call(callbackOpts.context,m,resp,callbackOpts)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(attrs,idAttribute){return attrs[idAttribute||this.model.prototype.idAttribute||"id"]},values:function(){return new CollectionIterator(this,ITERATOR_VALUES)},keys:function(){return new CollectionIterator(this,ITERATOR_KEYS)},entries:function(){return new CollectionIterator(this,ITERATOR_KEYSVALUES)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(this._isModel(attrs)){if(!attrs.collection)attrs.collection=this;return attrs}options=options?_.clone(options):{};options.collection=this;var model;if(this.model.prototype){model=new this.model(attrs,options)}else{model=this.model(attrs,options)}if(!model.validationError)return model;this.trigger("invalid",this,model.validationError,options);return false},_removeModels:function(models,options){var removed=[];for(var i=0;i<models.length;i++){var model=this.get(models[i]);if(!model)continue;var index=this.indexOf(model);this.models.splice(index,1);this.length--;delete this._byId[model.cid];var id=this.modelId(model.attributes,model.idAttribute);if(id!=null)delete this._byId[id];if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}removed.push(model);this._removeReference(model,options)}return removed},_isModel:function(model){return model instanceof Model},_addReference:function(model,options){this._byId[model.cid]=model;var id=this.modelId(model.attributes,model.idAttribute);if(id!=null)this._byId[id]=model;model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){delete this._byId[model.cid];var id=this.modelId(model.attributes,model.idAttribute);if(id!=null)delete this._byId[id];if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if(model){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(event==="changeId"){var prevId=this.modelId(model.previousAttributes(),model.idAttribute);var id=this.modelId(model.attributes,model.idAttribute);if(prevId!=null)delete this._byId[prevId];if(id!=null)this._byId[id]=model}}this.trigger.apply(this,arguments)}});var $$iterator=typeof Symbol==="function"&&Symbol.iterator;if($$iterator){Collection.prototype[$$iterator]=Collection.prototype.values}var CollectionIterator=function(collection,kind){this._collection=collection;this._kind=kind;this._index=0};var ITERATOR_VALUES=1;var ITERATOR_KEYS=2;var ITERATOR_KEYSVALUES=3;if($$iterator){CollectionIterator.prototype[$$iterator]=function(){return this}}CollectionIterator.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var model=this._collection.at(this._index);this._index++;var value;if(this._kind===ITERATOR_VALUES){value=model}else{var id=this._collection.modelId(model.attributes,model.idAttribute);if(this._kind===ITERATOR_KEYS){value=id}else{value=[id,model]}}return{value:value,done:false}}this._collection=void 0}return{value:void 0,done:true}};var View=Backbone.View=function(options){this.cid=_.uniqueId("view");this.preinitialize.apply(this,arguments);_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments)};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(element){this.undelegateEvents();this._setElement(element);this.delegateEvents();return this},_setElement:function(el){this.$el=el instanceof Backbone.$?el:Backbone.$(el);this.el=this.$el[0]},delegateEvents:function(events){events||(events=_.result(this,"events"));if(!events)return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[method];if(!method)continue;var match=key.match(delegateEventSplitter);this.delegate(match[1],match[2],method.bind(this))}return this},delegate:function(eventName,selector,listener){this.$el.on(eventName+".delegateEvents"+this.cid,selector,listener);return this},undelegateEvents:function(){if(this.$el)this.$el.off(".delegateEvents"+this.cid);return this},undelegate:function(eventName,selector,listener){this.$el.off(eventName+".delegateEvents"+this.cid,selector,listener);return this},_createElement:function(tagName){return document.createElement(tagName)},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");this.setElement(this._createElement(_.result(this,"tagName")));this._setAttributes(attrs)}else{this.setElement(_.result(this,"el"))}},_setAttributes:function(attributes){this.$el.attr(attributes)}});var addMethod=function(base,length,method,attribute){switch(length){case 1:return function(){return base[method](this[attribute])};case 2:return function(value){return base[method](this[attribute],value)};case 3:return function(iteratee,context){return base[method](this[attribute],cb(iteratee,this),context)};case 4:return function(iteratee,defaultVal,context){return base[method](this[attribute],cb(iteratee,this),defaultVal,context)};default:return function(){var args=slice.call(arguments);args.unshift(this[attribute]);return base[method].apply(base,args)}}};var addUnderscoreMethods=function(Class,base,methods,attribute){_.each(methods,function(length,method){if(base[method])Class.prototype[method]=addMethod(base,length,method,attribute)})};var cb=function(iteratee,instance){if(_.isFunction(iteratee))return iteratee;if(_.isObject(iteratee)&&!instance._isModel(iteratee))return modelMatcher(iteratee);if(_.isString(iteratee))return function(model){return model.get(iteratee)};return iteratee};var modelMatcher=function(attrs){var matcher=_.matches(attrs);return function(model){return matcher(model.attributes)}};var collectionMethods={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};var modelMethods={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};_.each([[Collection,collectionMethods,"models"],[Model,modelMethods,"attributes"]],function(config){var Base=config[0],methods=config[1],attribute=config[2];Base.mixin=function(obj){var mappings=_.reduce(_.functions(obj),function(memo,name){memo[name]=0;return memo},{});addUnderscoreMethods(Base,obj,mappings,attribute)};addUnderscoreMethods(Base,_,methods,attribute)});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}var error=options.error;options.error=function(xhr,textStatus,errorThrown){options.textStatus=textStatus;options.errorThrown=errorThrown;if(error)error.call(options.context,xhr,textStatus,errorThrown)};var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var methodMap={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});this.preinitialize.apply(this,arguments);if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{preinitialize:function(){},initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);if(router.execute(callback,args,name)!==false){router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)}});return this},execute:function(callback,args,name){if(callback)callback.apply(this,args)},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)");return new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){if(i===params.length-1)return param||null;return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];this.checkUrl=this.checkUrl.bind(this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var pathStripper=/#.*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,atRoot:function(){var path=this.location.pathname.replace(/[^\/]$/,"$&/");return path===this.root&&!this.getSearch()},matchRoot:function(){var path=this.decodeFragment(this.location.pathname);var rootPath=path.slice(0,this.root.length-1)+"/";return rootPath===this.root},decodeFragment:function(fragment){return decodeURI(fragment.replace(/%25/g,"%2525"))},getSearch:function(){var match=this.location.href.replace(/#.*/,"").match(/\?.+/);return match?match[0]:""},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getPath:function(){var path=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return path.charAt(0)==="/"?path.slice(1):path},getFragment:function(fragment){if(fragment==null){if(this._usePushState||!this._wantsHashChange){fragment=this.getPath()}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange"in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(rootStripper,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var rootPath=this.root.slice(0,-1)||"/";this.location.replace(rootPath+"#"+this.getPath());return true}else if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var body=document.body;var iWindow=body.insertBefore(this.iframe,body.firstChild).contentWindow;iWindow.document.open();iWindow.document.close();iWindow.location.hash="#"+this.fragment}var addEventListener=window.addEventListener||function(eventName,listener){return attachEvent("on"+eventName,listener)};if(this._usePushState){addEventListener("popstate",this.checkUrl,false)}else if(this._useHashChange&&!this.iframe){addEventListener("hashchange",this.checkUrl,false)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}if(!this.options.silent)return this.loadUrl()},stop:function(){var removeEventListener=window.removeEventListener||function(eventName,listener){return detachEvent("on"+eventName,listener)};if(this._usePushState){removeEventListener("popstate",this.checkUrl,false)}else if(this._useHashChange&&!this.iframe){removeEventListener("hashchange",this.checkUrl,false)}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval)clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getHash(this.iframe.contentWindow)}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()},loadUrl:function(fragment){if(!this.matchRoot())return false;fragment=this.fragment=this.getFragment(fragment);return _.some(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}})},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};fragment=this.getFragment(fragment||"");var rootPath=this.root;if(fragment===""||fragment.charAt(0)==="?"){rootPath=rootPath.slice(0,-1)||"/"}var url=rootPath+fragment;fragment=fragment.replace(pathStripper,"");var decodedFragment=this.decodeFragment(fragment);if(this.fragment===decodedFragment)return;this.fragment=decodedFragment;if(this._usePushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getHash(this.iframe.contentWindow)){var iWindow=this.iframe.contentWindow;if(!options.replace){iWindow.document.open();iWindow.document.close()}this._updateHash(iWindow.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)return this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);child.prototype=_.create(parent.prototype,protoProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error.call(options.context,model,resp,options);model.trigger("error",model,resp,options)}};return Backbone});(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports,require("backbone"),require("lodash"),require("jquery")):typeof define==="function"&&define.amd?define(["exports","backbone","lodash","jquery"],factory):(global=global||self,factory(global.joint={},global.Backbone,global._,global.$))})(this,function(exports,Backbone,_,$){"use strict";Backbone=Backbone&&Backbone.hasOwnProperty("default")?Backbone["default"]:Backbone;_=_&&_.hasOwnProperty("default")?_["default"]:_;$=$&&$.hasOwnProperty("default")?$["default"]:$;var commonjsGlobal=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function unwrapExports(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}function getCjsExportFromNamespace(n){return n&&n.default||n}var check=function(it){return it&&it.Math==Math&&it};var global_1=check(typeof globalThis=="object"&&globalThis)||check(typeof window=="object"&&window)||check(typeof self=="object"&&self)||check(typeof commonjsGlobal=="object"&&commonjsGlobal)||function(){return this}()||Function("return this")();var fails=function(exec){try{return!!exec()}catch(error){return true}};var descriptors=!fails(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7});"use strict";var nativePropertyIsEnumerable={}.propertyIsEnumerable;var getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var NASHORN_BUG=getOwnPropertyDescriptor&&!nativePropertyIsEnumerable.call({1:2},1);var f=NASHORN_BUG?function propertyIsEnumerable(V){var descriptor=getOwnPropertyDescriptor(this,V);return!!descriptor&&descriptor.enumerable}:nativePropertyIsEnumerable;var objectPropertyIsEnumerable={f:f};var createPropertyDescriptor=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}};var toString={}.toString;var classofRaw=function(it){return toString.call(it).slice(8,-1)};var split="".split;var indexedObject=fails(function(){return!Object("z").propertyIsEnumerable(0)})?function(it){return classofRaw(it)=="String"?split.call(it,""):Object(it)}:Object;var requireObjectCoercible=function(it){if(it==undefined){throw TypeError("Can't call method on "+it)}return it};var toIndexedObject=function(it){return indexedObject(requireObjectCoercible(it))};var isObject=function(it){return typeof it==="object"?it!==null:typeof it==="function"};var toPrimitive=function(input,PREFERRED_STRING){if(!isObject(input)){return input}var fn,val;if(PREFERRED_STRING&&typeof(fn=input.toString)=="function"&&!isObject(val=fn.call(input))){return val}if(typeof(fn=input.valueOf)=="function"&&!isObject(val=fn.call(input))){return val}if(!PREFERRED_STRING&&typeof(fn=input.toString)=="function"&&!isObject(val=fn.call(input))){return val}throw TypeError("Can't convert object to primitive value")};var hasOwnProperty={}.hasOwnProperty;var has=function(it,key){return hasOwnProperty.call(it,key)};var document$1=global_1.document;var EXISTS=isObject(document$1)&&isObject(document$1.createElement);var documentCreateElement=function(it){return EXISTS?document$1.createElement(it):{}};var ie8DomDefine=!descriptors&&!fails(function(){return Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a!=7});var nativeGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var f$1=descriptors?nativeGetOwnPropertyDescriptor:function getOwnPropertyDescriptor(O,P){O=toIndexedObject(O);P=toPrimitive(P,true);if(ie8DomDefine){try{return nativeGetOwnPropertyDescriptor(O,P)}catch(error){}}if(has(O,P)){return createPropertyDescriptor(!objectPropertyIsEnumerable.f.call(O,P),O[P])}};var objectGetOwnPropertyDescriptor={f:f$1};var anObject=function(it){if(!isObject(it)){throw TypeError(String(it)+" is not an object")}return it};var nativeDefineProperty=Object.defineProperty;var f$2=descriptors?nativeDefineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPrimitive(P,true);anObject(Attributes);if(ie8DomDefine){try{return nativeDefineProperty(O,P,Attributes)}catch(error){}}if("get"in Attributes||"set"in Attributes){throw TypeError("Accessors not supported")}if("value"in Attributes){O[P]=Attributes.value}return O};var objectDefineProperty={f:f$2};var createNonEnumerableProperty=descriptors?function(object,key,value){return objectDefineProperty.f(object,key,createPropertyDescriptor(1,value))}:function(object,key,value){object[key]=value;return object};var setGlobal=function(key,value){try{createNonEnumerableProperty(global_1,key,value)}catch(error){global_1[key]=value}return value};var SHARED="__core-js_shared__";var store=global_1[SHARED]||setGlobal(SHARED,{});var sharedStore=store;var functionToString=Function.toString;if(typeof sharedStore.inspectSource!="function"){sharedStore.inspectSource=function(it){return functionToString.call(it)}}var inspectSource=sharedStore.inspectSource;var WeakMap=global_1.WeakMap;var nativeWeakMap=typeof WeakMap==="function"&&/native code/.test(inspectSource(WeakMap));var isPure=false;var shared=createCommonjsModule(function(module){(module.exports=function(key,value){return sharedStore[key]||(sharedStore[key]=value!==undefined?value:{})})("versions",[]).push({version:"3.8.3",mode:isPure?"pure":"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})});var id=0;var postfix=Math.random();var uid=function(key){return"Symbol("+String(key===undefined?"":key)+")_"+(++id+postfix).toString(36)};var keys=shared("keys");var sharedKey=function(key){return keys[key]||(keys[key]=uid(key))};var hiddenKeys={};var WeakMap$1=global_1.WeakMap;var set,get,has$1;var enforce=function(it){return has$1(it)?get(it):set(it,{})};var getterFor=function(TYPE){return function(it){var state;if(!isObject(it)||(state=get(it)).type!==TYPE){throw TypeError("Incompatible receiver, "+TYPE+" required")}return state}};if(nativeWeakMap){var store$1=sharedStore.state||(sharedStore.state=new WeakMap$1);var wmget=store$1.get;var wmhas=store$1.has;var wmset=store$1.set;set=function(it,metadata){metadata.facade=it;wmset.call(store$1,it,metadata);return metadata};get=function(it){return wmget.call(store$1,it)||{}};has$1=function(it){return wmhas.call(store$1,it)}}else{var STATE=sharedKey("state");hiddenKeys[STATE]=true;set=function(it,metadata){metadata.facade=it;createNonEnumerableProperty(it,STATE,metadata);return metadata};get=function(it){return has(it,STATE)?it[STATE]:{}};has$1=function(it){return has(it,STATE)}}var internalState={set:set,get:get,has:has$1,enforce:enforce,getterFor:getterFor};var internalState_1=internalState.set;var internalState_2=internalState.get;var internalState_3=internalState.has;var internalState_4=internalState.enforce;var internalState_5=internalState.getterFor;var redefine=createCommonjsModule(function(module){var getInternalState=internalState.get;var enforceInternalState=internalState.enforce;var TEMPLATE=String(String).split("String");(module.exports=function(O,key,value,options){var unsafe=options?!!options.unsafe:false;var simple=options?!!options.enumerable:false;var noTargetGet=options?!!options.noTargetGet:false;var state;if(typeof value=="function"){if(typeof key=="string"&&!has(value,"name")){createNonEnumerableProperty(value,"name",key)}state=enforceInternalState(value);if(!state.source){state.source=TEMPLATE.join(typeof key=="string"?key:"")}}if(O===global_1){if(simple){O[key]=value}else{setGlobal(key,value)}return}else if(!unsafe){delete O[key]}else if(!noTargetGet&&O[key]){simple=true}if(simple){O[key]=value}else{createNonEnumerableProperty(O,key,value)}})(Function.prototype,"toString",function toString(){return typeof this=="function"&&getInternalState(this).source||inspectSource(this)})});var path=global_1;var aFunction=function(variable){return typeof variable=="function"?variable:undefined};var getBuiltIn=function(namespace,method){return arguments.length<2?aFunction(path[namespace])||aFunction(global_1[namespace]):path[namespace]&&path[namespace][method]||global_1[namespace]&&global_1[namespace][method]};var ceil=Math.ceil;var floor=Math.floor;var toInteger=function(argument){return isNaN(argument=+argument)?0:(argument>0?floor:ceil)(argument)};var min=Math.min;var toLength=function(argument){return argument>0?min(toInteger(argument),9007199254740991):0};var max=Math.max;var min$1=Math.min;var toAbsoluteIndex=function(index,length){var integer=toInteger(index);return integer<0?max(integer+length,0):min$1(integer,length)};var createMethod=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIndexedObject($this);var length=toLength(O.length);var index=toAbsoluteIndex(fromIndex,length);var value;if(IS_INCLUDES&&el!=el){while(length>index){value=O[index++];if(value!=value){return true}}}else{for(;length>index;index++){if((IS_INCLUDES||index in O)&&O[index]===el){return IS_INCLUDES||index||0}}}return!IS_INCLUDES&&-1}};var arrayIncludes={includes:createMethod(true),indexOf:createMethod(false)};var arrayIncludes_1=arrayIncludes.includes;var arrayIncludes_2=arrayIncludes.indexOf;var indexOf=arrayIncludes.indexOf;var objectKeysInternal=function(object,names){var O=toIndexedObject(object);var i=0;var result=[];var key;for(key in O){!has(hiddenKeys,key)&&has(O,key)&&result.push(key)}while(names.length>i){if(has(O,key=names[i++])){~indexOf(result,key)||result.push(key)}}return result};var enumBugKeys=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var hiddenKeys$1=enumBugKeys.concat("length","prototype");var f$3=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return objectKeysInternal(O,hiddenKeys$1)};var objectGetOwnPropertyNames={f:f$3};var f$4=Object.getOwnPropertySymbols;var objectGetOwnPropertySymbols={f:f$4};var ownKeys=getBuiltIn("Reflect","ownKeys")||function ownKeys(it){var keys=objectGetOwnPropertyNames.f(anObject(it));var getOwnPropertySymbols=objectGetOwnPropertySymbols.f;return getOwnPropertySymbols?keys.concat(getOwnPropertySymbols(it)):keys};var copyConstructorProperties=function(target,source){var keys=ownKeys(source);var defineProperty=objectDefineProperty.f;var getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f;for(var i=0;i<keys.length;i++){var key=keys[i];if(!has(target,key)){defineProperty(target,key,getOwnPropertyDescriptor(source,key))}}};var replacement=/#|\.prototype\./;var isForced=function(feature,detection){var value=data[normalize(feature)];return value==POLYFILL?true:value==NATIVE?false:typeof detection=="function"?fails(detection):!!detection};var normalize=isForced.normalize=function(string){return String(string).replace(replacement,".").toLowerCase()};var data=isForced.data={};var NATIVE=isForced.NATIVE="N";var POLYFILL=isForced.POLYFILL="P";var isForced_1=isForced;var getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f;var _export=function(options,source){var TARGET=options.target;var GLOBAL=options.global;var STATIC=options.stat;var FORCED,target,key,targetProperty,sourceProperty,descriptor;if(GLOBAL){target=global_1}else if(STATIC){target=global_1[TARGET]||setGlobal(TARGET,{})}else{target=(global_1[TARGET]||{}).prototype}if(target){for(key in source){sourceProperty=source[key];if(options.noTargetGet){descriptor=getOwnPropertyDescriptor$1(target,key);targetProperty=descriptor&&descriptor.value}else{targetProperty=target[key]}FORCED=isForced_1(GLOBAL?key:TARGET+(STATIC?".":"#")+key,options.forced);if(!FORCED&&targetProperty!==undefined){if(typeof sourceProperty===typeof targetProperty){continue}copyConstructorProperties(sourceProperty,targetProperty)}if(options.sham||targetProperty&&targetProperty.sham){createNonEnumerableProperty(sourceProperty,"sham",true)}redefine(target,key,sourceProperty,options)}}};var nativeSymbol=!!Object.getOwnPropertySymbols&&!fails(function(){return!String(Symbol())});var useSymbolAsUid=nativeSymbol&&!Symbol.sham&&typeof Symbol.iterator=="symbol";var WellKnownSymbolsStore=shared("wks");var Symbol$1=global_1.Symbol;var createWellKnownSymbol=useSymbolAsUid?Symbol$1:Symbol$1&&Symbol$1.withoutSetter||uid;var wellKnownSymbol=function(name){if(!has(WellKnownSymbolsStore,name)){if(nativeSymbol&&has(Symbol$1,name)){WellKnownSymbolsStore[name]=Symbol$1[name]}else{WellKnownSymbolsStore[name]=createWellKnownSymbol("Symbol."+name)}}return WellKnownSymbolsStore[name]};var objectKeys=Object.keys||function keys(O){return objectKeysInternal(O,enumBugKeys)};var objectDefineProperties=descriptors?Object.defineProperties:function defineProperties(O,Properties){anObject(O);var keys=objectKeys(Properties);var length=keys.length;var index=0;var key;while(length>index){objectDefineProperty.f(O,key=keys[index++],Properties[key])}return O};var html=getBuiltIn("document","documentElement");var GT=">";var LT="<";var PROTOTYPE="prototype";var SCRIPT="script";var IE_PROTO=sharedKey("IE_PROTO");var EmptyConstructor=function(){};var scriptTag=function(content){return LT+SCRIPT+GT+content+LT+"/"+SCRIPT+GT};var NullProtoObjectViaActiveX=function(activeXDocument){activeXDocument.write(scriptTag(""));activeXDocument.close();var temp=activeXDocument.parentWindow.Object;activeXDocument=null;return temp};var NullProtoObjectViaIFrame=function(){var iframe=documentCreateElement("iframe");var JS="java"+SCRIPT+":";var iframeDocument;iframe.style.display="none";html.appendChild(iframe);iframe.src=String(JS);iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write(scriptTag("document.F=Object"));iframeDocument.close();return iframeDocument.F};var activeXDocument;var NullProtoObject=function(){try{activeXDocument=document.domain&&new ActiveXObject("htmlfile")}catch(error){}NullProtoObject=activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame();var length=enumBugKeys.length;while(length--){delete NullProtoObject[PROTOTYPE][enumBugKeys[length]]}return NullProtoObject()};hiddenKeys[IE_PROTO]=true;var objectCreate=Object.create||function create(O,Properties){var result;if(O!==null){EmptyConstructor[PROTOTYPE]=anObject(O);result=new EmptyConstructor;EmptyConstructor[PROTOTYPE]=null;result[IE_PROTO]=O}else{result=NullProtoObject()}return Properties===undefined?result:objectDefineProperties(result,Properties)};var UNSCOPABLES=wellKnownSymbol("unscopables");var ArrayPrototype=Array.prototype;if(ArrayPrototype[UNSCOPABLES]==undefined){objectDefineProperty.f(ArrayPrototype,UNSCOPABLES,{configurable:true,value:objectCreate(null)})}var addToUnscopables=function(key){ArrayPrototype[UNSCOPABLES][key]=true};var defineProperty=Object.defineProperty;var cache={};var thrower=function(it){throw it};var arrayMethodUsesToLength=function(METHOD_NAME,options){if(has(cache,METHOD_NAME)){return cache[METHOD_NAME]}if(!options){options={}}var method=[][METHOD_NAME];var ACCESSORS=has(options,"ACCESSORS")?options.ACCESSORS:false;var argument0=has(options,0)?options[0]:thrower;var argument1=has(options,1)?options[1]:undefined;return cache[METHOD_NAME]=!!method&&!fails(function(){if(ACCESSORS&&!descriptors){return true}var O={length:-1};if(ACCESSORS){defineProperty(O,1,{enumerable:true,get:thrower})}else{O[1]=1}method.call(O,argument0,argument1)})};"use strict";var $includes=arrayIncludes.includes;var USES_TO_LENGTH=arrayMethodUsesToLength("indexOf",{ACCESSORS:true,1:0});_export({target:"Array",proto:true,forced:!USES_TO_LENGTH},{includes:function includes(el){return $includes(this,el,arguments.length>1?arguments[1]:undefined)}});addToUnscopables("includes");var es_array_includes={};var aFunction$1=function(it){if(typeof it!="function"){throw TypeError(String(it)+" is not a function")}return it};var functionBindContext=function(fn,that,length){aFunction$1(fn);if(that===undefined){return fn}switch(length){case 0:return function(){return fn.call(that)};case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}};var call=Function.call;var entryUnbind=function(CONSTRUCTOR,METHOD,length){return functionBindContext(call,global_1[CONSTRUCTOR].prototype[METHOD],length)};var includes=entryUnbind("Array","includes");var includes$1=includes;var toObject=function(argument){return Object(requireObjectCoercible(argument))};var isArray=Array.isArray||function isArray(arg){return classofRaw(arg)=="Array"};var SPECIES=wellKnownSymbol("species");var arraySpeciesCreate=function(originalArray,length){var C;if(isArray(originalArray)){C=originalArray.constructor;if(typeof C=="function"&&(C===Array||isArray(C.prototype))){C=undefined}else if(isObject(C)){C=C[SPECIES];if(C===null){C=undefined}}}return new(C===undefined?Array:C)(length===0?0:length)};var push=[].push;var createMethod$1=function(TYPE){var IS_MAP=TYPE==1;var IS_FILTER=TYPE==2;var IS_SOME=TYPE==3;var IS_EVERY=TYPE==4;var IS_FIND_INDEX=TYPE==6;var IS_FILTER_OUT=TYPE==7;var NO_HOLES=TYPE==5||IS_FIND_INDEX;return function($this,callbackfn,that,specificCreate){var O=toObject($this);var self=indexedObject(O);var boundFunction=functionBindContext(callbackfn,that,3);var length=toLength(self.length);var index=0;var create=specificCreate||arraySpeciesCreate;var target=IS_MAP?create($this,length):IS_FILTER||IS_FILTER_OUT?create($this,0):undefined;var value,result;for(;length>index;index++){if(NO_HOLES||index in self){value=self[index];result=boundFunction(value,index,O);if(TYPE){if(IS_MAP){target[index]=result}else if(result){switch(TYPE){case 3:return true;case 5:return value;case 6:return index;case 2:push.call(target,value)}}else{switch(TYPE){case 4:return false;case 7:push.call(target,value)}}}}}return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:target}};var arrayIteration={forEach:createMethod$1(0),map:createMethod$1(1),filter:createMethod$1(2),some:createMethod$1(3),every:createMethod$1(4),find:createMethod$1(5),findIndex:createMethod$1(6),filterOut:createMethod$1(7)};var arrayIteration_1=arrayIteration.forEach;var arrayIteration_2=arrayIteration.map;var arrayIteration_3=arrayIteration.filter;var arrayIteration_4=arrayIteration.some;var arrayIteration_5=arrayIteration.every;var arrayIteration_6=arrayIteration.find;var arrayIteration_7=arrayIteration.findIndex;var arrayIteration_8=arrayIteration.filterOut;"use strict";var $find=arrayIteration.find;var FIND="find";var SKIPS_HOLES=true;var USES_TO_LENGTH$1=arrayMethodUsesToLength(FIND);if(FIND in[]){Array(1)[FIND](function(){SKIPS_HOLES=false})}_export({target:"Array",proto:true,forced:SKIPS_HOLES||!USES_TO_LENGTH$1},{find:function find(callbackfn){return $find(this,callbackfn,arguments.length>1?arguments[1]:undefined)}});addToUnscopables(FIND);var es_array_find={};var find=entryUnbind("Array","find");var find$1=find;var createMethod$2=function(CONVERT_TO_STRING){return function($this,pos){var S=String(requireObjectCoercible($this));var position=toInteger(pos);var size=S.length;var first,second;if(position<0||position>=size){return CONVERT_TO_STRING?"":undefined}first=S.charCodeAt(position);return first<55296||first>56319||position+1===size||(second=S.charCodeAt(position+1))<56320||second>57343?CONVERT_TO_STRING?S.charAt(position):first:CONVERT_TO_STRING?S.slice(position,position+2):(first-55296<<10)+(second-56320)+65536}};var stringMultibyte={codeAt:createMethod$2(false),charAt:createMethod$2(true)};var stringMultibyte_1=stringMultibyte.codeAt;var stringMultibyte_2=stringMultibyte.charAt;var correctPrototypeGetter=!fails(function(){function F(){}F.prototype.constructor=null;return Object.getPrototypeOf(new F)!==F.prototype});var IE_PROTO$1=sharedKey("IE_PROTO");var ObjectPrototype=Object.prototype;var objectGetPrototypeOf=correctPrototypeGetter?Object.getPrototypeOf:function(O){O=toObject(O);if(has(O,IE_PROTO$1)){return O[IE_PROTO$1]}if(typeof O.constructor=="function"&&O instanceof O.constructor){return O.constructor.prototype}return O instanceof Object?ObjectPrototype:null};"use strict";var ITERATOR=wellKnownSymbol("iterator");var BUGGY_SAFARI_ITERATORS=false;var returnThis=function(){return this};var IteratorPrototype,PrototypeOfArrayIteratorPrototype,arrayIterator;if([].keys){arrayIterator=[].keys();if(!("next"in arrayIterator)){BUGGY_SAFARI_ITERATORS=true}else{PrototypeOfArrayIteratorPrototype=objectGetPrototypeOf(objectGetPrototypeOf(arrayIterator));if(PrototypeOfArrayIteratorPrototype!==Object.prototype){IteratorPrototype=PrototypeOfArrayIteratorPrototype}}}var NEW_ITERATOR_PROTOTYPE=IteratorPrototype==undefined||fails(function(){var test={};return IteratorPrototype[ITERATOR].call(test)!==test});if(NEW_ITERATOR_PROTOTYPE){IteratorPrototype={}}if((!isPure||NEW_ITERATOR_PROTOTYPE)&&!has(IteratorPrototype,ITERATOR)){createNonEnumerableProperty(IteratorPrototype,ITERATOR,returnThis)}var iteratorsCore={IteratorPrototype:IteratorPrototype,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS};var iteratorsCore_1=iteratorsCore.IteratorPrototype;var iteratorsCore_2=iteratorsCore.BUGGY_SAFARI_ITERATORS;var defineProperty$1=objectDefineProperty.f;var TO_STRING_TAG=wellKnownSymbol("toStringTag");var setToStringTag=function(it,TAG,STATIC){if(it&&!has(it=STATIC?it:it.prototype,TO_STRING_TAG)){defineProperty$1(it,TO_STRING_TAG,{configurable:true,value:TAG})}};var iterators={};"use strict";var IteratorPrototype$1=iteratorsCore.IteratorPrototype;var returnThis$1=function(){return this};var createIteratorConstructor=function(IteratorConstructor,NAME,next){var TO_STRING_TAG=NAME+" Iterator";IteratorConstructor.prototype=objectCreate(IteratorPrototype$1,{next:createPropertyDescriptor(1,next)});setToStringTag(IteratorConstructor,TO_STRING_TAG,false,true);iterators[TO_STRING_TAG]=returnThis$1;return IteratorConstructor};var aPossiblePrototype=function(it){if(!isObject(it)&&it!==null){throw TypeError("Can't set "+String(it)+" as a prototype")}return it};var objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var CORRECT_SETTER=false;var test={};var setter;try{setter=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;setter.call(test,[]);CORRECT_SETTER=test instanceof Array}catch(error){}return function setPrototypeOf(O,proto){anObject(O);aPossiblePrototype(proto);if(CORRECT_SETTER){setter.call(O,proto)}else{O.__proto__=proto}return O}}():undefined);"use strict";var IteratorPrototype$2=iteratorsCore.IteratorPrototype;var BUGGY_SAFARI_ITERATORS$1=iteratorsCore.BUGGY_SAFARI_ITERATORS;var ITERATOR$1=wellKnownSymbol("iterator");var KEYS="keys";var VALUES="values";var ENTRIES="entries";var returnThis$2=function(){return this};var defineIterator=function(Iterable,NAME,IteratorConstructor,next,DEFAULT,IS_SET,FORCED){createIteratorConstructor(IteratorConstructor,NAME,next);var getIterationMethod=function(KIND){if(KIND===DEFAULT&&defaultIterator){return defaultIterator}if(!BUGGY_SAFARI_ITERATORS$1&&KIND in IterablePrototype){return IterablePrototype[KIND]}switch(KIND){case KEYS:return function keys(){return new IteratorConstructor(this,KIND)};case VALUES:return function values(){return new IteratorConstructor(this,KIND)};case ENTRIES:return function entries(){return new IteratorConstructor(this,KIND)}}return function(){return new IteratorConstructor(this)}};var TO_STRING_TAG=NAME+" Iterator";var INCORRECT_VALUES_NAME=false;var IterablePrototype=Iterable.prototype;var nativeIterator=IterablePrototype[ITERATOR$1]||IterablePrototype["@@iterator"]||DEFAULT&&IterablePrototype[DEFAULT];var defaultIterator=!BUGGY_SAFARI_ITERATORS$1&&nativeIterator||getIterationMethod(DEFAULT);var anyNativeIterator=NAME=="Array"?IterablePrototype.entries||nativeIterator:nativeIterator;var CurrentIteratorPrototype,methods,KEY;if(anyNativeIterator){CurrentIteratorPrototype=objectGetPrototypeOf(anyNativeIterator.call(new Iterable));if(IteratorPrototype$2!==Object.prototype&&CurrentIteratorPrototype.next){if(!isPure&&objectGetPrototypeOf(CurrentIteratorPrototype)!==IteratorPrototype$2){if(objectSetPrototypeOf){objectSetPrototypeOf(CurrentIteratorPrototype,IteratorPrototype$2)}else if(typeof CurrentIteratorPrototype[ITERATOR$1]!="function"){createNonEnumerableProperty(CurrentIteratorPrototype,ITERATOR$1,returnThis$2)}}setToStringTag(CurrentIteratorPrototype,TO_STRING_TAG,true,true);if(isPure){iterators[TO_STRING_TAG]=returnThis$2}}}if(DEFAULT==VALUES&&nativeIterator&&nativeIterator.name!==VALUES){INCORRECT_VALUES_NAME=true;defaultIterator=function values(){return nativeIterator.call(this)}}if((!isPure||FORCED)&&IterablePrototype[ITERATOR$1]!==defaultIterator){createNonEnumerableProperty(IterablePrototype,ITERATOR$1,defaultIterator)}iterators[NAME]=defaultIterator;if(DEFAULT){methods={values:getIterationMethod(VALUES),keys:IS_SET?defaultIterator:getIterationMethod(KEYS),entries:getIterationMethod(ENTRIES)};if(FORCED){for(KEY in methods){if(BUGGY_SAFARI_ITERATORS$1||INCORRECT_VALUES_NAME||!(KEY in IterablePrototype)){redefine(IterablePrototype,KEY,methods[KEY])}}}else{_export({target:NAME,proto:true,forced:BUGGY_SAFARI_ITERATORS$1||INCORRECT_VALUES_NAME},methods)}}return methods};"use strict";var charAt=stringMultibyte.charAt;var STRING_ITERATOR="String Iterator";var setInternalState=internalState.set;var getInternalState=internalState.getterFor(STRING_ITERATOR);defineIterator(String,"String",function(iterated){setInternalState(this,{type:STRING_ITERATOR,string:String(iterated),index:0})},function next(){var state=getInternalState(this);var string=state.string;var index=state.index;var point;if(index>=string.length){return{value:undefined,done:true}}point=charAt(string,index);state.index+=point.length;return{value:point,done:false}});var es_string_iterator={};var iteratorClose=function(iterator){var returnMethod=iterator["return"];if(returnMethod!==undefined){return anObject(returnMethod.call(iterator)).value}};var callWithSafeIterationClosing=function(iterator,fn,value,ENTRIES){try{return ENTRIES?fn(anObject(value)[0],value[1]):fn(value)}catch(error){iteratorClose(iterator);throw error}};var ITERATOR$2=wellKnownSymbol("iterator");var ArrayPrototype$1=Array.prototype;var isArrayIteratorMethod=function(it){return it!==undefined&&(iterators.Array===it||ArrayPrototype$1[ITERATOR$2]===it)};"use strict";var createProperty=function(object,key,value){var propertyKey=toPrimitive(key);if(propertyKey in object){objectDefineProperty.f(object,propertyKey,createPropertyDescriptor(0,value))}else{object[propertyKey]=value}};var TO_STRING_TAG$1=wellKnownSymbol("toStringTag");var test={};test[TO_STRING_TAG$1]="z";var toStringTagSupport=String(test)==="[object z]";var TO_STRING_TAG$2=wellKnownSymbol("toStringTag");var CORRECT_ARGUMENTS=classofRaw(function(){return arguments}())=="Arguments";var tryGet=function(it,key){try{return it[key]}catch(error){}};var classof=toStringTagSupport?classofRaw:function(it){var O,tag,result;return it===undefined?"Undefined":it===null?"Null":typeof(tag=tryGet(O=Object(it),TO_STRING_TAG$2))=="string"?tag:CORRECT_ARGUMENTS?classofRaw(O):(result=classofRaw(O))=="Object"&&typeof O.callee=="function"?"Arguments":result};var ITERATOR$3=wellKnownSymbol("iterator");var getIteratorMethod=function(it){if(it!=undefined){return it[ITERATOR$3]||it["@@iterator"]||iterators[classof(it)]}};"use strict";var arrayFrom=function from(arrayLike){var O=toObject(arrayLike);var C=typeof this=="function"?this:Array;var argumentsLength=arguments.length;var mapfn=argumentsLength>1?arguments[1]:undefined;var mapping=mapfn!==undefined;var iteratorMethod=getIteratorMethod(O);var index=0;var length,result,step,iterator,next,value;if(mapping){mapfn=functionBindContext(mapfn,argumentsLength>2?arguments[2]:undefined,2)}if(iteratorMethod!=undefined&&!(C==Array&&isArrayIteratorMethod(iteratorMethod))){iterator=iteratorMethod.call(O);next=iterator.next;result=new C;for(;!(step=next.call(iterator)).done;index++){value=mapping?callWithSafeIterationClosing(iterator,mapfn,[step.value,index],true):step.value;createProperty(result,index,value)}}else{length=toLength(O.length);result=new C(length);for(;length>index;index++){value=mapping?mapfn(O[index],index):O[index];createProperty(result,index,value)}}result.length=index;return result};var ITERATOR$4=wellKnownSymbol("iterator");var SAFE_CLOSING=false;try{var called=0;var iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=true}};iteratorWithReturn[ITERATOR$4]=function(){return this};Array.from(iteratorWithReturn,function(){throw 2})}catch(error){}var checkCorrectnessOfIteration=function(exec,SKIP_CLOSING){if(!SKIP_CLOSING&&!SAFE_CLOSING){return false}var ITERATION_SUPPORT=false;try{var object={};object[ITERATOR$4]=function(){return{next:function(){return{done:ITERATION_SUPPORT=true}}}};exec(object)}catch(error){}return ITERATION_SUPPORT};var INCORRECT_ITERATION=!checkCorrectnessOfIteration(function(iterable){Array.from(iterable)});_export({target:"Array",stat:true,forced:INCORRECT_ITERATION},{from:arrayFrom});var es_array_from={};var from_1=path.Array.from;var from_1$1=from_1;"use strict";var $findIndex=arrayIteration.findIndex;var FIND_INDEX="findIndex";var SKIPS_HOLES$1=true;var USES_TO_LENGTH$2=arrayMethodUsesToLength(FIND_INDEX);if(FIND_INDEX in[]){Array(1)[FIND_INDEX](function(){SKIPS_HOLES$1=false})}_export({target:"Array",proto:true,forced:SKIPS_HOLES$1||!USES_TO_LENGTH$2},{findIndex:function findIndex(callbackfn){return $findIndex(this,callbackfn,arguments.length>1?arguments[1]:undefined)}});addToUnscopables(FIND_INDEX);var es_array_findIndex={};var findIndex=entryUnbind("Array","findIndex");var findIndex$1=findIndex;var base64=createCommonjsModule(function(module,exports){(function(){var object="object"!="undefined"?exports:this;var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function InvalidCharacterError(message){this.message=message}InvalidCharacterError.prototype=new Error;InvalidCharacterError.prototype.name="InvalidCharacterError";object.btoa||(object.btoa=function(input){var str=String(input);for(var block,charCode,idx=0,map=chars,output="";str.charAt(idx|0)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){charCode=str.charCodeAt(idx+=3/4);if(charCode>255){throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.")}block=block<<8|charCode}return output});object.atob||(object.atob=function(input){var str=String(input).replace(/=+$/,"");if(str.length%4==1){throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.")}for(var bc=0,bs,buffer,idx=0,output="";buffer=str.charAt(idx++);~buffer&&(bs=bc%4?bs*64+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0){buffer=chars.indexOf(buffer)}return output})})()});_export({target:"Number",stat:true},{isNaN:function isNaN(number){return number!=number}});var es_number_isNan={};var isNan=path.Number.isNaN;var isNan$1=isNan;var globalIsFinite=global_1.isFinite;var numberIsFinite=Number.isFinite||function isFinite(it){return typeof it=="number"&&globalIsFinite(it)};_export({target:"Number",stat:true},{isFinite:numberIsFinite});var es_number_isFinite={};var _isFinite=path.Number.isFinite;var _isFinite$1=_isFinite;var MATCH=wellKnownSymbol("match");var isRegexp=function(it){var isRegExp;return isObject(it)&&((isRegExp=it[MATCH])!==undefined?!!isRegExp:classofRaw(it)=="RegExp")};var notARegexp=function(it){if(isRegexp(it)){throw TypeError("The method doesn't accept regular expressions")}return it};var MATCH$1=wellKnownSymbol("match");var correctIsRegexpLogic=function(METHOD_NAME){var regexp=/./;try{"/./"[METHOD_NAME](regexp)}catch(error1){try{regexp[MATCH$1]=false;return"/./"[METHOD_NAME](regexp)}catch(error2){}}return false};"use strict";_export({target:"String",proto:true,forced:!correctIsRegexpLogic("includes")},{includes:function includes(searchString){return!!~String(requireObjectCoercible(this)).indexOf(notARegexp(searchString),arguments.length>1?arguments[1]:undefined)}});var es_string_includes={};var includes$2=entryUnbind("String","includes");var includes$3=includes$2;"use strict";var getOwnPropertyDescriptor$2=objectGetOwnPropertyDescriptor.f;var nativeStartsWith="".startsWith;var min$2=Math.min;var CORRECT_IS_REGEXP_LOGIC=correctIsRegexpLogic("startsWith");var MDN_POLYFILL_BUG=!isPure&&!CORRECT_IS_REGEXP_LOGIC&&!!function(){var descriptor=getOwnPropertyDescriptor$2(String.prototype,"startsWith");return descriptor&&!descriptor.writable}();_export({target:"String",proto:true,forced:!MDN_POLYFILL_BUG&&!CORRECT_IS_REGEXP_LOGIC},{startsWith:function startsWith(searchString){var that=String(requireObjectCoercible(this));notARegexp(searchString);var index=toLength(min$2(arguments.length>1?arguments[1]:undefined,that.length));var search=String(searchString);return nativeStartsWith?nativeStartsWith.call(that,search,index):that.slice(index,index+search.length)===search}});var es_string_startsWith={};var startsWith=entryUnbind("String","startsWith");var startsWith$1=startsWith;(function(){if(typeof Uint8Array!=="undefined"||typeof window==="undefined"){return}function subarray(start,end){return this.slice(start,end)}function set_(array,offset){if(arguments.length<2){offset=0}for(var i=0,n=array.length;i<n;++i,++offset){this[offset]=array[i]&255}}function TypedArray(arg1){var result;if(typeof arg1==="number"){result=new Array(arg1);for(var i=0;i<arg1;++i){result[i]=0}}else{result=arg1.slice(0)}result.subarray=subarray;result.buffer=result;result.byteLength=result.length;result.set=set_;if(typeof arg1==="object"&&arg1.buffer){result.buffer=arg1.buffer}return result}window.Uint8Array=TypedArray;window.Uint32Array=TypedArray;window.Int32Array=TypedArray})();var props={x:"x",y:"y",width:"w",height:"h",minimum:"s",maximum:"l",diagonal:"d"};var propsList=Object.keys(props).map(function(key){return props[key]}).join("");var numberPattern="[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?";var findSpacesRegex=/\s/g;var parseExpressionRegExp=new RegExp("^("+numberPattern+"\\*)?(["+propsList+"])(/"+numberPattern+")?([-+]{1,2}"+numberPattern+")?$","g");function throwInvalid(expression){throw new Error("Invalid calc() expression: "+expression)}function evalCalcExpression(expression,bbox){var match=parseExpressionRegExp.exec(expression.replace(findSpacesRegex,""));if(!match){throwInvalid(expression)}parseExpressionRegExp.lastIndex=0;var multiply=match[1];var property=match[2];var divide=match[3];var add=match[4];var x=bbox.x;var y=bbox.y;var width=bbox.width;var height=bbox.height;var value=0;switch(property){case props.width:{value=width;break}case props.height:{value=height;break}case props.x:{value=x;break}case props.y:{value=y;break}case props.minimum:{value=Math.min(height,width);break}case props.maximum:{value=Math.max(height,width);break}case props.diagonal:{value=Math.sqrt(height*height+width*width);break}}if(multiply){value*=parseFloat(multiply)}if(divide){value/=parseFloat(divide.slice(1))}if(add){value+=evalAddExpression(add)}return value}function evalAddExpression(addExpression){if(!addExpression){return 0}var sign=addExpression[0];switch(sign){case"+":{return parseFloat(addExpression.substr(1))}case"-":{return-parseFloat(addExpression.substr(1))}}return parseFloat(addExpression)}function isCalcAttribute(value){return typeof value==="string"&&value.includes("calc")}var calcStart="calc(";var calcStartOffset=calcStart.length;function evalCalcAttribute(attributeValue,refBBox){var value=attributeValue;var startSearchIndex=0;do{var calcIndex=value.indexOf(calcStart,startSearchIndex);if(calcIndex===-1){return value}var calcEndIndex=calcIndex+calcStartOffset;var brackets=1;findClosingBracket:do{switch(value[calcEndIndex]){case"(":{brackets++;break}case")":{brackets--;if(brackets===0){break findClosingBracket}break}case undefined:{throwInvalid(value)}}calcEndIndex++}while(true);var expression=value.slice(calcIndex+calcStartOffset,calcEndIndex);if(isCalcAttribute(expression)){expression=evalCalcAttribute(expression,refBBox)}var calcValue=String(evalCalcExpression(expression,refBBox));value=value.slice(0,calcIndex)+calcValue+value.slice(calcEndIndex+1);startSearchIndex=calcIndex+calcValue.length}while(true)}var round=Math.round;var floor$1=Math.floor;var PI=Math.PI;var scale={linear:function(domain,range,value){var domainSpan=domain[1]-domain[0];var rangeSpan=range[1]-range[0];return(value-domain[0])/domainSpan*rangeSpan+range[0]||0}};var normalizeAngle=function(angle){return angle%360+(angle<0?360:0)};var snapToGrid=function(value,gridSize){return gridSize*round(value/gridSize)};var toDeg=function(rad){return 180*rad/PI%360};var toRad=function(deg,over360){over360=over360||false;deg=over360?deg:deg%360;return deg*PI/180};var random=function(min,max){if(max===undefined){max=min===undefined?1:min;min=0}else if(max<min){var temp=min;min=max;max=temp}return floor$1(Math.random()*(max-min+1)+min)};var cos=Math.cos;var sin=Math.sin;var atan2=Math.atan2;var bearing=function(p,q){var lat1=toRad(p.y);var lat2=toRad(q.y);var lon1=p.x;var lon2=q.x;var dLon=toRad(lon2-lon1);var y=sin(dLon)*cos(lat2);var x=cos(lat1)*sin(lat2)-sin(lat1)*cos(lat2)*cos(dLon);var brng=toDeg(atan2(y,x));var bearings=["NE","E","SE","S","SW","W","NW","N"];var index=brng-22.5;if(index<0){index+=360}index=parseInt(index/45);return bearings[index]};var squaredLength=function(start,end){var x0=start.x;var y0=start.y;var x1=end.x;var y1=end.y;return(x0-=x1)*x0+(y0-=y1)*y0};var length=function(start,end){return Math.sqrt(squaredLength(start,end))};var types={Point:1,Line:2,Ellipse:3,Rect:4,Polyline:5,Polygon:6,Curve:7,Path:8};var abs=Math.abs;var cos$1=Math.cos;var sin$1=Math.sin;var sqrt=Math.sqrt;var min$3=Math.min;var max$1=Math.max;var atan2$1=Math.atan2;var round$1=Math.round;var pow=Math.pow;var PI$1=Math.PI;var Point=function(x,y){if(!(this instanceof Point)){return new Point(x,y)}if(typeof x==="string"){var xy=x.split(x.indexOf("@")===-1?" ":"@");x=parseFloat(xy[0]);y=parseFloat(xy[1])}else if(Object(x)===x){y=x.y;x=x.x}this.x=x===undefined?0:x;this.y=y===undefined?0:y};Point.fromPolar=function(distance,angle,origin){origin=new Point(origin);var x=abs(distance*cos$1(angle));var y=abs(distance*sin$1(angle));var deg=normalizeAngle(toDeg(angle));if(deg<90){y=-y}else if(deg<180){x=-x;y=-y}else if(deg<270){x=-x}return new Point(origin.x+x,origin.y+y)};Point.random=function(x1,x2,y1,y2){return new Point(random(x1,x2),random(y1,y2))};Point.prototype={type:types.Point,chooseClosest:function(points){var n=points.length;if(n===1){return new Point(points[0])}var closest=null;var minSqrDistance=Infinity;for(var i=0;i<n;i++){var p=new Point(points[i]);var sqrDistance=this.squaredDistance(p);if(sqrDistance<minSqrDistance){closest=p;minSqrDistance=sqrDistance}}return closest},adhereToRect:function(r){if(r.containsPoint(this)){return this}this.x=min$3(max$1(this.x,r.x),r.x+r.width);this.y=min$3(max$1(this.y,r.y),r.y+r.height);return this},angleBetween:function(p1,p2){var angleBetween=this.equals(p1)||this.equals(p2)?NaN:this.theta(p2)-this.theta(p1);if(angleBetween<0){angleBetween+=360}return angleBetween},bearing:function(point){return bearing(this,point)},changeInAngle:function(dx,dy,ref){return this.clone().offset(-dx,-dy).theta(ref)-this.theta(ref)},clone:function(){return new Point(this)},cross:function(p1,p2){return p1&&p2?(p2.x-this.x)*(p1.y-this.y)-(p2.y-this.y)*(p1.x-this.x):NaN},difference:function(dx,dy){if(Object(dx)===dx){dy=dx.y;dx=dx.x}return new Point(this.x-(dx||0),this.y-(dy||0))},distance:function(p){return length(this,p)},dot:function(p){return p?this.x*p.x+this.y*p.y:NaN},equals:function(p){return!!p&&this.x===p.x&&this.y===p.y},lerp:function(p,t){var x=this.x;var y=this.y;return new Point((1-t)*x+t*p.x,(1-t)*y+t*p.y)},magnitude:function(){return sqrt(this.x*this.x+this.y*this.y)||.01},manhattanDistance:function(p){return abs(p.x-this.x)+abs(p.y-this.y)},move:function(ref,distance){var theta=toRad(new Point(ref).theta(this));var offset=this.offset(cos$1(theta)*distance,-sin$1(theta)*distance);return offset},normalize:function(length){var scale=(length||1)/this.magnitude();return this.scale(scale,scale)},offset:function(dx,dy){if(Object(dx)===dx){dy=dx.y;dx=dx.x}this.x+=dx||0;this.y+=dy||0;return this},reflection:function(ref){return new Point(ref).move(this,this.distance(ref))},rotate:function(origin,angle){if(angle===0){return this}origin=origin||new Point(0,0);angle=toRad(normalizeAngle(-angle));var cosAngle=cos$1(angle);var sinAngle=sin$1(angle);var x=cosAngle*(this.x-origin.x)-sinAngle*(this.y-origin.y)+origin.x;var y=sinAngle*(this.x-origin.x)+cosAngle*(this.y-origin.y)+origin.y;this.x=x;this.y=y;return this},round:function(precision){var f=1;if(precision){switch(precision){case 1:f=10;break;case 2:f=100;break;case 3:f=1e3;break;default:f=pow(10,precision);break}}this.x=round$1(this.x*f)/f;this.y=round$1(this.y*f)/f;return this},scale:function(sx,sy,origin){origin=origin&&new Point(origin)||new Point(0,0);this.x=origin.x+sx*(this.x-origin.x);this.y=origin.y+sy*(this.y-origin.y);return this},snapToGrid:function(gx,gy){this.x=snapToGrid(this.x,gx);this.y=snapToGrid(this.y,gy||gx);return this},squaredDistance:function(p){return squaredLength(this,p)},theta:function(p){p=new Point(p);var y=-(p.y-this.y);var x=p.x-this.x;var rad=atan2$1(y,x);if(rad<0){rad=2*PI$1+rad}return 180*rad/PI$1},toJSON:function(){return{x:this.x,y:this.y}},toPolar:function(o){o=o&&new Point(o)||new Point(0,0);var x=this.x;var y=this.y;this.x=sqrt((x-o.x)*(x-o.x)+(y-o.y)*(y-o.y));this.y=toRad(o.theta(new Point(x,y)));return this},toString:function(){return this.x+"@"+this.y},serialize:function(){return this.x+","+this.y},update:function(x,y){if(Object(x)===x){y=x.y;x=x.x}this.x=x||0;this.y=y||0;return this},vectorAngle:function(p){var zero=new Point(0,0);return zero.angleBetween(this,p)}};Point.prototype.translate=Point.prototype.offset;var point=Point;var max$2=Math.max;var min$4=Math.min;var Line=function(p1,p2){if(!(this instanceof Line)){return new Line(p1,p2)}if(p1 instanceof Line){return new Line(p1.start,p1.end)}this.start=new Point(p1);this.end=new Point(p2)};Line.prototype={type:types.Line,angle:function(){var horizontalPoint=new Point(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,horizontalPoint)},bbox:function(){var left=min$4(this.start.x,this.end.x);var top=min$4(this.start.y,this.end.y);var right=max$2(this.start.x,this.end.x);var bottom=max$2(this.start.y,this.end.y);return new Rect(left,top,right-left,bottom-top)},bearing:function(){return bearing(this.start,this.end)},clone:function(){return new Line(this.start,this.end)},closestPoint:function(p){return this.pointAt(this.closestPointNormalizedLength(p))},closestPointLength:function(p){return this.closestPointNormalizedLength(p)*this.length()},closestPointNormalizedLength:function(p){var product=this.vector().dot(new Line(this.start,p).vector());var cpNormalizedLength=min$4(1,max$2(0,product/this.squaredLength()));if(cpNormalizedLength!==cpNormalizedLength){return 0}return cpNormalizedLength},closestPointTangent:function(p){return this.tangentAt(this.closestPointNormalizedLength(p))},containsPoint:function(p){var start=this.start;var end=this.end;if(start.cross(p,end)!==0){return false}var length=this.length();if(new Line(start,p).length()>length){return false}if(new Line(p,end).length()>length){return false}return true},divideAt:function(ratio){var dividerPoint=this.pointAt(ratio);return[new Line(this.start,dividerPoint),new Line(dividerPoint,this.end)]},divideAtLength:function(length){var dividerPoint=this.pointAtLength(length);return[new Line(this.start,dividerPoint),new Line(dividerPoint,this.end)]},equals:function(l){return!!l&&this.start.x===l.start.x&&this.start.y===l.start.y&&this.end.x===l.end.x&&this.end.y===l.end.y},intersect:function(shape,opt){if(shape&&shape.intersectionWithLine){var intersection=shape.intersectionWithLine(this,opt);if(intersection&&shape instanceof Line){intersection=intersection[0]}return intersection}return null},intersectionWithLine:function(line){var pt1Dir=new Point(this.end.x-this.start.x,this.end.y-this.start.y);var pt2Dir=new Point(line.end.x-line.start.x,line.end.y-line.start.y);var det=pt1Dir.x*pt2Dir.y-pt1Dir.y*pt2Dir.x;var deltaPt=new Point(line.start.x-this.start.x,line.start.y-this.start.y);var alpha=deltaPt.x*pt2Dir.y-deltaPt.y*pt2Dir.x;var beta=deltaPt.x*pt1Dir.y-deltaPt.y*pt1Dir.x;if(det===0||alpha*det<0||beta*det<0){return null}if(det>0){if(alpha>det||beta>det){return null}}else{if(alpha<det||beta<det){return null}}return[new Point(this.start.x+alpha*pt1Dir.x/det,this.start.y+alpha*pt1Dir.y/det)]},isDifferentiable:function(){return!this.start.equals(this.end)},length:function(){return length(this.start,this.end)},midpoint:function(){return new Point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},parallel:function(distance){var l=this.clone();if(!this.isDifferentiable()){return l}var start=l.start;var end=l.end;var eRef=start.clone().rotate(end,270);var sRef=end.clone().rotate(start,90);start.move(sRef,distance);end.move(eRef,distance);return l},pointAt:function(t){var start=this.start;var end=this.end;if(t<=0){return start.clone()}if(t>=1){return end.clone()}return start.lerp(end,t)},pointAtLength:function(length){var start=this.start;var end=this.end;var fromStart=true;if(length<0){fromStart=false;length=-length}var lineLength=this.length();if(length>=lineLength){return fromStart?end.clone():start.clone()}return this.pointAt((fromStart?length:lineLength-length)/lineLength)},pointOffset:function(p){p=new Point(p);var start=this.start;var end=this.end;var determinant=(end.x-start.x)*(p.y-start.y)-(end.y-start.y)*(p.x-start.x);return determinant/this.length()},rotate:function(origin,angle){this.start.rotate(origin,angle);this.end.rotate(origin,angle);return this},round:function(precision){this.start.round(precision);this.end.round(precision);return this},scale:function(sx,sy,origin){this.start.scale(sx,sy,origin);this.end.scale(sx,sy,origin);return this},setLength:function(length){var currentLength=this.length();if(!currentLength){return this}var scaleFactor=length/currentLength;return this.scale(scaleFactor,scaleFactor,this.start)},squaredLength:function(){return squaredLength(this.start,this.end)},tangentAt:function(t){if(!this.isDifferentiable()){return null}var start=this.start;var end=this.end;var tangentStart=this.pointAt(t);var tangentLine=new Line(start,end);tangentLine.translate(tangentStart.x-start.x,tangentStart.y-start.y);return tangentLine},tangentAtLength:function(length){if(!this.isDifferentiable()){return null}var start=this.start;var end=this.end;var tangentStart=this.pointAtLength(length);var tangentLine=new Line(start,end);tangentLine.translate(tangentStart.x-start.x,tangentStart.y-start.y);return tangentLine},toString:function(){return this.start.toString()+" "+this.end.toString()},serialize:function(){return this.start.serialize()+" "+this.end.serialize()},translate:function(tx,ty){this.start.translate(tx,ty);this.end.translate(tx,ty);return this},vector:function(){return new Point(this.end.x-this.start.x,this.end.y-this.start.y)}};Line.prototype.intersection=Line.prototype.intersect;var line=Line;var sqrt$1=Math.sqrt;var round$2=Math.round;var pow$1=Math.pow;var Ellipse=function(c,a,b){if(!(this instanceof Ellipse)){return new Ellipse(c,a,b)}if(c instanceof Ellipse){return new Ellipse(new Point(c.x,c.y),c.a,c.b)}c=new Point(c);this.x=c.x;this.y=c.y;this.a=a;this.b=b};Ellipse.fromRect=function(rect){rect=new Rect(rect);return new Ellipse(rect.center(),rect.width/2,rect.height/2)};Ellipse.prototype={type:types.Ellipse,bbox:function(){return new Rect(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},center:function(){return new Point(this.x,this.y)},clone:function(){return new Ellipse(this)},containsPoint:function(p){return this.normalizedDistance(p)<=1},equals:function(ellipse){return!!ellipse&&ellipse.x===this.x&&ellipse.y===this.y&&ellipse.a===this.a&&ellipse.b===this.b},inflate:function(dx,dy){if(dx===undefined){dx=0}if(dy===undefined){dy=dx}this.a+=2*dx;this.b+=2*dy;return this},intersectionWithLine:function(line){var intersections=[];var a1=line.start;var a2=line.end;var rx=this.a;var ry=this.b;var dir=line.vector();var diff=a1.difference(new Point(this));var mDir=new Point(dir.x/(rx*rx),dir.y/(ry*ry));var mDiff=new Point(diff.x/(rx*rx),diff.y/(ry*ry));var a=dir.dot(mDir);var b=dir.dot(mDiff);var c=diff.dot(mDiff)-1;var d=b*b-a*c;if(d<0){return null}else if(d>0){var root=sqrt$1(d);var ta=(-b-root)/a;var tb=(-b+root)/a;if((ta<0||1<ta)&&(tb<0||1<tb)){return null}else{if(0<=ta&&ta<=1){intersections.push(a1.lerp(a2,ta))}if(0<=tb&&tb<=1){intersections.push(a1.lerp(a2,tb))}}}else{var t=-b/a;if(0<=t&&t<=1){intersections.push(a1.lerp(a2,t))}else{return null}}return intersections},intersectionWithLineFromCenterToPoint:function(p,angle){p=new Point(p);if(angle){p.rotate(new Point(this.x,this.y),angle)}var dx=p.x-this.x;var dy=p.y-this.y;var result;if(dx===0){result=this.bbox().pointNearestToPoint(p);if(angle){return result.rotate(new Point(this.x,this.y),-angle)}return result}var m=dy/dx;var mSquared=m*m;var aSquared=this.a*this.a;var bSquared=this.b*this.b;var x=sqrt$1(1/(1/aSquared+mSquared/bSquared));x=dx<0?-x:x;var y=m*x;result=new Point(this.x+x,this.y+y);if(angle){return result.rotate(new Point(this.x,this.y),-angle)}return result},normalizedDistance:function(point){var x0=point.x;var y0=point.y;var a=this.a;var b=this.b;var x=this.x;var y=this.y;return(x0-x)*(x0-x)/(a*a)+(y0-y)*(y0-y)/(b*b)},round:function(precision){var f=1;if(precision){switch(precision){case 1:f=10;break;case 2:f=100;break;case 3:f=1e3;break;default:f=pow$1(10,precision);break}}this.x=round$2(this.x*f)/f;this.y=round$2(this.y*f)/f;this.a=round$2(this.a*f)/f;this.b=round$2(this.b*f)/f;return this},tangentTheta:function(p){var refPointDelta=30;var x0=p.x;var y0=p.y;var a=this.a;var b=this.b;var center=this.bbox().center();var m=center.x;var n=center.y;var q1=x0>center.x+a/2;var q3=x0<center.x-a/2;var y,x;if(q1||q3){y=x0>center.x?y0-refPointDelta:y0+refPointDelta;x=a*a/(x0-m)-a*a*(y0-n)*(y-n)/(b*b*(x0-m))+m}else{x=y0>center.y?x0+refPointDelta:x0-refPointDelta;y=b*b/(y0-n)-b*b*(x0-m)*(x-m)/(a*a*(y0-n))+n}return new Point(x,y).theta(p)},toString:function(){return new Point(this.x,this.y).toString()+" "+this.a+" "+this.b}};var ellipse=Ellipse;var abs$1=Math.abs;var cos$2=Math.cos;var sin$2=Math.sin;var min$5=Math.min;var max$3=Math.max;var round$3=Math.round;var pow$2=Math.pow;var Rect=function(x,y,w,h){if(!(this instanceof Rect)){return new Rect(x,y,w,h)}if(Object(x)===x){y=x.y;w=x.width;h=x.height;x=x.x}this.x=x===undefined?0:x;this.y=y===undefined?0:y;this.width=w===undefined?0:w;this.height=h===undefined?0:h};Rect.fromEllipse=function(e){e=new Ellipse(e);return new Rect(e.x-e.a,e.y-e.b,2*e.a,2*e.b)};Rect.fromPointUnion=function(){var points=[],len=arguments.length;while(len--)points[len]=arguments[len];if(points.length===0){return null}var p=new Point;var minX,minY,maxX,maxY;minX=minY=Infinity;maxX=maxY=-Infinity;for(var i=0;i<points.length;i++){p.update(points[i]);var x=p.x;var y=p.y;if(x<minX){minX=x}if(x>maxX){maxX=x}if(y<minY){minY=y}if(y>maxY){maxY=y}}return new Rect(minX,minY,maxX-minX,maxY-minY)};Rect.fromRectUnion=function(){var rects=[],len=arguments.length;while(len--)rects[len]=arguments[len];if(rects.length===0){return null}var r=new Rect;var minX,minY,maxX,maxY;minX=minY=Infinity;maxX=maxY=-Infinity;for(var i=0;i<rects.length;i++){r.update(rects[i]);var x=r.x;var y=r.y;var mX=x+r.width;var mY=y+r.height;if(x<minX){minX=x}if(mX>maxX){maxX=mX}if(y<minY){minY=y}if(mY>maxY){maxY=mY}}return new Rect(minX,minY,maxX-minX,maxY-minY)};Rect.prototype={type:types.Rect,bbox:function(angle){return this.clone().rotateAroundCenter(angle)},rotateAroundCenter:function(angle){if(!angle){return this}var ref=this;var width=ref.width;var height=ref.height;var theta=toRad(angle);var st=abs$1(sin$2(theta));var ct=abs$1(cos$2(theta));var w=width*ct+height*st;var h=width*st+height*ct;this.x+=(width-w)/2;this.y+=(height-h)/2;this.width=w;this.height=h;return this},bottomLeft:function(){return new Point(this.x,this.y+this.height)},bottomLine:function(){return new Line(this.bottomLeft(),this.bottomRight())},bottomMiddle:function(){return new Point(this.x+this.width/2,this.y+this.height)},center:function(){return new Point(this.x+this.width/2,this.y+this.height/2)},clone:function(){return new Rect(this)},containsPoint:function(p){p=new Point(p);return p.x>=this.x&&p.x<=this.x+this.width&&p.y>=this.y&&p.y<=this.y+this.height},containsRect:function(r){var r0=new Rect(this).normalize();var r1=new Rect(r).normalize();var w0=r0.width;var h0=r0.height;var w1=r1.width;var h1=r1.height;if(!w0||!h0||!w1||!h1){return false}var x0=r0.x;var y0=r0.y;var x1=r1.x;var y1=r1.y;w1+=x1;w0+=x0;h1+=y1;h0+=y0;return x0<=x1&&w1<=w0&&y0<=y1&&h1<=h0},corner:function(){return new Point(this.x+this.width,this.y+this.height)},equals:function(r){var mr=new Rect(this).normalize();var nr=new Rect(r).normalize();return mr.x===nr.x&&mr.y===nr.y&&mr.width===nr.width&&mr.height===nr.height},inflate:function(dx,dy){if(dx===undefined){dx=0}if(dy===undefined){dy=dx}this.x-=dx;this.y-=dy;this.width+=2*dx;this.height+=2*dy;return this},intersect:function(r){var myOrigin=this.origin();var myCorner=this.corner();var rOrigin=r.origin();var rCorner=r.corner();if(rCorner.x<=myOrigin.x||rCorner.y<=myOrigin.y||rOrigin.x>=myCorner.x||rOrigin.y>=myCorner.y){return null}var x=max$3(myOrigin.x,rOrigin.x);var y=max$3(myOrigin.y,rOrigin.y);return new Rect(x,y,min$5(myCorner.x,rCorner.x)-x,min$5(myCorner.y,rCorner.y)-y)},intersectionWithLine:function(line){var r=this;var rectLines=[r.topLine(),r.rightLine(),r.bottomLine(),r.leftLine()];var points=[];var dedupeArr=[];var pt,i;var n=rectLines.length;for(i=0;i<n;i++){pt=line.intersect(rectLines[i]);if(pt!==null&&dedupeArr.indexOf(pt.toString())<0){points.push(pt);dedupeArr.push(pt.toString())}}return points.length>0?points:null},intersectionWithLineFromCenterToPoint:function(p,angle){p=new Point(p);var center=new Point(this.x+this.width/2,this.y+this.height/2);var result;if(angle){p.rotate(center,angle)}var sides=[this.topLine(),this.rightLine(),this.bottomLine(),this.leftLine()];var connector=new Line(center,p);for(var i=sides.length-1;i>=0;--i){var intersection=sides[i].intersection(connector);if(intersection!==null){result=intersection;break}}if(result&&angle){result.rotate(center,-angle)}return result},leftLine:function(){return new Line(this.topLeft(),this.bottomLeft())},leftMiddle:function(){return new Point(this.x,this.y+this.height/2)},maxRectScaleToFit:function(rect,origin){rect=new Rect(rect);origin||(origin=rect.center());var sx1,sx2,sx3,sx4,sy1,sy2,sy3,sy4;var ox=origin.x;var oy=origin.y;sx1=sx2=sx3=sx4=sy1=sy2=sy3=sy4=Infinity;var p1=rect.topLeft();if(p1.x<ox){sx1=(this.x-ox)/(p1.x-ox)}if(p1.y<oy){sy1=(this.y-oy)/(p1.y-oy)}var p2=rect.bottomRight();if(p2.x>ox){sx2=(this.x+this.width-ox)/(p2.x-ox)}if(p2.y>oy){sy2=(this.y+this.height-oy)/(p2.y-oy)}var p3=rect.topRight();if(p3.x>ox){sx3=(this.x+this.width-ox)/(p3.x-ox)}if(p3.y<oy){sy3=(this.y-oy)/(p3.y-oy)}var p4=rect.bottomLeft();if(p4.x<ox){sx4=(this.x-ox)/(p4.x-ox)}if(p4.y>oy){sy4=(this.y+this.height-oy)/(p4.y-oy)}return{sx:min$5(sx1,sx2,sx3,sx4),sy:min$5(sy1,sy2,sy3,sy4)}},maxRectUniformScaleToFit:function(rect,origin){var scale=this.maxRectScaleToFit(rect,origin);return min$5(scale.sx,scale.sy)},moveAndExpand:function(r){this.x+=r.x||0;this.y+=r.y||0;this.width+=r.width||0;this.height+=r.height||0;return this},normalize:function(){var newx=this.x;var newy=this.y;var newwidth=this.width;var newheight=this.height;if(this.width<0){newx=this.x+this.width;newwidth=-this.width}if(this.height<0){newy=this.y+this.height;newheight=-this.height}this.x=newx;this.y=newy;this.width=newwidth;this.height=newheight;return this},offset:function(dx,dy){return Point.prototype.offset.call(this,dx,dy)},origin:function(){return new Point(this.x,this.y)},pointNearestToPoint:function(point){point=new Point(point);if(this.containsPoint(point)){var side=this.sideNearestToPoint(point);switch(side){case"right":return new Point(this.x+this.width,point.y);case"left":return new Point(this.x,point.y);case"bottom":return new Point(point.x,this.y+this.height);case"top":return new Point(point.x,this.y)}}return point.adhereToRect(this)},rightLine:function(){return new Line(this.topRight(),this.bottomRight())},rightMiddle:function(){return new Point(this.x+this.width,this.y+this.height/2)},round:function(precision){var f=1;if(precision){switch(precision){case 1:f=10;break;case 2:f=100;break;case 3:f=1e3;break;default:f=pow$2(10,precision);break}}this.x=round$3(this.x*f)/f;this.y=round$3(this.y*f)/f;this.width=round$3(this.width*f)/f;this.height=round$3(this.height*f)/f;return this},scale:function(sx,sy,origin){origin=this.origin().scale(sx,sy,origin);this.x=origin.x;this.y=origin.y;this.width*=sx;this.height*=sy;return this},sideNearestToPoint:function(point){point=new Point(point);var distToLeft=point.x-this.x;var distToRight=this.x+this.width-point.x;var distToTop=point.y-this.y;var distToBottom=this.y+this.height-point.y;var closest=distToLeft;var side="left";if(distToRight<closest){closest=distToRight;side="right"}if(distToTop<closest){closest=distToTop;side="top"}if(distToBottom<closest){side="bottom"}return side},snapToGrid:function(gx,gy){var origin=this.origin().snapToGrid(gx,gy);var corner=this.corner().snapToGrid(gx,gy);this.x=origin.x;this.y=origin.y;this.width=corner.x-origin.x;this.height=corner.y-origin.y;return this},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},topLine:function(){return new Line(this.topLeft(),this.topRight())},topMiddle:function(){return new Point(this.x+this.width/2,this.y)},topRight:function(){return new Point(this.x+this.width,this.y)},toString:function(){return this.origin().toString()+" "+this.corner().toString()},union:function(rect){return Rect.fromRectUnion(this,rect)},update:function(x,y,w,h){if(Object(x)===x){y=x.y;w=x.width;h=x.height;x=x.x}this.x=x||0;this.y=y||0;this.width=w||0;this.height=h||0;return this}};Rect.prototype.bottomRight=Rect.prototype.corner;Rect.prototype.topLeft=Rect.prototype.origin;Rect.prototype.translate=Rect.prototype.offset;var rect=Rect;function parsePoints(svgString){var trimmedString=svgString.trim();if(trimmedString===""){return[]}var points=[];var coords=trimmedString.split(/\b\s*,\s*|,\s*|\s+/);var numCoords=coords.length;for(var i=0;i<numCoords;i+=2){points.push({x:+coords[i],y:+coords[i+1]})}return points}function clonePoints(points){var numPoints=points.length;if(numPoints===0){return[]}var newPoints=[];for(var i=0;i<numPoints;i++){var point=points[i].clone();newPoints.push(point)}return newPoints}function convexHull(points){var abs=Math.abs;var i;var n;var numPoints=points.length;if(numPoints===0){return[]}var startPoint;for(i=0;i<numPoints;i++){if(startPoint===undefined){startPoint=points[i]}else if(points[i].y<startPoint.y){startPoint=points[i]}else if(points[i].y===startPoint.y&&points[i].x>startPoint.x){startPoint=points[i]}}var sortedPointRecords=[];for(i=0;i<numPoints;i++){var angle=startPoint.theta(points[i]);if(angle===0){angle=360}var entry=[points[i],i,angle];sortedPointRecords.push(entry)}sortedPointRecords.sort(function(record1,record2){var sortOutput=record1[2]-record2[2];if(sortOutput===0){sortOutput=record2[1]-record1[1]}return sortOutput});if(sortedPointRecords.length>2){var startPointRecord=sortedPointRecords[sortedPointRecords.length-1];sortedPointRecords.unshift(startPointRecord)}var insidePoints={};var hullPointRecords=[];var currentPointRecord;var currentPoint;var lastHullPointRecord;var lastHullPoint;var secondLastHullPointRecord;var secondLastHullPoint;while(sortedPointRecords.length!==0){currentPointRecord=sortedPointRecords.pop();currentPoint=currentPointRecord[0];if(insidePoints.hasOwnProperty(currentPointRecord[0]+"@@"+currentPointRecord[1])){continue}var correctTurnFound=false;while(!correctTurnFound){if(hullPointRecords.length<2){hullPointRecords.push(currentPointRecord);correctTurnFound=true}else{lastHullPointRecord=hullPointRecords.pop();lastHullPoint=lastHullPointRecord[0];secondLastHullPointRecord=hullPointRecords.pop();secondLastHullPoint=secondLastHullPointRecord[0];var crossProduct=secondLastHullPoint.cross(lastHullPoint,currentPoint);if(crossProduct<0){hullPointRecords.push(secondLastHullPointRecord);hullPointRecords.push(lastHullPointRecord);hullPointRecords.push(currentPointRecord);correctTurnFound=true}else if(crossProduct===0){var THRESHOLD=1e-10;var angleBetween=lastHullPoint.angleBetween(secondLastHullPoint,currentPoint);if(abs(angleBetween-180)<THRESHOLD){insidePoints[lastHullPointRecord[0]+"@@"+lastHullPointRecord[1]]=lastHullPoint;hullPointRecords.push(secondLastHullPointRecord)}else if(lastHullPoint.equals(currentPoint)||secondLastHullPoint.equals(lastHullPoint)){insidePoints[lastHullPointRecord[0]+"@@"+lastHullPointRecord[1]]=lastHullPoint;hullPointRecords.push(secondLastHullPointRecord)}else if(abs((angleBetween+1)%360-1)<THRESHOLD){hullPointRecords.push(secondLastHullPointRecord);sortedPointRecords.push(lastHullPointRecord)}}else{insidePoints[lastHullPointRecord[0]+"@@"+lastHullPointRecord[1]]=lastHullPoint;hullPointRecords.push(secondLastHullPointRecord)}}}}if(hullPointRecords.length>2){hullPointRecords.pop()}var lowestHullIndex;var indexOfLowestHullIndexRecord=-1;n=hullPointRecords.length;for(i=0;i<n;i++){var currentHullIndex=hullPointRecords[i][1];if(lowestHullIndex===undefined||currentHullIndex<lowestHullIndex){lowestHullIndex=currentHullIndex;indexOfLowestHullIndexRecord=i}}var hullPointRecordsReordered=[];if(indexOfLowestHullIndexRecord>0){var newFirstChunk=hullPointRecords.slice(indexOfLowestHullIndexRecord);var newSecondChunk=hullPointRecords.slice(0,indexOfLowestHullIndexRecord);hullPointRecordsReordered=newFirstChunk.concat(newSecondChunk)}else{hullPointRecordsReordered=hullPointRecords}var hullPoints=[];n=hullPointRecordsReordered.length;for(i=0;i<n;i++){hullPoints.push(hullPointRecordsReordered[i][0])}return hullPoints}var Polyline=function(points){if(!(this instanceof Polyline)){return new Polyline(points)}if(typeof points==="string"){return new Polyline.parse(points)}this.points=Array.isArray(points)?points.map(Point):[]};Polyline.parse=function(svgString){return new Polyline(parsePoints(svgString))};Polyline.fromRect=function(rect){return new Polyline([rect.topLeft(),rect.topRight(),rect.bottomRight(),rect.bottomLeft(),rect.topLeft()])};Polyline.prototype={type:types.Polyline,bbox:function(){var x1=Infinity;var x2=-Infinity;var y1=Infinity;var y2=-Infinity;var points=this.points;var numPoints=points.length;if(numPoints===0){return null}for(var i=0;i<numPoints;i++){var point=points[i];var x=point.x;var y=point.y;if(x<x1){x1=x}if(x>x2){x2=x}if(y<y1){y1=y}if(y>y2){y2=y}}return new Rect(x1,y1,x2-x1,y2-y1)},clone:function(){return new Polyline(clonePoints(this.points))},closestPoint:function(p){var cpLength=this.closestPointLength(p);return this.pointAtLength(cpLength)},closestPointLength:function(p){var points=this.lengthPoints();var numPoints=points.length;if(numPoints===0){return 0}if(numPoints===1){return 0}var cpLength;var minSqrDistance=Infinity;var length=0;var n=numPoints-1;for(var i=0;i<n;i++){var line=new Line(points[i],points[i+1]);var lineLength=line.length();var cpNormalizedLength=line.closestPointNormalizedLength(p);var cp=line.pointAt(cpNormalizedLength);var sqrDistance=cp.squaredDistance(p);if(sqrDistance<minSqrDistance){minSqrDistance=sqrDistance;cpLength=length+cpNormalizedLength*lineLength}length+=lineLength}return cpLength},closestPointNormalizedLength:function(p){var cpLength=this.closestPointLength(p);if(cpLength===0){return 0}var length=this.length();if(length===0){return 0}return cpLength/length},closestPointTangent:function(p){var cpLength=this.closestPointLength(p);return this.tangentAtLength(cpLength)},containsPoint:function(p){var points=this.points;var numPoints=points.length;if(numPoints===0){return false}var x=p.x;var y=p.y;var startIndex=numPoints-1;var endIndex=0;var numIntersections=0;var segment=new Line;var ray=new Line;var rayEnd=new Point;for(;endIndex<numPoints;endIndex++){var start=points[startIndex];var end=points[endIndex];if(p.equals(start)){return true}segment.start=start;segment.end=end;if(segment.containsPoint(p)){return true}if(y<=start.y&&y>end.y||y>start.y&&y<=end.y){var xDifference=start.x-x>end.x-x?start.x-x:end.x-x;if(xDifference>=0){rayEnd.x=x+xDifference;rayEnd.y=y;ray.start=p;ray.end=rayEnd;if(segment.intersect(ray)){numIntersections++}}}startIndex=endIndex}return numIntersections%2===1},close:function(){var ref=this;var start=ref.start;var end=ref.end;var points=ref.points;if(start&&end&&!start.equals(end)){points.push(start.clone())}return this},lengthPoints:function(){return this.points},convexHull:function(){return new Polyline(convexHull(this.points))},equals:function(p){if(!p){return false}var points=this.points;var otherPoints=p.points;var numPoints=points.length;if(otherPoints.length!==numPoints){return false}for(var i=0;i<numPoints;i++){var point=points[i];var otherPoint=p.points[i];if(!point.equals(otherPoint)){return false}}return true},intersectionWithLine:function(l){var line=new Line(l);var intersections=[];var points=this.lengthPoints();var l2=new Line;for(var i=0,n=points.length-1;i<n;i++){l2.start=points[i];l2.end=points[i+1];var int=line.intersectionWithLine(l2);if(int){intersections.push(int[0])}}return intersections.length>0?intersections:null},isDifferentiable:function(){var points=this.points;var numPoints=points.length;if(numPoints===0){return false}var line=new Line;var n=numPoints-1;for(var i=0;i<n;i++){line.start=points[i];line.end=points[i+1];if(line.isDifferentiable()){return true}}return false},length:function(){var points=this.lengthPoints();var numPoints=points.length;if(numPoints===0){return 0}var length=0;var n=numPoints-1;for(var i=0;i<n;i++){length+=points[i].distance(points[i+1])}return length},pointAt:function(ratio){var points=this.lengthPoints();var numPoints=points.length;if(numPoints===0){return null}if(numPoints===1){return points[0].clone()}if(ratio<=0){return points[0].clone()}if(ratio>=1){return points[numPoints-1].clone()}var polylineLength=this.length();var length=polylineLength*ratio;return this.pointAtLength(length)},pointAtLength:function(length){var points=this.lengthPoints();var numPoints=points.length;if(numPoints===0){return null}if(numPoints===1){return points[0].clone()}var fromStart=true;if(length<0){fromStart=false;length=-length}var l=0;var n=numPoints-1;for(var i=0;i<n;i++){var index=fromStart?i:n-1-i;var a=points[index];var b=points[index+1];var line=new Line(a,b);var d=a.distance(b);if(length<=l+d){return line.pointAtLength((fromStart?1:-1)*(length-l))}l+=d}var lastPoint=fromStart?points[numPoints-1]:points[0];return lastPoint.clone()},round:function(precision){var points=this.points;var numPoints=points.length;for(var i=0;i<numPoints;i++){points[i].round(precision)}return this},scale:function(sx,sy,origin){var points=this.points;var numPoints=points.length;for(var i=0;i<numPoints;i++){points[i].scale(sx,sy,origin)}return this},simplify:function(opt){if(opt===void 0)opt={};var points=this.points;if(points.length<3){return this}var threshold=opt.threshold||0;var currentIndex=0;while(points[currentIndex+2]){var firstIndex=currentIndex;var middleIndex=currentIndex+1;var lastIndex=currentIndex+2;var firstPoint=points[firstIndex];var middlePoint=points[middleIndex];var lastPoint=points[lastIndex];var chord=new Line(firstPoint,lastPoint);var closestPoint=chord.closestPoint(middlePoint);var closestPointDistance=closestPoint.distance(middlePoint);if(closestPointDistance<=threshold){points.splice(middleIndex,1)}else{currentIndex+=1}}return this},tangentAt:function(ratio){var points=this.lengthPoints();var numPoints=points.length;if(numPoints===0){return null}if(numPoints===1){return null}if(ratio<0){ratio=0}if(ratio>1){ratio=1}var polylineLength=this.length();var length=polylineLength*ratio;return this.tangentAtLength(length)},tangentAtLength:function(length){var points=this.lengthPoints();var numPoints=points.length;if(numPoints===0){return null}if(numPoints===1){return null}var fromStart=true;if(length<0){fromStart=false;length=-length}var lastValidLine;var l=0;var n=numPoints-1;for(var i=0;i<n;i++){var index=fromStart?i:n-1-i;var a=points[index];var b=points[index+1];var line=new Line(a,b);var d=a.distance(b);if(line.isDifferentiable()){if(length<=l+d){return line.tangentAtLength((fromStart?1:-1)*(length-l))}lastValidLine=line}l+=d}if(lastValidLine){var ratio=fromStart?1:0;return lastValidLine.tangentAt(ratio)}return null},toString:function(){return this.points+""},translate:function(tx,ty){var points=this.points;var numPoints=points.length;for(var i=0;i<numPoints;i++){points[i].translate(tx,ty)}return this},serialize:function(){var points=this.points;var numPoints=points.length;if(numPoints===0){return""}var output="";for(var i=0;i<numPoints;i++){var point=points[i];output+=point.x+","+point.y+" "}return output.trim()}};Object.defineProperty(Polyline.prototype,"start",{configurable:true,enumerable:true,get:function(){var points=this.points;var numPoints=points.length;if(numPoints===0){return null}return this.points[0]}});Object.defineProperty(Polyline.prototype,"end",{configurable:true,enumerable:true,get:function(){var points=this.points;var numPoints=points.length;if(numPoints===0){return null}return this.points[numPoints-1]}});var abs$2=Math.abs;var sqrt$2=Math.sqrt;var min$6=Math.min;var max$4=Math.max;var pow$3=Math.pow;var Curve=function(p1,p2,p3,p4){if(!(this instanceof Curve)){return new Curve(p1,p2,p3,p4)}if(p1 instanceof Curve){return new Curve(p1.start,p1.controlPoint1,p1.controlPoint2,p1.end)}this.start=new Point(p1);this.controlPoint1=new Point(p2);this.controlPoint2=new Point(p3);this.end=new Point(p4)};Curve.throughPoints=function(){function getCurveControlPoints(knots){var firstControlPoints=[];var secondControlPoints=[];var n=knots.length-1;var i;if(n==1){firstControlPoints[0]=new Point((2*knots[0].x+knots[1].x)/3,(2*knots[0].y+knots[1].y)/3);secondControlPoints[0]=new Point(2*firstControlPoints[0].x-knots[0].x,2*firstControlPoints[0].y-knots[0].y);return[firstControlPoints,secondControlPoints]}var rhs=[];for(i=1;i<n-1;i++){rhs[i]=4*knots[i].x+2*knots[i+1].x}rhs[0]=knots[0].x+2*knots[1].x;rhs[n-1]=(8*knots[n-1].x+knots[n].x)/2;var x=getFirstControlPoints(rhs);for(i=1;i<n-1;++i){rhs[i]=4*knots[i].y+2*knots[i+1].y}rhs[0]=knots[0].y+2*knots[1].y;rhs[n-1]=(8*knots[n-1].y+knots[n].y)/2;var y=getFirstControlPoints(rhs);for(i=0;i<n;i++){firstControlPoints.push(new Point(x[i],y[i]));if(i<n-1){secondControlPoints.push(new Point(2*knots[i+1].x-x[i+1],2*knots[i+1].y-y[i+1]))}else{secondControlPoints.push(new Point((knots[n].x+x[n-1])/2,(knots[n].y+y[n-1])/2))}}return[firstControlPoints,secondControlPoints]}function getFirstControlPoints(rhs){var n=rhs.length;var x=[];var tmp=[];var b=2;x[0]=rhs[0]/b;for(var i=1;i<n;i++){tmp[i]=1/b;b=(i<n-1?4:3.5)-tmp[i];x[i]=(rhs[i]-x[i-1])/b}for(i=1;i<n;i++){x[n-i-1]-=tmp[n-i]*x[n-i]}return x}return function(points){if(!points||Array.isArray(points)&&points.length<2){throw new Error("At least 2 points are required")}var controlPoints=getCurveControlPoints(points);var curves=[];var n=controlPoints[0].length;for(var i=0;i<n;i++){var controlPoint1=new Point(controlPoints[0][i].x,controlPoints[0][i].y);var controlPoint2=new Point(controlPoints[1][i].x,controlPoints[1][i].y);curves.push(new Curve(points[i],controlPoint1,controlPoint2,points[i+1]))}return curves}}();Curve.prototype={type:types.Curve,bbox:function(){var start=this.start;var controlPoint1=this.controlPoint1;var controlPoint2=this.controlPoint2;var end=this.end;var x0=start.x;var y0=start.y;var x1=controlPoint1.x;var y1=controlPoint1.y;var x2=controlPoint2.x;var y2=controlPoint2.y;var x3=end.x;var y3=end.y;var points=new Array;var tvalues=new Array;var bounds=[new Array,new Array];var a,b,c,t;var t1,t2;var b2ac,sqrtb2ac;for(var i=0;i<2;++i){if(i===0){b=6*x0-12*x1+6*x2;a=-3*x0+9*x1-9*x2+3*x3;c=3*x1-3*x0}else{b=6*y0-12*y1+6*y2;a=-3*y0+9*y1-9*y2+3*y3;c=3*y1-3*y0}if(abs$2(a)<1e-12){if(abs$2(b)<1e-12){continue}t=-c/b;if(0<t&&t<1){tvalues.push(t)}continue}b2ac=b*b-4*c*a;sqrtb2ac=sqrt$2(b2ac);if(b2ac<0){continue}t1=(-b+sqrtb2ac)/(2*a);if(0<t1&&t1<1){tvalues.push(t1)}t2=(-b-sqrtb2ac)/(2*a);if(0<t2&&t2<1){tvalues.push(t2)}}var j=tvalues.length;var jlen=j;var mt;var x,y;while(j--){t=tvalues[j];mt=1-t;x=mt*mt*mt*x0+3*mt*mt*t*x1+3*mt*t*t*x2+t*t*t*x3;bounds[0][j]=x;y=mt*mt*mt*y0+3*mt*mt*t*y1+3*mt*t*t*y2+t*t*t*y3;bounds[1][j]=y;points[j]={X:x,Y:y}}tvalues[jlen]=0;tvalues[jlen+1]=1;points[jlen]={X:x0,Y:y0};points[jlen+1]={X:x3,Y:y3};bounds[0][jlen]=x0;bounds[1][jlen]=y0;bounds[0][jlen+1]=x3;bounds[1][jlen+1]=y3;tvalues.length=jlen+2;bounds[0].length=jlen+2;bounds[1].length=jlen+2;points.length=jlen+2;var left=min$6.apply(null,bounds[0]);var top=min$6.apply(null,bounds[1]);var right=max$4.apply(null,bounds[0]);var bottom=max$4.apply(null,bounds[1]);return new Rect(left,top,right-left,bottom-top)},clone:function(){return new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end)},closestPoint:function(p,opt){return this.pointAtT(this.closestPointT(p,opt))},closestPointLength:function(p,opt){opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subdivisions=opt.subdivisions===undefined?this.getSubdivisions({precision:precision}):opt.subdivisions;var localOpt={precision:precision,subdivisions:subdivisions};return this.lengthAtT(this.closestPointT(p,localOpt),localOpt)},closestPointNormalizedLength:function(p,opt){opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subdivisions=opt.subdivisions===undefined?this.getSubdivisions({precision:precision}):opt.subdivisions;var localOpt={precision:precision,subdivisions:subdivisions};var cpLength=this.closestPointLength(p,localOpt);if(!cpLength){return 0}var length=this.length(localOpt);if(length===0){return 0}return cpLength/length},closestPointT:function(p,opt){opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subdivisions=opt.subdivisions===undefined?this.getSubdivisions({precision:precision}):opt.subdivisions;var investigatedSubdivision;var investigatedSubdivisionStartT;var investigatedSubdivisionEndT;var distFromStart;var distFromEnd;var chordLength;var minSumDist;var n=subdivisions.length;var subdivisionSize=n?1/n:0;for(var i=0;i<n;i++){var currentSubdivision=subdivisions[i];var startDist=currentSubdivision.start.distance(p);var endDist=currentSubdivision.end.distance(p);var sumDist=startDist+endDist;if(!minSumDist||sumDist<minSumDist){investigatedSubdivision=currentSubdivision;investigatedSubdivisionStartT=i*subdivisionSize;investigatedSubdivisionEndT=(i+1)*subdivisionSize;distFromStart=startDist;distFromEnd=endDist;chordLength=currentSubdivision.start.distance(currentSubdivision.end);minSumDist=sumDist}}var precisionRatio=pow$3(10,-precision);while(true){var startPrecisionRatio=distFromStart?abs$2(distFromStart-distFromEnd)/distFromStart:0;var endPrecisionRatio=distFromEnd?abs$2(distFromStart-distFromEnd)/distFromEnd:0;var hasRequiredPrecision=startPrecisionRatio<precisionRatio||endPrecisionRatio<precisionRatio;var hasMinimalStartDistance=distFromStart?distFromStart<chordLength*precisionRatio:true;var hasMinimalEndDistance=distFromEnd?distFromEnd<chordLength*precisionRatio:true;var hasMinimalDistance=hasMinimalStartDistance||hasMinimalEndDistance;if(hasRequiredPrecision||hasMinimalDistance){return distFromStart<=distFromEnd?investigatedSubdivisionStartT:investigatedSubdivisionEndT}var divided=investigatedSubdivision.divide(.5);subdivisionSize/=2;var startDist1=divided[0].start.distance(p);var endDist1=divided[0].end.distance(p);var sumDist1=startDist1+endDist1;var startDist2=divided[1].start.distance(p);var endDist2=divided[1].end.distance(p);var sumDist2=startDist2+endDist2;if(sumDist1<=sumDist2){investigatedSubdivision=divided[0];investigatedSubdivisionEndT-=subdivisionSize;distFromStart=startDist1;distFromEnd=endDist1}else{investigatedSubdivision=divided[1];investigatedSubdivisionStartT+=subdivisionSize;distFromStart=startDist2;distFromEnd=endDist2}}},closestPointTangent:function(p,opt){return this.tangentAtT(this.closestPointT(p,opt))},containsPoint:function(p,opt){var polyline=this.toPolyline(opt);return polyline.containsPoint(p)},divideAt:function(ratio,opt){if(ratio<=0){return this.divideAtT(0)}if(ratio>=1){return this.divideAtT(1)}var t=this.tAt(ratio,opt);return this.divideAtT(t)},divideAtLength:function(length,opt){var t=this.tAtLength(length,opt);return this.divideAtT(t)},divideAtT:function(t){var start=this.start;var controlPoint1=this.controlPoint1;var controlPoint2=this.controlPoint2;var end=this.end;if(t<=0){return[new Curve(start,start,start,start),new Curve(start,controlPoint1,controlPoint2,end)]}if(t>=1){return[new Curve(start,controlPoint1,controlPoint2,end),new Curve(end,end,end,end)]}var dividerPoints=this.getSkeletonPoints(t);var startControl1=dividerPoints.startControlPoint1;var startControl2=dividerPoints.startControlPoint2;var divider=dividerPoints.divider;var dividerControl1=dividerPoints.dividerControlPoint1;var dividerControl2=dividerPoints.dividerControlPoint2;return[new Curve(start,startControl1,startControl2,divider),new Curve(divider,dividerControl1,dividerControl2,end)]},endpointDistance:function(){return this.start.distance(this.end)},equals:function(c){return!!c&&this.start.x===c.start.x&&this.start.y===c.start.y&&this.controlPoint1.x===c.controlPoint1.x&&this.controlPoint1.y===c.controlPoint1.y&&this.controlPoint2.x===c.controlPoint2.x&&this.controlPoint2.y===c.controlPoint2.y&&this.end.x===c.end.x&&this.end.y===c.end.y},getSkeletonPoints:function(t){var start=this.start;var control1=this.controlPoint1;var control2=this.controlPoint2;var end=this.end;if(t<=0){return{startControlPoint1:start.clone(),startControlPoint2:start.clone(),divider:start.clone(),dividerControlPoint1:control1.clone(),dividerControlPoint2:control2.clone()}}if(t>=1){return{startControlPoint1:control1.clone(),startControlPoint2:control2.clone(),divider:end.clone(),dividerControlPoint1:end.clone(),dividerControlPoint2:end.clone()}}var midpoint1=new Line(start,control1).pointAt(t);var midpoint2=new Line(control1,control2).pointAt(t);var midpoint3=new Line(control2,end).pointAt(t);var subControl1=new Line(midpoint1,midpoint2).pointAt(t);var subControl2=new Line(midpoint2,midpoint3).pointAt(t);var divider=new Line(subControl1,subControl2).pointAt(t);var output={startControlPoint1:midpoint1,startControlPoint2:subControl1,divider:divider,dividerControlPoint1:subControl2,dividerControlPoint2:midpoint3};return output},getSubdivisions:function(opt){opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subdivisions=[new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end)];if(precision===0){return subdivisions}var previousLength=this.endpointDistance();var precisionRatio=pow$3(10,-precision);var iteration=0;while(true){iteration+=1;var newSubdivisions=[];var numSubdivisions=subdivisions.length;for(var i=0;i<numSubdivisions;i++){var currentSubdivision=subdivisions[i];var divided=currentSubdivision.divide(.5);newSubdivisions.push(divided[0],divided[1])}var length=0;var numNewSubdivisions=newSubdivisions.length;for(var j=0;j<numNewSubdivisions;j++){var currentNewSubdivision=newSubdivisions[j];length+=currentNewSubdivision.endpointDistance()}var observedPrecisionRatio=length!==0?(length-previousLength)/length:0;if(iteration>1&&observedPrecisionRatio<precisionRatio){return newSubdivisions}subdivisions=newSubdivisions;previousLength=length}},isDifferentiable:function(){var start=this.start;var control1=this.controlPoint1;var control2=this.controlPoint2;var end=this.end;return!(start.equals(control1)&&control1.equals(control2)&&control2.equals(end))},length:function(opt){opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subdivisions=opt.subdivisions===undefined?this.getSubdivisions({precision:precision}):opt.subdivisions;var length=0;var n=subdivisions.length;for(var i=0;i<n;i++){var currentSubdivision=subdivisions[i];length+=currentSubdivision.endpointDistance()}return length},lengthAtT:function(t,opt){if(t<=0){return 0}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subCurve=this.divide(t)[0];var subCurveLength=subCurve.length({precision:precision});return subCurveLength},pointAt:function(ratio,opt){if(ratio<=0){return this.start.clone()}if(ratio>=1){return this.end.clone()}var t=this.tAt(ratio,opt);return this.pointAtT(t)},pointAtLength:function(length,opt){var t=this.tAtLength(length,opt);return this.pointAtT(t)},pointAtT:function(t){if(t<=0){return this.start.clone()}if(t>=1){return this.end.clone()}return this.getSkeletonPoints(t).divider},PRECISION:3,round:function(precision){this.start.round(precision);this.controlPoint1.round(precision);this.controlPoint2.round(precision);this.end.round(precision);return this},scale:function(sx,sy,origin){this.start.scale(sx,sy,origin);this.controlPoint1.scale(sx,sy,origin);this.controlPoint2.scale(sx,sy,origin);this.end.scale(sx,sy,origin);return this},tangentAt:function(ratio,opt){if(!this.isDifferentiable()){return null}if(ratio<0){ratio=0}else if(ratio>1){ratio=1}var t=this.tAt(ratio,opt);return this.tangentAtT(t)},tangentAtLength:function(length,opt){if(!this.isDifferentiable()){return null}var t=this.tAtLength(length,opt);return this.tangentAtT(t)},tangentAtT:function(t){if(!this.isDifferentiable()){return null}if(t<0){t=0}else if(t>1){t=1}var skeletonPoints=this.getSkeletonPoints(t);var p1=skeletonPoints.startControlPoint2;var p2=skeletonPoints.dividerControlPoint1;var tangentStart=skeletonPoints.divider;var tangentLine=new Line(p1,p2);tangentLine.translate(tangentStart.x-p1.x,tangentStart.y-p1.y);return tangentLine},tAt:function(ratio,opt){if(ratio<=0){return 0}if(ratio>=1){return 1}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subdivisions=opt.subdivisions===undefined?this.getSubdivisions({precision:precision}):opt.subdivisions;var localOpt={precision:precision,subdivisions:subdivisions};var curveLength=this.length(localOpt);var length=curveLength*ratio;return this.tAtLength(length,localOpt)},tAtLength:function(length,opt){var fromStart=true;if(length<0){fromStart=false;length=-length}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subdivisions=opt.subdivisions===undefined?this.getSubdivisions({precision:precision}):opt.subdivisions;var localOpt={precision:precision,subdivisions:subdivisions};var investigatedSubdivision;var investigatedSubdivisionStartT;var investigatedSubdivisionEndT;var baselinePointDistFromStart;var baselinePointDistFromEnd;var l=0;var n=subdivisions.length;var subdivisionSize=1/n;for(var i=0;i<n;i++){var index=fromStart?i:n-1-i;var currentSubdivision=subdivisions[i];var d=currentSubdivision.endpointDistance();if(length<=l+d){investigatedSubdivision=currentSubdivision;investigatedSubdivisionStartT=index*subdivisionSize;investigatedSubdivisionEndT=(index+1)*subdivisionSize;baselinePointDistFromStart=fromStart?length-l:d+l-length;baselinePointDistFromEnd=fromStart?d+l-length:length-l;break}l+=d}if(!investigatedSubdivision){return fromStart?1:0}var curveLength=this.length(localOpt);var precisionRatio=pow$3(10,-precision);while(true){var observedPrecisionRatio;observedPrecisionRatio=curveLength!==0?baselinePointDistFromStart/curveLength:0;if(observedPrecisionRatio<precisionRatio){return investigatedSubdivisionStartT}observedPrecisionRatio=curveLength!==0?baselinePointDistFromEnd/curveLength:0;if(observedPrecisionRatio<precisionRatio){return investigatedSubdivisionEndT}var newBaselinePointDistFromStart;var newBaselinePointDistFromEnd;var divided=investigatedSubdivision.divide(.5);subdivisionSize/=2;var baseline1Length=divided[0].endpointDistance();var baseline2Length=divided[1].endpointDistance();if(baselinePointDistFromStart<=baseline1Length){investigatedSubdivision=divided[0];investigatedSubdivisionEndT-=subdivisionSize;newBaselinePointDistFromStart=baselinePointDistFromStart;newBaselinePointDistFromEnd=baseline1Length-newBaselinePointDistFromStart}else{investigatedSubdivision=divided[1];investigatedSubdivisionStartT+=subdivisionSize;newBaselinePointDistFromStart=baselinePointDistFromStart-baseline1Length;newBaselinePointDistFromEnd=baseline2Length-newBaselinePointDistFromStart}baselinePointDistFromStart=newBaselinePointDistFromStart;baselinePointDistFromEnd=newBaselinePointDistFromEnd}},toPoints:function(opt){opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var subdivisions=opt.subdivisions===undefined?this.getSubdivisions({precision:precision}):opt.subdivisions;var points=[subdivisions[0].start.clone()];var n=subdivisions.length;for(var i=0;i<n;i++){var currentSubdivision=subdivisions[i];points.push(currentSubdivision.end.clone())}return points},toPolyline:function(opt){return new Polyline(this.toPoints(opt))},toString:function(){return this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(tx,ty){this.start.translate(tx,ty);this.controlPoint1.translate(tx,ty);this.controlPoint2.translate(tx,ty);this.end.translate(tx,ty);return this}};Curve.prototype.divide=Curve.prototype.divideAtT;function extend(obj){var arguments$1=arguments;var i;var n;var args=[];n=arguments.length;for(i=1;i<n;i++){args.push(arguments$1[i])}if(!obj){throw new Error("Missing a parent object.")}var child=Object.create(obj);n=args.length;for(i=0;i<n;i++){var src=args[i];var inheritedProperty;var key;for(key in src){if(src.hasOwnProperty(key)){delete child[key];inheritedProperty=Object.getOwnPropertyDescriptor(src,key);Object.defineProperty(child,key,inheritedProperty)}}}return child}var Path=function(arg){if(!(this instanceof Path)){return new Path(arg)}if(typeof arg==="string"){return new Path.parse(arg)}this.segments=[];var i;var n;if(!arg){}else if(Array.isArray(arg)&&arg.length!==0){arg=arg.reduce(function(acc,val){return acc.concat(val)},[]);n=arg.length;if(arg[0].isSegment){for(i=0;i<n;i++){var segment=arg[i];this.appendSegment(segment)}}else{var previousObj=null;for(i=0;i<n;i++){var obj=arg[i];if(!(obj instanceof Line||obj instanceof Curve)){throw new Error("Cannot construct a path segment from the provided object.")}if(i===0){this.appendSegment(Path.createSegment("M",obj.start))}if(previousObj&&!previousObj.end.equals(obj.start)){this.appendSegment(Path.createSegment("M",obj.start))}if(obj instanceof Line){this.appendSegment(Path.createSegment("L",obj.end))}else if(obj instanceof Curve){this.appendSegment(Path.createSegment("C",obj.controlPoint1,obj.controlPoint2,obj.end))}previousObj=obj}}}else if(arg.isSegment){this.appendSegment(arg)}else if(arg instanceof Line){this.appendSegment(Path.createSegment("M",arg.start));this.appendSegment(Path.createSegment("L",arg.end))}else if(arg instanceof Curve){this.appendSegment(Path.createSegment("M",arg.start));this.appendSegment(Path.createSegment("C",arg.controlPoint1,arg.controlPoint2,arg.end))}else if(arg instanceof Polyline){if(!(arg.points&&arg.points.length!==0)){return}n=arg.points.length;for(i=0;i<n;i++){var point=arg.points[i];if(i===0){this.appendSegment(Path.createSegment("M",point))}else{this.appendSegment(Path.createSegment("L",point))}}}else{throw new Error("Cannot construct a path from the provided object.")}};Path.parse=function(pathData){if(!pathData){return new Path}var path=new Path;var commandRe=/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g;var commands=pathData.match(commandRe);var numCommands=commands.length;for(var i=0;i<numCommands;i++){var command=commands[i];var argRe=/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g;var args=command.match(argRe);var segment=Path.createSegment.apply(this,args);path.appendSegment(segment)}return path};Path.createSegment=function(type){var arguments$1=arguments;if(!type){throw new Error("Type must be provided.")}var segmentConstructor=Path.segmentTypes[type];if(!segmentConstructor){throw new Error(type+" is not a recognized path segment type.")}var args=[];var n=arguments.length;for(var i=1;i<n;i++){args.push(arguments$1[i])}return applyToNew(segmentConstructor,args)};Path.prototype={type:types.Path,appendSegment:function(arg){var segments=this.segments;var numSegments=segments.length;var currentSegment;var previousSegment=numSegments!==0?segments[numSegments-1]:null;var nextSegment=null;if(!Array.isArray(arg)){if(!arg||!arg.isSegment){throw new Error("Segment required.")}currentSegment=this.prepareSegment(arg,previousSegment,nextSegment);segments.push(currentSegment)}else{arg=arg.reduce(function(acc,val){return acc.concat(val)},[]);if(!arg[0].isSegment){throw new Error("Segments required.")}var n=arg.length;for(var i=0;i<n;i++){var currentArg=arg[i];currentSegment=this.prepareSegment(currentArg,previousSegment,nextSegment);segments.push(currentSegment);previousSegment=currentSegment}}},bbox:function(){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}var bbox;for(var i=0;i<numSegments;i++){var segment=segments[i];if(segment.isVisible){var segmentBBox=segment.bbox();bbox=bbox?bbox.union(segmentBBox):segmentBBox}}if(bbox){return bbox}var lastSegment=segments[numSegments-1];return new Rect(lastSegment.end.x,lastSegment.end.y,0,0)},clone:function(){var segments=this.segments;var numSegments=segments.length;var path=new Path;for(var i=0;i<numSegments;i++){var segment=segments[i].clone();path.appendSegment(segment)}return path},closestPoint:function(p,opt){var t=this.closestPointT(p,opt);if(!t){return null}return this.pointAtT(t)},closestPointLength:function(p,opt){opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var localOpt={precision:precision,segmentSubdivisions:segmentSubdivisions};var t=this.closestPointT(p,localOpt);if(!t){return 0}return this.lengthAtT(t,localOpt)},closestPointNormalizedLength:function(p,opt){opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var localOpt={precision:precision,segmentSubdivisions:segmentSubdivisions};var cpLength=this.closestPointLength(p,localOpt);if(cpLength===0){return 0}var length=this.length(localOpt);if(length===0){return 0}return cpLength/length},closestPointT:function(p,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var closestPointT;var minSquaredDistance=Infinity;for(var i=0;i<numSegments;i++){var segment=segments[i];var subdivisions=segmentSubdivisions[i];if(segment.isVisible){var segmentClosestPointT=segment.closestPointT(p,{precision:precision,subdivisions:subdivisions});var segmentClosestPoint=segment.pointAtT(segmentClosestPointT);var squaredDistance=new Line(segmentClosestPoint,p).squaredLength();if(squaredDistance<minSquaredDistance){closestPointT={segmentIndex:i,value:segmentClosestPointT};minSquaredDistance=squaredDistance}}}if(closestPointT){return closestPointT}return{segmentIndex:numSegments-1,value:1}},closestPointTangent:function(p,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var closestPointTangent;var minSquaredDistance=Infinity;for(var i=0;i<numSegments;i++){var segment=segments[i];var subdivisions=segmentSubdivisions[i];if(segment.isDifferentiable()){var segmentClosestPointT=segment.closestPointT(p,{precision:precision,subdivisions:subdivisions});var segmentClosestPoint=segment.pointAtT(segmentClosestPointT);var squaredDistance=new Line(segmentClosestPoint,p).squaredLength();if(squaredDistance<minSquaredDistance){closestPointTangent=segment.tangentAtT(segmentClosestPointT);minSquaredDistance=squaredDistance}}}if(closestPointTangent){return closestPointTangent}return null},containsPoint:function(p,opt){var polylines=this.toPolylines(opt);if(!polylines){return false}var numPolylines=polylines.length;var numIntersections=0;for(var i=0;i<numPolylines;i++){var polyline=polylines[i];if(polyline.containsPoint(p)){numIntersections++}}return numIntersections%2===1},divideAt:function(ratio,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}if(ratio<0){ratio=0}if(ratio>1){ratio=1}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var localOpt={precision:precision,segmentSubdivisions:segmentSubdivisions};var pathLength=this.length(localOpt);var length=pathLength*ratio;return this.divideAtLength(length,localOpt)},divideAtLength:function(length,opt){var numSegments=this.segments.length;if(numSegments===0){return null}var fromStart=true;if(length<0){fromStart=false;length=-length}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var i;var segment;var l=0;var divided;var dividedSegmentIndex;var lastValidSegment;var lastValidSegmentIndex;var t;for(i=0;i<numSegments;i++){var index=fromStart?i:numSegments-1-i;segment=this.getSegment(index);var subdivisions=segmentSubdivisions[index];var d=segment.length({precision:precision,subdivisions:subdivisions});if(segment.isDifferentiable()){lastValidSegment=segment;lastValidSegmentIndex=index;if(length<=l+d){dividedSegmentIndex=index;divided=segment.divideAtLength((fromStart?1:-1)*(length-l),{precision:precision,subdivisions:subdivisions});break}}l+=d}if(!lastValidSegment){return null}if(!divided){dividedSegmentIndex=lastValidSegmentIndex;t=fromStart?1:0;divided=lastValidSegment.divideAtT(t)}var pathCopy=this.clone();pathCopy.replaceSegment(dividedSegmentIndex,divided);var divisionStartIndex=dividedSegmentIndex;var divisionMidIndex=dividedSegmentIndex+1;var divisionEndIndex=dividedSegmentIndex+2;if(!divided[0].isDifferentiable()){pathCopy.removeSegment(divisionStartIndex);divisionMidIndex-=1;divisionEndIndex-=1}var movetoEnd=pathCopy.getSegment(divisionMidIndex).start;pathCopy.insertSegment(divisionMidIndex,Path.createSegment("M",movetoEnd));divisionEndIndex+=1;if(!divided[1].isDifferentiable()){pathCopy.removeSegment(divisionEndIndex-1);divisionEndIndex-=1}var secondPathSegmentIndexConversion=divisionEndIndex-divisionStartIndex-1;for(i=divisionEndIndex;i<pathCopy.segments.length;i++){var originalSegment=this.getSegment(i-secondPathSegmentIndexConversion);segment=pathCopy.getSegment(i);if(segment.type==="Z"&&!originalSegment.subpathStartSegment.end.equals(segment.subpathStartSegment.end)){var convertedSegment=Path.createSegment("L",originalSegment.end);pathCopy.replaceSegment(i,convertedSegment)}}var firstPath=new Path(pathCopy.segments.slice(0,divisionMidIndex));var secondPath=new Path(pathCopy.segments.slice(divisionMidIndex));return[firstPath,secondPath]},equals:function(p){if(!p){return false}var segments=this.segments;var otherSegments=p.segments;var numSegments=segments.length;if(otherSegments.length!==numSegments){return false}for(var i=0;i<numSegments;i++){var segment=segments[i];var otherSegment=otherSegments[i];if(segment.type!==otherSegment.type||!segment.equals(otherSegment)){return false}}return true},getSegment:function(index){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){throw new Error("Path has no segments.")}if(index<0){index=numSegments+index}if(index>=numSegments||index<0){throw new Error("Index out of range.")}return segments[index]},getSegmentSubdivisions:function(opt){var segments=this.segments;var numSegments=segments.length;opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=[];for(var i=0;i<numSegments;i++){var segment=segments[i];var subdivisions=segment.getSubdivisions({precision:precision});segmentSubdivisions.push(subdivisions)}return segmentSubdivisions},getSubpaths:function(){var validatedPath=this.clone().validate();var segments=validatedPath.segments;var numSegments=segments.length;var subpaths=[];for(var i=0;i<numSegments;i++){var segment=segments[i];if(segment.isSubpathStart){subpaths.push(new Path(segment))}else{subpaths[subpaths.length-1].appendSegment(segment)}}return subpaths},insertSegment:function(index,arg){var segments=this.segments;var numSegments=segments.length;if(index<0){index=numSegments+index+1}if(index>numSegments||index<0){throw new Error("Index out of range.")}var currentSegment;var previousSegment=null;var nextSegment=null;if(numSegments!==0){if(index>=1){previousSegment=segments[index-1];nextSegment=previousSegment.nextSegment}else{nextSegment=segments[0]}}if(!Array.isArray(arg)){if(!arg||!arg.isSegment){throw new Error("Segment required.")}currentSegment=this.prepareSegment(arg,previousSegment,nextSegment);segments.splice(index,0,currentSegment)}else{arg=arg.reduce(function(acc,val){return acc.concat(val)},[]);if(!arg[0].isSegment){throw new Error("Segments required.")}var n=arg.length;for(var i=0;i<n;i++){var currentArg=arg[i];currentSegment=this.prepareSegment(currentArg,previousSegment,nextSegment);segments.splice(index+i,0,currentSegment);previousSegment=currentSegment}}},intersectionWithLine:function(line,opt){var intersection=null;var polylines=this.toPolylines(opt);if(!polylines){return null}for(var i=0,n=polylines.length;i<n;i++){var polyline=polylines[i];var polylineIntersection=line.intersect(polyline);if(polylineIntersection){intersection||(intersection=[]);if(Array.isArray(polylineIntersection)){Array.prototype.push.apply(intersection,polylineIntersection)}else{intersection.push(polylineIntersection)}}}return intersection},isDifferentiable:function(){var segments=this.segments;var numSegments=segments.length;for(var i=0;i<numSegments;i++){var segment=segments[i];if(segment.isDifferentiable()){return true}}return false},isValid:function(){var segments=this.segments;var isValid=segments.length===0||segments[0].type==="M";return isValid},length:function(opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return 0}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var length=0;for(var i=0;i<numSegments;i++){var segment=segments[i];var subdivisions=segmentSubdivisions[i];length+=segment.length({subdivisions:subdivisions})}return length},lengthAtT:function(t,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return 0}var segmentIndex=t.segmentIndex;if(segmentIndex<0){return 0}var tValue=t.value;if(segmentIndex>=numSegments){segmentIndex=numSegments-1;tValue=1}else if(tValue<0){tValue=0}else if(tValue>1){tValue=1}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var subdivisions;var length=0;for(var i=0;i<segmentIndex;i++){var segment=segments[i];subdivisions=segmentSubdivisions[i];length+=segment.length({precisison:precision,subdivisions:subdivisions})}segment=segments[segmentIndex];subdivisions=segmentSubdivisions[segmentIndex];length+=segment.lengthAtT(tValue,{precisison:precision,subdivisions:subdivisions});return length},pointAt:function(ratio,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}if(ratio<=0){return this.start.clone()}if(ratio>=1){return this.end.clone()}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var localOpt={precision:precision,segmentSubdivisions:segmentSubdivisions};var pathLength=this.length(localOpt);var length=pathLength*ratio;return this.pointAtLength(length,localOpt)},pointAtLength:function(length,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}if(length===0){return this.start.clone()}var fromStart=true;if(length<0){fromStart=false;length=-length}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var lastVisibleSegment;var l=0;for(var i=0;i<numSegments;i++){var index=fromStart?i:numSegments-1-i;var segment=segments[index];var subdivisions=segmentSubdivisions[index];var d=segment.length({precision:precision,subdivisions:subdivisions});if(segment.isVisible){if(length<=l+d){return segment.pointAtLength((fromStart?1:-1)*(length-l),{precision:precision,subdivisions:subdivisions})}lastVisibleSegment=segment}l+=d}if(lastVisibleSegment){return fromStart?lastVisibleSegment.end:lastVisibleSegment.start}var lastSegment=segments[numSegments-1];return lastSegment.end.clone()},pointAtT:function(t){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}var segmentIndex=t.segmentIndex;if(segmentIndex<0){return segments[0].pointAtT(0)}if(segmentIndex>=numSegments){return segments[numSegments-1].pointAtT(1)}var tValue=t.value;if(tValue<0){tValue=0}else if(tValue>1){tValue=1}return segments[segmentIndex].pointAtT(tValue)},PRECISION:3,prepareSegment:function(segment,previousSegment,nextSegment){segment.previousSegment=previousSegment;segment.nextSegment=nextSegment;if(previousSegment){previousSegment.nextSegment=segment}if(nextSegment){nextSegment.previousSegment=segment}var updateSubpathStart=segment;if(segment.isSubpathStart){segment.subpathStartSegment=segment;updateSubpathStart=nextSegment}if(updateSubpathStart){this.updateSubpathStartSegment(updateSubpathStart)}return segment},removeSegment:function(index){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){throw new Error("Path has no segments.")}if(index<0){index=numSegments+index}if(index>=numSegments||index<0){throw new Error("Index out of range.")}var removedSegment=segments.splice(index,1)[0];var previousSegment=removedSegment.previousSegment;var nextSegment=removedSegment.nextSegment;if(previousSegment){previousSegment.nextSegment=nextSegment}if(nextSegment){nextSegment.previousSegment=previousSegment}if(removedSegment.isSubpathStart&&nextSegment){this.updateSubpathStartSegment(nextSegment)}},replaceSegment:function(index,arg){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){throw new Error("Path has no segments.")}if(index<0){index=numSegments+index}if(index>=numSegments||index<0){throw new Error("Index out of range.")}var currentSegment;var replacedSegment=segments[index];var previousSegment=replacedSegment.previousSegment;var nextSegment=replacedSegment.nextSegment;var updateSubpathStart=replacedSegment.isSubpathStart;if(!Array.isArray(arg)){if(!arg||!arg.isSegment){throw new Error("Segment required.")}currentSegment=this.prepareSegment(arg,previousSegment,nextSegment);segments.splice(index,1,currentSegment);if(updateSubpathStart&&currentSegment.isSubpathStart){updateSubpathStart=false}}else{arg=arg.reduce(function(acc,val){return acc.concat(val)},[]);if(!arg[0].isSegment){throw new Error("Segments required.")}segments.splice(index,1);var n=arg.length;for(var i=0;i<n;i++){var currentArg=arg[i];currentSegment=this.prepareSegment(currentArg,previousSegment,nextSegment);segments.splice(index+i,0,currentSegment);previousSegment=currentSegment;if(updateSubpathStart&&currentSegment.isSubpathStart){updateSubpathStart=false}}}if(updateSubpathStart&&nextSegment){this.updateSubpathStartSegment(nextSegment)}},round:function(precision){var segments=this.segments;var numSegments=segments.length;for(var i=0;i<numSegments;i++){var segment=segments[i];segment.round(precision)}return this},scale:function(sx,sy,origin){var segments=this.segments;var numSegments=segments.length;for(var i=0;i<numSegments;i++){var segment=segments[i];segment.scale(sx,sy,origin)}return this},segmentAt:function(ratio,opt){var index=this.segmentIndexAt(ratio,opt);if(!index){return null}return this.getSegment(index)},segmentAtLength:function(length,opt){var index=this.segmentIndexAtLength(length,opt);if(!index){return null}return this.getSegment(index)},segmentIndexAt:function(ratio,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}if(ratio<0){ratio=0}if(ratio>1){ratio=1}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var localOpt={precision:precision,segmentSubdivisions:segmentSubdivisions};var pathLength=this.length(localOpt);var length=pathLength*ratio;return this.segmentIndexAtLength(length,localOpt)},segmentIndexAtLength:function(length,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}var fromStart=true;if(length<0){fromStart=false;length=-length}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var lastVisibleSegmentIndex=null;var l=0;for(var i=0;i<numSegments;i++){var index=fromStart?i:numSegments-1-i;var segment=segments[index];var subdivisions=segmentSubdivisions[index];var d=segment.length({precision:precision,subdivisions:subdivisions});if(segment.isVisible){if(length<=l+d){return index}lastVisibleSegmentIndex=index}l+=d}return lastVisibleSegmentIndex},serialize:function(){if(!this.isValid()){throw new Error("Invalid path segments.")}return this.toString()},tangentAt:function(ratio,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}if(ratio<0){ratio=0}if(ratio>1){ratio=1}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var localOpt={precision:precision,segmentSubdivisions:segmentSubdivisions};var pathLength=this.length(localOpt);var length=pathLength*ratio;return this.tangentAtLength(length,localOpt)},tangentAtLength:function(length,opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}var fromStart=true;if(length<0){fromStart=false;length=-length}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var lastValidSegment;var l=0;for(var i=0;i<numSegments;i++){var index=fromStart?i:numSegments-1-i;var segment=segments[index];var subdivisions=segmentSubdivisions[index];var d=segment.length({precision:precision,subdivisions:subdivisions});if(segment.isDifferentiable()){if(length<=l+d){return segment.tangentAtLength((fromStart?1:-1)*(length-l),{precision:precision,subdivisions:subdivisions})}lastValidSegment=segment}l+=d}if(lastValidSegment){var t=fromStart?1:0;return lastValidSegment.tangentAtT(t)}return null},tangentAtT:function(t){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}var segmentIndex=t.segmentIndex;if(segmentIndex<0){return segments[0].tangentAtT(0)}if(segmentIndex>=numSegments){return segments[numSegments-1].tangentAtT(1)}var tValue=t.value;if(tValue<0){tValue=0}else if(tValue>1){tValue=1}return segments[segmentIndex].tangentAtT(tValue)},toPoints:function(opt){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}opt=opt||{};var precision=opt.precision===undefined?this.PRECISION:opt.precision;var segmentSubdivisions=opt.segmentSubdivisions===undefined?this.getSegmentSubdivisions({precision:precision}):opt.segmentSubdivisions;var points=[];var partialPoints=[];for(var i=0;i<numSegments;i++){var segment=segments[i];if(segment.isVisible){var currentSegmentSubdivisions=segmentSubdivisions[i];if(currentSegmentSubdivisions.length>0){var subdivisionPoints=currentSegmentSubdivisions.map(function(curve){return curve.start});Array.prototype.push.apply(partialPoints,subdivisionPoints)}else{partialPoints.push(segment.start)}}else if(partialPoints.length>0){partialPoints.push(segments[i-1].end);points.push(partialPoints);partialPoints=[]}}if(partialPoints.length>0){partialPoints.push(this.end);points.push(partialPoints)}return points},toPolylines:function(opt){var polylines=[];var points=this.toPoints(opt);if(!points){return null}for(var i=0,n=points.length;i<n;i++){polylines.push(new Polyline(points[i]))}return polylines},toString:function(){var segments=this.segments;var numSegments=segments.length;var pathData="";for(var i=0;i<numSegments;i++){var segment=segments[i];pathData+=segment.serialize()+" "}return pathData.trim()},translate:function(tx,ty){var segments=this.segments;var numSegments=segments.length;for(var i=0;i<numSegments;i++){var segment=segments[i];segment.translate(tx,ty)}return this},updateSubpathStartSegment:function(segment){var previousSegment=segment.previousSegment;while(segment&&!segment.isSubpathStart){if(previousSegment){segment.subpathStartSegment=previousSegment.subpathStartSegment}else{segment.subpathStartSegment=null}previousSegment=segment;segment=segment.nextSegment}},validate:function(){if(!this.isValid()){this.insertSegment(0,Path.createSegment("M",0,0))}return this}};Object.defineProperty(Path.prototype,"start",{configurable:true,enumerable:true,get:function(){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}for(var i=0;i<numSegments;i++){var segment=segments[i];if(segment.isVisible){return segment.start}}return segments[numSegments-1].end}});Object.defineProperty(Path.prototype,"end",{configurable:true,enumerable:true,get:function(){var segments=this.segments;var numSegments=segments.length;if(numSegments===0){return null}for(var i=numSegments-1;i>=0;i--){var segment=segments[i];if(segment.isVisible){return segment.end}}return segments[numSegments-1].end}});function applyToNew(constructor,argsArray){argsArray.unshift(null);return new(Function.prototype.bind.apply(constructor,argsArray))}var segmentPrototype={bbox:function(){throw new Error("Declaration missing for virtual function.")},clone:function(){throw new Error("Declaration missing for virtual function.")},closestPoint:function(){throw new Error("Declaration missing for virtual function.")},closestPointLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointNormalizedLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointT:function(p){if(this.closestPointNormalizedLength){return this.closestPointNormalizedLength(p)}throw new Error("Neither closestPointT() nor closestPointNormalizedLength() function is implemented.")},closestPointTangent:function(){throw new Error("Declaration missing for virtual function.")},divideAt:function(){throw new Error("Declaration missing for virtual function.")},divideAtLength:function(){throw new Error("Declaration missing for virtual function.")},divideAtT:function(t){if(this.divideAt){return this.divideAt(t)}throw new Error("Neither divideAtT() nor divideAt() function is implemented.")},equals:function(){throw new Error("Declaration missing for virtual function.")},getSubdivisions:function(){throw new Error("Declaration missing for virtual function.")},isDifferentiable:function(){throw new Error("Declaration missing for virtual function.")},isSegment:true,isSubpathStart:false,isVisible:true,length:function(){throw new Error("Declaration missing for virtual function.")},lengthAtT:function(t){if(t<=0){return 0}var length=this.length();if(t>=1){return length}return length*t},nextSegment:null,pointAt:function(){throw new Error("Declaration missing for virtual function.")},pointAtLength:function(){throw new Error("Declaration missing for virtual function.")},pointAtT:function(t){if(this.pointAt){return this.pointAt(t)}throw new Error("Neither pointAtT() nor pointAt() function is implemented.")},previousSegment:null,round:function(){throw new Error("Declaration missing for virtual function.")},subpathStartSegment:null,scale:function(){throw new Error("Declaration missing for virtual function.")},serialize:function(){throw new Error("Declaration missing for virtual function.")},tangentAt:function(){throw new Error("Declaration missing for virtual function.")},tangentAtLength:function(){throw new Error("Declaration missing for virtual function.")},tangentAtT:function(t){if(this.tangentAt){return this.tangentAt(t)}throw new Error("Neither tangentAtT() nor tangentAt() function is implemented.")},toString:function(){throw new Error("Declaration missing for virtual function.")},translate:function(){throw new Error("Declaration missing for virtual function.")}};Object.defineProperty(segmentPrototype,"end",{configurable:true,enumerable:true,writable:true});Object.defineProperty(segmentPrototype,"start",{configurable:true,enumerable:true,get:function(){if(!this.previousSegment){throw new Error("Missing previous segment. (This segment cannot be the first segment of a path; OR segment has not yet been added to a path.)")}return this.previousSegment.end}});Object.defineProperty(segmentPrototype,"type",{configurable:true,enumerable:true,get:function(){throw new Error("Bad segment declaration. No type specified.")}});var Lineto=function(){var arguments$1=arguments;var args=[];var n=arguments.length;for(var i=0;i<n;i++){args.push(arguments$1[i])}if(!(this instanceof Lineto)){return applyToNew(Lineto,args)}if(n===0){throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates (none provided).")}var outputArray;if(args[0]instanceof Line){if(n===1){this.end=args[0].end.clone();return this}else{throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+n+" lines provided).")}}else if(typeof args[0]==="string"||typeof args[0]==="number"){if(n===2){this.end=new Point(+args[0],+args[1]);return this}else if(n<2){throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+n+" coordinates provided).")}else{var segmentCoords;outputArray=[];for(i=0;i<n;i+=2){segmentCoords=args.slice(i,i+2);outputArray.push(applyToNew(Lineto,segmentCoords))}return outputArray}}else{if(n===1){this.end=new Point(args[0]);return this}else{var segmentPoint;outputArray=[];for(i=0;i<n;i+=1){segmentPoint=args[i];outputArray.push(new Lineto(segmentPoint))}return outputArray}}};var linetoPrototype={clone:function(){return new Lineto(this.end)},divideAt:function(ratio){var line=new Line(this.start,this.end);var divided=line.divideAt(ratio);return[new Lineto(divided[0]),new Lineto(divided[1])]},divideAtLength:function(length){var line=new Line(this.start,this.end);var divided=line.divideAtLength(length);return[new Lineto(divided[0]),new Lineto(divided[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){if(!this.previousSegment){return false}return!this.start.equals(this.end)},round:function(precision){this.end.round(precision);return this},scale:function(sx,sy,origin){this.end.scale(sx,sy,origin);return this},serialize:function(){var end=this.end;return this.type+" "+end.x+" "+end.y},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(tx,ty){this.end.translate(tx,ty);return this}};Object.defineProperty(linetoPrototype,"type",{configurable:true,enumerable:true,value:"L"});Lineto.prototype=extend(segmentPrototype,Line.prototype,linetoPrototype);var Curveto=function(){var arguments$1=arguments;var args=[];var n=arguments.length;for(var i=0;i<n;i++){args.push(arguments$1[i])}if(!(this instanceof Curveto)){return applyToNew(Curveto,args)}if(n===0){throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates (none provided).")}var outputArray;if(args[0]instanceof Curve){if(n===1){this.controlPoint1=args[0].controlPoint1.clone();this.controlPoint2=args[0].controlPoint2.clone();this.end=args[0].end.clone();return this}else{throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+n+" curves provided).")}}else if(typeof args[0]==="string"||typeof args[0]==="number"){if(n===6){this.controlPoint1=new Point(+args[0],+args[1]);this.controlPoint2=new Point(+args[2],+args[3]);this.end=new Point(+args[4],+args[5]);return this}else if(n<6){throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+n+" coordinates provided).")}else{var segmentCoords;outputArray=[];for(i=0;i<n;i+=6){segmentCoords=args.slice(i,i+6);outputArray.push(applyToNew(Curveto,segmentCoords))}return outputArray}}else{if(n===3){this.controlPoint1=new Point(args[0]);this.controlPoint2=new Point(args[1]);this.end=new Point(args[2]);return this}else if(n<3){throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+n+" points provided).")}else{var segmentPoints;outputArray=[];for(i=0;i<n;i+=3){segmentPoints=args.slice(i,i+3);outputArray.push(applyToNew(Curveto,segmentPoints))}return outputArray}}};var curvetoPrototype={clone:function(){return new Curveto(this.controlPoint1,this.controlPoint2,this.end)},divideAt:function(ratio,opt){var curve=new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end);var divided=curve.divideAt(ratio,opt);return[new Curveto(divided[0]),new Curveto(divided[1])]},divideAtLength:function(length,opt){var curve=new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end);var divided=curve.divideAtLength(length,opt);return[new Curveto(divided[0]),new Curveto(divided[1])]},divideAtT:function(t){var curve=new Curve(this.start,this.controlPoint1,this.controlPoint2,this.end);var divided=curve.divideAtT(t);return[new Curveto(divided[0]),new Curveto(divided[1])]},isDifferentiable:function(){if(!this.previousSegment){return false}var start=this.start;var control1=this.controlPoint1;var control2=this.controlPoint2;var end=this.end;return!(start.equals(control1)&&control1.equals(control2)&&control2.equals(end))},round:function(precision){this.controlPoint1.round(precision);this.controlPoint2.round(precision);this.end.round(precision);return this},scale:function(sx,sy,origin){this.controlPoint1.scale(sx,sy,origin);this.controlPoint2.scale(sx,sy,origin);this.end.scale(sx,sy,origin);return this},serialize:function(){var c1=this.controlPoint1;var c2=this.controlPoint2;var end=this.end;return this.type+" "+c1.x+" "+c1.y+" "+c2.x+" "+c2.y+" "+end.x+" "+end.y},toString:function(){return this.type+" "+this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(tx,ty){this.controlPoint1.translate(tx,ty);this.controlPoint2.translate(tx,ty);this.end.translate(tx,ty);return this}};Object.defineProperty(curvetoPrototype,"type",{configurable:true,enumerable:true,value:"C"});Curveto.prototype=extend(segmentPrototype,Curve.prototype,curvetoPrototype);var Moveto=function(){var arguments$1=arguments;var args=[];var n=arguments.length;for(var i=0;i<n;i++){args.push(arguments$1[i])}if(!(this instanceof Moveto)){return applyToNew(Moveto,args)}if(n===0){throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates (none provided).")}var outputArray;if(args[0]instanceof Line){if(n===1){this.end=args[0].end.clone();return this}else{throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+n+" lines provided).")}}else if(args[0]instanceof Curve){if(n===1){this.end=args[0].end.clone();return this}else{throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+n+" curves provided).")}}else if(typeof args[0]==="string"||typeof args[0]==="number"){if(n===2){this.end=new Point(+args[0],+args[1]);return this}else if(n<2){throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+n+" coordinates provided).")}else{var segmentCoords;outputArray=[];for(i=0;i<n;i+=2){segmentCoords=args.slice(i,i+2);if(i===0){outputArray.push(applyToNew(Moveto,segmentCoords))}else{outputArray.push(applyToNew(Lineto,segmentCoords))}}return outputArray}}else{if(n===1){this.end=new Point(args[0]);return this}else{var segmentPoint;outputArray=[];for(i=0;i<n;i+=1){segmentPoint=args[i];if(i===0){outputArray.push(new Moveto(segmentPoint))}else{outputArray.push(new Lineto(segmentPoint))}}return outputArray}}};var movetoPrototype={bbox:function(){return null},clone:function(){return new Moveto(this.end)},closestPoint:function(){return this.end.clone()},closestPointNormalizedLength:function(){return 0},closestPointLength:function(){return 0},closestPointT:function(){return 1},closestPointTangent:function(){return null},divideAt:function(){return[this.clone(),this.clone()]},divideAtLength:function(){return[this.clone(),this.clone()]},equals:function(m){return this.end.equals(m.end)},getSubdivisions:function(){return[]},isDifferentiable:function(){return false},isSubpathStart:true,isVisible:false,length:function(){return 0},lengthAtT:function(){return 0},pointAt:function(){return this.end.clone()},pointAtLength:function(){return this.end.clone()},pointAtT:function(){return this.end.clone()},round:function(precision){this.end.round(precision);return this},scale:function(sx,sy,origin){this.end.scale(sx,sy,origin);return this},serialize:function(){var end=this.end;return this.type+" "+end.x+" "+end.y},tangentAt:function(){return null},tangentAtLength:function(){return null},tangentAtT:function(){return null},toString:function(){return this.type+" "+this.end},translate:function(tx,ty){this.end.translate(tx,ty);return this}};Object.defineProperty(movetoPrototype,"start",{configurable:true,enumerable:true,get:function(){throw new Error("Illegal access. Moveto segments should not need a start property.")}});Object.defineProperty(movetoPrototype,"type",{configurable:true,enumerable:true,value:"M"});Moveto.prototype=extend(segmentPrototype,movetoPrototype);var Closepath=function(){var arguments$1=arguments;var args=[];var n=arguments.length;for(var i=0;i<n;i++){args.push(arguments$1[i])}if(!(this instanceof Closepath)){return applyToNew(Closepath,args)}if(n>0){throw new Error("Closepath constructor expects no arguments.")}return this};var closepathPrototype={clone:function(){return new Closepath},divideAt:function(ratio){var line=new Line(this.start,this.end);var divided=line.divideAt(ratio);return[divided[1].isDifferentiable()?new Lineto(divided[0]):this.clone(),new Lineto(divided[1])]},divideAtLength:function(length){var line=new Line(this.start,this.end);var divided=line.divideAtLength(length);return[divided[1].isDifferentiable()?new Lineto(divided[0]):this.clone(),new Lineto(divided[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){if(!this.previousSegment||!this.subpathStartSegment){return false}return!this.start.equals(this.end)},round:function(){return this},scale:function(){return this},serialize:function(){return this.type},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(){return this}};Object.defineProperty(closepathPrototype,"end",{configurable:true,enumerable:true,get:function(){if(!this.subpathStartSegment){throw new Error("Missing subpath start segment. (This segment needs a subpath start segment (e.g. Moveto); OR segment has not yet been added to a path.)")}return this.subpathStartSegment.end}});Object.defineProperty(closepathPrototype,"type",{configurable:true,enumerable:true,value:"Z"});Closepath.prototype=extend(segmentPrototype,Line.prototype,closepathPrototype);var segmentTypes=Path.segmentTypes={L:Lineto,C:Curveto,M:Moveto,Z:Closepath,z:Closepath};Path.regexSupportedData=new RegExp("^[\\s\\d"+Object.keys(segmentTypes).join("")+",.]*$");Path.isDataSupported=function(data){if(typeof data!=="string"){return false}return this.regexSupportedData.test(data)};var bezier={curveThroughPoints:function(points){console.warn("deprecated");return new Path(Curve.throughPoints(points)).serialize()},getCurveControlPoints:function(knots){console.warn("deprecated");var firstControlPoints=[];var secondControlPoints=[];var n=knots.length-1;var i;if(n==1){firstControlPoints[0]=new Point((2*knots[0].x+knots[1].x)/3,(2*knots[0].y+knots[1].y)/3);secondControlPoints[0]=new Point(2*firstControlPoints[0].x-knots[0].x,2*firstControlPoints[0].y-knots[0].y);return[firstControlPoints,secondControlPoints]}var rhs=[];for(i=1;i<n-1;i++){rhs[i]=4*knots[i].x+2*knots[i+1].x}rhs[0]=knots[0].x+2*knots[1].x;rhs[n-1]=(8*knots[n-1].x+knots[n].x)/2;var x=this.getFirstControlPoints(rhs);for(i=1;i<n-1;++i){rhs[i]=4*knots[i].y+2*knots[i+1].y}rhs[0]=knots[0].y+2*knots[1].y;rhs[n-1]=(8*knots[n-1].y+knots[n].y)/2;var y=this.getFirstControlPoints(rhs);for(i=0;i<n;i++){firstControlPoints.push(new Point(x[i],y[i]));if(i<n-1){secondControlPoints.push(new Point(2*knots[i+1].x-x[i+1],2*knots[i+1].y-y[i+1]))}else{secondControlPoints.push(new Point((knots[n].x+x[n-1])/2,(knots[n].y+y[n-1])/2))}}return[firstControlPoints,secondControlPoints]},getCurveDivider:function(p0,p1,p2,p3){console.warn("deprecated");var curve=new Curve(p0,p1,p2,p3);return function divideCurve(t){var divided=curve.divide(t);return[{p0:divided[0].start,p1:divided[0].controlPoint1,p2:divided[0].controlPoint2,p3:divided[0].end},{p0:divided[1].start,p1:divided[1].controlPoint1,p2:divided[1].controlPoint2,p3:divided[1].end}]}},getFirstControlPoints:function(rhs){console.warn("deprecated");var n=rhs.length;var x=[];var tmp=[];var b=2;x[0]=rhs[0]/b;for(var i=1;i<n;i++){tmp[i]=1/b;b=(i<n-1?4:3.5)-tmp[i];x[i]=(rhs[i]-x[i-1])/b}for(i=1;i<n;i++){x[n-i-1]-=tmp[n-i]*x[n-i]}return x},getInversionSolver:function(p0,p1,p2,p3){console.warn("deprecated");var curve=new Curve(p0,p1,p2,p3);return function solveInversion(p){return curve.closestPointT(p)}}};var Polygon=function(points){if(!(this instanceof Polygon)){return new Polygon(points)}if(typeof points==="string"){return new Polygon.parse(points)}this.points=Array.isArray(points)?points.map(Point):[]};Polygon.parse=function(svgString){return new Polygon(parsePoints(svgString))};Polygon.fromRect=function(rect){return new Polygon([rect.topLeft(),rect.topRight(),rect.bottomRight(),rect.bottomLeft()])};Polygon.prototype=extend(Polyline.prototype,{type:types.Polygon,clone:function(){return new Polygon(clonePoints(this.points))},convexHull:function(){return new Polygon(convexHull(this.points))},lengthPoints:function(){var ref=this;var start=ref.start;var end=ref.end;var points=ref.points;if(points.length<=1||start.equals(end)){return points}return points.concat([start.clone()])}});function exists(shape1,shape2,shape1opt,shape2opt){switch(shape1.type){case types.Line:{switch(shape2.type){case types.Line:{return lineWithLine(shape1,shape2)}}break}case types.Ellipse:{switch(shape2.type){case types.Line:{return ellipseWithLine(shape1,shape2)}case types.Ellipse:{return ellipseWithEllipse(shape1,shape2)}}break}case types.Rect:{switch(shape2.type){case types.Line:{return rectWithLine(shape1,shape2)}case types.Ellipse:{return rectWithEllipse(shape1,shape2)}case types.Rect:{return rectWithRect(shape1,shape2)}}break}case types.Polyline:{switch(shape2.type){case types.Line:{return polylineWithLine(shape1,shape2)}case types.Ellipse:{return polylineWithEllipse(shape1,shape2)}case types.Rect:{return polylineWithRect(shape1,shape2)}case types.Polyline:{return polylineWithPolyline(shape1,shape2)}}break}case types.Polygon:{switch(shape2.type){case types.Line:{return polygonWithLine(shape1,shape2)}case types.Ellipse:{return polygonWithEllipse(shape1,shape2)}case types.Rect:{return polygonWithRect(shape1,shape2)}case types.Polyline:{return polygonWithPolyline(shape1,shape2)}case types.Polygon:{return polygonWithPolygon(shape1,shape2)}}break}case types.Path:{switch(shape2.type){case types.Line:{return pathWithLine(shape1,shape2,shape1opt)}case types.Ellipse:{return pathWithEllipse(shape1,shape2,shape1opt)}case types.Rect:{return pathWithRect(shape1,shape2,shape1opt)}case types.Polyline:{return pathWithPolyline(shape1,shape2,shape1opt)}case types.Polygon:{return pathWithPolygon(shape1,shape2,shape1opt)}case types.Path:{return pathWithPath(shape1,shape2,shape1opt,shape2opt)}}break}}switch(shape2.type){case types.Ellipse:case types.Rect:case types.Polyline:case types.Polygon:case types.Path:{return exists(shape2,shape1,shape2opt,shape1opt)}default:{throw Error("The intersection for "+shape1+" and "+shape2+" could not be found.")}}}function lineWithLine(line1,line2){var x1=line1.start.x;var y1=line1.start.y;var x2=line1.end.x;var y2=line1.end.y;var x3=line2.start.x;var y3=line2.start.y;var x4=line2.end.x;var y4=line2.end.y;var s1x=x2-x1;var s1y=y2-y1;var s2x=x4-x3;var s2y=y4-y3;var s3x=x1-x3;var s3y=y1-y3;var p=s1x*s2y-s2x*s1y;var s=(s1x*s3y-s1y*s3x)/p;var t=(s2x*s3y-s2y*s3x)/p;return s>=0&&s<=1&&t>=0&&t<=1}function ellipseWithLine(ellipse,line){var rex=ellipse.a;var rey=ellipse.b;var xe=ellipse.x;var ye=ellipse.y;var x1=line.start.x-xe;var x2=line.end.x-xe;var y1=line.start.y-ye;var y2=line.end.y-ye;var rex_2=rex*rex;var rey_2=rey*rey;var dx=x2-x1;var dy=y2-y1;var A=dx*dx/rex_2+dy*dy/rey_2;var B=2*x1*dx/rex_2+2*y1*dy/rey_2;var C=x1*x1/rex_2+y1*y1/rey_2-1;var D=B*B-4*A*C;if(D===0){var t=-B/2/A;return t>=0&&t<=1}else if(D>0){var sqrt=Math.sqrt(D);var t1=(-B+sqrt)/2/A;var t2=(-B-sqrt)/2/A;return t1>=0&&t1<=1||t2>=0&&t2<=1}return false}function ellipseWithEllipse(ellipse1,ellipse2){return _ellipsesIntersection(ellipse1,0,ellipse2,0)}function rectWithLine(rect,line){var start=line.start;var end=line.end;var x=rect.x;var y=rect.y;var width=rect.width;var height=rect.height;if(start.x>x+width&&end.x>x+width||start.x<x&&end.x<x||start.y>y+height&&end.y>y+height||start.y<y&&end.y<y){return false}if(rect.containsPoint(line.start)||rect.containsPoint(line.end)){return true}return lineWithLine(rect.topLine(),line)||lineWithLine(rect.rightLine(),line)||lineWithLine(rect.bottomLine(),line)||lineWithLine(rect.leftLine(),line)}function rectWithEllipse(rect,ellipse){if(!rectWithRect(rect,Rect.fromEllipse(ellipse))){return false}return polygonWithEllipse(Polygon.fromRect(rect),ellipse)}function rectWithRect(rect1,rect2){return rect1.x<rect2.x+rect2.width&&rect1.x+rect1.width>rect2.x&&rect1.y<rect2.y+rect2.height&&rect1.y+rect1.height>rect2.y}function polylineWithLine(polyline,line){return _polylineWithLine(polyline,line,{interior:false})}function polylineWithEllipse(polyline,ellipse){return _polylineWithEllipse(polyline,ellipse,{interior:false})}function polylineWithRect(polyline,rect){return _polylineWithRect(polyline,rect,{interior:false})}function polylineWithPolyline(polyline1,polyline2){return _polylineWithPolyline(polyline1,polyline2,{interior:false})}function polygonWithLine(polygon,line){return _polylineWithLine(polygon,line,{interior:true})}function polygonWithEllipse(polygon,ellipse){return _polylineWithEllipse(polygon,ellipse,{interior:true})}function polygonWithRect(polygon,rect){return _polylineWithRect(polygon,rect,{interior:true})}function polygonWithPolyline(polygon,polyline){return _polylineWithPolyline(polygon,polyline,{interior:true})}function polygonWithPolygon(polygon1,polygon2){return _polylineWithPolygon(polygon1,polygon2,{interior:true})}function pathWithLine(path,line,pathOpt){return path.getSubpaths().some(function(subpath){var ref=subpath.toPolylines(pathOpt);var polyline=ref[0];var ref$1=subpath.getSegment(-1);var type=ref$1.type;if(type==="Z"){return polygonWithLine(polyline,line)}else{return polylineWithLine(polyline,line)}})}function pathWithEllipse(path,ellipse,pathOpt){return path.getSubpaths().some(function(subpath){var ref=subpath.toPolylines(pathOpt);var polyline=ref[0];var ref$1=subpath.getSegment(-1);var type=ref$1.type;if(type==="Z"){return polygonWithEllipse(polyline,ellipse)}else{return polylineWithEllipse(polyline,ellipse)}})}function pathWithRect(path,rect,pathOpt){return pathWithPolygon(path,Polygon.fromRect(rect),pathOpt)}function pathWithPolyline(path,polyline,pathOpt){return _pathWithPolyline(path,polyline,pathOpt,{interior:false})}function pathWithPolygon(path,polygon,pathOpt){return _pathWithPolyline(path,polygon,pathOpt,{interior:true})}function pathWithPath(path1,path2,pathOpt1,pathOpt2){return path1.getSubpaths().some(function(subpath){var ref=subpath.toPolylines(pathOpt1);var polyline1=ref[0];var ref$1=subpath.getSegment(-1);var type=ref$1.type;if(type==="Z"){return pathWithPolygon(path2,polyline1,pathOpt2)}else{return pathWithPolyline(path2,polyline1,pathOpt2)}})}function _polylineWithLine(polyline,line,opt){if(opt===void 0)opt={};var interior=opt.interior;if(interior===void 0)interior=false;var thisPoints;if(interior){if(polyline.containsPoint(line.start)){return true}var start=polyline.start;var end=polyline.end;var points=polyline.points;thisPoints=end.equals(start)?points:points.concat([start])}else{thisPoints=polyline.points}var length=thisPoints.length;var segment=new Line;for(var i=0;i<length-1;i++){segment.start=thisPoints[i];segment.end=thisPoints[i+1];if(lineWithLine(line,segment)){return true}}return false}function _polylineWithEllipse(polyline,ellipse,opt){if(opt===void 0)opt={};var start=polyline.start;var end=polyline.end;var points=polyline.points;if(ellipse.containsPoint(start)){return true}var thisPoints;var interior=opt.interior;if(interior===void 0)interior=false;if(interior){if(polyline.containsPoint(ellipse.center())){return true}thisPoints=end.equals(start)?points:points.concat([start])}else{thisPoints=points}var length=thisPoints.length;var segment=new Line;for(var i=0;i<length-1;i++){segment.start=thisPoints[i];segment.end=thisPoints[i+1];if(ellipseWithLine(ellipse,segment)){return true}}return false}function _polylineWithRect(polyline,rect,opt){var polygon=Polygon.fromRect(rect);return _polylineWithPolygon(polyline,polygon,opt)}function _pathWithPolyline(path,polyline1,pathOpt,opt){return path.getSubpaths().some(function(subpath){var ref=subpath.toPolylines(pathOpt);var polyline2=ref[0];var ref$1=subpath.getSegment(-1);var type=ref$1.type;if(type==="Z"){return _polylineWithPolygon(polyline1,polyline2,opt)}else{return _polylineWithPolyline(polyline1,polyline2,opt)}})}function _polylineWithPolyline(polyline1,polyline2,opt){if(opt===void 0)opt={};var interior=opt.interior;if(interior===void 0)interior=false;var thisPolyline;if(interior){var start=polyline2.start;if(polyline1.containsPoint(start)){return true}thisPolyline=polyline1.clone().close()}else{thisPolyline=polyline1}var otherPoints=polyline2.points;var length=otherPoints.length;var segment=new Line;for(var i=0;i<length-1;i++){segment.start=otherPoints[i];segment.end=otherPoints[i+1];if(polylineWithLine(thisPolyline,segment)){return true}}return false}function _polylineWithPolygon(polyline,polygon,opt){return polygon.containsPoint(polyline.start)||_polylineWithPolyline(polyline,polygon.clone().close(),opt)}function _ellipsesIntersection(e1,w1,e2,w2){var cos=Math.cos;var sin=Math.sin;var sinW1=sin(w1);var cosW1=cos(w1);var sinW2=sin(w2);var cosW2=cos(w2);var sinW1s=sinW1*sinW1;var cosW1s=cosW1*cosW1;var sinCos1=sinW1*cosW1;var sinW2s=sinW2*sinW2;var cosW2s=cosW2*cosW2;var sinCos2=sinW2*cosW2;var a1s=e1.a*e1.a;var b1s=e1.b*e1.b;var a2s=e2.a*e2.a;var b2s=e2.b*e2.b;var A1=a1s*sinW1s+b1s*cosW1s;var A2=a2s*sinW2s+b2s*cosW2s;var B1=a1s*cosW1s+b1s*sinW1s;var B2=a2s*cosW2s+b2s*sinW2s;var C1=2*(b1s-a1s)*sinCos1;var C2=2*(b2s-a2s)*sinCos2;var D1=-2*A1*e1.x-C1*e1.y;var D2=-2*A2*e2.x-C2*e2.y;var E1=-C1*e1.x-2*B1*e1.y;var E2=-C2*e2.x-2*B2*e2.y;var F1=A1*e1.x*e1.x+B1*e1.y*e1.y+C1*e1.x*e1.y-a1s*b1s;var F2=A2*e2.x*e2.x+B2*e2.y*e2.y+C2*e2.x*e2.y-a2s*b2s;C1=C1/2;C2=C2/2;D1=D1/2;D2=D2/2;E1=E1/2;E2=E2/2;var l3=det3([[A1,C1,D1],[C1,B1,E1],[D1,E1,F1]]);var l0=det3([[A2,C2,D2],[C2,B2,E2],[D2,E2,F2]]);var l2=.33333333*(det3([[A2,C1,D1],[C2,B1,E1],[D2,E1,F1]])+det3([[A1,C2,D1],[C1,B2,E1],[D1,E2,F1]])+det3([[A1,C1,D2],[C1,B1,E2],[D1,E1,F2]]));var l1=.33333333*(det3([[A1,C2,D2],[C1,B2,E2],[D1,E2,F2]])+det3([[A2,C1,D2],[C2,B1,E2],[D2,E1,F2]])+det3([[A2,C2,D1],[C2,B2,E1],[D2,E2,F1]]));var delta1=det2([[l3,l2],[l2,l1]]);var delta2=det2([[l3,l1],[l2,l0]]);var delta3=det2([[l2,l1],[l1,l0]]);var dP=det2([[2*delta1,delta2],[delta2,2*delta3]]);if(dP>0&&(l1>0||l2>0)){return false}return true}function det2(m){return m[0][0]*m[1][1]-m[0][1]*m[1][0]}function det3(m){return m[0][0]*m[1][1]*m[2][2]-m[0][0]*m[1][2]*m[2][1]-m[0][1]*m[1][0]*m[2][2]+m[0][1]*m[1][2]*m[2][0]+m[0][2]*m[1][0]*m[2][1]-m[0][2]*m[1][1]*m[2][0]}var _intersection={exists:exists,lineWithLine:lineWithLine,ellipseWithLine:ellipseWithLine,ellipseWithEllipse:ellipseWithEllipse,rectWithLine:rectWithLine,rectWithEllipse:rectWithEllipse,rectWithRect:rectWithRect,polylineWithLine:polylineWithLine,polylineWithEllipse:polylineWithEllipse,polylineWithRect:polylineWithRect,polylineWithPolyline:polylineWithPolyline,polygonWithLine:polygonWithLine,polygonWithEllipse:polygonWithEllipse,polygonWithRect:polygonWithRect,polygonWithPolyline:polygonWithPolyline,polygonWithPolygon:polygonWithPolygon,pathWithLine:pathWithLine,pathWithEllipse:pathWithEllipse,pathWithRect:pathWithRect,pathWithPolyline:pathWithPolyline,pathWithPolygon:pathWithPolygon,pathWithPath:pathWithPath};var intersection=_intersection;var g={intersection:intersection,scale:scale,normalizeAngle:normalizeAngle,snapToGrid:snapToGrid,toDeg:toDeg,toRad:toRad,random:random,bezier:bezier,Curve:Curve,Ellipse:Ellipse,ellipse:ellipse,Line:Line,line:line,Path:Path,Point:Point,point:point,Polyline:Polyline,Polygon:Polygon,Rect:Rect,rect:rect,types:types};var V=function(){var hasSvg=typeof window==="object"&&!!window.SVGAngle;if(!hasSvg){return function(){throw new Error("SVG is required to use Vectorizer.")}}var ns={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xml:"http://www.w3.org/XML/1998/namespace",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml"};var SVGVersion="1.1";var math=Math;var PI=math.PI;var atan2=math.atan2;var sqrt=math.sqrt;var min=math.min;var max=math.max;var cos=math.cos;var sin=math.sin;var V=function(el,attrs,children){if(!(this instanceof V)){return V.apply(Object.create(V.prototype),arguments)}if(!el){return}if(V.isV(el)){el=el.node}attrs=attrs||{};if(V.isString(el)){el=el.trim();if(el.toLowerCase()==="svg"){el=V.createSvgDocument()}else if(el[0]==="<"){var svgDoc=V.createSvgDocument(el);if(svgDoc.childNodes.length>1){var arrayOfVels=[];var i,len;for(i=0,len=svgDoc.childNodes.length;i<len;i++){var childNode=svgDoc.childNodes[i];arrayOfVels.push(new V(document.importNode(childNode,true)))}return arrayOfVels}el=document.importNode(svgDoc.firstChild,true)}else{el=document.createElementNS(ns.svg,el)}V.ensureId(el)}this.node=el;this.setAttributes(attrs);if(children){this.append(children)}return this};var VPrototype=V.prototype;Object.defineProperty(VPrototype,"id",{enumerable:true,get:function(){return this.node.id},set:function(id){this.node.id=id}});VPrototype.getTransformToElement=function(target){var node=this.node;if(V.isSVGGraphicsElement(target)&&V.isSVGGraphicsElement(node)){var targetCTM=V.toNode(target).getScreenCTM();var nodeCTM=node.getScreenCTM();if(targetCTM&&nodeCTM){return targetCTM.inverse().multiply(nodeCTM)}}return V.createSVGMatrix()};VPrototype.transform=function(matrix,opt){var node=this.node;if(V.isUndefined(matrix)){return V.transformStringToMatrix(this.attr("transform"))}if(opt&&opt.absolute){return this.attr("transform",V.matrixToTransformString(matrix))}var svgTransform=V.createSVGTransform(matrix);node.transform.baseVal.appendItem(svgTransform);return this};VPrototype.translate=function(tx,ty,opt){opt=opt||{};ty=ty||0;var transformAttr=this.attr("transform")||"";var transform=V.parseTransformString(transformAttr);transformAttr=transform.value;if(V.isUndefined(tx)){return transform.translate}transformAttr=transformAttr.replace(/translate\([^)]*\)/g,"").trim();var newTx=opt.absolute?tx:transform.translate.tx+tx;var newTy=opt.absolute?ty:transform.translate.ty+ty;var newTranslate="translate("+newTx+","+newTy+")";this.attr("transform",(newTranslate+" "+transformAttr).trim());return this};VPrototype.rotate=function(angle,cx,cy,opt){opt=opt||{};var transformAttr=this.attr("transform")||"";var transform=V.parseTransformString(transformAttr);transformAttr=transform.value;if(V.isUndefined(angle)){return transform.rotate}transformAttr=transformAttr.replace(/rotate\([^)]*\)/g,"").trim();angle%=360;var newAngle=opt.absolute?angle:transform.rotate.angle+angle;var newOrigin=cx!==undefined&&cy!==undefined?","+cx+","+cy:"";var newRotate="rotate("+newAngle+newOrigin+")";this.attr("transform",(transformAttr+" "+newRotate).trim());return this};VPrototype.scale=function(sx,sy){sy=V.isUndefined(sy)?sx:sy;var transformAttr=this.attr("transform")||"";var transform=V.parseTransformString(transformAttr);transformAttr=transform.value;if(V.isUndefined(sx)){return transform.scale}transformAttr=transformAttr.replace(/scale\([^)]*\)/g,"").trim();var newScale="scale("+sx+","+sy+")";this.attr("transform",(transformAttr+" "+newScale).trim());return this};VPrototype.bbox=function(withoutTransformations,target){var box;var node=this.node;var ownerSVGElement=node.ownerSVGElement;if(!ownerSVGElement){return new Rect(0,0,0,0)}try{box=node.getBBox()}catch(e){box={x:node.clientLeft,y:node.clientTop,width:node.clientWidth,height:node.clientHeight}}if(withoutTransformations){return new Rect(box)}var matrix=this.getTransformToElement(target||ownerSVGElement);return V.transformRect(box,matrix)};VPrototype.getBBox=function(opt){var options={};var outputBBox;var node=this.node;var ownerSVGElement=node.ownerSVGElement;if(!ownerSVGElement||!V.isSVGGraphicsElement(node)){return new Rect(0,0,0,0)}if(opt){if(opt.target){options.target=V.toNode(opt.target)}if(opt.recursive){options.recursive=opt.recursive}}if(!options.recursive){try{outputBBox=node.getBBox()}catch(e){outputBBox={x:node.clientLeft,y:node.clientTop,width:node.clientWidth,height:node.clientHeight}}if(!options.target){return new Rect(outputBBox)}else{var matrix=this.getTransformToElement(options.target);return V.transformRect(outputBBox,matrix)}}else{var children=this.children();var n=children.length;if(n===0){return this.getBBox({target:options.target,recursive:false})}if(!options.target){options.target=this}for(var i=0;i<n;i++){var currentChild=children[i];var childBBox;if(currentChild.children().length===0){childBBox=currentChild.getBBox({target:options.target,recursive:false})}else{childBBox=currentChild.getBBox({target:options.target,recursive:true})}if(!outputBBox){outputBBox=childBBox}else{outputBBox=outputBBox.union(childBBox)}}return outputBBox}};function createTextPathNode(attrs,vel){attrs||(attrs={});var textPathElement=V("textPath");var d=attrs.d;if(d&&attrs["xlink:href"]===undefined){var linkedPath=V("path").attr("d",d).appendTo(vel.defs());textPathElement.attr("xlink:href","#"+linkedPath.id)}if(V.isObject(attrs)){textPathElement.attr(attrs)}return textPathElement.node}function annotateTextLine(lineNode,lineAnnotations,opt){opt||(opt={});var includeAnnotationIndices=opt.includeAnnotationIndices;var eol=opt.eol;var lineHeight=opt.lineHeight;var baseSize=opt.baseSize;var maxFontSize=0;var fontMetrics={};var lastJ=lineAnnotations.length-1;for(var j=0;j<=lastJ;j++){var annotation=lineAnnotations[j];var fontSize=null;if(V.isObject(annotation)){var annotationAttrs=annotation.attrs;var vTSpan=V("tspan",annotationAttrs);var tspanNode=vTSpan.node;var t=annotation.t;if(eol&&j===lastJ){t+=eol}tspanNode.textContent=t;var annotationClass=annotationAttrs["class"];if(annotationClass){vTSpan.addClass(annotationClass)}if(includeAnnotationIndices){vTSpan.attr("annotations",annotation.annotations)}fontSize=parseFloat(annotationAttrs["font-size"]);if(!isFinite(fontSize)){fontSize=baseSize}if(fontSize&&fontSize>maxFontSize){maxFontSize=fontSize}}else{if(eol&&j===lastJ){annotation+=eol}tspanNode=document.createTextNode(annotation||" ");if(baseSize&&baseSize>maxFontSize){maxFontSize=baseSize}}lineNode.appendChild(tspanNode)}if(maxFontSize){fontMetrics.maxFontSize=maxFontSize}if(lineHeight){fontMetrics.lineHeight=lineHeight}else if(maxFontSize){fontMetrics.lineHeight=maxFontSize*1.2}return fontMetrics}var emRegex=/em$/;function convertEmToPx(em,fontSize){var numerical=parseFloat(em);if(emRegex.test(em)){return numerical*fontSize}return numerical}function calculateDY(alignment,linesMetrics,baseSizePx,lineHeight){if(!Array.isArray(linesMetrics)){return 0}var n=linesMetrics.length;if(!n){return 0}var lineMetrics=linesMetrics[0];var flMaxFont=convertEmToPx(lineMetrics.maxFontSize,baseSizePx)||baseSizePx;var rLineHeights=0;var lineHeightPx=convertEmToPx(lineHeight,baseSizePx);for(var i=1;i<n;i++){lineMetrics=linesMetrics[i];var iLineHeight=convertEmToPx(lineMetrics.lineHeight,baseSizePx)||lineHeightPx;rLineHeights+=iLineHeight}var llMaxFont=convertEmToPx(lineMetrics.maxFontSize,baseSizePx)||baseSizePx;var dy;switch(alignment){case"middle":dy=flMaxFont/2-.15*llMaxFont-rLineHeights/2;break;case"bottom":dy=-(.25*llMaxFont)-rLineHeights;break;default:case"top":dy=.8*flMaxFont;break}return dy}VPrototype.text=function(content,opt){if(content&&typeof content!=="string"){throw new Error("Vectorizer: text() expects the first argument to be a string.")}content=V.sanitizeText(content);opt||(opt={});var displayEmpty=opt.displayEmpty;var eol=opt.eol;var textPath=opt.textPath;var verticalAnchor=opt.textVerticalAnchor;var namedVerticalAnchor=verticalAnchor==="middle"||verticalAnchor==="bottom"||verticalAnchor==="top";var x=opt.x;if(x===undefined){x=this.attr("x")||0}var iai=opt.includeAnnotationIndices;var annotations=opt.annotations;if(annotations&&!V.isArray(annotations)){annotations=[annotations]}var defaultLineHeight=opt.lineHeight;var autoLineHeight=defaultLineHeight==="auto";var lineHeight=autoLineHeight?"1.5em":defaultLineHeight||"1em";this.empty();this.attr({"xml:space":"preserve",display:content||displayEmpty?null:"none"});var fontSize=parseFloat(this.attr("font-size"));if(!fontSize){fontSize=16;if(namedVerticalAnchor||annotations){this.attr("font-size",fontSize)}}var doc=document;var containerNode;if(textPath){if(typeof textPath==="string"){textPath={d:textPath}}containerNode=createTextPathNode(textPath,this)}else{containerNode=doc.createDocumentFragment()}var offset=0;var lines=content.split("\n");var linesMetrics=[];var annotatedY;for(var i=0,lastI=lines.length-1;i<=lastI;i++){var dy=lineHeight;var lineClassName="v-line";var lineNode=doc.createElementNS(ns.svg,"tspan");var line=lines[i];var lineMetrics;if(line){if(annotations){var lineAnnotations=V.annotateString(line,annotations,{offset:-offset,includeAnnotationIndices:iai});lineMetrics=annotateTextLine(lineNode,lineAnnotations,{includeAnnotationIndices:iai,eol:i!==lastI&&eol,lineHeight:autoLineHeight?null:lineHeight,baseSize:fontSize});var iLineHeight=lineMetrics.lineHeight;if(iLineHeight&&autoLineHeight&&i!==0){dy=iLineHeight}if(i===0){annotatedY=lineMetrics.maxFontSize*.8}}else{if(eol&&i!==lastI){line+=eol}lineNode.textContent=line}}else{lineNode.textContent="-";lineClassName+=" v-empty-line";var lineNodeStyle=lineNode.style;lineNodeStyle.fillOpacity=0;lineNodeStyle.strokeOpacity=0;if(annotations){lineMetrics={};lineAnnotations=V.findAnnotationsAtIndex(annotations,offset);var lineFontSize=fontSize;for(var j=lineAnnotations.length;j>0;j--){var attrs=lineAnnotations[j-1].attrs;if(!attrs||!("font-size"in attrs)){continue}var fs=parseFloat(attrs["font-size"]);if(isFinite(fs)){lineFontSize=fs;break}}if(autoLineHeight){if(i>0){dy=lineFontSize*1.2}else{annotatedY=lineFontSize*.8}}lineNode.setAttribute("font-size",lineFontSize);lineMetrics.maxFontSize=lineFontSize}}if(lineMetrics){linesMetrics.push(lineMetrics)}if(i>0){lineNode.setAttribute("dy",dy)}if(i>0||textPath){lineNode.setAttribute("x",x)}lineNode.className.baseVal=lineClassName;containerNode.appendChild(lineNode);offset+=line.length+1}if(namedVerticalAnchor){if(annotations){dy=calculateDY(verticalAnchor,linesMetrics,fontSize,lineHeight)}else if(verticalAnchor==="top"){dy="0.8em"}else{var rh;if(lastI>0){rh=parseFloat(lineHeight)||1;rh*=lastI;if(!emRegex.test(lineHeight)){rh/=fontSize}}else{rh=0}switch(verticalAnchor){case"middle":dy=.3-rh/2+"em";break;case"bottom":dy=-rh-.3+"em";break}}}else{if(verticalAnchor===0){dy="0em"}else if(verticalAnchor){dy=verticalAnchor}else{dy=0;if(this.attr("y")===null){this.attr("y",annotatedY||"0.8em")}}}containerNode.firstChild.setAttribute("dy",dy);this.append(containerNode);return this};VPrototype.removeAttr=function(name){var qualifiedName=V.qualifyAttr(name);var el=this.node;if(qualifiedName.ns){if(el.hasAttributeNS(qualifiedName.ns,qualifiedName.local)){el.removeAttributeNS(qualifiedName.ns,qualifiedName.local)}}else if(el.hasAttribute(name)){el.removeAttribute(name)}return this};VPrototype.attr=function(name,value){if(V.isUndefined(name)){var attributes=this.node.attributes;var attrs={};for(var i=0;i<attributes.length;i++){attrs[attributes[i].name]=attributes[i].value}return attrs}if(V.isString(name)&&V.isUndefined(value)){return this.node.getAttribute(name)}if(typeof name==="object"){for(var attrName in name){if(name.hasOwnProperty(attrName)){this.setAttribute(attrName,name[attrName])}}}else{this.setAttribute(name,value)}return this};VPrototype.normalizePath=function(){var tagName=this.tagName();if(tagName==="PATH"){this.attr("d",V.normalizePathData(this.attr("d")))}return this};VPrototype.remove=function(){if(this.node.parentNode){this.node.parentNode.removeChild(this.node)}return this};VPrototype.empty=function(){while(this.node.firstChild){this.node.removeChild(this.node.firstChild)}return this};VPrototype.setAttributes=function(attrs){for(var key in attrs){if(attrs.hasOwnProperty(key)){this.setAttribute(key,attrs[key])}}return this};VPrototype.append=function(els){if(!V.isArray(els)){els=[els]}for(var i=0,len=els.length;i<len;i++){this.node.appendChild(V.toNode(els[i]))}return this};VPrototype.prepend=function(els){var child=this.node.firstChild;return child?V(child).before(els):this.append(els)};VPrototype.before=function(els){var node=this.node;var parent=node.parentNode;if(parent){if(!V.isArray(els)){els=[els]}for(var i=0,len=els.length;i<len;i++){parent.insertBefore(V.toNode(els[i]),node)}}return this};VPrototype.appendTo=function(node){V.toNode(node).appendChild(this.node);return this};VPrototype.svg=function(){return this.node instanceof window.SVGSVGElement?this:V(this.node.ownerSVGElement)};VPrototype.tagName=function(){return this.node.tagName.toUpperCase()};VPrototype.defs=function(){var context=this.svg()||this;var defsNode=context.node.getElementsByTagName("defs")[0];if(defsNode){return V(defsNode)}return V("defs").appendTo(context)};VPrototype.clone=function(){var clone=V(this.node.cloneNode(true));clone.node.id=V.uniqueId();return clone};VPrototype.findOne=function(selector){var found=this.node.querySelector(selector);return found?V(found):undefined};VPrototype.find=function(selector){var vels=[];var nodes=this.node.querySelectorAll(selector);if(nodes){for(var i=0;i<nodes.length;i++){vels.push(V(nodes[i]))}}return vels};VPrototype.children=function(){var children=this.node.childNodes;var outputArray=[];for(var i=0;i<children.length;i++){var currentChild=children[i];if(currentChild.nodeType===1){outputArray.push(V(children[i]))}}return outputArray};VPrototype.parent=function(){return V(this.node.parentNode)||null},VPrototype.index=function(){var index=0;var node=this.node.previousSibling;while(node){if(node.nodeType===1){index++}node=node.previousSibling}return index};VPrototype.findParentByClass=function(className,terminator){var ownerSVGElement=this.node.ownerSVGElement;var node=this.node.parentNode;while(node&&node!==terminator&&node!==ownerSVGElement){var vel=V(node);if(vel.hasClass(className)){return vel}node=node.parentNode}return null};VPrototype.contains=function(el){var a=this.node;var b=V.toNode(el);var bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&a.compareDocumentPosition(bup)&16)};VPrototype.toLocalPoint=function(x,y){var svg=this.svg().node;var p=svg.createSVGPoint();p.x=x;p.y=y;try{var globalPoint=p.matrixTransform(svg.getScreenCTM().inverse());var globalToLocalMatrix=this.getTransformToElement(svg).inverse()}catch(e){return p}return globalPoint.matrixTransform(globalToLocalMatrix)};VPrototype.translateCenterToPoint=function(p){var bbox=this.getBBox({target:this.svg()});var center=bbox.center();this.translate(p.x-center.x,p.y-center.y);return this};VPrototype.translateAndAutoOrient=function(position,reference,target){position=new Point(position);reference=new Point(reference);target||(target=this.svg());var scale=this.scale();this.attr("transform","");var bbox=this.getBBox({target:target}).scale(scale.sx,scale.sy);var translateToOrigin=V.createSVGTransform();translateToOrigin.setTranslate(-bbox.x-bbox.width/2,-bbox.y-bbox.height/2);var rotateAroundOrigin=V.createSVGTransform();var angle=position.angleBetween(reference,position.clone().offset(1,0));if(angle){rotateAroundOrigin.setRotate(angle,0,0)}var translateFromOrigin=V.createSVGTransform();var finalPosition=position.clone().move(reference,bbox.width/2);translateFromOrigin.setTranslate(2*position.x-finalPosition.x,2*position.y-finalPosition.y);var ctm=this.getTransformToElement(target);var transform=V.createSVGTransform();transform.setMatrix(translateFromOrigin.matrix.multiply(rotateAroundOrigin.matrix.multiply(translateToOrigin.matrix.multiply(ctm.scale(scale.sx,scale.sy)))));this.attr("transform",V.matrixToTransformString(transform.matrix));return this};VPrototype.animateAlongPath=function(attrs,path){path=V.toNode(path);var id=V.ensureId(path);var animateMotion=V("animateMotion",attrs);var mpath=V("mpath",{"xlink:href":"#"+id});animateMotion.append(mpath);this.append(animateMotion);try{animateMotion.node.beginElement()}catch(e){if(document.documentElement.getAttribute("smiling")==="fake"){var animation=animateMotion.node;animation.animators=[];var animationID=animation.getAttribute("id");if(animationID){id2anim[animationID]=animation}var targets=getTargets(animation);for(var i=0,len=targets.length;i<len;i++){var target=targets[i];var animator=new Animator(animation,target,i);animators.push(animator);animation.animators[i]=animator;animator.register()}}}return this};var noHTMLWhitespaceRegex=/[^\x20\t\r\n\f]+/g;function getTokenList(str){if(!V.isString(str)){return[]}return str.trim().match(noHTMLWhitespaceRegex)||[]}VPrototype.hasClass=function(className){if(!V.isString(className)){return false}return this.node.classList.contains(className.trim())};VPrototype.addClass=function(className){var ref;(ref=this.node.classList).add.apply(ref,getTokenList(className));return this};VPrototype.removeClass=function(className){var ref;(ref=this.node.classList).remove.apply(ref,getTokenList(className));return this};VPrototype.toggleClass=function(className,toAdd){var tokens=getTokenList(className);for(var i=0;i<tokens.length;i++){this.node.classList.toggle(tokens[i],toAdd)}return this};VPrototype.sample=function(interval){interval=interval||1;var node=this.node;var length=node.getTotalLength();var samples=[];var distance=0;var sample;while(distance<length){sample=node.getPointAtLength(distance);samples.push({x:sample.x,y:sample.y,distance:distance});distance+=interval}return samples};VPrototype.convertToPath=function(){var path=V("path");path.attr(this.attr());var d=this.convertToPathData();if(d){path.attr("d",d)}return path};VPrototype.convertToPathData=function(){var tagName=this.tagName();switch(tagName){case"PATH":return this.attr("d");case"LINE":return V.convertLineToPathData(this.node);case"POLYGON":return V.convertPolygonToPathData(this.node);case"POLYLINE":return V.convertPolylineToPathData(this.node);case"ELLIPSE":return V.convertEllipseToPathData(this.node);case"CIRCLE":return V.convertCircleToPathData(this.node);case"RECT":return V.convertRectToPathData(this.node)}throw new Error(tagName+" cannot be converted to PATH.")};V.prototype.toGeometryShape=function(){var x,y,width,height,cx,cy,r,rx,ry,points,d,x1,x2,y1,y2;switch(this.tagName()){case"RECT":x=parseFloat(this.attr("x"))||0;y=parseFloat(this.attr("y"))||0;width=parseFloat(this.attr("width"))||0;height=parseFloat(this.attr("height"))||0;return new Rect(x,y,width,height);case"CIRCLE":cx=parseFloat(this.attr("cx"))||0;cy=parseFloat(this.attr("cy"))||0;r=parseFloat(this.attr("r"))||0;return new Ellipse({x:cx,y:cy},r,r);case"ELLIPSE":cx=parseFloat(this.attr("cx"))||0;cy=parseFloat(this.attr("cy"))||0;rx=parseFloat(this.attr("rx"))||0;ry=parseFloat(this.attr("ry"))||0;return new Ellipse({x:cx,y:cy},rx,ry);case"POLYLINE":points=V.getPointsFromSvgNode(this);return new Polyline(points);case"POLYGON":points=V.getPointsFromSvgNode(this);if(points.length>1){points.push(points[0])}return new Polyline(points);case"PATH":d=this.attr("d");if(!Path.isDataSupported(d)){d=V.normalizePathData(d)}return new Path(d);case"LINE":x1=parseFloat(this.attr("x1"))||0;y1=parseFloat(this.attr("y1"))||0;x2=parseFloat(this.attr("x2"))||0;y2=parseFloat(this.attr("y2"))||0;return new Line({x:x1,y:y1},{x:x2,y:y2})}return this.getBBox()};VPrototype.findIntersection=function(ref,target){var svg=this.svg().node;target=target||svg;var bbox=this.getBBox({target:target});var center=bbox.center();if(!bbox.intersectionWithLineFromCenterToPoint(ref)){return undefined}var spot;var tagName=this.tagName();if(tagName==="RECT"){var gRect=new Rect(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height")));var rectMatrix=this.getTransformToElement(target);var rectMatrixComponents=V.decomposeMatrix(rectMatrix);var resetRotation=svg.createSVGTransform();resetRotation.setRotate(-rectMatrixComponents.rotation,center.x,center.y);var rect=V.transformRect(gRect,resetRotation.matrix.multiply(rectMatrix));spot=new Rect(rect).intersectionWithLineFromCenterToPoint(ref,rectMatrixComponents.rotation)}else if(tagName==="PATH"||tagName==="POLYGON"||tagName==="POLYLINE"||tagName==="CIRCLE"||tagName==="ELLIPSE"){var pathNode=tagName==="PATH"?this:this.convertToPath();var samples=pathNode.sample();var minDistance=Infinity;var closestSamples=[];var i,sample,gp,centerDistance,refDistance,distance;for(i=0;i<samples.length;i++){sample=samples[i];gp=V.createSVGPoint(sample.x,sample.y);gp=gp.matrixTransform(this.getTransformToElement(target));sample=new Point(gp);centerDistance=sample.distance(center);refDistance=sample.distance(ref)*1.1;distance=centerDistance+refDistance;if(distance<minDistance){minDistance=distance;closestSamples=[{sample:sample,refDistance:refDistance}]}else if(distance<minDistance+1){closestSamples.push({sample:sample,refDistance:refDistance})}}closestSamples.sort(function(a,b){return a.refDistance-b.refDistance});if(closestSamples[0]){spot=closestSamples[0].sample}}return spot};VPrototype.setAttribute=function(name,value){var el=this.node;if(value===null){this.removeAttr(name);return this}var qualifiedName=V.qualifyAttr(name);if(qualifiedName.ns){el.setAttributeNS(qualifiedName.ns,name,value)}else if(name==="id"){el.id=value}else{el.setAttribute(name,value)}return this};V.createSvgDocument=function(content){if(content){var XMLString='<svg xmlns="'+ns.svg+'" xmlns:xlink="'+ns.xlink+'" version="'+SVGVersion+'">'+content+"</svg>";var ref=V.parseXML(XMLString,{async:false});var documentElement=ref.documentElement;return documentElement}var svg=document.createElementNS(ns.svg,"svg");svg.setAttributeNS(ns.xmlns,"xmlns:xlink",ns.xlink);svg.setAttribute("version",SVGVersion);return svg};V.createSVGStyle=function(stylesheet){var ref=V("style",{type:"text/css"},[V.createCDATASection(stylesheet)]);var node=ref.node;return node},V.createCDATASection=function(data){if(data===void 0)data="";var xml=document.implementation.createDocument(null,"xml",null);return xml.createCDATASection(data)};V.idCounter=0;V.uniqueId=function(){return"v-"+ ++V.idCounter};V.toNode=function(el){return V.isV(el)?el.node:el.nodeName&&el||el[0]};V.ensureId=function(node){node=V.toNode(node);return node.id||(node.id=V.uniqueId())};V.sanitizeText=function(text){return(text||"").replace(/ /g,"Â ")};V.isUndefined=function(value){return typeof value==="undefined"};V.isString=function(value){return typeof value==="string"};V.isObject=function(value){return value&&typeof value==="object"};V.isArray=Array.isArray;V.parseXML=function(data,opt){opt=opt||{};var xml;try{var parser=new DOMParser;if(!V.isUndefined(opt.async)){parser.async=opt.async}xml=parser.parseFromString(data,"text/xml")}catch(error){xml=undefined}if(!xml||xml.getElementsByTagName("parsererror").length){throw new Error("Invalid XML: "+data)}return xml};V.qualifyAttr=function(name){if(name.indexOf(":")!==-1){var combinedKey=name.split(":");return{ns:ns[combinedKey[0]],local:combinedKey[1]}}return{ns:null,local:name}};V.transformSeparatorRegex=/[ ,]+/;V.transformRegex=/\b\w+\([^()]+\)/g;V.transformFunctionRegex=/\b(\w+)\(([^()]+)\)/;V.transformTranslateRegex=/\btranslate\(([^()]+)\)/;V.transformRotateRegex=/\brotate\(([^()]+)\)/;V.transformScaleRegex=/\bscale\(([^()]+)\)/;V.transformStringToMatrix=function(transform){var transformationMatrix=V.createSVGMatrix();var transformMatches=transform&&transform.match(V.transformRegex);if(!transformMatches){return transformationMatrix}var numMatches=transformMatches.length;for(var i=0;i<numMatches;i++){var transformMatch=transformMatches[i];var transformFunctionMatch=transformMatch.match(V.transformFunctionRegex);if(transformFunctionMatch){var sx=void 0,sy=void 0,tx=void 0,ty=void 0,angle=void 0;var ctm=V.createSVGMatrix();var transformFunction=transformFunctionMatch[1].toLowerCase();var args=transformFunctionMatch[2].split(V.transformSeparatorRegex);switch(transformFunction){case"scale":sx=parseFloat(args[0]);sy=args[1]===undefined?sx:parseFloat(args[1]);ctm=ctm.scaleNonUniform(sx,sy);break;case"translate":tx=parseFloat(args[0]);ty=parseFloat(args[1]);ctm=ctm.translate(tx,ty);break;case"rotate":angle=parseFloat(args[0]);tx=parseFloat(args[1])||0;ty=parseFloat(args[2])||0;if(tx!==0||ty!==0){ctm=ctm.translate(tx,ty).rotate(angle).translate(-tx,-ty)}else{ctm=ctm.rotate(angle)}break;case"skewx":angle=parseFloat(args[0]);ctm=ctm.skewX(angle);break;case"skewy":angle=parseFloat(args[0]);ctm=ctm.skewY(angle);break;case"matrix":ctm.a=parseFloat(args[0]);ctm.b=parseFloat(args[1]);ctm.c=parseFloat(args[2]);ctm.d=parseFloat(args[3]);ctm.e=parseFloat(args[4]);ctm.f=parseFloat(args[5]);break;default:continue}transformationMatrix=transformationMatrix.multiply(ctm)}}return transformationMatrix};V.matrixToTransformString=function(matrix){matrix||(matrix=true);return"matrix("+(matrix.a!==undefined?matrix.a:1)+","+(matrix.b!==undefined?matrix.b:0)+","+(matrix.c!==undefined?matrix.c:0)+","+(matrix.d!==undefined?matrix.d:1)+","+(matrix.e!==undefined?matrix.e:0)+","+(matrix.f!==undefined?matrix.f:0)+")"};V.parseTransformString=function(transform){var translate,rotate,scale;if(transform){var separator=V.transformSeparatorRegex;if(transform.trim().indexOf("matrix")>=0){var matrix=V.transformStringToMatrix(transform);var decomposedMatrix=V.decomposeMatrix(matrix);translate=[decomposedMatrix.translateX,decomposedMatrix.translateY];scale=[decomposedMatrix.scaleX,decomposedMatrix.scaleY];rotate=[decomposedMatrix.rotation];var transformations=[];if(translate[0]!==0||translate[1]!==0){transformations.push("translate("+translate+")")}if(scale[0]!==1||scale[1]!==1){transformations.push("scale("+scale+")")}if(rotate[0]!==0){transformations.push("rotate("+rotate+")")}transform=transformations.join(" ")}else{var translateMatch=transform.match(V.transformTranslateRegex);if(translateMatch){translate=translateMatch[1].split(separator)}var rotateMatch=transform.match(V.transformRotateRegex);if(rotateMatch){rotate=rotateMatch[1].split(separator)}var scaleMatch=transform.match(V.transformScaleRegex);if(scaleMatch){scale=scaleMatch[1].split(separator)}}}var sx=scale&&scale[0]?parseFloat(scale[0]):1;return{value:transform,translate:{tx:translate&&translate[0]?parseInt(translate[0],10):0,ty:translate&&translate[1]?parseInt(translate[1],10):0},rotate:{angle:rotate&&rotate[0]?parseInt(rotate[0],10):0,cx:rotate&&rotate[1]?parseInt(rotate[1],10):undefined,cy:rotate&&rotate[2]?parseInt(rotate[2],10):undefined},scale:{sx:sx,sy:scale&&scale[1]?parseFloat(scale[1]):sx}}};V.deltaTransformPoint=function(matrix,point){var dx=point.x*matrix.a+point.y*matrix.c+0;var dy=point.x*matrix.b+point.y*matrix.d+0;return{x:dx,y:dy}};V.decomposeMatrix=function(matrix){var px=V.deltaTransformPoint(matrix,{x:0,y:1});var py=V.deltaTransformPoint(matrix,{x:1,y:0});var skewX=180/PI*atan2(px.y,px.x)-90;var skewY=180/PI*atan2(py.y,py.x);return{translateX:matrix.e,translateY:matrix.f,scaleX:sqrt(matrix.a*matrix.a+matrix.b*matrix.b),scaleY:sqrt(matrix.c*matrix.c+matrix.d*matrix.d),skewX:skewX,skewY:skewY,rotation:skewX}};V.matrixToScale=function(matrix){var a,b,c,d;if(matrix){a=V.isUndefined(matrix.a)?1:matrix.a;d=V.isUndefined(matrix.d)?1:matrix.d;b=matrix.b;c=matrix.c}else{a=d=1}return{sx:b?sqrt(a*a+b*b):a,sy:c?sqrt(c*c+d*d):d}};V.matrixToRotate=function(matrix){var p={x:0,y:1};if(matrix){p=V.deltaTransformPoint(matrix,p)}return{angle:normalizeAngle(toDeg(atan2(p.y,p.x))-90)}};V.matrixToTranslate=function(matrix){return{tx:matrix&&matrix.e||0,ty:matrix&&matrix.f||0}};V.isV=function(object){return object instanceof V};V.isVElement=V.isV;V.isSVGGraphicsElement=function(node){if(!node){return false}node=V.toNode(node);return node instanceof SVGElement&&typeof node.getScreenCTM==="function"};var svgDocument=V("svg").node;V.createSVGMatrix=function(matrix){var svgMatrix=svgDocument.createSVGMatrix();for(var component in matrix){svgMatrix[component]=matrix[component]}return svgMatrix};V.createSVGTransform=function(matrix){if(!V.isUndefined(matrix)){if(!(matrix instanceof SVGMatrix)){matrix=V.createSVGMatrix(matrix)}return svgDocument.createSVGTransformFromMatrix(matrix)}return svgDocument.createSVGTransform()};V.createSVGPoint=function(x,y){var p=svgDocument.createSVGPoint();p.x=x;p.y=y;return p};V.transformRect=function(r,matrix){var p=svgDocument.createSVGPoint();p.x=r.x;p.y=r.y;var corner1=p.matrixTransform(matrix);p.x=r.x+r.width;p.y=r.y;var corner2=p.matrixTransform(matrix);p.x=r.x+r.width;p.y=r.y+r.height;var corner3=p.matrixTransform(matrix);p.x=r.x;p.y=r.y+r.height;var corner4=p.matrixTransform(matrix);var minX=min(corner1.x,corner2.x,corner3.x,corner4.x);var maxX=max(corner1.x,corner2.x,corner3.x,corner4.x);var minY=min(corner1.y,corner2.y,corner3.y,corner4.y);var maxY=max(corner1.y,corner2.y,corner3.y,corner4.y);return new Rect(minX,minY,maxX-minX,maxY-minY)};V.transformPoint=function(p,matrix){return new Point(V.createSVGPoint(p.x,p.y).matrixTransform(matrix))};V.transformLine=function(l,matrix){return new Line(V.transformPoint(l.start,matrix),V.transformPoint(l.end,matrix))};V.transformPolyline=function(p,matrix){var inPoints=p instanceof Polyline?p.points:p;if(!V.isArray(inPoints)){inPoints=[]}var outPoints=[];for(var i=0,n=inPoints.length;i<n;i++){outPoints[i]=V.transformPoint(inPoints[i],matrix)}return new Polyline(outPoints)};V.styleToObject=function(styleString){var ret={};var styles=styleString.split(";");for(var i=0;i<styles.length;i++){var style=styles[i];var pair=style.split("=");ret[pair[0].trim()]=pair[1].trim()}return ret};V.createSlicePathData=function(innerRadius,outerRadius,startAngle,endAngle){var svgArcMax=2*PI-1e-6;var r0=innerRadius;var r1=outerRadius;var a0=startAngle;var a1=endAngle;var da=(a1<a0&&(da=a0,a0=a1,a1=da),a1-a0);var df=da<PI?"0":"1";var c0=cos(a0);var s0=sin(a0);var c1=cos(a1);var s1=sin(a1);return da>=svgArcMax?r0?"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"M0,"+r0+"A"+r0+","+r0+" 0 1,0 0,"+-r0+"A"+r0+","+r0+" 0 1,0 0,"+r0+"Z":"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"Z":r0?"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L"+r0*c1+","+r0*s1+"A"+r0+","+r0+" 0 "+df+",0 "+r0*c0+","+r0*s0+"Z":"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L0,0"+"Z"};V.mergeAttrs=function(a,b){for(var attr in b){if(attr==="class"){a[attr]=a[attr]?a[attr]+" "+b[attr]:b[attr]}else if(attr==="style"){if(V.isObject(a[attr])&&V.isObject(b[attr])){a[attr]=V.mergeAttrs(a[attr],b[attr])}else if(V.isObject(a[attr])){a[attr]=V.mergeAttrs(a[attr],V.styleToObject(b[attr]))}else if(V.isObject(b[attr])){a[attr]=V.mergeAttrs(V.styleToObject(a[attr]),b[attr])}else{a[attr]=V.mergeAttrs(V.styleToObject(a[attr]),V.styleToObject(b[attr]))}}else{a[attr]=b[attr]}}return a};V.annotateString=function(t,annotations,opt){annotations=annotations||[];opt=opt||{};var offset=opt.offset||0;var compacted=[];var batch;var ret=[];var item;var prev;for(var i=0;i<t.length;i++){item=ret[i]=t[i];for(var j=0;j<annotations.length;j++){var annotation=annotations[j];var start=annotation.start+offset;var end=annotation.end+offset;if(i>=start&&i<end){if(V.isObject(item)){item.attrs=V.mergeAttrs(V.mergeAttrs({},item.attrs),annotation.attrs)}else{item=ret[i]={t:t[i],attrs:annotation.attrs}}if(opt.includeAnnotationIndices){(item.annotations||(item.annotations=[])).push(j)}}}prev=ret[i-1];if(!prev){batch=item}else if(V.isObject(item)&&V.isObject(prev)){if(JSON.stringify(item.attrs)===JSON.stringify(prev.attrs)){batch.t+=item.t}else{compacted.push(batch);batch=item}}else if(V.isObject(item)){compacted.push(batch);batch=item}else if(V.isObject(prev)){compacted.push(batch);batch=item}else{batch=(batch||"")+item}}if(batch){compacted.push(batch)}return compacted};V.findAnnotationsAtIndex=function(annotations,index){var found=[];if(annotations){annotations.forEach(function(annotation){if(annotation.start<index&&index<=annotation.end){found.push(annotation)}})}return found};V.findAnnotationsBetweenIndexes=function(annotations,start,end){var found=[];if(annotations){annotations.forEach(function(annotation){if(start>=annotation.start&&start<annotation.end||end>annotation.start&&end<=annotation.end||annotation.start>=start&&annotation.end<end){found.push(annotation)}})}return found};V.shiftAnnotations=function(annotations,index,offset){if(annotations){annotations.forEach(function(annotation){if(annotation.start<index&&annotation.end>=index){annotation.end+=offset}else if(annotation.start>=index){annotation.start+=offset;annotation.end+=offset}})}return annotations};V.convertLineToPathData=function(line){line=V(line);var d=["M",line.attr("x1"),line.attr("y1"),"L",line.attr("x2"),line.attr("y2")].join(" ");return d};V.convertPolygonToPathData=function(polygon){var points=V.getPointsFromSvgNode(polygon);if(points.length===0){return null}return V.svgPointsToPath(points)+" Z"};V.convertPolylineToPathData=function(polyline){var points=V.getPointsFromSvgNode(polyline);if(points.length===0){return null}return V.svgPointsToPath(points)};V.svgPointsToPath=function(points){for(var i=0,n=points.length;i<n;i++){points[i]=points[i].x+" "+points[i].y}return"M "+points.join(" L")};V.getPointsFromSvgNode=function(node){node=V.toNode(node);var points=[];var nodePoints=node.points;if(nodePoints){for(var i=0,n=nodePoints.numberOfItems;i<n;i++){points.push(nodePoints.getItem(i))}}return points};V.KAPPA=.551784;V.convertCircleToPathData=function(circle){circle=V(circle);var cx=parseFloat(circle.attr("cx"))||0;var cy=parseFloat(circle.attr("cy"))||0;var r=parseFloat(circle.attr("r"));var cd=r*V.KAPPA;var d=["M",cx,cy-r,"C",cx+cd,cy-r,cx+r,cy-cd,cx+r,cy,"C",cx+r,cy+cd,cx+cd,cy+r,cx,cy+r,"C",cx-cd,cy+r,cx-r,cy+cd,cx-r,cy,"C",cx-r,cy-cd,cx-cd,cy-r,cx,cy-r,"Z"].join(" ");return d};V.convertEllipseToPathData=function(ellipse){ellipse=V(ellipse);var cx=parseFloat(ellipse.attr("cx"))||0;var cy=parseFloat(ellipse.attr("cy"))||0;var rx=parseFloat(ellipse.attr("rx"));var ry=parseFloat(ellipse.attr("ry"))||rx;var cdx=rx*V.KAPPA;var cdy=ry*V.KAPPA;var d=["M",cx,cy-ry,"C",cx+cdx,cy-ry,cx+rx,cy-cdy,cx+rx,cy,"C",cx+rx,cy+cdy,cx+cdx,cy+ry,cx,cy+ry,"C",cx-cdx,cy+ry,cx-rx,cy+cdy,cx-rx,cy,"C",cx-rx,cy-cdy,cx-cdx,cy-ry,cx,cy-ry,"Z"].join(" ");return d};V.convertRectToPathData=function(rect){rect=V(rect);return V.rectToPath({x:parseFloat(rect.attr("x"))||0,y:parseFloat(rect.attr("y"))||0,width:parseFloat(rect.attr("width"))||0,height:parseFloat(rect.attr("height"))||0,rx:parseFloat(rect.attr("rx"))||0,ry:parseFloat(rect.attr("ry"))||0})};V.rectToPath=function(r){var d;var x=r.x;var y=r.y;var width=r.width;var height=r.height;var topRx=min(r.rx||r["top-rx"]||0,width/2);var bottomRx=min(r.rx||r["bottom-rx"]||0,width/2);var topRy=min(r.ry||r["top-ry"]||0,height/2);var bottomRy=min(r.ry||r["bottom-ry"]||0,height/2);if(topRx||bottomRx||topRy||bottomRy){d=["M",x,y+topRy,"v",height-topRy-bottomRy,"a",bottomRx,bottomRy,0,0,0,bottomRx,bottomRy,"h",width-2*bottomRx,"a",bottomRx,bottomRy,0,0,0,bottomRx,-bottomRy,"v",-(height-bottomRy-topRy),"a",topRx,topRy,0,0,0,-topRx,-topRy,"h",-(width-2*topRx),"a",topRx,topRy,0,0,0,-topRx,topRy,"Z"]}else{d=["M",x,y,"H",x+width,"V",y+height,"H",x,"V",y,"Z"]}return d.join(" ")};V.normalizePathData=function(){var spaces="\t\n\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029";var pathCommand=new RegExp("([a-z])["+spaces+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+spaces+"]*,?["+spaces+"]*)+)","ig");var pathValues=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+spaces+"]*,?["+spaces+"]*","ig");var math=Math;var PI=math.PI;var sin=math.sin;var cos=math.cos;var tan=math.tan;var asin=math.asin;var sqrt=math.sqrt;var abs=math.abs;function q2c(x1,y1,ax,ay,x2,y2){var _13=1/3;var _23=2/3;return[_13*x1+_23*ax,_13*y1+_23*ay,_13*x2+_23*ax,_13*y2+_23*ay,x2,y2]}function rotate(x,y,rad){var X=x*cos(rad)-y*sin(rad);var Y=x*sin(rad)+y*cos(rad);return{x:X,y:Y}}function a2c(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var _120=PI*120/180;var rad=PI/180*(+angle||0);var res=[];var xy;if(!recursive){xy=rotate(x1,y1,-rad);x1=xy.x;y1=xy.y;xy=rotate(x2,y2,-rad);x2=xy.x;y2=xy.y;var x=(x1-x2)/2;var y=(y1-y2)/2;var h=x*x/(rx*rx)+y*y/(ry*ry);if(h>1){h=sqrt(h);rx=h*rx;ry=h*ry}var rx2=rx*rx;var ry2=ry*ry;var k=(large_arc_flag==sweep_flag?-1:1)*sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x)));var cx=k*rx*y/ry+(x1+x2)/2;var cy=k*-ry*x/rx+(y1+y2)/2;var f1=asin(((y1-cy)/ry).toFixed(9));var f2=asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1;f2=x2<cx?PI-f2:f2;if(f1<0){f1=PI*2+f1}if(f2<0){f2=PI*2+f2}if(sweep_flag&&f1>f2){f1=f1-PI*2}if(!sweep_flag&&f2>f1){f2=f2-PI*2}}else{f1=recursive[0];f2=recursive[1];cx=recursive[2];cy=recursive[3]}var df=f2-f1;if(abs(df)>_120){var f2old=f2;var x2old=x2;var y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1);x2=cx+rx*cos(f2);y2=cy+ry*sin(f2);res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy])}df=f2-f1;var c1=cos(f1);var s1=sin(f1);var c2=cos(f2);var s2=sin(f2);var t=tan(df/4);var hx=4/3*(rx*t);var hy=4/3*(ry*t);var m1=[x1,y1];var m2=[x1+hx*s1,y1-hy*c1];var m3=[x2+hx*s2,y2-hy*c2];var m4=[x2,y2];m2[0]=2*m1[0]-m2[0];m2[1]=2*m1[1]-m2[1];if(recursive){return[m2,m3,m4].concat(res)}else{res=[m2,m3,m4].concat(res).join().split(",");var newres=[];var ii=res.length;for(var i=0;i<ii;i++){newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x}return newres}}function parsePathString(pathString){if(!pathString){return null}var paramCounts={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0};var data=[];String(pathString).replace(pathCommand,function(a,b,c){var params=[];var name=b.toLowerCase();c.replace(pathValues,function(a,b){if(b){params.push(+b)}});if(name==="m"&&params.length>2){data.push([b].concat(params.splice(0,2)));name="l";b=b==="m"?"l":"L"}while(params.length>=paramCounts[name]){data.push([b].concat(params.splice(0,paramCounts[name])));if(!paramCounts[name]){break}}});return data}function pathToAbsolute(pathArray){if(!Array.isArray(pathArray)||!Array.isArray(pathArray&&pathArray[0])){pathArray=parsePathString(pathArray)}if(!pathArray||!pathArray.length){return[["M",0,0]]}var res=[];var x=0;var y=0;var mx=0;var my=0;var start=0;var pa0;var ii=pathArray.length;for(var i=start;i<ii;i++){var r=[];res.push(r);var pa=pathArray[i];pa0=pa[0];if(pa0!=pa0.toUpperCase()){r[0]=pa0.toUpperCase();var jj;var j;switch(r[0]){case"A":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+pa[6]+x;r[7]=+pa[7]+y;break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"M":mx=+pa[1]+x;my=+pa[2]+y;jj=pa.length;for(j=1;j<jj;j++){r[j]=+pa[j]+(j%2?x:y)}break;default:jj=pa.length;for(j=1;j<jj;j++){r[j]=+pa[j]+(j%2?x:y)}break}}else{var kk=pa.length;for(var k=0;k<kk;k++){r[k]=pa[k]}}switch(r[0]){case"Z":x=+mx;y=+my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2];my=r[r.length-1];x=r[r.length-2];y=r[r.length-1];break;default:x=r[r.length-2];y=r[r.length-1];break}}return res}function normalize(path){var p=pathToAbsolute(path);var attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function processPath(path,d,pcom){var nx,ny;if(!path){return["C",d.x,d.y,d.x,d.y,d.x,d.y]}if(!(path[0]in{T:1,Q:1})){d.qx=null;d.qy=null}switch(path[0]){case"M":d.X=path[1];d.Y=path[2];break;case"A":if(parseFloat(path[1])===0||parseFloat(path[2])===0){path=["L",path[6],path[7]]}else{path=["C"].concat(a2c.apply(0,[d.x,d.y].concat(path.slice(1))))}break;case"S":if(pcom==="C"||pcom==="S"){nx=d.x*2-d.bx;ny=d.y*2-d.by}else{nx=d.x;ny=d.y}path=["C",nx,ny].concat(path.slice(1));break;case"T":if(pcom==="Q"||pcom==="T"){d.qx=d.x*2-d.qx;d.qy=d.y*2-d.qy}else{d.qx=d.x;d.qy=d.y}path=["C"].concat(q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1];d.qy=path[2];path=["C"].concat(q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"H":path=["L"].concat(path[1],d.y);break;case"V":path=["L"].concat(d.x,path[1]);break;case"L":break;case"Z":break}return path}function fixArc(pp,i){if(pp[i].length>7){pp[i].shift();var pi=pp[i];while(pi.length){pcoms[i]="A";pp.splice(i++,0,["C"].concat(pi.splice(0,6)))}pp.splice(i,1);ii=p.length}}var pcoms=[];var pfirst="";var pcom="";var ii=p.length;for(var i=0;i<ii;i++){if(p[i]){pfirst=p[i][0]}if(pfirst!=="C"){pcoms[i]=pfirst;if(i>0){pcom=pcoms[i-1]}}p[i]=processPath(p[i],attrs,pcom);if(pcoms[i]!=="A"&&pfirst==="C"){pcoms[i]="C"}fixArc(p,i);var seg=p[i];var seglen=seg.length;attrs.x=seg[seglen-2];attrs.y=seg[seglen-1];attrs.bx=parseFloat(seg[seglen-4])||attrs.x;attrs.by=parseFloat(seg[seglen-3])||attrs.y}if(!p[0][0]||p[0][0]!=="M"){p.unshift(["M",0,0])}return p}return function(pathData){return normalize(pathData).join(",").split(",").join(" ")}}();V.namespace=ns;V.g=g;return V}();var config={useCSSSelectors:true,classNamePrefix:"joint-",defaultTheme:"default",doubleTapInterval:300};var addClassNamePrefix=function(className){if(!className){return className}return className.toString().split(" ").map(function(_className){if(_className.substr(0,config.classNamePrefix.length)!==config.classNamePrefix){_className=config.classNamePrefix+_className}return _className}).join(" ")};var removeClassNamePrefix=function(className){if(!className){return className}return className.toString().split(" ").map(function(_className){if(_className.substr(0,config.classNamePrefix.length)===config.classNamePrefix){_className=_className.substr(config.classNamePrefix.length)}return _className}).join(" ")};var parseDOMJSON=function(json,namespace){var selectors={};var groupSelectors={};var svgNamespace=V.namespace.svg;var ns=namespace||svgNamespace;var fragment=document.createDocumentFragment();var queue=[json,fragment,ns];while(queue.length>0){ns=queue.pop();var parentNode=queue.pop();var siblingsDef=queue.pop();for(var i=0,n=siblingsDef.length;i<n;i++){var nodeDef=siblingsDef[i];if(!nodeDef.hasOwnProperty("tagName")){throw new Error("json-dom-parser: missing tagName")}var tagName=nodeDef.tagName;if(nodeDef.hasOwnProperty("namespaceURI")){ns=nodeDef.namespaceURI}var node=document.createElementNS(ns,tagName);var svg=ns===svgNamespace;var wrapper=svg?V:$;var attributes=nodeDef.attributes;if(attributes){wrapper(node).attr(attributes)}var style=nodeDef.style;if(style){$(node).css(style)}if(nodeDef.hasOwnProperty("className")){var className=nodeDef.className;if(svg){node.className.baseVal=className}else{node.className=className}}if(nodeDef.hasOwnProperty("textContent")){node.textContent=nodeDef.textContent}if(nodeDef.hasOwnProperty("selector")){var nodeSelector=nodeDef.selector;if(selectors[nodeSelector]){throw new Error("json-dom-parser: selector must be unique")}selectors[nodeSelector]=node;wrapper(node).attr("joint-selector",nodeSelector)}if(nodeDef.hasOwnProperty("groupSelector")){var nodeGroups=nodeDef.groupSelector;if(!Array.isArray(nodeGroups)){nodeGroups=[nodeGroups]}for(var j=0,m=nodeGroups.length;j<m;j++){var nodeGroup=nodeGroups[j];var group=groupSelectors[nodeGroup];if(!group){group=groupSelectors[nodeGroup]=[]}group.push(node)}}parentNode.appendChild(node);var childrenDef=nodeDef.children;if(Array.isArray(childrenDef)){queue.push(childrenDef,node,ns)}}}return{fragment:fragment,selectors:selectors,groupSelectors:groupSelectors}};var hashCode=function(str){var hash=0;if(str.length===0){return hash}for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);hash=(hash<<5)-hash+c;hash=hash&hash}return hash};var getByPath=function(obj,path,delimiter){var keys=Array.isArray(path)?path:path.split(delimiter||"/");var key;var i=0;var length=keys.length;while(i<length){key=keys[i++];if(Object(obj)===obj&&key in obj){obj=obj[key]}else{return undefined}}return obj};var isGetSafe=function(obj,key){if(typeof key!=="string"&&typeof key!=="number"){key=String(key)}if(key==="constructor"&&typeof obj[key]==="function"){return false}if(key==="__proto__"){return false}return true};var setByPath=function(obj,path,value,delimiter){var keys=Array.isArray(path)?path:path.split(delimiter||"/");var last=keys.length-1;var diver=obj;var i=0;for(;i<last;i++){var key=keys[i];if(!isGetSafe(diver,key)){return obj}var value$1=diver[key];diver=value$1||(diver[key]={})}diver[keys[last]]=value;return obj};var unsetByPath=function(obj,path,delimiter){var keys=Array.isArray(path)?path:path.split(delimiter||"/");var last=keys.length-1;var diver=obj;var i=0;for(;i<last;i++){var key=keys[i];if(!isGetSafe(diver,key)){return obj}var value=diver[key];if(!value){return obj}diver=value}delete diver[keys[last]];return obj};var flattenObject=function(obj,delim,stop){delim=delim||"/";var ret={};for(var key in obj){if(!obj.hasOwnProperty(key)){continue}var shouldGoDeeper=typeof obj[key]==="object";if(shouldGoDeeper&&stop&&stop(obj[key])){shouldGoDeeper=false}if(shouldGoDeeper){var flatObject=flattenObject(obj[key],delim,stop);for(var flatKey in flatObject){if(!flatObject.hasOwnProperty(flatKey)){continue}ret[key+delim+flatKey]=flatObject[flatKey]}}else{ret[key]=obj[key]}}return ret};var uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0;var v=c==="x"?r:r&3|8;return v.toString(16)})};var guid=function(obj){guid.id=guid.id||1;if(obj===undefined){return"j_"+guid.id++}obj.id=obj.id===undefined?"j_"+guid.id++:obj.id;return obj.id};var toKebabCase=function(string){return string.replace(/[A-Z]/g,"-$&").toLowerCase()};var normalizeEvent=function(evt){var normalizedEvent=evt;var touchEvt=evt.originalEvent&&evt.originalEvent.changedTouches&&evt.originalEvent.changedTouches[0];if(touchEvt){for(var property in evt){if(touchEvt[property]===undefined){touchEvt[property]=evt[property]}}normalizedEvent=touchEvt}var target=normalizedEvent.target;if(target){var useElement=target.correspondingUseElement;if(useElement){normalizedEvent.target=useElement}}return normalizedEvent};var normalizeWheel=function(evt){var PIXEL_STEP=10;var LINE_HEIGHT=40;var PAGE_HEIGHT=800;var sX=0,sY=0,pX=0,pY=0;if("detail"in evt){sY=evt.detail}if("wheelDelta"in evt){sY=-evt.wheelDelta/120}if("wheelDeltaY"in evt){sY=-evt.wheelDeltaY/120}if("wheelDeltaX"in evt){sX=-evt.wheelDeltaX/120}if("axis"in evt&&evt.axis===evt.HORIZONTAL_AXIS){sX=sY;sY=0}pX="deltaX"in evt?evt.deltaX:sX*PIXEL_STEP;pY="deltaY"in evt?evt.deltaY:sY*PIXEL_STEP;if((pX||pY)&&evt.deltaMode){if(evt.deltaMode==1){pX*=LINE_HEIGHT;pY*=LINE_HEIGHT}else{pX*=PAGE_HEIGHT;pY*=PAGE_HEIGHT}}if(evt.deltaX===0&&evt.deltaY!==0&&evt.shiftKey){pX=pY;pY=0;sX=sY;sY=0}if(pX&&!sX){sX=pX<1?-1:1}if(pY&&!sY){sY=pY<1?-1:1}return{spinX:sX,spinY:sY,deltaX:pX,deltaY:pY}};var cap=function(val,max){return val>max?max:val<-max?-max:val};var nextFrame=function(){var raf;if(typeof window!=="undefined"){raf=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}if(!raf){var lastTime=0;raf=function(callback){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}return function(callback,context){var rest=[],len=arguments.length-2;while(len-- >0)rest[len]=arguments[len+2];return context!==undefined?raf(callback.bind.apply(callback,[context].concat(rest))):raf(callback)}}();var cancelFrame=function(){var caf;var client=typeof window!="undefined";if(client){caf=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame}caf=caf||clearTimeout;return client?caf.bind(window):caf}();var shapePerimeterConnectionPoint=function(linkView,view,magnet,reference){var bbox;var spot;if(!magnet){var scalable=view.$(".scalable")[0];var rotatable=view.$(".rotatable")[0];if(scalable&&scalable.firstChild){magnet=scalable.firstChild}else if(rotatable&&rotatable.firstChild){magnet=rotatable.firstChild}}if(magnet){spot=V(magnet).findIntersection(reference,linkView.paper.cells);if(!spot){bbox=V(magnet).getBBox({target:linkView.paper.cells})}}else{bbox=view.model.getBBox();spot=bbox.intersectionWithLineFromCenterToPoint(reference)}return spot||bbox.center()};var isPercentage=function(val){return isString(val)&&val.slice(-1)==="%"};var parseCssNumeric=function(val,restrictUnits){function getUnit(validUnitExp){var matches=new RegExp("(?:\\d+(?:\\.\\d+)*)("+validUnitExp+")$").exec(val);if(!matches){return null}return matches[1]}var number=parseFloat(val);if(Number.isNaN(number)){return null}var output={};output.value=number;var validUnitExp;if(restrictUnits==null){validUnitExp="[A-Za-z]*"}else if(Array.isArray(restrictUnits)){if(restrictUnits.length===0){return null}validUnitExp=restrictUnits.join("|")}else if(isString(restrictUnits)){validUnitExp=restrictUnits}var unit=getUnit(validUnitExp);if(unit===null){return null}output.unit=unit;return output};var NO_SPACE=0;function splitWordWithEOL(word,eol){var eolWords=word.split(eol);var n=1;for(var j=0,jl=eolWords.length-1;j<jl;j++){var replacement=[];if(j>0||eolWords[0]!==""){replacement.push(NO_SPACE)}replacement.push(eol);if(j<jl-1||eolWords[jl]!==""){replacement.push(NO_SPACE)}eolWords.splice.apply(eolWords,[n,0].concat(replacement));n+=replacement.length+1}return eolWords.filter(function(word){return word!==""})}var breakText=function(text,size,styles,opt){if(styles===void 0)styles={};if(opt===void 0)opt={};var width=size.width;var height=size.height;var svgDocument=opt.svgDocument||V("svg").node;var textSpan=V("tspan").node;var textElement=V("text").attr(styles).append(textSpan).node;var textNode=document.createTextNode("");textElement.style.opacity=0;textElement.style.display="block";textSpan.style.display="block";textSpan.appendChild(textNode);svgDocument.appendChild(textElement);if(!opt.svgDocument){document.body.appendChild(svgDocument)}var preserveSpaces=opt.preserveSpaces;var space=" ";var separator=opt.separator||space;var eol=opt.eol||"\n";var hyphen=opt.hyphen?new RegExp(opt.hyphen):/[^\w\d]/;var maxLineCount=opt.maxLineCount;if(!isNumber(maxLineCount)){maxLineCount=Infinity}var words=text.split(separator);var full=[];var lines=[];var p,h;var lineHeight;if(preserveSpaces){V(textSpan).attr("xml:space","preserve")}for(var i=0,l=0,len=words.length;i<len;i++){var word=words[i];if(!word&&!preserveSpaces){continue}if(typeof word!=="string"){continue}var isEol=false;if(eol&&word.indexOf(eol)>=0){if(word.length>1){var eolWords=splitWordWithEOL(words[i],eol);words.splice.apply(words,[i,1].concat(eolWords));i--;len=words.length;continue}else{if(preserveSpaces&&typeof words[i-1]==="string"){words.splice(i,NO_SPACE,"",NO_SPACE);len+=2;i--;continue}lines[++l]=!preserveSpaces||typeof words[i+1]==="string"?"":undefined;isEol=true}}if(!isEol){var data=void 0;if(preserveSpaces){data=lines[l]!==undefined?lines[l]+space+word:word}else{data=lines[l]?lines[l]+space+word:word}textNode.data=data;if(textSpan.getComputedTextLength()<=width){lines[l]=data;if(p||h){full[l++]=true;p=0;h=0}}else{if(!lines[l]||p){var partition=!!p;p=word.length-1;if(partition||!p){if(!p){if(!lines[l]){lines=[];break}words.splice(i,2,word+words[i+1]);len--;full[l++]=true;i--;continue}words[i]=word.substring(0,p);words[i+1]=word.substring(p)+(words[i+1]===undefined?"":words[i+1])}else{if(h){words.splice(i,2,words[i]+words[i+1]);h=0}else{var hyphenIndex=word.search(hyphen);if(hyphenIndex>-1&&hyphenIndex!==word.length-1&&hyphenIndex!==0){h=hyphenIndex+1;p=0}words.splice(i,1,word.substring(0,h||p),word.substring(h||p));len++}if(l&&!full[l-1]){l--}}if(!preserveSpaces||lines[l]!==""){i--}continue}l++;i--}}var lastL=null;if(lines.length>maxLineCount){lastL=maxLineCount-1}else if(height!==undefined){if(lineHeight===undefined&&textNode.data!==""){var heightValue;if(styles.lineHeight==="auto"){heightValue={value:1.5,unit:"em"}}else{heightValue=parseCssNumeric(styles.lineHeight,["em"])||{value:1,unit:"em"}}lineHeight=heightValue.value;if(heightValue.unit==="em"){lineHeight*=textElement.getBBox().height}}if(lineHeight*lines.length>height){lastL=Math.floor(height/lineHeight)-1}}if(lastL!==null){lines.splice(lastL+1);var ellipsis=opt.ellipsis;if(!ellipsis||lastL<0){break}if(typeof ellipsis!=="string"){ellipsis="â¦"}var lastLine=lines[lastL];if(!lastLine&&!isEol){break}var k=lastLine.length;var lastLineWithOmission,lastChar,separatorChar;do{lastChar=lastLine[k];lastLineWithOmission=lastLine.substring(0,k);if(!lastChar){separatorChar=typeof separator==="string"?separator:" ";lastLineWithOmission+=separatorChar}else if(lastChar.match(separator)){lastLineWithOmission+=lastChar}lastLineWithOmission+=ellipsis;textNode.data=lastLineWithOmission;if(textSpan.getComputedTextLength()<=width){lines[lastL]=lastLineWithOmission;break}k--}while(k>=0);break}}if(opt.svgDocument){svgDocument.removeChild(textElement)}else{document.body.removeChild(svgDocument)}return lines.join(eol)};var sanitizeHTML=function(html){var output=$($.parseHTML("<div>"+html+"</div>",null,false));output.find("*").each(function(){var currentNode=this;$.each(currentNode.attributes,function(){var currentAttribute=this;var attrName=currentAttribute.name;var attrValue=currentAttribute.value;if(attrName.startsWith("on")||attrValue.startsWith("javascript:")||attrValue.startsWith("data:")||attrValue.startsWith("vbscript:")){$(currentNode).removeAttr(attrName)}})});return output.html()};var downloadBlob=function(blob,fileName){if(window.navigator.msSaveBlob){window.navigator.msSaveBlob(blob,fileName)}else{var url=window.URL.createObjectURL(blob);var link=document.createElement("a");link.href=url;link.download=fileName;document.body.appendChild(link);link.click();document.body.removeChild(link);window.URL.revokeObjectURL(url)}};var downloadDataUri=function(dataUri,fileName){var blob=dataUriToBlob(dataUri);downloadBlob(blob,fileName)};var dataUriToBlob=function(dataUri){dataUri=dataUri.replace(/\s/g,"");dataUri=decodeURIComponent(dataUri);var firstCommaIndex=dataUri.indexOf(",");var dataTypeString=dataUri.slice(0,firstCommaIndex);var mimeString=dataTypeString.split(":")[1].split(";")[0];var data=dataUri.slice(firstCommaIndex+1);var decodedString;if(dataTypeString.indexOf("base64")>=0){decodedString=atob(data)}else{decodedString=unescape(encodeURIComponent(data))}var ia=new Uint8Array(decodedString.length);for(var i=0;i<decodedString.length;i++){ia[i]=decodedString.charCodeAt(i)}return new Blob([ia],{type:mimeString})};var imageToDataUri=function(url,callback){if(!url||url.substr(0,"data:".length)==="data:"){return setTimeout(function(){callback(null,url)},0)}var modernHandler=function(xhr,callback){if(xhr.status===200){var reader=new FileReader;reader.onload=function(evt){var dataUri=evt.target.result;callback(null,dataUri)};reader.onerror=function(){callback(new Error("Failed to load image "+url))};reader.readAsDataURL(xhr.response)}else{callback(new Error("Failed to load image "+url))}};var legacyHandler=function(xhr,callback){var Uint8ToString=function(u8a){var CHUNK_SZ=32768;var c=[];for(var i=0;i<u8a.length;i+=CHUNK_SZ){c.push(String.fromCharCode.apply(null,u8a.subarray(i,i+CHUNK_SZ)))}return c.join("")};if(xhr.status===200){var bytes=new Uint8Array(xhr.response);var suffix=url.split(".").pop()||"png";var map={svg:"svg+xml"};var meta="data:image/"+(map[suffix]||suffix)+";base64,";var b64encoded=meta+btoa(Uint8ToString(bytes));callback(null,b64encoded)}else{callback(new Error("Failed to load image "+url))}};var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.addEventListener("error",function(){callback(new Error("Failed to load image "+url))});xhr.responseType=window.FileReader?"blob":"arraybuffer";xhr.addEventListener("load",function(){if(window.FileReader){modernHandler(xhr,callback)}else{legacyHandler(xhr,callback)}});xhr.send()};var getElementBBox=function(el){var $el=$(el);if($el.length===0){throw new Error("Element not found")}var element=$el[0];var doc=element.ownerDocument;var clientBBox=element.getBoundingClientRect();var strokeWidthX=0;var strokeWidthY=0;if(element.ownerSVGElement){var vel=V(element);var bbox=vel.getBBox({target:vel.svg()});strokeWidthX=clientBBox.width-bbox.width;strokeWidthY=clientBBox.height-bbox.height}return{x:clientBBox.left+window.pageXOffset-doc.documentElement.offsetLeft+strokeWidthX/2,y:clientBBox.top+window.pageYOffset-doc.documentElement.offsetTop+strokeWidthY/2,width:clientBBox.width-strokeWidthX,height:clientBBox.height-strokeWidthY}};var sortElements=function(elements,comparator){var $elements=$(elements);var placements=$elements.map(function(){var sortElement=this;var parentNode=sortElement.parentNode;var nextSibling=parentNode.insertBefore(document.createTextNode(""),sortElement.nextSibling);return function(){if(parentNode===this){throw new Error("You can't sort elements if any one is a descendant of another.")}parentNode.insertBefore(this,nextSibling);parentNode.removeChild(nextSibling)}});return Array.prototype.sort.call($elements,comparator).each(function(i){placements[i].call(this)})};var setAttributesBySelector=function(element,attrs){var $element=$(element);forIn(attrs,function(attrs,selector){var $elements=$element.find(selector).addBack().filter(selector);if(has$2(attrs,"class")){$elements.addClass(attrs["class"]);attrs=omit(attrs,"class")}$elements.attr(attrs)})};var normalizeSides=function(box){if(Object(box)!==box){var val=0;if(isFinite(box)){val=+box}return{top:val,right:val,bottom:val,left:val}}var top,right,bottom,left;top=right=bottom=left=0;if(isFinite(box.vertical)){top=bottom=+box.vertical}if(isFinite(box.horizontal)){right=left=+box.horizontal}if(isFinite(box.top)){top=+box.top}if(isFinite(box.right)){right=+box.right}if(isFinite(box.bottom)){bottom=+box.bottom}if(isFinite(box.left)){left=+box.left}return{top:top,right:right,bottom:bottom,left:left}};var timing={linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0){return 0}if(t>=1){return 1}var t2=t*t;var t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var a=0,b=1;1;a+=b,b/=2){if(t>=(7-4*a)/11){var q=(11-6*a-11*t)/4;return-q*q+b*b}}},reverse:function(f){return function(t){return 1-f(1-t)}},reflect:function(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t))}},clamp:function(f,n,x){n=n||0;x=x||1;return function(t){var r=f(t);return r<n?n:r>x?x:r}},back:function(s){if(!s){s=1.70158}return function(t){return t*t*((s+1)*t-s)}},elastic:function(x){if(!x){x=1.5}return function(t){return Math.pow(2,10*(t-1))*Math.cos(20*Math.PI*x/3*t)}}};var interpolate={number:function(a,b){var d=b-a;return function(t){return a+d*t}},object:function(a,b){var s=Object.keys(a);return function(t){var i,p;var r={};for(i=s.length-1;i!=-1;i--){p=s[i];r[p]=a[p]+(b[p]-a[p])*t}return r}},hexColor:function(a,b){var ca=parseInt(a.slice(1),16);var cb=parseInt(b.slice(1),16);var ra=ca&255;var rd=(cb&255)-ra;var ga=ca&65280;var gd=(cb&65280)-ga;var ba=ca&16711680;var bd=(cb&16711680)-ba;return function(t){var r=ra+rd*t&255;var g=ga+gd*t&65280;var b=ba+bd*t&16711680;return"#"+(1<<24|r|g|b).toString(16).slice(1)}},unit:function(a,b){var r=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/;var ma=r.exec(a);var mb=r.exec(b);var p=mb[1].indexOf(".");var f=p>0?mb[1].length-p-1:0;a=+ma[1];var d=+mb[1]-a;var u=ma[2];return function(t){return(a+d*t).toFixed(f)+u}}};var filter={outline:function(args){var tpl='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${outerRadius}" /><feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${innerRadius}" /><feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/><feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/><feMerge><feMergeNode in="outline"/><feMergeNode in="SourceGraphic"/></feMerge></filter>';var margin=Number.isFinite(args.margin)?args.margin:2;var width=Number.isFinite(args.width)?args.width:1;return template(tpl)({color:args.color||"blue",opacity:Number.isFinite(args.opacity)?args.opacity:1,outerRadius:margin+width,innerRadius:margin})},highlight:function(args){var tpl='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${width}"/><feComposite result="composed" in="colored" in2="morphed" operator="in"/><feGaussianBlur result="blured" in="composed" stdDeviation="${blur}"/><feBlend in="SourceGraphic" in2="blured" mode="normal"/></filter>';return template(tpl)({color:args.color||"red",width:Number.isFinite(args.width)?args.width:1,blur:Number.isFinite(args.blur)?args.blur:0,opacity:Number.isFinite(args.opacity)?args.opacity:1})},blur:function(args){var x=Number.isFinite(args.x)?args.x:2;return template('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>')({stdDeviation:Number.isFinite(args.y)?[x,args.y]:x})},dropShadow:function(args){var tpl="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return template(tpl)({dx:args.dx||0,dy:args.dy||0,opacity:Number.isFinite(args.opacity)?args.opacity:1,color:args.color||"black",blur:Number.isFinite(args.blur)?args.blur:4})},grayscale:function(args){var amount=Number.isFinite(args.amount)?args.amount:1;return template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>')({a:.2126+.7874*(1-amount),b:.7152-.7152*(1-amount),c:.0722-.0722*(1-amount),d:.2126-.2126*(1-amount),e:.7152+.2848*(1-amount),f:.0722-.0722*(1-amount),g:.2126-.2126*(1-amount),h:.0722+.9278*(1-amount)})},sepia:function(args){var amount=Number.isFinite(args.amount)?args.amount:1;return template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>')({a:.393+.607*(1-amount),b:.769-.769*(1-amount),c:.189-.189*(1-amount),d:.349-.349*(1-amount),e:.686+.314*(1-amount),f:.168-.168*(1-amount),g:.272-.272*(1-amount),h:.534-.534*(1-amount),i:.131+.869*(1-amount)})},saturate:function(args){var amount=Number.isFinite(args.amount)?args.amount:1;return template('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>')({amount:1-amount})},hueRotate:function(args){return template('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>')({angle:args.angle||0})},invert:function(args){var amount=Number.isFinite(args.amount)?args.amount:1;return template('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>')({amount:amount,amount2:1-amount})},brightness:function(args){return template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>')({amount:Number.isFinite(args.amount)?args.amount:1})},contrast:function(args){var amount=Number.isFinite(args.amount)?args.amount:1;return template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>')({amount:amount,amount2:.5-amount/2})}};var format={number:function(specifier,value,locale){locale=locale||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var re=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i;var match=re.exec(specifier);var fill=match[1]||" ";var align=match[2]||">";var sign=match[3]||"";var symbol=match[4]||"";var zfill=match[5];var width=+match[6];var comma=match[7];var precision=match[8];var type=match[9];var scale=1;var prefix="";var suffix="";var integer=false;if(precision){precision=+precision.substring(1)}if(zfill||fill==="0"&&align==="="){zfill=fill="0";align="=";if(comma){width-=Math.floor((width-1)/4)}}switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"b":case"o":case"x":case"X":if(symbol==="#"){prefix="0"+type.toLowerCase()}break;case"c":case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break}if(symbol==="$"){prefix=locale.currency[0];suffix=locale.currency[1]}if(type=="r"&&!precision){type="g"}if(precision!=null){if(type=="g"){precision=Math.max(1,Math.min(21,precision))}else if(type=="e"||type=="f"){precision=Math.max(0,Math.min(20,precision))}}var zcomma=zfill&&comma;if(integer&&value%1){return""}var negative=value<0||value===0&&1/value<0?(value=-value,"-"):sign;var fullSuffix=suffix;if(scale<0){var unit=this.prefix(value,precision);value=unit.scale(value);fullSuffix=unit.symbol+suffix}else{value*=scale}value=this.convert(type,value,precision);var i=value.lastIndexOf(".");var before=i<0?value:value.substring(0,i);var after=i<0?"":locale.decimal+value.substring(i+1);function formatGroup(value){var i=value.length;var t=[];var j=0;var g=locale.grouping[0];while(i>0&&g>0){t.push(value.substring(i-=g,i+g));g=locale.grouping[j=(j+1)%locale.grouping.length]}return t.reverse().join(locale.thousands)}if(!zfill&&comma&&locale.grouping){before=formatGroup(before)}var length=prefix.length+before.length+after.length+(zcomma?0:negative.length);var padding=length<width?new Array(length=width-length+1).join(fill):"";if(zcomma){before=formatGroup(padding+before)}negative+=prefix;value=before+after;return(align==="<"?negative+value+padding:align===">"?padding+negative+value:align==="^"?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix},string:function(formatString,value){var fieldDelimiterIndex;var fieldDelimiter="{";var endPlaceholder=false;var formattedStringArray=[];while((fieldDelimiterIndex=formatString.indexOf(fieldDelimiter))!==-1){var pieceFormattedString,formatSpec,fieldName;pieceFormattedString=formatString.slice(0,fieldDelimiterIndex);if(endPlaceholder){formatSpec=pieceFormattedString.split(":");fieldName=formatSpec.shift().split(".");pieceFormattedString=value;for(var i=0;i<fieldName.length;i++){pieceFormattedString=pieceFormattedString[fieldName[i]]}if(formatSpec.length){pieceFormattedString=this.number(formatSpec,pieceFormattedString)}}formattedStringArray.push(pieceFormattedString);formatString=formatString.slice(fieldDelimiterIndex+1);endPlaceholder=!endPlaceholder;fieldDelimiter=endPlaceholder?"}":"{"}formattedStringArray.push(formatString);return formattedStringArray.join("")},convert:function(type,value,precision){switch(type){case"b":return value.toString(2);case"c":return String.fromCharCode(value);case"o":return value.toString(8);case"x":return value.toString(16);case"X":return value.toString(16).toUpperCase();case"g":return value.toPrecision(precision);case"e":return value.toExponential(precision);case"f":return value.toFixed(precision);case"r":return(value=this.round(value,this.precision(value,precision))).toFixed(Math.max(0,Math.min(20,this.precision(value*(1+1e-15),precision))));default:return value+""}},round:function(value,precision){return precision?Math.round(value*(precision=Math.pow(10,precision)))/precision:Math.round(value)},precision:function(value,precision){return precision-(value?Math.ceil(Math.log(value)/Math.LN10):1)},prefix:function(value,precision){var prefixes=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"].map(function(d,i){var k=Math.pow(10,Math.abs(8-i)*3);return{scale:i>8?function(d){return d/k}:function(d){return d*k},symbol:d}});var i=0;if(value){if(value<0){value*=-1}if(precision){value=this.round(value,this.precision(value,precision))}i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i<=0?i+1:i-1)/3)*3))}return prefixes[8+i/3]}};var template=function(html){var regex=/<%= ([^ ]+) %>|\$\{ ?([^{} ]+) ?\}|\{\{([^{} ]+)\}\}/g;return function(data){data=data||{};return html.replace(regex,function(match){var args=Array.from(arguments);var attr=args.slice(1,4).find(function(_attr){return!!_attr});var attrArray=attr.split(".");var value=data[attrArray.shift()];while(value!==undefined&&attrArray.length){value=value[attrArray.shift()]}return value!==undefined?value:""})}};var toggleFullScreen=function(el){var topDocument=window.top.document;el=el||topDocument.body;function prefixedResult(el,prop){var prefixes=["webkit","moz","ms","o",""];for(var i=0;i<prefixes.length;i++){var prefix=prefixes[i];var propName=prefix?prefix+prop:prop.substr(0,1).toLowerCase()+prop.substr(1);if(el[propName]!==undefined){return isFunction(el[propName])?el[propName]():el[propName]}}}if(prefixedResult(topDocument,"FullscreenElement")||prefixedResult(topDocument,"FullScreenElement")){prefixedResult(topDocument,"ExitFullscreen")||prefixedResult(topDocument,"CancelFullScreen")}else{prefixedResult(el,"RequestFullscreen")||prefixedResult(el,"RequestFullScreen")}};var mixin=_.assign;var supplement=_.defaults;var deepMixin=mixin;var deepSupplement=_.defaultsDeep;var assign=_.assign;var defaults=_.defaults;var defaultsDeep=_.defaultsDeep;var invoke=_.invokeMap||_.invoke;var sortedIndex=_.sortedIndexBy||_.sortedIndex;var uniq=_.uniqBy||_.uniq;var clone=_.clone;var cloneDeep=_.cloneDeep;var isEmpty=_.isEmpty;var isEqual=_.isEqual;var isFunction=_.isFunction;var isPlainObject=_.isPlainObject;var toArray=_.toArray;var debounce=_.debounce;var groupBy=_.groupBy;var sortBy=_.sortBy;var flattenDeep=_.flattenDeep;var without=_.without;var difference=_.difference;var intersection$1=_.intersection;var union=_.union;var has$2=_.has;var result=_.result;var omit=_.omit;var pick=_.pick;var bindAll=_.bindAll;var forIn=_.forIn;var camelCase=_.camelCase;var uniqueId=_.uniqueId;var merge=function(){if(_.mergeWith){var args=Array.from(arguments);var last=args[args.length-1];var customizer=isFunction(last)?last:noop;args.push(function(a,b){var customResult=customizer(a,b);if(customResult!==undefined){return customResult}if(Array.isArray(a)&&!Array.isArray(b)){return b}});return _.mergeWith.apply(this,args)}return _.merge.apply(this,arguments)};var isBoolean=function(value){var toString=Object.prototype.toString;return value===true||value===false||!!value&&typeof value==="object"&&toString.call(value)==="[object Boolean]"};var isObject$1=function(value){return!!value&&(typeof value==="object"||typeof value==="function")};var isNumber=function(value){var toString=Object.prototype.toString;return typeof value==="number"||!!value&&typeof value==="object"&&toString.call(value)==="[object Number]"};var isString=function(value){var toString=Object.prototype.toString;return typeof value==="string"||!!value&&typeof value==="object"&&toString.call(value)==="[object String]"};var noop=function(){};function cloneCells(cells){cells=uniq(cells);var cloneMap=toArray(cells).reduce(function(map,cell){map[cell.id]=cell.clone();return map},{});toArray(cells).forEach(function(cell){var clone=cloneMap[cell.id];if(clone.isLink()){var source=clone.source();var target=clone.target();if(source.id&&cloneMap[source.id]){clone.prop("source/id",cloneMap[source.id].id)}if(target.id&&cloneMap[target.id]){clone.prop("target/id",cloneMap[target.id].id)}}var parent=cell.get("parent");if(parent&&cloneMap[parent]){clone.set("parent",cloneMap[parent].id)}var embeds=toArray(cell.get("embeds")).reduce(function(newEmbeds,embed){if(cloneMap[embed]){newEmbeds.push(cloneMap[embed].id)}return newEmbeds},[]);if(!isEmpty(embeds)){clone.set("embeds",embeds)}});return cloneMap}function setWrapper(attrName,dimension){return function(value,refBBox){var isValuePercentage=isPercentage(value);value=parseFloat(value);if(isValuePercentage){value/=100}var attrs={};if(isFinite(value)){var attrValue=isValuePercentage||value>=0&&value<=1?value*refBBox[dimension]:Math.max(value+refBBox[dimension],0);attrs[attrName]=attrValue}return attrs}}function positionWrapper(axis,dimension,origin){return function(value,refBBox){var valuePercentage=isPercentage(value);value=parseFloat(value);if(valuePercentage){value/=100}var delta;if(isFinite(value)){var refOrigin=refBBox[origin]();if(valuePercentage||value>0&&value<1){delta=refOrigin[axis]+refBBox[dimension]*value}else{delta=refOrigin[axis]+value}}var point=Point();point[axis]=delta||0;return point}}function offsetWrapper(axis,dimension,corner){return function(value,nodeBBox){var delta;if(value==="middle"){delta=nodeBBox[dimension]/2}else if(value===corner){delta=nodeBBox[dimension]}else if(isFinite(value)){delta=value>-1&&value<1?-nodeBBox[dimension]*value:-value}else if(isPercentage(value)){delta=nodeBBox[dimension]*parseFloat(value)/100}else{delta=0}var point=Point();point[axis]=-(nodeBBox[axis]+delta);return point}}function shapeWrapper(shapeConstructor,opt){var cacheName="joint-shape";var resetOffset=opt&&opt.resetOffset;return function(value,refBBox,node){var $node=$(node);var cache=$node.data(cacheName);if(!cache||cache.value!==value){var cachedShape=shapeConstructor(value);cache={value:value,shape:cachedShape,shapeBBox:cachedShape.bbox()};$node.data(cacheName,cache)}var shape=cache.shape.clone();var shapeBBox=cache.shapeBBox.clone();var shapeOrigin=shapeBBox.origin();var refOrigin=refBBox.origin();shapeBBox.x=refOrigin.x;shapeBBox.y=refOrigin.y;var fitScale=refBBox.maxRectScaleToFit(shapeBBox,refOrigin);var sx=shapeBBox.width===0||refBBox.width===0?1:fitScale.sx;var sy=shapeBBox.height===0||refBBox.height===0?1:fitScale.sy;shape.scale(sx,sy,shapeOrigin);if(resetOffset){shape.translate(-shapeOrigin.x,-shapeOrigin.y)}return shape}}function dWrapper(opt){function pathConstructor(value){return new Path(V.normalizePathData(value))}var shape=shapeWrapper(pathConstructor,opt);return function(value,refBBox,node){var path=shape(value,refBBox,node);return{d:path.serialize()}}}function pointsWrapper(opt){var shape=shapeWrapper(Polyline,opt);return function(value,refBBox,node){var polyline=shape(value,refBBox,node);return{points:polyline.serialize()}}}function atConnectionWrapper(method,opt){var zeroVector=new Point(1,0);return function(value){var p,angle;var tangent=this[method](value);if(tangent){angle=opt.rotate?tangent.vector().vectorAngle(zeroVector):0;p=tangent.start}else{p=this.path.start;angle=0}if(angle===0){return{transform:"translate("+p.x+","+p.y+")"}}return{transform:"translate("+p.x+","+p.y+") rotate("+angle+")"}}}function setIfChangedWrapper(attribute){return function setIfChanged(value,_,node){var vel=V(node);if(vel.attr(attribute)===value){return}vel.attr(attribute,value)}}function isTextInUse(_value,_node,attrs){return attrs.text!==undefined}function isLinkView(){return this.model.isLink()}function contextMarker(context){var marker={};var stroke=context.stroke;if(typeof stroke==="string"){marker["stroke"]=stroke;marker["fill"]=stroke}var strokeOpacity=context.strokeOpacity;if(strokeOpacity===undefined){strokeOpacity=context["stroke-opacity"]}if(strokeOpacity===undefined){strokeOpacity=context.opacity}if(strokeOpacity!==undefined){marker["stroke-opacity"]=strokeOpacity;marker["fill-opacity"]=strokeOpacity}return marker}function setPaintURL(def){var ref=this;var paper=ref.paper;var url=def.type==="pattern"?paper.definePattern(def):paper.defineGradient(def);return"url(#"+url+")"}var attributesNS={xlinkShow:{set:"xlink:show"},xlinkRole:{set:"xlink:role"},xlinkType:{set:"xlink:type"},xlinkArcrole:{set:"xlink:arcrole"},xlinkTitle:{set:"xlink:title"},xlinkActuate:{set:"xlink:actuate"},xmlSpace:{set:"xml:space"},xmlBase:{set:"xml:base"},xmlLang:{set:"xml:lang"},preserveAspectRatio:{set:"preserveAspectRatio"},requiredExtension:{set:"requiredExtension"},requiredFeatures:{set:"requiredFeatures"},systemLanguage:{set:"systemLanguage"},externalResourcesRequired:{set:"externalResourceRequired"},href:{set:setIfChangedWrapper("href")},xlinkHref:{set:setIfChangedWrapper("xlink:href")},filter:{qualify:isPlainObject,set:function(filter){return"url(#"+this.paper.defineFilter(filter)+")"}},fill:{qualify:isPlainObject,set:setPaintURL},stroke:{qualify:isPlainObject,set:setPaintURL},sourceMarker:{qualify:isPlainObject,set:function(marker,refBBox,node,attrs){marker=assign(contextMarker(attrs),marker);return{"marker-start":"url(#"+this.paper.defineMarker(marker)+")"}}},targetMarker:{qualify:isPlainObject,set:function(marker,refBBox,node,attrs){marker=assign(contextMarker(attrs),{transform:"rotate(180)"},marker);return{"marker-end":"url(#"+this.paper.defineMarker(marker)+")"}}},vertexMarker:{qualify:isPlainObject,set:function(marker,refBBox,node,attrs){marker=assign(contextMarker(attrs),marker);return{"marker-mid":"url(#"+this.paper.defineMarker(marker)+")"}}},text:{qualify:function(_text,_node,attrs){return!attrs.textWrap||!isPlainObject(attrs.textWrap)},set:function(text,refBBox,node,attrs){var $node=$(node);var cacheName="joint-text";var cache=$node.data(cacheName);var textAttrs=pick(attrs,"lineHeight","annotations","textPath","x","textVerticalAnchor","eol","displayEmpty");var x=textAttrs.x;if(isCalcAttribute(x)){textAttrs.x=evalCalcAttribute(x,refBBox)}var fontSizeAttr=attrs["font-size"]||attrs["fontSize"];if(isCalcAttribute(fontSizeAttr)){fontSizeAttr=evalCalcAttribute(fontSizeAttr,refBBox)}var fontSize=textAttrs.fontSize=fontSizeAttr;var textHash=JSON.stringify([text,textAttrs]);if(cache===undefined||cache!==textHash){if(fontSize){node.setAttribute("font-size",fontSize)}var textPath=textAttrs.textPath;if(isObject$1(textPath)){var pathSelector=textPath.selector;if(typeof pathSelector==="string"){var pathNode=this.findBySelector(pathSelector)[0];if(pathNode instanceof SVGPathElement){textAttrs.textPath=assign({"xlink:href":"#"+pathNode.id},textPath)}}}V(node).text(""+text,textAttrs);$node.data(cacheName,textHash)}}},textWrap:{qualify:isPlainObject,set:function(value,refBBox,node,attrs){var size={};var width=value.width||0;if(isPercentage(width)){size.width=refBBox.width*parseFloat(width)/100}else if(isCalcAttribute(width)){size.width=Number(evalCalcAttribute(width,refBBox))}else{if(value.width===null){size.width=Infinity}else if(width<=0){size.width=refBBox.width+width}else{size.width=width}}var height=value.height||0;if(isPercentage(height)){size.height=refBBox.height*parseFloat(height)/100}else if(isCalcAttribute(height)){size.height=Number(evalCalcAttribute(height,refBBox))}else{if(value.height===null){}else if(height<=0){size.height=refBBox.height+height}else{size.height=height}}var wrappedText;var text=value.text;if(text===undefined){text=attrs.text}if(text!==undefined){var breakTextFn=value.breakText||breakText;var fontSizeAttr=attrs["font-size"]||attrs.fontSize;wrappedText=breakTextFn(""+text,size,{"font-weight":attrs["font-weight"]||attrs.fontWeight,"font-size":isCalcAttribute(fontSizeAttr)?evalCalcAttribute(fontSizeAttr,refBBox):fontSizeAttr,"font-family":attrs["font-family"]||attrs.fontFamily,lineHeight:attrs.lineHeight,"letter-spacing":"letter-spacing"in attrs?attrs["letter-spacing"]:attrs.letterSpacing},{svgDocument:this.paper.svg,ellipsis:value.ellipsis,hyphen:value.hyphen,maxLineCount:value.maxLineCount,preserveSpaces:value.preserveSpaces})}else{wrappedText=""}attributesNS.text.set.call(this,wrappedText,refBBox,node,attrs)}},title:{qualify:function(title,node){return node instanceof SVGElement},set:function(title,refBBox,node){var $node=$(node);var cacheName="joint-title";var cache=$node.data(cacheName);if(cache===undefined||cache!==title){$node.data(cacheName,title);var firstChild=node.firstChild;if(firstChild&&firstChild.tagName.toUpperCase()==="TITLE"){firstChild.textContent=title}else{var titleNode=document.createElementNS(node.namespaceURI,"title");titleNode.textContent=title;node.insertBefore(titleNode,firstChild)}}}},lineHeight:{qualify:isTextInUse},textVerticalAnchor:{qualify:isTextInUse},textPath:{qualify:isTextInUse},annotations:{qualify:isTextInUse},eol:{qualify:isTextInUse},displayEmpty:{qualify:isTextInUse},port:{set:function(port){return port===null||port.id===undefined?port:port.id}},style:{qualify:isPlainObject,set:function(styles,refBBox,node){$(node).css(styles)}},html:{set:function(html,refBBox,node){$(node).html(html+"")}},ref:{},refX:{position:positionWrapper("x","width","origin")},refY:{position:positionWrapper("y","height","origin")},refDx:{position:positionWrapper("x","width","corner")},refDy:{position:positionWrapper("y","height","corner")},refWidth:{set:setWrapper("width","width")},refHeight:{set:setWrapper("height","height")},refRx:{set:setWrapper("rx","width")},refRy:{set:setWrapper("ry","height")},refRInscribed:{set:function(attrName){var widthFn=setWrapper(attrName,"width");var heightFn=setWrapper(attrName,"height");return function(value,refBBox){var fn=refBBox.height>refBBox.width?widthFn:heightFn;return fn(value,refBBox)}}("r")},refRCircumscribed:{set:function(value,refBBox){var isValuePercentage=isPercentage(value);value=parseFloat(value);if(isValuePercentage){value/=100}var diagonalLength=Math.sqrt(refBBox.height*refBBox.height+refBBox.width*refBBox.width);var rValue;if(isFinite(value)){if(isValuePercentage||value>=0&&value<=1){rValue=value*diagonalLength}else{rValue=Math.max(value+diagonalLength,0)}}return{r:rValue}}},refCx:{set:setWrapper("cx","width")},refCy:{set:setWrapper("cy","height")},xAlignment:{offset:offsetWrapper("x","width","right")},yAlignment:{offset:offsetWrapper("y","height","bottom")},resetOffset:{offset:function(val,nodeBBox){return val?{x:-nodeBBox.x,y:-nodeBBox.y}:{x:0,y:0}}},refDResetOffset:{set:dWrapper({resetOffset:true})},refDKeepOffset:{set:dWrapper({resetOffset:false})},refPointsResetOffset:{set:pointsWrapper({resetOffset:true})},refPointsKeepOffset:{set:pointsWrapper({resetOffset:false})},connection:{qualify:isLinkView,set:function(ref){var stubs=ref.stubs;if(stubs===void 0)stubs=0;var d;if(isFinite(stubs)&&stubs!==0){var offset;if(stubs<0){offset=(this.getConnectionLength()+stubs)/2}else{offset=stubs}var path=this.getConnection();var segmentSubdivisions=this.getConnectionSubdivisions();var sourceParts=path.divideAtLength(offset,{segmentSubdivisions:segmentSubdivisions});var targetParts=path.divideAtLength(-offset,{segmentSubdivisions:segmentSubdivisions});if(sourceParts&&targetParts){d=sourceParts[0].serialize()+" "+targetParts[1].serialize()}}return{d:d||this.getSerializedConnection()}}},atConnectionLengthKeepGradient:{qualify:isLinkView,set:atConnectionWrapper("getTangentAtLength",{rotate:true})},atConnectionLengthIgnoreGradient:{qualify:isLinkView,set:atConnectionWrapper("getTangentAtLength",{rotate:false})},atConnectionRatioKeepGradient:{qualify:isLinkView,set:atConnectionWrapper("getTangentAtRatio",{rotate:true})},atConnectionRatioIgnoreGradient:{qualify:isLinkView,set:atConnectionWrapper("getTangentAtRatio",{rotate:false})}};attributesNS["xlink:href"]=attributesNS.xlinkHref;["transform","d","points","cx","cy","x1","x2","y1","y2","x","y","dx","dy"].forEach(function(attribute){attributesNS[attribute]={qualify:isCalcAttribute,set:function setCalcAttribute(value,refBBox){var obj;return obj={},obj[attribute]=evalCalcAttribute(value,refBBox),obj}}});["width","height","r","rx","ry","font-size","stroke-width"].forEach(function(attribute){attributesNS[attribute]={qualify:isCalcAttribute,set:function setCalcAttribute(value,refBBox){var obj;return obj={},obj[attribute]=Math.max(0,evalCalcAttribute(value,refBBox)),obj}}});attributesNS.refR=attributesNS.refRInscribed;attributesNS.refD=attributesNS.refDResetOffset;attributesNS.refPoints=attributesNS.refPointsResetOffset;attributesNS.atConnectionLength=attributesNS.atConnectionLengthKeepGradient;attributesNS.atConnectionRatio=attributesNS.atConnectionRatioKeepGradient;attributesNS.fontSize=attributesNS["font-size"];attributesNS.strokeWidth=attributesNS["stroke-width"];attributesNS.refX2=attributesNS.refX;attributesNS.refY2=attributesNS.refY;attributesNS.refWidth2=attributesNS.refWidth;attributesNS.refHeight2=attributesNS.refHeight;attributesNS["ref-x"]=attributesNS.refX;attributesNS["ref-y"]=attributesNS.refY;attributesNS["ref-dy"]=attributesNS.refDy;attributesNS["ref-dx"]=attributesNS.refDx;attributesNS["ref-width"]=attributesNS.refWidth;attributesNS["ref-height"]=attributesNS.refHeight;attributesNS["x-alignment"]=attributesNS.xAlignment;attributesNS["y-alignment"]=attributesNS.yAlignment;var attributes=attributesNS;var Cell=Backbone.Model.extend({constructor:function(attributes,options){var defaults;var attrs=attributes||{};if(typeof this.preinitialize==="function"){this.preinitialize.apply(this,arguments)}this.cid=uniqueId("c");this.attributes={};if(options&&options.collection){this.collection=options.collection}if(options&&options.parse){attrs=this.parse(attrs,options)||{}}if(defaults=result(this,"defaults")){attrs=merge({},defaults,attrs)}this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)},translate:function(dx,dy,opt){throw new Error("Must define a translate() method.")},toJSON:function(){var defaults=result(this.constructor.prototype,"defaults");var defaultAttrs=defaults.attrs||{};var attrs=this.attributes.attrs;var finalAttrs={};forIn(attrs,function(attr,selector){var defaultAttr=defaultAttrs[selector];forIn(attr,function(value,name){if(isObject$1(value)&&!Array.isArray(value)){forIn(value,function(value2,name2){if(!defaultAttr||!defaultAttr[name]||!isEqual(defaultAttr[name][name2],value2)){finalAttrs[selector]=finalAttrs[selector]||{};(finalAttrs[selector][name]||(finalAttrs[selector][name]={}))[name2]=value2}})}else if(!defaultAttr||!isEqual(defaultAttr[name],value)){finalAttrs[selector]=finalAttrs[selector]||{};finalAttrs[selector][name]=value}})});var attributes=cloneDeep(omit(this.attributes,"attrs"));attributes.attrs=finalAttrs;return attributes},initialize:function(options){var idAttribute=this.getIdAttribute();if(!options||!(idAttribute in options)){this.set(idAttribute,this.generateId(),{silent:true})}this._transitionIds={};this._scheduledTransitionIds={};this.processPorts();this.on("change:attrs",this.processPorts,this)},getIdAttribute:function(){return this.idAttribute||"id"},generateId:function(){return uuid()},processPorts:function(){var previousPorts=this.ports;var ports={};forIn(this.get("attrs"),function(attrs,selector){if(attrs&&attrs.port){if(attrs.port.id!==undefined){ports[attrs.port.id]=attrs.port}else{ports[attrs.port]={id:attrs.port}}}});var removedPorts={};forIn(previousPorts,function(port,id){if(!ports[id]){removedPorts[id]=true}});if(this.graph&&!isEmpty(removedPorts)){var inboundLinks=this.graph.getConnectedLinks(this,{inbound:true});inboundLinks.forEach(function(link){if(removedPorts[link.get("target").port]){link.remove()}});var outboundLinks=this.graph.getConnectedLinks(this,{outbound:true});outboundLinks.forEach(function(link){if(removedPorts[link.get("source").port]){link.remove()}})}this.ports=ports},remove:function(opt){if(opt===void 0)opt={};var ref=this;var graph=ref.graph;var collection=ref.collection;if(!graph){if(collection){collection.remove(this,opt)}return this}graph.startBatch("remove");var parentCell=this.getParentCell();if(parentCell){parentCell.unembed(this,opt)}var embeddedCells=this.getEmbeddedCells();for(var i=0,n=embeddedCells.length;i<n;i++){var embed=embeddedCells[i];if(embed){embed.remove(opt)}}this.trigger("remove",this,graph.attributes.cells,opt);graph.stopBatch("remove");return this},toFront:function(opt){var graph=this.graph;if(graph){opt=opt||{};var z=graph.maxZIndex();var cells;if(opt.deep){cells=this.getEmbeddedCells({deep:true,breadthFirst:opt.breadthFirst!==false});cells.unshift(this)}else{cells=[this]}z=z-cells.length+1;var collection=graph.get("cells");var shouldUpdate=collection.indexOf(this)!==collection.length-cells.length;if(!shouldUpdate){shouldUpdate=cells.some(function(cell,index){return cell.get("z")!==z+index})}if(shouldUpdate){this.startBatch("to-front");z=z+cells.length;cells.forEach(function(cell,index){cell.set("z",z+index,opt)});this.stopBatch("to-front")}}return this},toBack:function(opt){var graph=this.graph;if(graph){opt=opt||{};var z=graph.minZIndex();var cells;if(opt.deep){cells=this.getEmbeddedCells({deep:true,breadthFirst:opt.breadthFirst!==false});cells.unshift(this)}else{cells=[this]}var collection=graph.get("cells");var shouldUpdate=collection.indexOf(this)!==0;if(!shouldUpdate){shouldUpdate=cells.some(function(cell,index){return cell.get("z")!==z+index})}if(shouldUpdate){this.startBatch("to-back");z-=cells.length;cells.forEach(function(cell,index){cell.set("z",z+index,opt)});this.stopBatch("to-back")}}return this},parent:function(parent,opt){if(parent===undefined){return this.get("parent")}return this.set("parent",parent,opt)},embed:function(cell,opt){var this$1=this;var cells=Array.isArray(cell)?cell:[cell];if(!this.canEmbed(cells)){throw new Error("Recursive embedding not allowed.")}if(cells.some(function(c){return c.isEmbedded()&&this$1.id!==c.parent()})){throw new Error("Embedding of already embedded cells is not allowed.")}this._embedCells(cells,opt);return this},unembed:function(cell,opt){var cells=Array.isArray(cell)?cell:[cell];this._unembedCells(cells,opt);return this},canEmbed:function(cell){var this$1=this;var cells=Array.isArray(cell)?cell:[cell];return cells.every(function(c){return this$1!==c&&!this$1.isEmbeddedIn(c)})},_embedCells:function(cells,opt){var this$1=this;var batchName="embed";this.startBatch(batchName);var embeds=assign([],this.get("embeds"));cells.forEach(function(cell){embeds[cell.isLink()?"unshift":"push"](cell.id);cell.parent(this$1.id,opt)});this.set("embeds",uniq(embeds),opt);this.stopBatch(batchName)},_unembedCells:function(cells,opt){var batchName="unembed";this.startBatch(batchName);cells.forEach(function(cell){return cell.unset("parent",opt)});this.set("embeds",without.apply(void 0,[this.get("embeds")].concat(cells.map(function(cell){return cell.id}))),opt);this.stopBatch(batchName)},getParentCell:function(){var parentId=this.parent();var graph=this.graph;return parentId&&graph&&graph.getCell(parentId)||null},getAncestors:function(){var ancestors=[];if(!this.graph){return ancestors}var parentCell=this.getParentCell();while(parentCell){ancestors.push(parentCell);parentCell=parentCell.getParentCell()}return ancestors},getEmbeddedCells:function(opt){opt=opt||{};if(this.graph){var cells;if(opt.deep){if(opt.breadthFirst){cells=[];var queue=this.getEmbeddedCells();while(queue.length>0){var parent=queue.shift();cells.push(parent);queue.push.apply(queue,parent.getEmbeddedCells())}}else{cells=this.getEmbeddedCells();cells.forEach(function(cell){cells.push.apply(cells,cell.getEmbeddedCells(opt))})}}else{cells=toArray(this.get("embeds")).map(this.graph.getCell,this.graph)}return cells}return[]},isEmbeddedIn:function(cell,opt){var cellId=isString(cell)?cell:cell.id;var parentId=this.parent();opt=assign({deep:true},opt);if(this.graph&&opt.deep){while(parentId){if(parentId===cellId){return true}parentId=this.graph.getCell(parentId).parent()}return false}else{return parentId===cellId}},isEmbedded:function(){return!!this.parent()},clone:function(opt){opt=opt||{};if(!opt.deep){var clone=Backbone.Model.prototype.clone.apply(this,arguments);clone.set(this.getIdAttribute(),this.generateId());clone.unset("embeds");clone.unset("parent");return clone}else{return toArray(cloneCells([this].concat(this.getEmbeddedCells({deep:true}))))}},prop:function(props,value,opt){var delim="/";var _isString=isString(props);if(_isString||Array.isArray(props)){if(arguments.length>1){var path;var pathArray;if(_isString){path=props;pathArray=path.split("/")}else{path=props.join(delim);pathArray=props.slice()}var property=pathArray[0];var pathArrayLength=pathArray.length;opt=opt||{};opt.propertyPath=path;opt.propertyValue=value;opt.propertyPathArray=pathArray;if(pathArrayLength===1){return this.set(property,value,opt)}var update={};var initializer=update;var prevProperty=property;for(var i=1;i<pathArrayLength;i++){var pathItem=pathArray[i];var isArrayIndex=Number.isFinite(_isString?Number(pathItem):pathItem);initializer=initializer[prevProperty]=isArrayIndex?[]:{};prevProperty=pathItem}update=setByPath(update,pathArray,value,"/");var baseAttributes=merge({},this.attributes);opt.rewrite&&unsetByPath(baseAttributes,path,"/");var attributes=merge(baseAttributes,update);return this.set(property,attributes[property],opt)}else{return getByPath(this.attributes,props,delim)}}return this.set(merge({},this.attributes,props),value)},removeProp:function(path,opt){opt=opt||{};var pathArray=Array.isArray(path)?path:path.split("/");var property=pathArray[0];if(property==="attrs"){opt.dirty=true}if(pathArray.length===1){return this.unset(path,opt)}var nestedPath=pathArray.slice(1);var propertyValue=this.get(property);if(propertyValue===undefined||propertyValue===null){return this}propertyValue=cloneDeep(propertyValue);unsetByPath(propertyValue,nestedPath,"/");return this.set(property,propertyValue,opt)},attr:function(attrs,value,opt){var args=Array.from(arguments);if(args.length===0){return this.get("attrs")}if(Array.isArray(attrs)){args[0]=["attrs"].concat(attrs)}else if(isString(attrs)){args[0]="attrs/"+attrs}else{args[0]={attrs:attrs}}return this.prop.apply(this,args)},removeAttr:function(path,opt){if(Array.isArray(path)){return this.removeProp(["attrs"].concat(path))}return this.removeProp("attrs/"+path,opt)},transition:function(path,value,opt,delim){var this$1=this;delim=delim||"/";var defaults={duration:100,delay:10,timingFunction:timing.linear,valueFunction:interpolate.number};opt=assign(defaults,opt);var firstFrameTime=0;var interpolatingFunction;var setter=function(runtime){var id,progress,propertyValue;firstFrameTime=firstFrameTime||runtime;runtime-=firstFrameTime;progress=runtime/opt.duration;if(progress<1){this._transitionIds[path]=id=nextFrame(setter)}else{progress=1;delete this._transitionIds[path]}propertyValue=interpolatingFunction(opt.timingFunction(progress));opt.transitionId=id;this.prop(path,propertyValue,opt);if(!id){this.trigger("transition:end",this,path)}}.bind(this);var ref=this;var _scheduledTransitionIds=ref._scheduledTransitionIds;var initialId;var initiator=function(callback){if(_scheduledTransitionIds[path]){_scheduledTransitionIds[path]=without(_scheduledTransitionIds[path],initialId);if(_scheduledTransitionIds[path].length===0){delete _scheduledTransitionIds[path]}}this$1.stopPendingTransitions(path,delim);interpolatingFunction=opt.valueFunction(getByPath(this$1.attributes,path,delim),value);this$1._transitionIds[path]=nextFrame(callback);this$1.trigger("transition:start",this$1,path)};initialId=setTimeout(initiator,opt.delay,setter);_scheduledTransitionIds[path]||(_scheduledTransitionIds[path]=[]);_scheduledTransitionIds[path].push(initialId);return initialId},getTransitions:function(){return union(Object.keys(this._transitionIds),Object.keys(this._scheduledTransitionIds))},stopScheduledTransitions:function(path,delim){if(delim===void 0)delim="/";var ref=this;var _scheduledTransitionIds=ref._scheduledTransitionIds;if(_scheduledTransitionIds===void 0)_scheduledTransitionIds={};var transitions=Object.keys(_scheduledTransitionIds);if(path){var pathArray=path.split(delim);transitions=transitions.filter(function(key){return isEqual(pathArray,key.split(delim).slice(0,pathArray.length))})}transitions.forEach(function(key){var transitionIds=_scheduledTransitionIds[key];transitionIds.forEach(function(transitionId){return clearTimeout(transitionId)});delete _scheduledTransitionIds[key]});return this},stopPendingTransitions:function stopPendingTransitions(path,delim){var this$1=this;if(delim===void 0)delim="/";var ref=this;var _transitionIds=ref._transitionIds;if(_transitionIds===void 0)_transitionIds={};var transitions=Object.keys(_transitionIds);if(path){var pathArray=path.split(delim);transitions=transitions.filter(function(key){return isEqual(pathArray,key.split(delim).slice(0,pathArray.length))})}transitions.forEach(function(key){var transitionId=_transitionIds[key];cancelFrame(transitionId);delete _transitionIds[key];this$1.trigger("transition:end",this$1,key)})},stopTransitions:function(path,delim){if(delim===void 0)delim="/";this.stopScheduledTransitions(path,delim);this.stopPendingTransitions(path,delim);return this},addTo:function(graph,opt){graph.addCell(this,opt);return this},findView:function(paper){return paper.findViewByModel(this)},isElement:function(){return false},isLink:function(){return false},startBatch:function(name,opt){if(this.graph){this.graph.startBatch(name,assign({},opt,{cell:this}))}return this},stopBatch:function(name,opt){if(this.graph){this.graph.stopBatch(name,assign({},opt,{cell:this}))}return this},getChangeFlag:function(attributes){var flag=0;if(!attributes){return flag}for(var key in attributes){if(!attributes.hasOwnProperty(key)||!this.hasChanged(key)){continue}flag|=attributes[key]}return flag},angle:function(){return 0},position:function(){return new Point(0,0)},getPointFromConnectedLink:function(){return new Point},getBBox:function(){return new Rect(0,0,0,0)},getPointRotatedAroundCenter:function getPointRotatedAroundCenter(angle,x,y){var point=new Point(x,y);if(angle){point.rotate(this.getBBox().center(),angle)}return point},getAbsolutePointFromRelative:function getAbsolutePointFromRelative(x,y){return this.getPointRotatedAroundCenter(-this.angle(),this.position().offset(x,y))},getRelativePointFromAbsolute:function getRelativePointFromAbsolute(x,y){return this.getPointRotatedAroundCenter(this.angle(),x,y).difference(this.position())}},{getAttributeDefinition:function(attrName){var defNS=this.attributes;var globalDefNS=attributes;return defNS&&defNS[attrName]||globalDefNS[attrName]},define:function(type,defaults,protoProps,staticProps){protoProps=assign({defaults:defaultsDeep({type:type},defaults,this.prototype.defaults)},protoProps);var Cell=this.extend(protoProps,staticProps);if(typeof joint!=="undefined"&&has$2(joint,"shapes")){setByPath(joint.shapes,type,Cell,".")}return Cell}});var wrapWith=function(object,methods,wrapper){if(isString(wrapper)){if(!wrappers[wrapper]){throw new Error('Unknown wrapper: "'+wrapper+'"')}wrapper=wrappers[wrapper]}if(!isFunction(wrapper)){throw new Error("Wrapper must be a function.")}toArray(methods).forEach(function(method){object[method]=wrapper(object[method])})};var wrappers={cells:function(fn){return function(){var args=Array.from(arguments);var n=args.length;var cells=n>0&&args[0]||[];var opt=n>1&&args[n-1]||{};if(!Array.isArray(cells)){if(opt instanceof Cell){cells=args}else if(cells instanceof Cell){if(args.length>1){args.pop()}cells=args}}if(opt instanceof Cell){opt={}}return fn.call(this,cells,opt)}}};function svg(strings){var expressions=[],len=arguments.length-1;while(len-- >0)expressions[len]=arguments[len+1];var svgParts=[];strings.forEach(function(part,index){svgParts.push(part);if(index in expressions){svgParts.push(expressions[index])}});var markup=parseFromSVGString(svgParts.join(""));return markup}function parseFromSVGString(str){var parser=new DOMParser;var markupString="<svg>"+str.trim()+"</svg>";var xmldocument=parser.parseFromString(markupString.replace(/@/g,""),"application/xml");if(xmldocument.getElementsByTagName("parsererror")[0]){throw new Error("Invalid SVG markup")}var document=parser.parseFromString(markupString,"text/html");var svg=document.querySelector("svg");return build(svg)}function build(root){var markup=[];Array.from(root.children).forEach(function(node){var markupNode={};var tagName=node.tagName;var attributes=node.attributes;var textContent=node.textContent;var namespaceURI=node.namespaceURI;var style=node.style;markupNode.tagName=tagName;markupNode.namespaceURI=namespaceURI;var stylesObject={};for(var i=style.length;i--;){var nameString=style[i];stylesObject[nameString]=style.getPropertyValue(nameString)}markupNode.style=stylesObject;var selectorAttribute=attributes.getNamedItem("@selector");if(selectorAttribute){markupNode.selector=selectorAttribute.value;attributes.removeNamedItem("@selector")}var groupSelectorAttribute=attributes.getNamedItem("@group-selector");if(groupSelectorAttribute){var groupSelectors=groupSelectorAttribute.value.split(",");markupNode.groupSelector=groupSelectors.map(function(s){return s.trim()});attributes.removeNamedItem("@group-selector")}var className=attributes.getNamedItem("class");if(className){markupNode.className=className.value}if(textContent){markupNode.textContent=textContent}var nodeAttrs={};Array.from(attributes).forEach(function(nodeAttribute){var name=nodeAttribute.name;var value=nodeAttribute.value;nodeAttrs[name]=value});if(Object.keys(nodeAttrs).length>0){markupNode.attributes=nodeAttrs}if(node.childElementCount>0){markupNode.children=build(node)}markup.push(markupNode)});return markup}var Positions={TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",CENTER:"center"};function getRectPoint(rect,position){var r=new Rect(rect);switch(position){case undefined:throw new Error("Position required");case Positions.LEFT:case"leftMiddle":return r.leftMiddle();case Positions.RIGHT:case"rightMiddle":return r.rightMiddle();case Positions.TOP:case"topMiddle":return r.topMiddle();case Positions.BOTTOM:case"bottomMiddle":return r.bottomMiddle();case Positions.TOP_LEFT:case"topLeft":case"origin":return r.topLeft();case Positions.TOP_RIGHT:case"topRight":return r.topRight();case Positions.BOTTOM_LEFT:case"bottomLeft":return r.bottomLeft();case Positions.BOTTOM_RIGHT:case"bottomRight":case"corner":return r.bottomRight();case Positions.CENTER:return r.center();default:throw new Error("Unknown position: "+position)}}var index={getRectPoint:getRectPoint,wrapWith:wrapWith,wrappers:wrappers,addClassNamePrefix:addClassNamePrefix,removeClassNamePrefix:removeClassNamePrefix,parseDOMJSON:parseDOMJSON,hashCode:hashCode,getByPath:getByPath,setByPath:setByPath,unsetByPath:unsetByPath,flattenObject:flattenObject,uuid:uuid,guid:guid,toKebabCase:toKebabCase,normalizeEvent:normalizeEvent,normalizeWheel:normalizeWheel,cap:cap,nextFrame:nextFrame,cancelFrame:cancelFrame,shapePerimeterConnectionPoint:shapePerimeterConnectionPoint,isPercentage:isPercentage,parseCssNumeric:parseCssNumeric,breakText:breakText,sanitizeHTML:sanitizeHTML,downloadBlob:downloadBlob,downloadDataUri:downloadDataUri,dataUriToBlob:dataUriToBlob,imageToDataUri:imageToDataUri,getElementBBox:getElementBBox,sortElements:sortElements,setAttributesBySelector:setAttributesBySelector,normalizeSides:normalizeSides,timing:timing,interpolate:interpolate,filter:filter,format:format,template:template,toggleFullScreen:toggleFullScreen,mixin:mixin,supplement:supplement,deepMixin:deepMixin,deepSupplement:deepSupplement,assign:assign,defaults:defaults,defaultsDeep:defaultsDeep,invoke:invoke,sortedIndex:sortedIndex,uniq:uniq,clone:clone,cloneDeep:cloneDeep,isEmpty:isEmpty,isEqual:isEqual,isFunction:isFunction,isPlainObject:isPlainObject,toArray:toArray,debounce:debounce,groupBy:groupBy,sortBy:sortBy,flattenDeep:flattenDeep,without:without,difference:difference,intersection:intersection$1,union:union,has:has$2,result:result,omit:omit,pick:pick,bindAll:bindAll,forIn:forIn,camelCase:camelCase,uniqueId:uniqueId,merge:merge,isBoolean:isBoolean,isObject:isObject$1,isNumber:isNumber,isString:isString,noop:noop,cloneCells:cloneCells,svg:svg};function portTransformAttrs(point,angle,opt){var trans=point.toJSON();trans.angle=angle||0;return defaults({},opt,trans)}function lineLayout(ports,p1,p2,elBBox){return ports.map(function(port,index,ports){var p=this.pointAt((index+.5)/ports.length);if(port.dx||port.dy){p.offset(port.dx||0,port.dy||0)}return portTransformAttrs(p.round(),0,argTransform(elBBox,port))},line(p1,p2))}function ellipseLayout(ports,elBBox,startAngle,stepFn){var center=elBBox.center();var ratio=elBBox.width/elBBox.height;var p1=elBBox.topMiddle();var ellipse=Ellipse.fromRect(elBBox);return ports.map(function(port,index,ports){var angle=startAngle+stepFn(index,ports.length);var p2=p1.clone().rotate(center,-angle).scale(ratio,1,center);var theta=port.compensateRotation?-ellipse.tangentTheta(p2):0;if(port.dx||port.dy){p2.offset(port.dx||0,port.dy||0)}if(port.dr){p2.move(center,port.dr)}return portTransformAttrs(p2.round(),theta,argTransform(elBBox,port))})}function argTransform(bbox,args){var x=args.x;var y=args.y;var angle=args.angle;if(isPercentage(x)){x=parseFloat(x)/100*bbox.width}else if(isCalcAttribute(x)){x=Number(evalCalcAttribute(x,bbox))}if(isPercentage(y)){y=parseFloat(y)/100*bbox.height}else if(isCalcAttribute(y)){y=Number(evalCalcAttribute(y,bbox))}return{x:x,y:y,angle:angle}}function argPoint(bbox,args){var ref=argTransform(bbox,args);var x=ref.x;var y=ref.y;return new Point(x||0,y||0)}var absolute=function(ports,elBBox){return ports.map(function(port){var transformation=argPoint(elBBox,port).round().toJSON();transformation.angle=port.angle||0;return transformation})};var fn=function(ports,elBBox,opt){return opt.fn(ports,elBBox,opt)};var line$1=function(ports,elBBox,opt){var start=argPoint(elBBox,opt.start||elBBox.origin());var end=argPoint(elBBox,opt.end||elBBox.corner());return lineLayout(ports,start,end,elBBox)};var left=function(ports,elBBox,opt){return lineLayout(ports,elBBox.origin(),elBBox.bottomLeft(),elBBox)};var right=function(ports,elBBox,opt){return lineLayout(ports,elBBox.topRight(),elBBox.corner(),elBBox)};var top=function(ports,elBBox,opt){return lineLayout(ports,elBBox.origin(),elBBox.topRight(),elBBox)};var bottom=function(ports,elBBox,opt){return lineLayout(ports,elBBox.bottomLeft(),elBBox.corner(),elBBox)};var ellipseSpread=function(ports,elBBox,opt){var startAngle=opt.startAngle||0;var stepAngle=opt.step||360/ports.length;return ellipseLayout(ports,elBBox,startAngle,function(index){return index*stepAngle})};var ellipse$1=function(ports,elBBox,opt){var startAngle=opt.startAngle||0;var stepAngle=opt.step||20;return ellipseLayout(ports,elBBox,startAngle,function(index,count){return(index+.5-count/2)*stepAngle})};var Port={absolute:absolute,fn:fn,line:line$1,left:left,right:right,top:top,bottom:bottom,ellipseSpread:ellipseSpread,ellipse:ellipse$1};function labelAttributes(opt1,opt2){return defaultsDeep({},opt1,opt2,{x:0,y:0,angle:0,attrs:{".":{y:"0","text-anchor":"start"}}})}function outsideLayout(portPosition,elBBox,autoOrient,opt){opt=defaults({},opt,{offset:15});var angle=elBBox.center().theta(portPosition);var x=getBBoxAngles(elBBox);var tx,ty,y,textAnchor;var offset=opt.offset;var orientAngle=0;if(angle<x[1]||angle>x[2]){y=".3em";tx=offset;ty=0;textAnchor="start"}else if(angle<x[0]){y="0";tx=0;ty=-offset;if(autoOrient){orientAngle=-90;textAnchor="start"}else{textAnchor="middle"}}else if(angle<x[3]){y=".3em";tx=-offset;ty=0;textAnchor="end"}else{y=".6em";tx=0;ty=offset;if(autoOrient){orientAngle=90;textAnchor="start"}else{textAnchor="middle"}}var round=Math.round;return labelAttributes({x:round(tx),y:round(ty),angle:orientAngle,attrs:{".":{y:y,"text-anchor":textAnchor}}})}function getBBoxAngles(elBBox){var center=elBBox.center();var tl=center.theta(elBBox.origin());var bl=center.theta(elBBox.bottomLeft());var br=center.theta(elBBox.corner());var tr=center.theta(elBBox.topRight());return[tl,tr,br,bl]}function insideLayout(portPosition,elBBox,autoOrient,opt){var angle=elBBox.center().theta(portPosition);opt=defaults({},opt,{offset:15});var tx,ty,y,textAnchor;var offset=opt.offset;var orientAngle=0;var bBoxAngles=getBBoxAngles(elBBox);if(angle<bBoxAngles[1]||angle>bBoxAngles[2]){y=".3em";tx=-offset;ty=0;textAnchor="end"}else if(angle<bBoxAngles[0]){y=".6em";tx=0;ty=offset;if(autoOrient){orientAngle=90;textAnchor="start"}else{textAnchor="middle"}}else if(angle<bBoxAngles[3]){y=".3em";tx=offset;ty=0;textAnchor="start"}else{y="0em";tx=0;ty=-offset;if(autoOrient){orientAngle=-90;textAnchor="start"}else{textAnchor="middle"}}var round=Math.round;return labelAttributes({x:round(tx),y:round(ty),angle:orientAngle,attrs:{".":{y:y,"text-anchor":textAnchor}}})}function radialLayout(portCenterOffset,autoOrient,opt){opt=defaults({},opt,{offset:20});var origin=point(0,0);var angle=-portCenterOffset.theta(origin);var orientAngle=angle;var offset=portCenterOffset.clone().move(origin,opt.offset).difference(portCenterOffset).round();var y=".3em";var textAnchor;if((angle+90)%180===0){textAnchor=autoOrient?"end":"middle";if(!autoOrient&&angle===-270){y="0em"}}else if(angle>-270&&angle<-90){textAnchor="start";orientAngle=angle-180}else{textAnchor="end"}var round=Math.round;return labelAttributes({x:round(offset.x),y:round(offset.y),angle:autoOrient?orientAngle:0,attrs:{".":{y:y,"text-anchor":textAnchor}}})}var manual=function(portPosition,elBBox,opt){return labelAttributes(opt,elBBox)};var left$1=function(portPosition,elBBox,opt){return labelAttributes(opt,{x:-15,attrs:{".":{y:".3em","text-anchor":"end"}}})};var right$1=function(portPosition,elBBox,opt){return labelAttributes(opt,{x:15,attrs:{".":{y:".3em","text-anchor":"start"}}})};var top$1=function(portPosition,elBBox,opt){return labelAttributes(opt,{y:-15,attrs:{".":{"text-anchor":"middle"}}})};var bottom$1=function(portPosition,elBBox,opt){return labelAttributes(opt,{y:15,attrs:{".":{y:".6em","text-anchor":"middle"}}})};var outsideOriented=function(portPosition,elBBox,opt){return outsideLayout(portPosition,elBBox,true,opt)};var outside=function(portPosition,elBBox,opt){return outsideLayout(portPosition,elBBox,false,opt)};var insideOriented=function(portPosition,elBBox,opt){return insideLayout(portPosition,elBBox,true,opt)};var inside=function(portPosition,elBBox,opt){return insideLayout(portPosition,elBBox,false,opt)};var radial=function(portPosition,elBBox,opt){return radialLayout(portPosition.difference(elBBox.center()),false,opt)};var radialOriented=function(portPosition,elBBox,opt){return radialLayout(portPosition.difference(elBBox.center()),true,opt)};var PortLabel={manual:manual,left:left$1,right:right$1,top:top$1,bottom:bottom$1,outsideOriented:outsideOriented,outside:outside,insideOriented:insideOriented,inside:inside,radial:radial,radialOriented:radialOriented};var Link=Cell.extend({markup:['<path class="connection" stroke="black" d="M 0 0 0 0"/>','<path class="marker-source" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="marker-target" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="connection-wrap" d="M 0 0 0 0"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z" />',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),doubleToolMarkup:undefined,vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaultLabel:undefined,labelMarkup:undefined,_builtins:{defaultLabel:{markup:[{tagName:"rect",selector:"rect"},{tagName:"text",selector:"text"}],attrs:{text:{fill:"#000000",fontSize:14,textAnchor:"middle",yAlignment:"middle",pointerEvents:"none"},rect:{ref:"text",fill:"#ffffff",rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}}},defaults:{type:"link",source:{},target:{}},isLink:function(){return true},disconnect:function(opt){return this.set({source:{x:0,y:0},target:{x:0,y:0}},opt)},source:function(source,args,opt){if(source===undefined){return clone(this.get("source"))}var setSource;var setOpt;var isCellProvided=source instanceof Cell;if(isCellProvided){setSource=clone(args)||{};setSource.id=source.id;setOpt=opt;return this.set("source",setSource,setOpt)}var isPointProvided=!isPlainObject(source);if(isPointProvided){setSource=clone(args)||{};setSource.x=source.x;setSource.y=source.y;setOpt=opt;return this.set("source",setSource,setOpt)}setSource=source;setOpt=args;return this.set("source",setSource,setOpt)},target:function(target,args,opt){if(target===undefined){return clone(this.get("target"))}var setTarget;var setOpt;var isCellProvided=target instanceof Cell;if(isCellProvided){setTarget=clone(args)||{};setTarget.id=target.id;setOpt=opt;return this.set("target",setTarget,setOpt)}var isPointProvided=!isPlainObject(target);if(isPointProvided){setTarget=clone(args)||{};setTarget.x=target.x;setTarget.y=target.y;setOpt=opt;return this.set("target",setTarget,setOpt)}setTarget=target;setOpt=args;return this.set("target",setTarget,setOpt)},router:function(name,args,opt){if(name===undefined){var router=this.get("router");if(!router){if(this.get("manhattan")){return{name:"orthogonal"}}return null}if(typeof router==="object"){return clone(router)}return router}var isRouterProvided=typeof name==="object"||typeof name==="function";var localRouter=isRouterProvided?name:{name:name,args:args};var localOpt=isRouterProvided?args:opt;return this.set("router",localRouter,localOpt)},connector:function(name,args,opt){if(name===undefined){var connector=this.get("connector");if(!connector){if(this.get("smooth")){return{name:"smooth"}}return null}if(typeof connector==="object"){return clone(connector)}return connector}var isConnectorProvided=typeof name==="object"||typeof name==="function";var localConnector=isConnectorProvided?name:{name:name,args:args};var localOpt=isConnectorProvided?args:opt;return this.set("connector",localConnector,localOpt)},label:function(idx,label,opt){var labels=this.labels();idx=isFinite(idx)&&idx!==null?idx|0:0;if(idx<0){idx=labels.length+idx}if(arguments.length<=1){return this.prop(["labels",idx])}return this.prop(["labels",idx],label,opt)},labels:function(labels,opt){if(arguments.length===0){labels=this.get("labels");if(!Array.isArray(labels)){return[]}return labels.slice()}if(!Array.isArray(labels)){labels=[]}return this.set("labels",labels,opt)},hasLabels:function(){var ref=this.attributes;var labels=ref.labels;return Array.isArray(labels)&&labels.length>0},insertLabel:function(idx,label,opt){if(!label){throw new Error("dia.Link: no label provided")}var labels=this.labels();var n=labels.length;idx=isFinite(idx)&&idx!==null?idx|0:n;if(idx<0){idx=n+idx+1}labels.splice(idx,0,label);return this.labels(labels,opt)},appendLabel:function(label,opt){return this.insertLabel(-1,label,opt)},removeLabel:function(idx,opt){var labels=this.labels();idx=isFinite(idx)&&idx!==null?idx|0:-1;labels.splice(idx,1);return this.labels(labels,opt)},vertex:function(idx,vertex,opt){var vertices=this.vertices();idx=isFinite(idx)&&idx!==null?idx|0:0;if(idx<0){idx=vertices.length+idx}if(arguments.length<=1){return this.prop(["vertices",idx])}var setVertex=this._normalizeVertex(vertex);return this.prop(["vertices",idx],setVertex,opt)},vertices:function(vertices,opt){if(arguments.length===0){vertices=this.get("vertices");if(!Array.isArray(vertices)){return[]}return vertices.slice()}if(!Array.isArray(vertices)){vertices=[]}var setVertices=[];for(var i=0;i<vertices.length;i++){var vertex=vertices[i];var setVertex=this._normalizeVertex(vertex);setVertices.push(setVertex)}return this.set("vertices",setVertices,opt)},insertVertex:function(idx,vertex,opt){if(!vertex){throw new Error("dia.Link: no vertex provided")}var vertices=this.vertices();var n=vertices.length;idx=isFinite(idx)&&idx!==null?idx|0:n;if(idx<0){idx=n+idx+1}var setVertex=this._normalizeVertex(vertex);vertices.splice(idx,0,setVertex);return this.vertices(vertices,opt)},removeVertex:function(idx,opt){var vertices=this.vertices();idx=isFinite(idx)&&idx!==null?idx|0:-1;vertices.splice(idx,1);return this.vertices(vertices,opt)},_normalizeVertex:function(vertex){var isPointProvided=!isPlainObject(vertex);if(isPointProvided){return{x:vertex.x,y:vertex.y}}return vertex},translate:function(tx,ty,opt){opt=opt||{};opt.translateBy=opt.translateBy||this.id;opt.tx=tx;opt.ty=ty;return this.applyToPoints(function(p){return{x:(p.x||0)+tx,y:(p.y||0)+ty}},opt)},scale:function(sx,sy,origin,opt){return this.applyToPoints(function(p){return Point(p).scale(sx,sy,origin).toJSON()},opt)},applyToPoints:function(fn,opt){if(!isFunction(fn)){throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.")}var attrs={};var ref=this.attributes;var source=ref.source;var target=ref.target;if(!source.id){attrs.source=fn(source)}if(!target.id){attrs.target=fn(target)}var vertices=this.vertices();if(vertices.length>0){attrs.vertices=vertices.map(fn)}return this.set(attrs,opt)},getSourcePoint:function(){var sourceCell=this.getSourceCell();if(!sourceCell){return new Point(this.source())}return sourceCell.getPointFromConnectedLink(this,"source")},getTargetPoint:function(){var targetCell=this.getTargetCell();if(!targetCell){return new Point(this.target())}return targetCell.getPointFromConnectedLink(this,"target")},getPointFromConnectedLink:function(){return this.getPolyline().pointAt(.5)},getPolyline:function(){var points=[this.getSourcePoint()].concat(this.vertices().map(Point),[this.getTargetPoint()]);return new Polyline(points)},getBBox:function(){return this.getPolyline().bbox()},reparent:function(opt){var newParent;if(this.graph){var source=this.getSourceElement();var target=this.getTargetElement();var prevParent=this.getParentCell();if(source&&target){if(source===target||source.isEmbeddedIn(target)){newParent=target}else if(target.isEmbeddedIn(source)){newParent=source}else{newParent=this.graph.getCommonAncestor(source,target)}}if(prevParent&&(!newParent||newParent.id!==prevParent.id)){prevParent.unembed(this,opt)}if(newParent){newParent.embed(this,opt)}}return newParent},hasLoop:function(opt){opt=opt||{};var ref=this.attributes;var source=ref.source;var target=ref.target;var sourceId=source.id;var targetId=target.id;if(!sourceId||!targetId){return false}var loop=sourceId===targetId;if(!loop&&opt.deep&&this.graph){var sourceElement=this.getSourceCell();var targetElement=this.getTargetCell();loop=sourceElement.isEmbeddedIn(targetElement)||targetElement.isEmbeddedIn(sourceElement)}return loop},getSourceCell:function(){var ref=this;var graph=ref.graph;var attributes=ref.attributes;var source=attributes.source;return source&&source.id&&graph&&graph.getCell(source.id)||null},getSourceElement:function(){var cell=this;var visited={};do{if(visited[cell.id]){return null}visited[cell.id]=true;cell=cell.getSourceCell()}while(cell&&cell.isLink());return cell},getTargetCell:function(){var ref=this;var graph=ref.graph;var attributes=ref.attributes;var target=attributes.target;return target&&target.id&&graph&&graph.getCell(target.id)||null},getTargetElement:function(){var cell=this;var visited={};do{if(visited[cell.id]){return null}visited[cell.id]=true;cell=cell.getTargetCell()}while(cell&&cell.isLink());return cell},getRelationshipAncestor:function(){var connectionAncestor;if(this.graph){var cells=[this,this.getSourceElement(),this.getTargetElement()].filter(function(item){return!!item});connectionAncestor=this.graph.getCommonAncestor.apply(this.graph,cells)}return connectionAncestor||null},isRelationshipEmbeddedIn:function(cell){var cellId=isString(cell)||isNumber(cell)?cell:cell.id;var ancestor=this.getRelationshipAncestor();return!!ancestor&&(ancestor.id===cellId||ancestor.isEmbeddedIn(cellId))},_getDefaultLabel:function(){var defaultLabel=this.get("defaultLabel")||this.defaultLabel||{};var label={};label.markup=defaultLabel.markup||this.get("labelMarkup")||this.labelMarkup;label.position=defaultLabel.position;label.attrs=defaultLabel.attrs;label.size=defaultLabel.size;return label}},{endsEqual:function(a,b){var portsEqual=a.port===b.port||!a.port&&!b.port;return a.id===b.id&&portsEqual}});var PortData=function(data){var clonedData=cloneDeep(data)||{};this.ports=[];this.groups={};this.portLayoutNamespace=Port;this.portLabelLayoutNamespace=PortLabel;this._init(clonedData)};PortData.prototype={getPorts:function(){return this.ports},getGroup:function(name){return this.groups[name]||{}},getPortsByGroup:function(groupName){return this.ports.filter(function(port){return port.group===groupName})},getGroupPortsMetrics:function(groupName,elBBox){var group=this.getGroup(groupName);var ports=this.getPortsByGroup(groupName);var groupPosition=group.position||{};var groupPositionName=groupPosition.name;var namespace=this.portLayoutNamespace;if(!namespace[groupPositionName]){groupPositionName="left"}var groupArgs=groupPosition.args||{};var portsArgs=ports.map(function(port){return port&&port.position&&port.position.args});var groupPortTransformations=namespace[groupPositionName](portsArgs,elBBox,groupArgs);var accumulator={ports:ports,result:[]};toArray(groupPortTransformations).reduce(function(res,portTransformation,index){var port=res.ports[index];res.result.push({portId:port.id,portTransformation:portTransformation,labelTransformation:this._getPortLabelLayout(port,Point(portTransformation),elBBox),portAttrs:port.attrs,portSize:port.size,labelSize:port.label.size});return res}.bind(this),accumulator);return accumulator.result},_getPortLabelLayout:function(port,portPosition,elBBox){var namespace=this.portLabelLayoutNamespace;var labelPosition=port.label.position.name||"left";if(namespace[labelPosition]){return namespace[labelPosition](portPosition,elBBox,port.label.position.args)}return null},_init:function(data){if(isObject$1(data.groups)){var groups=Object.keys(data.groups);for(var i=0,n=groups.length;i<n;i++){var key=groups[i];this.groups[key]=this._evaluateGroup(data.groups[key])}}var ports=toArray(data.items);for(var j=0,m=ports.length;j<m;j++){this.ports.push(this._evaluatePort(ports[j]))}},_evaluateGroup:function(group){return merge(group,{position:this._getPosition(group.position,true),label:this._getLabel(group,true)})},_evaluatePort:function(port){var evaluated=assign({},port);var group=this.getGroup(port.group);evaluated.markup=evaluated.markup||group.markup;evaluated.attrs=merge({},group.attrs,evaluated.attrs);evaluated.position=this._createPositionNode(group,evaluated);evaluated.label=merge({},group.label,this._getLabel(evaluated));evaluated.z=this._getZIndex(group,evaluated);evaluated.size=assign({},group.size,evaluated.size);return evaluated},_getZIndex:function(group,port){if(isNumber(port.z)){return port.z}if(isNumber(group.z)||group.z==="auto"){return group.z}return"auto"},_createPositionNode:function(group,port){return merge({name:"left",args:{}},group.position,{args:port.args})},_getPosition:function(position,setDefault){var args={};var positionName;if(isFunction(position)){positionName="fn";args.fn=position}else if(isString(position)){positionName=position}else if(position===undefined){positionName=setDefault?"left":null}else if(Array.isArray(position)){positionName="absolute";args.x=position[0];args.y=position[1]}else if(isObject$1(position)){positionName=position.name;assign(args,position.args)}var result={args:args};if(positionName){result.name=positionName}return result},_getLabel:function(item,setDefaults){var label=item.label||{};var ret=label;ret.position=this._getPosition(label.position,setDefaults);return ret}};var elementPortPrototype={_initializePorts:function(){this._createPortData();this.on("change:ports",function(){this._processRemovedPort();this._createPortData()},this)},_processRemovedPort:function(){var current=this.get("ports")||{};var currentItemsMap={};toArray(current.items).forEach(function(item){currentItemsMap[item.id]=true});var previous=this.previous("ports")||{};var removed={};toArray(previous.items).forEach(function(item){if(!currentItemsMap[item.id]){removed[item.id]=true}});var graph=this.graph;if(graph&&!isEmpty(removed)){var inboundLinks=graph.getConnectedLinks(this,{inbound:true});inboundLinks.forEach(function(link){if(removed[link.get("target").port]){link.remove()}});var outboundLinks=graph.getConnectedLinks(this,{outbound:true});outboundLinks.forEach(function(link){if(removed[link.get("source").port]){link.remove()}})}},hasPorts:function(){var ports=this.prop("ports/items");return Array.isArray(ports)&&ports.length>0},hasPort:function(id){return this.getPortIndex(id)!==-1},getPorts:function(){return cloneDeep(this.prop("ports/items"))||[]},getGroupPorts:function(groupName){var groupPorts=toArray(this.prop(["ports","items"])).filter(function(port){return port.group===groupName});return cloneDeep(groupPorts)},getPort:function(id){return cloneDeep(toArray(this.prop("ports/items")).find(function(port){return port.id&&port.id===id}))},getPortsPositions:function(groupName){var portsMetrics=this._portSettingsData.getGroupPortsMetrics(groupName,Rect(this.size()));return portsMetrics.reduce(function(positions,metrics){var transformation=metrics.portTransformation;positions[metrics.portId]={x:transformation.x,y:transformation.y,angle:transformation.angle};return positions},{})},getPortIndex:function(port){var id=isObject$1(port)?port.id:port;if(!this._isValidPortId(id)){return-1}return toArray(this.prop("ports/items")).findIndex(function(item){return item.id===id})},addPort:function(port,opt){if(!isObject$1(port)||Array.isArray(port)){throw new Error("Element: addPort requires an object.")}var ports=assign([],this.prop("ports/items"));ports.push(port);this.prop("ports/items",ports,opt);return this},insertPort:function(before,port,opt){var index$1=typeof before==="number"?before:this.getPortIndex(before);if(!isObject$1(port)||Array.isArray(port)){throw new Error("dia.Element: insertPort requires an object.")}var ports=assign([],this.prop("ports/items"));ports.splice(index$1,0,port);this.prop("ports/items",ports,opt);return this},portProp:function(portId,path,value,opt){var index$1=this.getPortIndex(portId);if(index$1===-1){throw new Error("Element: unable to find port with id "+portId)}var args=Array.prototype.slice.call(arguments,1);if(Array.isArray(path)){args[0]=["ports","items",index$1].concat(path)}else if(isString(path)){args[0]=["ports/items/",index$1,"/",path].join("")}else{args=["ports/items/"+index$1];if(isPlainObject(path)){args.push(path);args.push(value)}}return this.prop.apply(this,args)},_validatePorts:function(){var portsAttr=this.get("ports")||{};var errorMessages=[];portsAttr=portsAttr||{};var ports=toArray(portsAttr.items);ports.forEach(function(p){if(typeof p!=="object"){errorMessages.push("Element: invalid port ",p)}if(!this._isValidPortId(p.id)){p.id=this.generatePortId()}},this);if(uniq(ports,"id").length!==ports.length){errorMessages.push("Element: found id duplicities in ports.")}return errorMessages},generatePortId:function(){return this.generateId()},_isValidPortId:function(id){return id!==null&&id!==undefined&&!isObject$1(id)},addPorts:function(ports,opt){if(ports.length){this.prop("ports/items",assign([],this.prop("ports/items")).concat(ports),opt)}return this},removePort:function(port,opt){var options=opt||{};var index$1=this.getPortIndex(port);if(index$1!==-1){var ports=assign([],this.prop(["ports","items"]));ports.splice(index$1,1);options.rewrite=true;this.startBatch("port-remove");this.prop(["ports","items"],ports,options);this.stopBatch("port-remove")}return this},removePorts:function(portsForRemoval,opt){var options,newPorts;if(Array.isArray(portsForRemoval)){options=opt||{};if(portsForRemoval.length===0){return this.this}var currentPorts=assign([],this.prop(["ports","items"]));newPorts=currentPorts.filter(function(cp){return!portsForRemoval.some(function(rp){var rpId=isObject$1(rp)?rp.id:rp;return cp.id===rpId})})}else{options=portsForRemoval||{};newPorts=[]}this.startBatch("port-remove");options.rewrite=true;this.prop(["ports","items"],newPorts,options);this.stopBatch("port-remove");return this},_createPortData:function(){var err=this._validatePorts();if(err.length>0){this.set("ports",this.previous("ports"));throw new Error(err.join(" "))}var prevPortData;if(this._portSettingsData){prevPortData=this._portSettingsData.getPorts()}this._portSettingsData=new PortData(this.get("ports"));var curPortData=this._portSettingsData.getPorts();if(prevPortData){var added=curPortData.filter(function(item){if(!prevPortData.find(function(prevPort){return prevPort.id===item.id})){return item}});var removed=prevPortData.filter(function(item){if(!curPortData.find(function(curPort){return curPort.id===item.id})){return item}});if(removed.length>0){this.trigger("ports:remove",this,removed)}if(added.length>0){this.trigger("ports:add",this,added)}}}};var elementViewPortPrototype={portContainerMarkup:"g",portMarkup:[{tagName:"circle",selector:"circle",attributes:{r:10,fill:"#FFFFFF",stroke:"#000000"}}],portLabelMarkup:[{tagName:"text",selector:"text",attributes:{fill:"#000000"}}],_portElementsCache:null,_initializePorts:function(){this._cleanPortsCache()},_refreshPorts:function(){this._removePorts();this._cleanPortsCache();this._renderPorts()},_cleanPortsCache:function(){this._portElementsCache={}},_renderPorts:function(){var elementReferences=[];var elem=this._getContainerElement();for(var i=0,count=elem.node.childNodes.length;i<count;i++){elementReferences.push(elem.node.childNodes[i])}var portsGropsByZ=groupBy(this.model._portSettingsData.getPorts(),"z");var withoutZKey="auto";toArray(portsGropsByZ[withoutZKey]).forEach(function(port){var portElement=this._getPortElement(port);elem.append(portElement);elementReferences.push(portElement)},this);var groupNames=Object.keys(portsGropsByZ);for(var k=0;k<groupNames.length;k++){var groupName=groupNames[k];if(groupName!==withoutZKey){var z=parseInt(groupName,10);this._appendPorts(portsGropsByZ[groupName],z,elementReferences)}}this._updatePorts()},_getContainerElement:function(){return this.rotatableNode||this.vel},_appendPorts:function(ports,z,refs){var containerElement=this._getContainerElement();var portElements=toArray(ports).map(this._getPortElement,this);if(refs[z]||z<0){V(refs[Math.max(z,0)]).before(portElements)}else{containerElement.append(portElements)}},_getPortElement:function(port){if(this._portElementsCache[port.id]){return this._portElementsCache[port.id].portElement}return this._createPortElement(port)},findPortNode:function(portId,selector){var portCache=this._portElementsCache[portId];if(!portCache){return null}if(!selector){return portCache.portContentElement.node}var portRoot=portCache.portElement.node;var portSelectors=portCache.portSelectors;var ref=this.findBySelector(selector,portRoot,portSelectors);var node=ref[0];if(node===void 0)node=null;return node},_updatePorts:function(){this._updatePortGroup(undefined);var groupsNames=Object.keys(this.model._portSettingsData.groups);groupsNames.forEach(this._updatePortGroup,this)},_removePorts:function(){invoke(this._portElementsCache,"portElement.remove")},_createPortElement:function(port){var portElement;var labelElement;var labelSelectors;var portSelectors;var portContainerElement=V(this.portContainerMarkup).addClass("joint-port");var portMarkup=this._getPortMarkup(port);if(Array.isArray(portMarkup)){var portDoc=this.parseDOMJSON(portMarkup,portContainerElement.node);var portFragment=portDoc.fragment;if(portFragment.childNodes.length>1){portElement=V("g").append(portFragment)}else{portElement=V(portFragment.firstChild)}portSelectors=portDoc.selectors}else{portElement=V(portMarkup);if(Array.isArray(portElement)){portElement=V("g").append(portElement)}}if(!portElement){throw new Error("ElementView: Invalid port markup.")}portElement.attr({port:port.id,"port-group":port.group});var labelMarkupDef=this._getPortLabelMarkup(port.label);if(Array.isArray(labelMarkupDef)){var ref=this.parseDOMJSON(labelMarkupDef,portContainerElement.node);var fragment=ref.fragment;var selectors=ref.selectors;var childCount=fragment.childNodes.length;if(childCount>0){labelSelectors=selectors;labelElement=childCount===1?V(fragment.firstChild):V("g").append(fragment)}}else{labelElement=V(labelMarkupDef);if(Array.isArray(labelElement)){labelElement=V("g").append(labelElement)}}var portContainerSelectors;if(portSelectors&&labelSelectors){for(var key in labelSelectors){if(portSelectors[key]&&key!==this.selector){throw new Error("ElementView: selectors within port must be unique.")}}portContainerSelectors=assign({},portSelectors,labelSelectors)}else{portContainerSelectors=portSelectors||labelSelectors||{}}var portRootSelector="portRoot";if(!(portRootSelector in portContainerSelectors)){portContainerSelectors[portRootSelector]=portElement.node}var labelRootSelector="labelRoot";if(labelElement&&!(labelRootSelector in portContainerSelectors)){portContainerSelectors[labelRootSelector]=labelElement.node}portContainerElement.append(portElement.addClass("joint-port-body"));if(labelElement){portContainerElement.append(labelElement.addClass("joint-port-label"))}this._portElementsCache[port.id]={portElement:portContainerElement,portLabelElement:labelElement,portSelectors:portContainerSelectors,portLabelSelectors:labelSelectors,portContentElement:portElement,portContentSelectors:portSelectors};return portContainerElement},_updatePortGroup:function(groupName){var elementBBox=Rect(this.model.size());var portsMetrics=this.model._portSettingsData.getGroupPortsMetrics(groupName,elementBBox);for(var i=0,n=portsMetrics.length;i<n;i++){var metrics=portsMetrics[i];var portId=metrics.portId;var cached=this._portElementsCache[portId]||{};var portTransformation=metrics.portTransformation;this.applyPortTransform(cached.portElement,portTransformation);this.updateDOMSubtreeAttributes(cached.portElement.node,metrics.portAttrs,{rootBBox:new Rect(metrics.portSize),selectors:cached.portSelectors});var labelTransformation=metrics.labelTransformation;if(labelTransformation&&cached.portLabelElement){this.applyPortTransform(cached.portLabelElement,labelTransformation,-portTransformation.angle||0);this.updateDOMSubtreeAttributes(cached.portLabelElement.node,labelTransformation.attrs,{rootBBox:new Rect(metrics.labelSize),selectors:cached.portLabelSelectors})}}},applyPortTransform:function(element,transformData,initialAngle){var matrix=V.createSVGMatrix().rotate(initialAngle||0).translate(transformData.x||0,transformData.y||0).rotate(transformData.angle||0);element.transform(matrix,{absolute:true})},_getPortMarkup:function(port){return port.markup||this.model.get("portMarkup")||this.model.portMarkup||this.portMarkup},_getPortLabelMarkup:function(label){return label.markup||this.model.get("portLabelMarkup")||this.model.portLabelMarkup||this.portLabelMarkup}};var Element$1=Cell.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(){this._initializePorts();Cell.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return true},position:function(x,y,opt){var isSetter=isNumber(y);opt=(isSetter?opt:x)||{};var parentRelative=opt.parentRelative;var deep=opt.deep;var restrictedArea=opt.restrictedArea;var parentPosition;if(parentRelative){if(!this.graph){throw new Error("Element must be part of a graph.")}var parent=this.getParentCell();if(parent&&!parent.isLink()){parentPosition=parent.get("position")}}if(isSetter){if(parentPosition){x+=parentPosition.x;y+=parentPosition.y}if(deep||restrictedArea){var ref=this.get("position");var x0=ref.x;var y0=ref.y;this.translate(x-x0,y-y0,opt)}else{this.set("position",{x:x,y:y},opt)}return this}else{var elementPosition=Point(this.get("position"));return parentRelative?elementPosition.difference(parentPosition):elementPosition}},translate:function(tx,ty,opt){tx=tx||0;ty=ty||0;if(tx===0&&ty===0){return this}opt=opt||{};opt.translateBy=opt.translateBy||this.id;var position=this.get("position")||{x:0,y:0};var ra=opt.restrictedArea;if(ra&&opt.translateBy===this.id){if(typeof ra==="function"){var newPosition=ra.call(this,position.x+tx,position.y+ty,opt);tx=newPosition.x-position.x;ty=newPosition.y-position.y}else{var bbox=this.getBBox({deep:true});var dx=position.x-bbox.x;var dy=position.y-bbox.y;var x=Math.max(ra.x+dx,Math.min(ra.x+ra.width+dx-bbox.width,position.x+tx));var y=Math.max(ra.y+dy,Math.min(ra.y+ra.height+dy-bbox.height,position.y+ty));tx=x-position.x;ty=y-position.y}}var translatedPosition={x:position.x+tx,y:position.y+ty};opt.tx=tx;opt.ty=ty;if(opt.transition){if(!isObject$1(opt.transition)){opt.transition={}}this.transition("position",translatedPosition,assign({},opt.transition,{valueFunction:interpolate.object}));invoke(this.getEmbeddedCells(),"translate",tx,ty,opt)}else{this.startBatch("translate",opt);this.set("position",translatedPosition,opt);invoke(this.getEmbeddedCells(),"translate",tx,ty,opt);this.stopBatch("translate",opt)}return this},size:function(width,height,opt){var currentSize=this.get("size");if(width===undefined){return{width:currentSize.width,height:currentSize.height}}if(isObject$1(width)){opt=height;height=isNumber(width.height)?width.height:currentSize.height;width=isNumber(width.width)?width.width:currentSize.width}return this.resize(width,height,opt)},resize:function(width,height,opt){opt=opt||{};this.startBatch("resize",opt);if(opt.direction){var currentSize=this.get("size");switch(opt.direction){case"left":case"right":height=currentSize.height;break;case"top":case"bottom":width=currentSize.width;break}var angle=normalizeAngle(this.get("angle")||0);var bbox=this.getBBox();var origin;if(angle){var quadrant={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[opt.direction];if(opt.absolute){quadrant+=Math.floor((angle+45)/90);quadrant%=4}var fixedPoint=bbox[["bottomLeft","corner","topRight","origin"][quadrant]]();var imageFixedPoint=Point(fixedPoint).rotate(bbox.center(),-angle);var radius=Math.sqrt(width*width+height*height)/2;var alpha=quadrant*Math.PI/2;alpha+=Math.atan(quadrant%2==0?height/width:width/height);alpha-=toRad(angle);var center=Point.fromPolar(radius,alpha,imageFixedPoint);origin=Point(center).offset(width/-2,height/-2)}else{origin=bbox.topLeft();switch(opt.direction){case"top":case"top-right":origin.offset(0,bbox.height-height);break;case"left":case"bottom-left":origin.offset(bbox.width-width,0);break;case"top-left":origin.offset(bbox.width-width,bbox.height-height);break}}this.set("size",{width:width,height:height},opt);this.position(origin.x,origin.y,opt)}else{this.set("size",{width:width,height:height},opt)}this.stopBatch("resize",opt);return this},scale:function(sx,sy,origin,opt){var scaledBBox=this.getBBox().scale(sx,sy,origin);this.startBatch("scale",opt);this.position(scaledBBox.x,scaledBBox.y,opt);this.resize(scaledBBox.width,scaledBBox.height,opt);this.stopBatch("scale");return this},fitEmbeds:function(opt){if(opt===void 0)opt={};var ref=this;var graph=ref.graph;if(!graph){throw new Error("Element must be part of a graph.")}var embeddedCells=this.getEmbeddedCells().filter(function(cell){return cell.isElement()});if(embeddedCells.length===0){return this}this.startBatch("fit-embeds",opt);if(opt.deep){invoke(embeddedCells,"fitEmbeds",opt)}var ref$1=normalizeSides(opt.padding);var left=ref$1.left;var right=ref$1.right;var top=ref$1.top;var bottom=ref$1.bottom;var ref$2=graph.getCellsBBox(embeddedCells);var x=ref$2.x;var y=ref$2.y;var width=ref$2.width;var height=ref$2.height;x-=left;y-=top;width+=left+right;height+=bottom+top;this.set({position:{x:x,y:y},size:{width:width,height:height}},opt);this.stopBatch("fit-embeds");return this},rotate:function(angle,absolute,origin,opt){if(origin){var center=this.getBBox().center();var size=this.get("size");var position=this.get("position");center.rotate(origin,this.get("angle")-angle);var dx=center.x-size.width/2-position.x;var dy=center.y-size.height/2-position.y;this.startBatch("rotate",{angle:angle,absolute:absolute,origin:origin});this.position(position.x+dx,position.y+dy,opt);this.rotate(angle,absolute,null,opt);this.stopBatch("rotate")}else{this.set("angle",absolute?angle:(this.get("angle")+angle)%360,opt)}return this},angle:function(){return normalizeAngle(this.get("angle")||0)},getBBox:function(opt){if(opt===void 0)opt={};var ref=this;var graph=ref.graph;var attributes=ref.attributes;var deep=opt.deep;var rotate=opt.rotate;if(deep&&graph){var elements=this.getEmbeddedCells({deep:true,breadthFirst:true});elements.push(this);return graph.getCellsBBox(elements,opt)}var angle=attributes.angle;if(angle===void 0)angle=0;var attributes_position=attributes.position;var x=attributes_position.x;var y=attributes_position.y;var attributes_size=attributes.size;var width=attributes_size.width;var height=attributes_size.height;var bbox=new Rect(x,y,width,height);if(rotate){bbox.rotateAroundCenter(angle)}return bbox},getPointFromConnectedLink:function(link,endType){var bbox=this.getBBox();var center=bbox.center();var endDef=link.get(endType);if(!endDef){return center}var portId=endDef.port;if(!portId||!this.hasPort(portId)){return center}var portGroup=this.portProp(portId,["group"]);var portsPositions=this.getPortsPositions(portGroup);var portCenter=new Point(portsPositions[portId]).offset(bbox.origin());var angle=this.angle();if(angle){portCenter.rotate(center,-angle)}return portCenter}});assign(Element$1.prototype,elementPortPrototype);var GraphCells=Backbone.Collection.extend({initialize:function(models,opt){if(opt.cellNamespace){this.cellNamespace=opt.cellNamespace}else{this.cellNamespace=typeof joint!=="undefined"&&has$2(joint,"shapes")?joint.shapes:null}this.graph=opt.graph},model:function(attrs,opt){var collection=opt.collection;var namespace=collection.cellNamespace;var ModelClass=attrs.type==="link"?Link:getByPath(namespace,attrs.type,".")||Element$1;var cell=new ModelClass(attrs,opt);if(!opt.dry){cell.graph=collection.graph}return cell},comparator:function(model){return model.get("z")||0}});var Graph=Backbone.Model.extend({initialize:function(attrs,opt){opt=opt||{};var cells=new GraphCells([],{model:opt.cellModel,cellNamespace:opt.cellNamespace,graph:this});Backbone.Model.prototype.set.call(this,"cells",cells);cells.on("all",this.trigger,this);this.on("change:z",this._sortOnChangeZ,this);this._out={};this._in={};this._nodes={};this._edges={};this._batches={};cells.on("add",this._restructureOnAdd,this);cells.on("remove",this._restructureOnRemove,this);cells.on("reset",this._restructureOnReset,this);cells.on("change:source",this._restructureOnChangeSource,this);cells.on("change:target",this._restructureOnChangeTarget,this);cells.on("remove",this._removeCell,this)},_sortOnChangeZ:function(){this.get("cells").sort()},_restructureOnAdd:function(cell){if(cell.isLink()){this._edges[cell.id]=true;var ref=cell.attributes;var source=ref.source;var target=ref.target;if(source.id){(this._out[source.id]||(this._out[source.id]={}))[cell.id]=true}if(target.id){(this._in[target.id]||(this._in[target.id]={}))[cell.id]=true}}else{this._nodes[cell.id]=true}},_restructureOnRemove:function(cell){if(cell.isLink()){delete this._edges[cell.id];var ref=cell.attributes;var source=ref.source;var target=ref.target;if(source.id&&this._out[source.id]&&this._out[source.id][cell.id]){delete this._out[source.id][cell.id]}if(target.id&&this._in[target.id]&&this._in[target.id][cell.id]){delete this._in[target.id][cell.id]}}else{delete this._nodes[cell.id]}},_restructureOnReset:function(cells){cells=cells.models;this._out={};this._in={};this._nodes={};this._edges={};cells.forEach(this._restructureOnAdd,this)},_restructureOnChangeSource:function(link){var prevSource=link.previous("source");if(prevSource.id&&this._out[prevSource.id]){delete this._out[prevSource.id][link.id]}var source=link.attributes.source;if(source.id){(this._out[source.id]||(this._out[source.id]={}))[link.id]=true}},_restructureOnChangeTarget:function(link){var prevTarget=link.previous("target");if(prevTarget.id&&this._in[prevTarget.id]){delete this._in[prevTarget.id][link.id]}var target=link.get("target");if(target.id){(this._in[target.id]||(this._in[target.id]={}))[link.id]=true}},getOutboundEdges:function(node){return this._out&&this._out[node]||{}},getInboundEdges:function(node){return this._in&&this._in[node]||{}},toJSON:function(){var json=Backbone.Model.prototype.toJSON.apply(this,arguments);json.cells=this.get("cells").toJSON();return json},fromJSON:function(json,opt){if(!json.cells){throw new Error("Graph JSON must contain cells array.")}return this.set(json,opt)},set:function(key,val,opt){var attrs;if(typeof key==="object"){attrs=key;opt=val}else{(attrs={})[key]=val}if(attrs.hasOwnProperty("cells")){this.resetCells(attrs.cells,opt);attrs=omit(attrs,"cells")}return Backbone.Model.prototype.set.call(this,attrs,opt)},clear:function(opt){opt=assign({},opt,{clear:true});var collection=this.get("cells");if(collection.length===0){return this}this.startBatch("clear",opt);var cells=collection.sortBy(function(cell){return cell.isLink()?1:2});do{cells.shift().remove(opt)}while(cells.length>0);this.stopBatch("clear");return this},_prepareCell:function(cell,opt){var attrs;if(cell instanceof Backbone.Model){attrs=cell.attributes;if(!cell.graph&&(!opt||!opt.dry)){cell.graph=this}}else{attrs=cell}if(!isString(attrs.type)){throw new TypeError("dia.Graph: cell type must be a string.")}return cell},minZIndex:function(){var firstCell=this.get("cells").first();return firstCell?firstCell.get("z")||0:0},maxZIndex:function(){var lastCell=this.get("cells").last();return lastCell?lastCell.get("z")||0:0},addCell:function(cell,opt){if(Array.isArray(cell)){return this.addCells(cell,opt)}if(cell instanceof Backbone.Model){if(!cell.has("z")){cell.set("z",this.maxZIndex()+1)}}else if(cell.z===undefined){cell.z=this.maxZIndex()+1}this.get("cells").add(this._prepareCell(cell,opt),opt||{});return this},addCells:function(cells,opt){if(cells.length===0){return this}cells=flattenDeep(cells);opt.maxPosition=opt.position=cells.length-1;this.startBatch("add",opt);cells.forEach(function(cell){this.addCell(cell,opt);opt.position--},this);this.stopBatch("add",opt);return this},resetCells:function(cells,opt){var preparedCells=toArray(cells).map(function(cell){return this._prepareCell(cell,opt)},this);this.get("cells").reset(preparedCells,opt);return this},removeCells:function(cells,opt){if(cells.length){this.startBatch("remove");invoke(cells,"remove",opt);this.stopBatch("remove")}return this},_removeCell:function(cell,collection,options){options=options||{};if(!options.clear){if(options.disconnectLinks){this.disconnectLinks(cell,options)}else{this.removeLinks(cell,options)}}this.get("cells").remove(cell,{silent:true});if(cell.graph===this){cell.graph=null}},getCell:function(id){return this.get("cells").get(id)},getCells:function(){return this.get("cells").toArray()},getElements:function(){return this.get("cells").filter(function(cell){return cell.isElement()})},getLinks:function(){return this.get("cells").filter(function(cell){return cell.isLink()})},getFirstCell:function(){return this.get("cells").first()},getLastCell:function(){return this.get("cells").last()},getConnectedLinks:function(model,opt){opt=opt||{};var indirect=opt.indirect;var inbound=opt.inbound;var outbound=opt.outbound;if(inbound===undefined&&outbound===undefined){inbound=outbound=true}var links=[];var edges={};if(outbound){addOutbounds(this,model)}if(inbound){addInbounds(this,model)}function addOutbounds(graph,model){forIn(graph.getOutboundEdges(model.id),function(_,edge){if(edges[edge]){return}var link=graph.getCell(edge);links.push(link);edges[edge]=true;if(indirect){if(inbound){addInbounds(graph,link)}if(outbound){addOutbounds(graph,link)}}}.bind(graph));if(indirect&&model.isLink()){var outCell=model.getTargetCell();if(outCell&&outCell.isLink()){if(!edges[outCell.id]){links.push(outCell);addOutbounds(graph,outCell)}}}}function addInbounds(graph,model){forIn(graph.getInboundEdges(model.id),function(_,edge){if(edges[edge]){return}var link=graph.getCell(edge);links.push(link);edges[edge]=true;if(indirect){if(inbound){addInbounds(graph,link)}if(outbound){addOutbounds(graph,link)}}}.bind(graph));if(indirect&&model.isLink()){var inCell=model.getSourceCell();if(inCell&&inCell.isLink()){if(!edges[inCell.id]){links.push(inCell);addInbounds(graph,inCell)}}}}if(opt.deep){var embeddedCells=model.getEmbeddedCells({deep:true});var embeddedElements={};embeddedCells.forEach(function(cell){if(cell.isElement()){embeddedElements[cell.id]=true}});embeddedCells.forEach(function(cell){if(cell.isLink()){return}if(outbound){forIn(this.getOutboundEdges(cell.id),function(exists,edge){if(!edges[edge]){var edgeCell=this.getCell(edge);var ref=edgeCell.attributes;var source=ref.source;var target=ref.target;var sourceId=source.id;var targetId=target.id;if(!opt.includeEnclosed&&(sourceId&&embeddedElements[sourceId])&&(targetId&&embeddedElements[targetId])){return}links.push(this.getCell(edge));edges[edge]=true}}.bind(this))}if(inbound){forIn(this.getInboundEdges(cell.id),function(exists,edge){if(!edges[edge]){var edgeCell=this.getCell(edge);var ref=edgeCell.attributes;var source=ref.source;var target=ref.target;var sourceId=source.id;var targetId=target.id;if(!opt.includeEnclosed&&(sourceId&&embeddedElements[sourceId])&&(targetId&&embeddedElements[targetId])){return}links.push(this.getCell(edge));edges[edge]=true}}.bind(this))}},this)}return links},getNeighbors:function(model,opt){opt||(opt={});var inbound=opt.inbound;var outbound=opt.outbound;if(inbound===undefined&&outbound===undefined){inbound=outbound=true}var neighbors=this.getConnectedLinks(model,opt).reduce(function(res,link){var ref=link.attributes;var source=ref.source;var target=ref.target;var loop=link.hasLoop(opt);if(inbound&&has$2(source,"id")&&!res[source.id]){var sourceElement=this.getCell(source.id);if(sourceElement.isElement()){if(loop||sourceElement&&sourceElement!==model&&(!opt.deep||!sourceElement.isEmbeddedIn(model))){res[source.id]=sourceElement}}}if(outbound&&has$2(target,"id")&&!res[target.id]){var targetElement=this.getCell(target.id);if(targetElement.isElement()){if(loop||targetElement&&targetElement!==model&&(!opt.deep||!targetElement.isEmbeddedIn(model))){res[target.id]=targetElement}}}return res}.bind(this),{});if(model.isLink()){if(inbound){var sourceCell=model.getSourceCell();if(sourceCell&&sourceCell.isElement()&&!neighbors[sourceCell.id]){neighbors[sourceCell.id]=sourceCell}}if(outbound){var targetCell=model.getTargetCell();if(targetCell&&targetCell.isElement()&&!neighbors[targetCell.id]){neighbors[targetCell.id]=targetCell}}}return toArray(neighbors)},getCommonAncestor:function(){var cellsAncestors=Array.from(arguments).map(function(cell){var ancestors=[];var parentId=cell.get("parent");while(parentId){ancestors.push(parentId);parentId=this.getCell(parentId).get("parent")}return ancestors},this);cellsAncestors=cellsAncestors.sort(function(a,b){return a.length-b.length});var commonAncestor=toArray(cellsAncestors.shift()).find(function(ancestor){return cellsAncestors.every(function(cellAncestors){return cellAncestors.includes(ancestor)})});return this.getCell(commonAncestor)},getSuccessors:function(element,opt){opt=opt||{};var res=[];this.search(element,function(el){if(el!==element){res.push(el)}},assign({},opt,{outbound:true}));return res},cloneCells:cloneCells,cloneSubgraph:function(cells,opt){var subgraph=this.getSubgraph(cells,opt);return this.cloneCells(subgraph)},getSubgraph:function(cells,opt){opt=opt||{};var subgraph=[];var cellMap={};var elements=[];var links=[];toArray(cells).forEach(function(cell){if(!cellMap[cell.id]){subgraph.push(cell);cellMap[cell.id]=cell;if(cell.isLink()){links.push(cell)}else{elements.push(cell)}}if(opt.deep){var embeds=cell.getEmbeddedCells({deep:true});embeds.forEach(function(embed){if(!cellMap[embed.id]){subgraph.push(embed);cellMap[embed.id]=embed;if(embed.isLink()){links.push(embed)}else{elements.push(embed)}}})}});links.forEach(function(link){var ref=link.attributes;var source=ref.source;var target=ref.target;if(source.id&&!cellMap[source.id]){var sourceElement=this.getCell(source.id);subgraph.push(sourceElement);cellMap[sourceElement.id]=sourceElement;elements.push(sourceElement)}if(target.id&&!cellMap[target.id]){var targetElement=this.getCell(target.id);subgraph.push(this.getCell(target.id));cellMap[targetElement.id]=targetElement;elements.push(targetElement)}},this);elements.forEach(function(element){var links=this.getConnectedLinks(element,opt);links.forEach(function(link){var ref=link.attributes;var source=ref.source;var target=ref.target;if(!cellMap[link.id]&&source.id&&cellMap[source.id]&&target.id&&cellMap[target.id]){subgraph.push(link);cellMap[link.id]=link}})},this);return subgraph},getPredecessors:function(element,opt){opt=opt||{};var res=[];this.search(element,function(el){if(el!==element){res.push(el)}},assign({},opt,{inbound:true}));return res},search:function(element,iteratee,opt){opt=opt||{};if(opt.breadthFirst){this.bfs(element,iteratee,opt)}else{this.dfs(element,iteratee,opt)}},bfs:function(element,iteratee,opt){if(opt===void 0)opt={};var visited={};var distance={};var queue=[];queue.push(element);distance[element.id]=0;while(queue.length>0){var next=queue.shift();if(visited[next.id]){continue}visited[next.id]=true;if(iteratee.call(this,next,distance[next.id])===false){continue}var neighbors=this.getNeighbors(next,opt);for(var i=0,n=neighbors.length;i<n;i++){var neighbor=neighbors[i];distance[neighbor.id]=distance[next.id]+1;queue.push(neighbor)}}},dfs:function(element,iteratee,opt){if(opt===void 0)opt={};var visited={};var distance={};var queue=[];queue.push(element);distance[element.id]=0;while(queue.length>0){var next=queue.pop();if(visited[next.id]){continue}visited[next.id]=true;if(iteratee.call(this,next,distance[next.id])===false){continue}var neighbors=this.getNeighbors(next,opt);var lastIndex=queue.length;for(var i=0,n=neighbors.length;i<n;i++){var neighbor=neighbors[i];distance[neighbor.id]=distance[next.id]+1;queue.splice(lastIndex,0,neighbor)}}},getSources:function(){var sources=[];forIn(this._nodes,function(exists,node){if(!this._in[node]||isEmpty(this._in[node])){sources.push(this.getCell(node))}}.bind(this));return sources},getSinks:function(){var sinks=[];forIn(this._nodes,function(exists,node){if(!this._out[node]||isEmpty(this._out[node])){sinks.push(this.getCell(node))}}.bind(this));return sinks},isSource:function(element){return!this._in[element.id]||isEmpty(this._in[element.id])},isSink:function(element){return!this._out[element.id]||isEmpty(this._out[element.id])},isSuccessor:function(elementA,elementB){var isSuccessor=false;this.search(elementA,function(element){if(element===elementB&&element!==elementA){isSuccessor=true;return false}},{outbound:true});return isSuccessor},isPredecessor:function(elementA,elementB){var isPredecessor=false;this.search(elementA,function(element){if(element===elementB&&element!==elementA){isPredecessor=true;return false}},{inbound:true});return isPredecessor},isNeighbor:function(elementA,elementB,opt){opt=opt||{};var inbound=opt.inbound;var outbound=opt.outbound;if(inbound===undefined&&outbound===undefined){inbound=outbound=true}var isNeighbor=false;this.getConnectedLinks(elementA,opt).forEach(function(link){var ref=link.attributes;var source=ref.source;var target=ref.target;if(inbound&&has$2(source,"id")&&source.id===elementB.id){isNeighbor=true;return false}if(outbound&&has$2(target,"id")&&target.id===elementB.id){isNeighbor=true;return false}});return isNeighbor},disconnectLinks:function(model,opt){this.getConnectedLinks(model).forEach(function(link){link.set(link.attributes.source.id===model.id?"source":"target",{x:0,y:0},opt)})},removeLinks:function(model,opt){invoke(this.getConnectedLinks(model),"remove",opt)},findModelsFromPoint:function(p){return this.getElements().filter(function(el){return el.getBBox({rotate:true}).containsPoint(p)})},findModelsInArea:function(rect,opt){if(opt===void 0)opt={};var r=new Rect(rect);var strict=opt.strict;if(strict===void 0)strict=false;var method=strict?"containsRect":"intersect";return this.getElements().filter(function(el){return r[method](el.getBBox({rotate:true}))})},findModelsUnderElement:function(element,opt){if(opt===void 0)opt={};var searchBy=opt.searchBy;if(searchBy===void 0)searchBy="bbox";var bbox=element.getBBox().rotateAroundCenter(element.angle());var elements=searchBy==="bbox"?this.findModelsInArea(bbox):this.findModelsFromPoint(getRectPoint(bbox,searchBy));return elements.filter(function(el){return element.id!==el.id&&!el.isEmbeddedIn(element)})},getBBox:function(){return this.getCellsBBox(this.getCells())},getCellsBBox:function(cells,opt){if(opt===void 0)opt={};var rotate=opt.rotate;if(rotate===void 0)rotate=true;return toArray(cells).reduce(function(memo,cell){var rect=cell.getBBox({rotate:rotate});if(!rect){return memo}if(memo){return memo.union(rect)}return rect},null)},translate:function(dx,dy,opt){var cells=this.getCells().filter(function(cell){return!cell.isEmbedded()});invoke(cells,"translate",dx,dy,opt);return this},resize:function(width,height,opt){return this.resizeCells(width,height,this.getCells(),opt)},resizeCells:function(width,height,cells,opt){var bbox=this.getCellsBBox(cells);if(bbox){var sx=Math.max(width/bbox.width,0);var sy=Math.max(height/bbox.height,0);invoke(cells,"scale",sx,sy,bbox.origin(),opt)}return this},startBatch:function(name,data){data=data||{};this._batches[name]=(this._batches[name]||0)+1;return this.trigger("batch:start",assign({},data,{batchName:name}))},stopBatch:function(name,data){data=data||{};this._batches[name]=(this._batches[name]||0)-1;return this.trigger("batch:stop",assign({},data,{batchName:name}))},hasActiveBatch:function(name){var batches=this._batches;var names;if(arguments.length===0){names=Object.keys(batches)}else if(Array.isArray(name)){names=name}else{names=[name]}return names.some(function(batch){return batches[batch]>0})}},{validations:{multiLinks:function(graph,link){var ref=link.attributes;var source=ref.source;var target=ref.target;if(source.id&&target.id){var sourceModel=link.getSourceCell();if(sourceModel){var connectedLinks=graph.getConnectedLinks(sourceModel,{outbound:true});var sameLinks=connectedLinks.filter(function(_link){var ref=_link.attributes;var _source=ref.source;var _target=ref.target;return _source&&_source.id===source.id&&(!_source.port||_source.port===source.port)&&_target&&_target.id===target.id&&(!_target.port||_target.port===target.port)});if(sameLinks.length>1){return false}}}return true},linkPinning:function(_graph,link){var ref=link.attributes;var source=ref.source;var target=ref.target;return source.id&&target.id}}});wrapWith(Graph.prototype,["resetCells","addCells","removeCells"],wrappers.cells);var views={};var View=Backbone.View.extend({options:{},theme:null,themeClassNamePrefix:addClassNamePrefix("theme-"),requireSetThemeOverride:false,defaultTheme:config.defaultTheme,children:null,childNodes:null,DETACHABLE:true,UPDATE_PRIORITY:2,FLAG_INSERT:1<<30,FLAG_REMOVE:1<<29,constructor:function(options){this.requireSetThemeOverride=options&&!!options.theme;this.options=assign({},this.options,options);Backbone.View.call(this,options)},initialize:function(){views[this.cid]=this;this.setTheme(this.options.theme||this.defaultTheme);this.init()},unmount:function(){if(this.svgElement){this.vel.remove()}else{this.$el.remove()}},renderChildren:function(children){children||(children=result(this,"children"));if(children){var isSVG=this.svgElement;var namespace=V.namespace[isSVG?"svg":"xhtml"];var doc=parseDOMJSON(children,namespace);(isSVG?this.vel:this.$el).empty().append(doc.fragment);this.childNodes=doc.selectors}return this},findAttribute:function(attributeName,node){var currentNode=node;while(currentNode&&currentNode.nodeType===1){var attributeValue=currentNode.getAttribute(attributeName);if(attributeValue){return attributeValue}if(currentNode===this.el){return null}currentNode=currentNode.parentNode}return null},_ensureElement:function(){if(!this.el){var tagName=result(this,"tagName");var attrs=assign({},result(this,"attributes"));var style=assign({},result(this,"style"));if(this.id){attrs.id=result(this,"id")}this.setElement(this._createElement(tagName));this._setAttributes(attrs);this._setStyle(style)}else{this.setElement(result(this,"el"))}this._ensureElClassName()},_setAttributes:function(attrs){if(this.svgElement){this.vel.attr(attrs)}else{this.$el.attr(attrs)}},_setStyle:function(style){this.$el.css(style)},_createElement:function(tagName){if(this.svgElement){return document.createElementNS(V.namespace.svg,tagName)}else{return document.createElement(tagName)}},_setElement:function(el){this.$el=el instanceof Backbone.$?el:Backbone.$(el);this.el=this.$el[0];if(this.svgElement){this.vel=V(this.el)}},_ensureElClassName:function(){var className=result(this,"className");if(!className){return}var prefixedClassName=addClassNamePrefix(className);if(this.svgElement){this.vel.removeClass(className).addClass(prefixedClassName)}else{this.$el.removeClass(className).addClass(prefixedClassName)}},init:function(){},onRender:function(){},confirmUpdate:function(){return 0},setTheme:function(theme,opt){opt=opt||{};if(this.theme&&this.requireSetThemeOverride&&!opt.override){return this}this.removeThemeClassName();this.addThemeClassName(theme);this.onSetTheme(this.theme,theme);this.theme=theme;return this},addThemeClassName:function(theme){theme=theme||this.theme;if(!theme){return this}var className=this.themeClassNamePrefix+theme;if(this.svgElement){this.vel.addClass(className)}else{this.$el.addClass(className)}return this},removeThemeClassName:function(theme){theme=theme||this.theme;var className=this.themeClassNamePrefix+theme;if(this.svgElement){this.vel.removeClass(className)}else{this.$el.removeClass(className)}return this},onSetTheme:function(oldTheme,newTheme){},remove:function(){this.onRemove();this.undelegateDocumentEvents();views[this.cid]=null;Backbone.View.prototype.remove.apply(this,arguments);return this},onRemove:function(){},getEventNamespace:function(){return".joint-event-ns-"+this.cid},delegateElementEvents:function(element,events,data){if(!events){return this}data||(data={});var eventNS=this.getEventNamespace();for(var eventName in events){var method=events[eventName];if(typeof method!=="function"){method=this[method]}if(!method){continue}$(element).on(eventName+eventNS,data,method.bind(this))}return this},undelegateElementEvents:function(element){$(element).off(this.getEventNamespace());return this},delegateDocumentEvents:function(events,data){events||(events=result(this,"documentEvents"));return this.delegateElementEvents(document,events,data)},undelegateDocumentEvents:function(){return this.undelegateElementEvents(document)},eventData:function(evt,data){if(!evt){throw new Error("eventData(): event object required.")}var currentData=evt.data;var key="__"+this.cid+"__";if(data===undefined){if(!currentData){return{}}return currentData[key]||{}}currentData||(currentData=evt.data={});currentData[key]||(currentData[key]={});assign(currentData[key],data);return this},stopPropagation:function(evt){this.eventData(evt,{propagationStopped:true});return this},isPropagationStopped:function(evt){return!!this.eventData(evt).propagationStopped}},{extend:function(){var args=Array.from(arguments);var protoProps=args[0]&&assign({},args[0])||{};var staticProps=args[1]&&assign({},args[1])||{};var renderFn=protoProps.render||this.prototype&&this.prototype.render||null;protoProps.render=function(){if(typeof renderFn==="function"){renderFn.apply(this,arguments)}if(this.render.__render__===renderFn){this.onRender()}return this};protoProps.render.__render__=renderFn;return Backbone.View.extend.call(this,protoProps,staticProps)}});var DoubleTapEventName="dbltap";if($.event&&!(DoubleTapEventName in $.event.special)){var maxDelay=config.doubleTapInterval;var minDelay=30;$.event.special[DoubleTapEventName]={bindType:"touchend",delegateType:"touchend",handle:function(event){var ref;var args=[],len=arguments.length-1;while(len-- >0)args[len]=arguments[len+1];var handleObj=event.handleObj;var target=event.target;var targetData=$.data(target);var now=(new Date).getTime();var delta="lastTouch"in targetData?now-targetData.lastTouch:0;if(delta<maxDelay&&delta>minDelay){targetData.lastTouch=null;event.type=handleObj.origType;(ref=handleObj.handler).call.apply(ref,[this,event].concat(args))}else{targetData.lastTouch=now}}}}var Listener=function Listener(){var callbackArguments=[],len=arguments.length;while(len--)callbackArguments[len]=arguments[len];this.callbackArguments=callbackArguments};Listener.prototype.listenTo=function listenTo(object,evt){var this$1=this;var args=[],len=arguments.length-2;while(len-- >0)args[len]=arguments[len+2];var ref=this;var callbackArguments=ref.callbackArguments;if(V.isObject(evt)){var context=args[0];if(context===void 0)context=null;Object.entries(evt).forEach(function(ref){var eventName=ref[0];var cb=ref[1];if(typeof cb!=="function"){return}if(context||callbackArguments.length>0){cb=cb.bind.apply(cb,[context].concat(callbackArguments))}Backbone.Events.listenTo.call(this$1,object,eventName,cb)})}else if(typeof evt==="string"&&typeof args[0]==="function"){var cb=args[0];var context$1=args[1];if(context$1===void 0)context$1=null;if(context$1||callbackArguments.length>0){cb=cb.bind.apply(cb,[context$1].concat(callbackArguments))}Backbone.Events.listenTo.call(this,object,evt,cb)}};Listener.prototype.stopListening=function stopListening(){Backbone.Events.stopListening.call(this)};var index$1={views:views,View:View,Listener:Listener};var LayersNames={CELLS:"cells",BACK:"back",FRONT:"front",TOOLS:"tools",LABELS:"labels"};var PaperLayer=View.extend({tagName:"g",svgElement:true,pivotNodes:null,defaultTheme:null,options:{name:""},className:function(){return addClassNamePrefix(this.options.name+"-layer")},init:function(){this.pivotNodes={}},insertSortedNode:function(node,z){this.el.insertBefore(node,this.insertPivot(z))},insertNode:function(node){var ref=this;var el=ref.el;if(node.parentNode!==el){el.appendChild(node)}},insertPivot:function(z){var ref=this;var el=ref.el;var pivotNodes=ref.pivotNodes;z=+z;z||(z=0);var pivotNode=pivotNodes[z];if(pivotNode){return pivotNode}pivotNode=pivotNodes[z]=document.createComment("z-index:"+(z+1));var neighborZ=-Infinity;for(var currentZ in pivotNodes){currentZ=+currentZ;if(currentZ<z&&currentZ>neighborZ){neighborZ=currentZ;if(neighborZ===z-1){continue}}}if(neighborZ!==-Infinity){var neighborPivot=pivotNodes[neighborZ];el.insertBefore(pivotNode,neighborPivot.nextSibling)}else{el.insertBefore(pivotNode,el.firstChild)}return pivotNode},removePivots:function(){var ref=this;var el=ref.el;var pivotNodes=ref.pivotNodes;for(var z in pivotNodes){el.removeChild(pivotNodes[z])}this.pivotNodes={}}});function toArray$1(obj){if(!obj){return[]}if(Array.isArray(obj)){return obj}return[obj]}var HighlighterView=View.extend({tagName:"g",svgElement:true,className:"highlight",HIGHLIGHT_FLAG:1,UPDATE_PRIORITY:3,DETACHABLE:false,UPDATABLE:true,MOUNTABLE:true,cellView:null,nodeSelector:null,node:null,updateRequested:false,transformGroup:null,requestUpdate:function requestUpdate(cellView,nodeSelector){var paper=cellView.paper;this.cellView=cellView;this.nodeSelector=nodeSelector;if(paper){this.updateRequested=true;paper.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY)}},confirmUpdate:function confirmUpdate(){this.updateRequested=false;var ref=this;var cellView=ref.cellView;var nodeSelector=ref.nodeSelector;this.update(cellView,nodeSelector);this.mount();this.transform();return 0},findNode:function findNode(cellView,nodeSelector){var assign,assign$1;if(nodeSelector===void 0)nodeSelector=null;var el;if(typeof nodeSelector==="string"){assign=cellView.findBySelector(nodeSelector),el=assign[0]}else if(isPlainObject(nodeSelector)){var isLink=cellView.model.isLink();var label=nodeSelector.label;if(label===void 0)label=null;var port=nodeSelector.port;var selector=nodeSelector.selector;if(isLink&&label!==null){el=cellView.findLabelNode(label,selector)}else if(!isLink&&port){el=cellView.findPortNode(port,selector)}else{assign$1=cellView.findBySelector(selector),el=assign$1[0]}}else if(nodeSelector){el=V.toNode(nodeSelector);if(!(el instanceof SVGElement)){el=null}}return el?el:null},getNodeMatrix:function getNodeMatrix(cellView,node){var ref=this;var options=ref.options;var layer=options.layer;var rotatableNode=cellView.rotatableNode;var nodeMatrix=cellView.getNodeMatrix(node);if(rotatableNode){if(layer){if(rotatableNode.contains(node)){return nodeMatrix}return cellView.getRootRotateMatrix().inverse().multiply(nodeMatrix)}else{return cellView.getNodeRotateMatrix(node).multiply(nodeMatrix)}}return nodeMatrix},mount:function mount(){var ref=this;var MOUNTABLE=ref.MOUNTABLE;var cellView=ref.cellView;var el=ref.el;var options=ref.options;var transformGroup=ref.transformGroup;if(!MOUNTABLE||transformGroup){return}var cellViewRoot=cellView.vel;var paper=cellView.paper;var layerName=options.layer;if(layerName){var vGroup=this.transformGroup=V("g").addClass("highlight-transform").append(el);paper.getLayerView(layerName).insertSortedNode(vGroup.node,options.z)}else{if(!el.parentNode||el.nextSibling){cellViewRoot.append(el)}}},unmount:function unmount(){var ref=this;var MOUNTABLE=ref.MOUNTABLE;var transformGroup=ref.transformGroup;var vel=ref.vel;if(!MOUNTABLE){return}if(transformGroup){this.transformGroup=null;transformGroup.remove()}else{vel.remove()}},transform:function transform(){var ref=this;var transformGroup=ref.transformGroup;var cellView=ref.cellView;var updateRequested=ref.updateRequested;if(!transformGroup||cellView.model.isLink()||updateRequested){return}var translateMatrix=cellView.getRootTranslateMatrix();var rotateMatrix=cellView.getRootRotateMatrix();var transformMatrix=translateMatrix.multiply(rotateMatrix);transformGroup.attr("transform",V.matrixToTransformString(transformMatrix))},update:function update(){var ref=this;var prevNode=ref.node;var cellView=ref.cellView;var nodeSelector=ref.nodeSelector;var updateRequested=ref.updateRequested;var id=ref.id;if(updateRequested){return}var node=this.node=this.findNode(cellView,nodeSelector);if(prevNode){this.unhighlight(cellView,prevNode)}if(node){this.highlight(cellView,node);this.mount()}else{this.unmount();cellView.notify("cell:highlight:invalid",id,this)}},onRemove:function onRemove(){var ref=this;var node=ref.node;var cellView=ref.cellView;var id=ref.id;var constructor=ref.constructor;if(node){this.unhighlight(cellView,node)}this.unmount();constructor._removeRef(cellView,id)},highlight:function highlight(_cellView,_node){},unhighlight:function unhighlight(_cellView,_node){},listenToUpdateAttributes:function listenToUpdateAttributes(cellView){var attributes=result(this,"UPDATE_ATTRIBUTES");if(!Array.isArray(attributes)||attributes.length===0){return}this.listenTo(cellView.model,"change",this.onCellAttributeChange)},onCellAttributeChange:function onCellAttributeChange(){var ref=this;var cellView=ref.cellView;if(!cellView){return}var model=cellView.model;var paper=cellView.paper;var attributes=result(this,"UPDATE_ATTRIBUTES");if(!attributes.some(function(attribute){return model.hasChanged(attribute)})){return}paper.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY)}},{_views:{},highlight:function(cellView,node,opt){var id=this.uniqueId(node,opt);this.add(cellView,node,id,opt)},unhighlight:function(cellView,node,opt){var id=this.uniqueId(node,opt);this.remove(cellView,id)},get:function get(cellView,id){if(id===void 0)id=null;var cid=cellView.cid;var ref$2=this;var _views=ref$2._views;var refs=_views[cid];if(id===null){var views=[];if(!refs){return views}for(var hid in refs){var ref=refs[hid];if(ref instanceof this){views.push(ref)}}return views}else{if(!refs){return null}if(id in refs){var ref$1=refs[id];if(ref$1 instanceof this){return ref$1}}return null}},add:function add(cellView,nodeSelector,id,opt){if(opt===void 0)opt={};if(!id){throw new Error("dia.HighlighterView: An ID required.")}var previousView=HighlighterView.get(cellView,id);if(previousView){previousView.remove()}var view=new this(opt);view.id=id;this._addRef(cellView,id,view);view.requestUpdate(cellView,nodeSelector);view.listenToUpdateAttributes(cellView);return view},_addRef:function _addRef(cellView,id,view){var cid=cellView.cid;var ref=this;var _views=ref._views;var refs=_views[cid];if(!refs){refs=_views[cid]={}}refs[id]=view},_removeRef:function _removeRef(cellView,id){var cid=cellView.cid;var ref=this;var _views=ref._views;var refs=_views[cid];if(!refs){return}if(id){delete refs[id]}for(var _ in refs){return}delete _views[cid]},remove:function remove(cellView,id){if(id===void 0)id=null;toArray$1(this.get(cellView,id)).forEach(function(view){view.remove()})},removeAll:function removeAll(paper,id){if(id===void 0)id=null;var ref=this;var _views=ref._views;for(var cid in _views){for(var hid in _views[cid]){var view=_views[cid][hid];if(view.cellView.paper===paper&&view instanceof this&&(id===null||hid===id)){view.remove()}}}},update:function update(cellView,id,dirty){if(id===void 0)id=null;if(dirty===void 0)dirty=false;toArray$1(this.get(cellView,id)).forEach(function(view){if(dirty||view.UPDATABLE){view.update()}})},transform:function transform(cellView,id){if(id===void 0)id=null;toArray$1(this.get(cellView,id)).forEach(function(view){if(view.UPDATABLE){view.transform()}})},uniqueId:function uniqueId(node,opt){if(opt===void 0)opt="";return V.ensureId(node)+JSON.stringify(opt)}});var HighlightingTypes={DEFAULT:"default",EMBEDDING:"embedding",CONNECTING:"connecting",MAGNET_AVAILABILITY:"magnetAvailability",ELEMENT_AVAILABILITY:"elementAvailability"};var CellView=View.extend({tagName:"g",svgElement:true,selector:"root",metrics:null,className:function(){var classNames=["cell"];var type=this.model.get("type");if(type){type.toLowerCase().split(".").forEach(function(value,index,list){classNames.push("type-"+list.slice(0,index+1).join("-"))})}return classNames.join(" ")},_presentationAttributes:null,_flags:null,setFlags:function(){var flags={};var attributes={};var shift=0;var i,n,label;var presentationAttributes=result(this,"presentationAttributes");for(var attribute in presentationAttributes){if(!presentationAttributes.hasOwnProperty(attribute)){continue}var labels=presentationAttributes[attribute];if(!Array.isArray(labels)){labels=[labels]}for(i=0,n=labels.length;i<n;i++){label=labels[i];var flag=flags[label];if(!flag){flag=flags[label]=1<<shift++}attributes[attribute]|=flag}}var initFlag=result(this,"initFlag");if(!Array.isArray(initFlag)){initFlag=[initFlag]}for(i=0,n=initFlag.length;i<n;i++){label=initFlag[i];if(!flags[label]){flags[label]=1<<shift++}}if(shift>25){throw new Error("dia.CellView: Maximum number of flags exceeded.")}this._flags=flags;this._presentationAttributes=attributes},hasFlag:function(flag,label){return flag&this.getFlag(label)},removeFlag:function(flag,label){return flag^flag&this.getFlag(label)},getFlag:function(label){var flags=this._flags;if(!flags){return 0}var flag=0;if(Array.isArray(label)){for(var i=0,n=label.length;i<n;i++){flag|=flags[label[i]]}}else{flag|=flags[label]}return flag},attributes:function(){var cell=this.model;return{"model-id":cell.id,"data-type":cell.attributes.type}},constructor:function(options){options.id=options.id||guid(this);View.call(this,options)},initialize:function(){this.setFlags();View.prototype.initialize.apply(this,arguments);this.cleanNodesCache();this.$el.data("view",this);this.startListening()},onMount:function onMount(){},startListening:function(){this.listenTo(this.model,"change",this.onAttributesChange)},onAttributesChange:function(model,opt){var flag=model.getChangeFlag(this._presentationAttributes);if(opt.updateHandled||!flag){return}if(opt.dirty&&this.hasFlag(flag,"UPDATE")){flag|=this.getFlag("RENDER")}if(opt.tool){opt.async=false}this.requestUpdate(flag,opt)},requestUpdate:function(flags,opt){var ref=this;var paper=ref.paper;if(paper&&flags>0){paper.requestViewUpdate(this,flags,this.UPDATE_PRIORITY,opt)}},parseDOMJSON:function(markup,root){var doc=parseDOMJSON(markup);var selectors=doc.selectors;var groups=doc.groupSelectors;for(var group in groups){if(selectors[group]){throw new Error("dia.CellView: ambiguous group selector")}selectors[group]=groups[group]}if(root){var rootSelector=this.selector;if(selectors[rootSelector]){throw new Error("dia.CellView: ambiguous root selector.")}selectors[rootSelector]=root}return{fragment:doc.fragment,selectors:selectors}},can:function(feature){var interactive=isFunction(this.options.interactive)?this.options.interactive(this):this.options.interactive;return isObject$1(interactive)&&interactive[feature]!==false||isBoolean(interactive)&&interactive!==false},findBySelector:function(selector,root,selectors){root||(root=this.el);selectors||(selectors=this.selectors);if(!selector||selector==="."){return[root]}if(selectors){var nodes=selectors[selector];if(nodes){if(Array.isArray(nodes)){return nodes}return[nodes]}}if(config.useCSSSelectors){return $(root).find(selector).toArray()}return[]},notify:function(eventName){if(this.paper){var args=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[eventName].concat(args));this.paper.trigger.apply(this.paper,[eventName,this].concat(args))}},getBBox:function(opt){var bbox;if(opt&&opt.useModelGeometry){var model=this.model;bbox=model.getBBox().bbox(model.angle())}else{bbox=this.getNodeBBox(this.el)}return this.paper.localToPaperRect(bbox)},getNodeBBox:function(magnet){var rect=this.getNodeBoundingRect(magnet);var transformMatrix=this.getRootTranslateMatrix().multiply(this.getNodeRotateMatrix(magnet));var magnetMatrix=this.getNodeMatrix(magnet);return V.transformRect(rect,transformMatrix.multiply(magnetMatrix))},getNodeRotateMatrix:function getNodeRotateMatrix(node){if(!this.rotatableNode||this.rotatableNode.contains(node)){return this.getRootRotateMatrix()}return V.createSVGMatrix()},getNodeUnrotatedBBox:function(magnet){var rect=this.getNodeBoundingRect(magnet);var magnetMatrix=this.getNodeMatrix(magnet);var translateMatrix=this.getRootTranslateMatrix();return V.transformRect(rect,translateMatrix.multiply(magnetMatrix))},getRootTranslateMatrix:function(){var model=this.model;var position=model.position();var mt=V.createSVGMatrix().translate(position.x,position.y);return mt},getRootRotateMatrix:function(){var mr=V.createSVGMatrix();var model=this.model;var angle=model.angle();if(angle){var bbox=model.getBBox();var cx=bbox.width/2;var cy=bbox.height/2;mr=mr.translate(cx,cy).rotate(angle).translate(-cx,-cy)}return mr},_notifyHighlight:function(eventName,el,opt){var assign,assign$1;if(opt===void 0)opt={};var ref=this;var rootNode=ref.el;var node;if(typeof el==="string"){assign=this.findBySelector(el),node=assign[0],node=node===void 0?rootNode:node}else{assign$1=this.$(el),node=assign$1[0],node=node===void 0?rootNode:node}opt.partial=node!==rootNode;if(opt.type===undefined){var type;switch(true){case opt.embedding:type=HighlightingTypes.EMBEDDING;break;case opt.connecting:type=HighlightingTypes.CONNECTING;break;case opt.magnetAvailability:type=HighlightingTypes.MAGNET_AVAILABILITY;break;case opt.elementAvailability:type=HighlightingTypes.ELEMENT_AVAILABILITY;break;default:type=HighlightingTypes.DEFAULT;break}opt.type=type}this.notify(eventName,node,opt);return this},highlight:function(el,opt){return this._notifyHighlight("cell:highlight",el,opt)},unhighlight:function(el,opt){if(opt===void 0)opt={};return this._notifyHighlight("cell:unhighlight",el,opt)},findMagnet:function(el){var root=this.el;var magnet=this.$(el)[0];if(!magnet){magnet=root}do{var magnetAttribute=magnet.getAttribute("magnet");var isMagnetRoot=magnet===root;if((magnetAttribute||isMagnetRoot)&&magnetAttribute!=="false"){return magnet}if(isMagnetRoot){return undefined}magnet=magnet.parentNode}while(magnet);return undefined},findProxyNode:function(el,type){el||(el=this.el);var nodeSelector=el.getAttribute(type+"-selector");if(nodeSelector){var ref=this.findBySelector(nodeSelector);var proxyNode=ref[0];if(proxyNode){return proxyNode}}return el},getSelector:function(el,prevSelector){var selector;if(el===this.el){if(typeof prevSelector==="string"){selector="> "+prevSelector}return selector}if(el){var nthChild=V(el).index()+1;selector=el.tagName+":nth-child("+nthChild+")";if(prevSelector){selector+=" > "+prevSelector}selector=this.getSelector(el.parentNode,selector)}return selector},addLinkFromMagnet:function(magnet,x,y){var paper=this.paper;var graph=paper.model;var link=paper.getDefaultLink(this,magnet);link.set({source:this.getLinkEnd(magnet,x,y,link,"source"),target:{x:x,y:y}}).addTo(graph,{async:false,ui:true});return link.findView(paper)},getLinkEnd:function(magnet){var ref;var args=[],len=arguments.length-1;while(len-- >0)args[len]=arguments[len+1];var model=this.model;var id=model.id;var port=this.findAttribute("port",magnet);var selector=magnet.getAttribute("joint-selector");var end={id:id};if(selector!=null){end.magnet=selector}if(port!=null){end.port=port;if(!model.hasPort(port)&&!selector){end.selector=this.getSelector(magnet)}}else if(selector==null&&this.el!==magnet){end.selector=this.getSelector(magnet)}return(ref=this).customizeLinkEnd.apply(ref,[end,magnet].concat(args))},customizeLinkEnd:function(end,magnet,x,y,link,endType){var ref=this;var paper=ref.paper;var ref$1=paper.options;var connectionStrategy=ref$1.connectionStrategy;if(typeof connectionStrategy==="function"){var strategy=connectionStrategy.call(paper,end,this,magnet,new Point(x,y),link,endType,paper);if(strategy){return strategy}}return end},getMagnetFromLinkEnd:function(end){var root=this.el;var port=end.port;var selector=end.magnet;var model=this.model;var magnet;if(port!=null&&model.isElement()&&model.hasPort(port)){magnet=this.findPortNode(port,selector)||root}else{if(!selector){selector=end.selector}if(!selector&&port!=null){selector='[port="'+port+'"]'}magnet=this.findBySelector(selector,root,this.selectors)[0]}return this.findProxyNode(magnet,"magnet")},dragLinkStart:function(evt,magnet,x,y){this.model.startBatch("add-link");var linkView=this.addLinkFromMagnet(magnet,x,y);linkView.notifyPointerdown(evt,x,y);linkView.eventData(evt,linkView.startArrowheadMove("target",{whenNotAllowed:"remove"}));this.eventData(evt,{linkView:linkView})},dragLink:function(evt,x,y){var data=this.eventData(evt);var linkView=data.linkView;if(linkView){linkView.pointermove(evt,x,y)}else{var paper=this.paper;var magnetThreshold=paper.options.magnetThreshold;var currentTarget=this.getEventTarget(evt);var targetMagnet=data.targetMagnet;if(magnetThreshold==="onleave"){if(targetMagnet===currentTarget||V(targetMagnet).contains(currentTarget)){return}}else{if(paper.eventData(evt).mousemoved<=magnetThreshold){return}}this.dragLinkStart(evt,targetMagnet,x,y)}},dragLinkEnd:function(evt,x,y){var data=this.eventData(evt);var linkView=data.linkView;if(!linkView){return}linkView.pointerup(evt,x,y);this.model.stopBatch("add-link")},getAttributeDefinition:function(attrName){return this.model.constructor.getAttributeDefinition(attrName)},setNodeAttributes:function(node,attrs){if(!isEmpty(attrs)){if(node instanceof SVGElement){V(node).attr(attrs)}else{$(node).attr(attrs)}}},processNodeAttributes:function(node,attrs){var attrName,attrVal,def,i,n;var normalAttrs,setAttrs,positionAttrs,offsetAttrs;var relatives=[];for(attrName in attrs){if(!attrs.hasOwnProperty(attrName)){continue}attrVal=attrs[attrName];def=this.getAttributeDefinition(attrName);if(def&&(!isFunction(def.qualify)||def.qualify.call(this,attrVal,node,attrs,this))){if(isString(def.set)){normalAttrs||(normalAttrs={});normalAttrs[def.set]=attrVal}if(attrVal!==null){relatives.push(attrName,def)}}else{normalAttrs||(normalAttrs={});normalAttrs[toKebabCase(attrName)]=attrVal}}for(i=0,n=relatives.length;i<n;i+=2){attrName=relatives[i];def=relatives[i+1];attrVal=attrs[attrName];if(isFunction(def.set)){setAttrs||(setAttrs={});setAttrs[attrName]=attrVal}if(isFunction(def.position)){positionAttrs||(positionAttrs={});positionAttrs[attrName]=attrVal}if(isFunction(def.offset)){offsetAttrs||(offsetAttrs={});offsetAttrs[attrName]=attrVal}}return{raw:attrs,normal:normalAttrs,set:setAttrs,position:positionAttrs,offset:offsetAttrs}},updateRelativeAttributes:function(node,attrs,refBBox,opt){opt||(opt={});var attrName,attrVal,def;var rawAttrs=attrs.raw||{};var nodeAttrs=attrs.normal||{};var setAttrs=attrs.set;var positionAttrs=attrs.position;var offsetAttrs=attrs.offset;for(attrName in setAttrs){attrVal=setAttrs[attrName];def=this.getAttributeDefinition(attrName);var setResult=def.set.call(this,attrVal,refBBox.clone(),node,rawAttrs,this);if(isObject$1(setResult)){assign(nodeAttrs,setResult)}else if(setResult!==undefined){nodeAttrs[attrName]=setResult}}if(node instanceof HTMLElement){this.setNodeAttributes(node,nodeAttrs);return}var nodeTransform=nodeAttrs.transform;var nodeMatrix=V.transformStringToMatrix(nodeTransform);var nodePosition=Point(nodeMatrix.e,nodeMatrix.f);if(nodeTransform){nodeAttrs=omit(nodeAttrs,"transform");nodeMatrix.e=nodeMatrix.f=0}var sx,sy,translation;if(positionAttrs||offsetAttrs){var nodeScale=this.getNodeScale(node,opt.scalableNode);sx=nodeScale.sx;sy=nodeScale.sy}var positioned=false;for(attrName in positionAttrs){attrVal=positionAttrs[attrName];def=this.getAttributeDefinition(attrName);translation=def.position.call(this,attrVal,refBBox.clone(),node,rawAttrs,this);if(translation){nodePosition.offset(Point(translation).scale(sx,sy));positioned||(positioned=true)}}this.setNodeAttributes(node,nodeAttrs);var offseted=false;if(offsetAttrs){var nodeBoundingRect=this.getNodeBoundingRect(node);if(nodeBoundingRect.width>0&&nodeBoundingRect.height>0){var nodeBBox=V.transformRect(nodeBoundingRect,nodeMatrix).scale(1/sx,1/sy);for(attrName in offsetAttrs){attrVal=offsetAttrs[attrName];def=this.getAttributeDefinition(attrName);translation=def.offset.call(this,attrVal,nodeBBox,node,rawAttrs,this);if(translation){nodePosition.offset(Point(translation).scale(sx,sy));offseted||(offseted=true)}}}}if(nodeTransform!==undefined||positioned||offseted){nodePosition.round(1);nodeMatrix.e=nodePosition.x;nodeMatrix.f=nodePosition.y;node.setAttribute("transform",V.matrixToTransformString(nodeMatrix))}},getNodeScale:function(node,scalableNode){var sx,sy;if(scalableNode&&scalableNode.contains(node)){var scale=scalableNode.scale();sx=1/scale.sx;sy=1/scale.sy}else{sx=1;sy=1}return{sx:sx,sy:sy}},cleanNodesCache:function(){this.metrics={}},nodeCache:function(magnet){var metrics=this.metrics;if(!metrics){return{}}var id=V.ensureId(magnet);var value=metrics[id];if(!value){value=metrics[id]={}}return value},getNodeData:function(magnet){var metrics=this.nodeCache(magnet);if(!metrics.data){metrics.data={}}return metrics.data},getNodeBoundingRect:function(magnet){var metrics=this.nodeCache(magnet);if(metrics.boundingRect===undefined){metrics.boundingRect=V(magnet).getBBox()}return new Rect(metrics.boundingRect)},getNodeMatrix:function(magnet){var metrics=this.nodeCache(magnet);if(metrics.magnetMatrix===undefined){var ref=this;var rotatableNode=ref.rotatableNode;var el=ref.el;var target;if(rotatableNode&&rotatableNode.contains(magnet)){target=rotatableNode}else{target=el}metrics.magnetMatrix=V(magnet).getTransformToElement(target)}return V.createSVGMatrix(metrics.magnetMatrix)},getNodeShape:function(magnet){var metrics=this.nodeCache(magnet);if(metrics.geometryShape===undefined){metrics.geometryShape=V(magnet).toGeometryShape()}return metrics.geometryShape.clone()},isNodeConnection:function(node){return this.model.isLink()&&(!node||node===this.el)},findNodesAttributes:function(attrs,root,selectorCache,selectors){var i,n,nodeAttrs,nodeId;var nodesAttrs={};var mergeIds=[];for(var selector in attrs){if(!attrs.hasOwnProperty(selector)){continue}nodeAttrs=attrs[selector];if(!isPlainObject(nodeAttrs)){continue}var selected=selectorCache[selector]=this.findBySelector(selector,root,selectors);for(i=0,n=selected.length;i<n;i++){var node=selected[i];nodeId=V.ensureId(node);var unique=selectors&&selectors[selector]===node;var prevNodeAttrs=nodesAttrs[nodeId];if(prevNodeAttrs){if(!prevNodeAttrs.array){mergeIds.push(nodeId);prevNodeAttrs.array=true;prevNodeAttrs.attributes=[prevNodeAttrs.attributes];prevNodeAttrs.selectedLength=[prevNodeAttrs.selectedLength]}var attributes=prevNodeAttrs.attributes;var selectedLength=prevNodeAttrs.selectedLength;if(unique){attributes.unshift(nodeAttrs);selectedLength.unshift(-1)}else{var sortIndex=sortedIndex(selectedLength,n);attributes.splice(sortIndex,0,nodeAttrs);selectedLength.splice(sortIndex,0,n)}}else{nodesAttrs[nodeId]={attributes:nodeAttrs,selectedLength:unique?-1:n,node:node,array:false}}}}for(i=0,n=mergeIds.length;i<n;i++){nodeId=mergeIds[i];nodeAttrs=nodesAttrs[nodeId];nodeAttrs.attributes=merge.apply(void 0,[{}].concat(nodeAttrs.attributes.reverse()))}return nodesAttrs},getEventTarget:function(evt,opt){if(opt===void 0)opt={};var target=evt.target;var type=evt.type;var clientX=evt.clientX;if(clientX===void 0)clientX=0;var clientY=evt.clientY;if(clientY===void 0)clientY=0;if(opt.fromPoint||type==="touchmove"||type==="touchend"){return document.elementFromPoint(clientX,clientY)}return target},updateDOMSubtreeAttributes:function(rootNode,attrs,opt){opt||(opt={});opt.rootBBox||(opt.rootBBox=Rect());opt.selectors||(opt.selectors=this.selectors);var selectorCache={};var bboxCache={};var relativeItems=[];var relativeRefItems=[];var item,node,nodeAttrs,nodeData,processedAttrs;var roAttrs=opt.roAttributes;var nodesAttrs=this.findNodesAttributes(roAttrs||attrs,rootNode,selectorCache,opt.selectors);var nodesAllAttrs=roAttrs?this.findNodesAttributes(attrs,rootNode,selectorCache,opt.selectors):nodesAttrs;for(var nodeId in nodesAttrs){nodeData=nodesAttrs[nodeId];nodeAttrs=nodeData.attributes;node=nodeData.node;processedAttrs=this.processNodeAttributes(node,nodeAttrs);if(!processedAttrs.set&&!processedAttrs.position&&!processedAttrs.offset){this.setNodeAttributes(node,processedAttrs.normal)}else{var nodeAllAttrs=nodesAllAttrs[nodeId]&&nodesAllAttrs[nodeId].attributes;var refSelector=nodeAllAttrs&&nodeAttrs.ref===undefined?nodeAllAttrs.ref:nodeAttrs.ref;var refNode;if(refSelector){refNode=(selectorCache[refSelector]||this.findBySelector(refSelector,rootNode,opt.selectors))[0];if(!refNode){throw new Error('dia.CellView: "'+refSelector+'" reference does not exist.')}}else{refNode=null}item={node:node,refNode:refNode,processedAttributes:processedAttrs,allAttributes:nodeAllAttrs};if(refNode){var itemIndex=relativeRefItems.findIndex(function(item){return item.refNode===node});if(itemIndex>-1){relativeRefItems.splice(itemIndex,0,item)}else{relativeRefItems.push(item)}}else{relativeItems.push(item)}}}relativeItems.push.apply(relativeItems,relativeRefItems);var rotatableMatrix;for(var i=0,n=relativeItems.length;i<n;i++){item=relativeItems[i];node=item.node;refNode=item.refNode;var vRotatable=V(opt.rotatableNode);var refNodeId=refNode?V.ensureId(refNode):"";var isRefNodeRotatable=!!vRotatable&&!!refNode&&vRotatable.contains(refNode);var unrotatedRefBBox=bboxCache[refNodeId];if(!unrotatedRefBBox){var transformationTarget=isRefNodeRotatable?vRotatable:rootNode;unrotatedRefBBox=bboxCache[refNodeId]=refNode?V(refNode).getBBox({target:transformationTarget}):opt.rootBBox}if(roAttrs){processedAttrs=this.processNodeAttributes(node,item.allAttributes);this.mergeProcessedAttributes(processedAttrs,item.processedAttributes)}else{processedAttrs=item.processedAttributes}var refBBox=unrotatedRefBBox;if(isRefNodeRotatable&&!vRotatable.contains(node)){if(!rotatableMatrix){rotatableMatrix=V.transformStringToMatrix(vRotatable.attr("transform"))}refBBox=V.transformRect(unrotatedRefBBox,rotatableMatrix)}this.updateRelativeAttributes(node,processedAttrs,refBBox,opt)}},mergeProcessedAttributes:function(processedAttrs,roProcessedAttrs){processedAttrs.set||(processedAttrs.set={});processedAttrs.position||(processedAttrs.position={});processedAttrs.offset||(processedAttrs.offset={});assign(processedAttrs.set,roProcessedAttrs.set);assign(processedAttrs.position,roProcessedAttrs.position);assign(processedAttrs.offset,roProcessedAttrs.offset);var transform=processedAttrs.normal&&processedAttrs.normal.transform;if(transform!==undefined&&roProcessedAttrs.normal){roProcessedAttrs.normal.transform=transform}processedAttrs.normal=roProcessedAttrs.normal},onRemove:function(){this.removeTools();this.removeHighlighters()},_toolsView:null,hasTools:function(name){var toolsView=this._toolsView;if(!toolsView){return false}if(!name){return true}return toolsView.getName()===name},addTools:function(toolsView){this.removeTools();if(toolsView){this._toolsView=toolsView;toolsView.configure({relatedView:this});toolsView.listenTo(this.paper,"tools:event",this.onToolEvent.bind(this))}return this},updateTools:function(opt){var toolsView=this._toolsView;if(toolsView){toolsView.update(opt)}return this},removeTools:function(){var toolsView=this._toolsView;if(toolsView){toolsView.remove();this._toolsView=null}return this},hideTools:function(){var toolsView=this._toolsView;if(toolsView){toolsView.hide()}return this},showTools:function(){var toolsView=this._toolsView;if(toolsView){toolsView.show()}return this},onToolEvent:function(event){switch(event){case"remove":this.removeTools();break;case"hide":this.hideTools();break;case"show":this.showTools();break}},removeHighlighters:function(){HighlighterView.remove(this)},updateHighlighters:function(dirty){if(dirty===void 0)dirty=false;HighlighterView.update(this,null,dirty)},transformHighlighters:function(){HighlighterView.transform(this)},pointerdblclick:function(evt,x,y){this.notify("cell:pointerdblclick",evt,x,y)},pointerclick:function(evt,x,y){this.notify("cell:pointerclick",evt,x,y)},contextmenu:function(evt,x,y){this.notify("cell:contextmenu",evt,x,y)},pointerdown:function(evt,x,y){var ref=this;var model=ref.model;var graph=model.graph;if(graph){model.startBatch("pointer");this.eventData(evt,{graph:graph})}this.notify("cell:pointerdown",evt,x,y)},pointermove:function(evt,x,y){this.notify("cell:pointermove",evt,x,y)},pointerup:function(evt,x,y){var ref=this.eventData(evt);var graph=ref.graph;this.notify("cell:pointerup",evt,x,y);if(graph){graph.stopBatch("pointer",{cell:this.model})}},mouseover:function(evt){this.notify("cell:mouseover",evt)},mouseout:function(evt){this.notify("cell:mouseout",evt)},mouseenter:function(evt){this.notify("cell:mouseenter",evt)},mouseleave:function(evt){this.notify("cell:mouseleave",evt)},mousewheel:function(evt,x,y,delta){this.notify("cell:mousewheel",evt,x,y,delta)},onevent:function(evt,eventName,x,y){this.notify(eventName,evt,x,y)},onmagnet:function(){},magnetpointerdblclick:function(){},magnetcontextmenu:function(){},checkMouseleave:function checkMouseleave(evt){var ref=this;var paper=ref.paper;if(paper.isAsync()){paper.dumpView(this)}var target=this.getEventTarget(evt,{fromPoint:true});var view=paper.findView(target);if(view===this){return}this.mouseleave(evt);if(!view){return}view.mouseenter(evt)},setInteractivity:function(value){this.options.interactive=value}},{Highlighting:HighlightingTypes,addPresentationAttributes:function(presentationAttributes){return merge({},result(this.prototype,"presentationAttributes"),presentationAttributes,function(a,b){if(!a||!b){return}if(typeof a==="string"){a=[a]}if(typeof b==="string"){b=[b]}if(Array.isArray(a)&&Array.isArray(b)){return uniq(a.concat(b))}})}});var Flags={UPDATE:"UPDATE",TRANSLATE:"TRANSLATE",TOOLS:"TOOLS",RESIZE:"RESIZE",PORTS:"PORTS",ROTATE:"ROTATE",RENDER:"RENDER"};var ElementView=CellView.extend({_removePorts:function(){},_renderPorts:function(){},className:function(){var classNames=CellView.prototype.className.apply(this).split(" ");classNames.push("element");return classNames.join(" ")},initialize:function(){CellView.prototype.initialize.apply(this,arguments);this._initializePorts()},presentationAttributes:{attrs:[Flags.UPDATE],position:[Flags.TRANSLATE,Flags.TOOLS],size:[Flags.RESIZE,Flags.PORTS,Flags.TOOLS],angle:[Flags.ROTATE,Flags.TOOLS],markup:[Flags.RENDER],ports:[Flags.PORTS]},initFlag:[Flags.RENDER],UPDATE_PRIORITY:0,confirmUpdate:function(flag,opt){var useCSSSelectors=config.useCSSSelectors;if(this.hasFlag(flag,Flags.PORTS)){this._removePorts();this._cleanPortsCache()}var transformHighlighters=false;if(this.hasFlag(flag,Flags.RENDER)){this.render();this.updateTools(opt);this.updateHighlighters(true);transformHighlighters=true;flag=this.removeFlag(flag,[Flags.RENDER,Flags.UPDATE,Flags.RESIZE,Flags.TRANSLATE,Flags.ROTATE,Flags.PORTS,Flags.TOOLS])}else{var updateHighlighters=false;if(this.hasFlag(flag,Flags.RESIZE)){this.resize(opt);updateHighlighters=true;flag=this.removeFlag(flag,[Flags.RESIZE,Flags.UPDATE])}if(this.hasFlag(flag,Flags.UPDATE)){this.update(this.model,null,opt);flag=this.removeFlag(flag,Flags.UPDATE);updateHighlighters=true;if(useCSSSelectors){flag=this.removeFlag(flag,Flags.PORTS)}}if(this.hasFlag(flag,Flags.TRANSLATE)){this.translate();flag=this.removeFlag(flag,Flags.TRANSLATE);transformHighlighters=true}if(this.hasFlag(flag,Flags.ROTATE)){this.rotate();flag=this.removeFlag(flag,Flags.ROTATE);transformHighlighters=true}if(this.hasFlag(flag,Flags.PORTS)){this._renderPorts();updateHighlighters=true;flag=this.removeFlag(flag,Flags.PORTS)}if(updateHighlighters){this.updateHighlighters(false)}}if(transformHighlighters){this.transformHighlighters()}if(this.hasFlag(flag,Flags.TOOLS)){this.updateTools(opt);flag=this.removeFlag(flag,Flags.TOOLS)}return flag},_initializePorts:function(){},update:function(_,renderingOnlyAttrs){this.cleanNodesCache();var useCSSSelectors=config.useCSSSelectors;if(useCSSSelectors){this._removePorts()}var model=this.model;var modelAttrs=model.attr();this.updateDOMSubtreeAttributes(this.el,modelAttrs,{rootBBox:new Rect(model.size()),selectors:this.selectors,scalableNode:this.scalableNode,rotatableNode:this.rotatableNode,roAttributes:renderingOnlyAttrs===modelAttrs?null:renderingOnlyAttrs});if(useCSSSelectors){this._renderPorts()}},rotatableSelector:"rotatable",scalableSelector:"scalable",scalableNode:null,rotatableNode:null,renderMarkup:function(){var element=this.model;var markup=element.get("markup")||element.markup;if(!markup){throw new Error("dia.ElementView: markup required")}if(Array.isArray(markup)){return this.renderJSONMarkup(markup)}if(typeof markup==="string"){return this.renderStringMarkup(markup)}throw new Error("dia.ElementView: invalid markup")},renderJSONMarkup:function(markup){var doc=this.parseDOMJSON(markup,this.el);var selectors=this.selectors=doc.selectors;this.rotatableNode=V(selectors[this.rotatableSelector])||null;this.scalableNode=V(selectors[this.scalableSelector])||null;this.vel.append(doc.fragment)},renderStringMarkup:function(markup){var vel=this.vel;vel.append(V(markup));this.rotatableNode=vel.findOne(".rotatable");this.scalableNode=vel.findOne(".scalable");var selectors=this.selectors={};selectors[this.selector]=this.el},render:function(){this.vel.empty();this.renderMarkup();if(this.scalableNode){this.update()}this.resize();if(this.rotatableNode){this.rotate();this.translate()}else{this.updateTransformation()}if(!config.useCSSSelectors){this._renderPorts()}return this},resize:function(opt){if(this.scalableNode){return this.sgResize(opt)}if(this.model.attributes.angle){this.rotate()}this.update()},translate:function(){if(this.rotatableNode){return this.rgTranslate()}this.updateTransformation()},rotate:function(){if(this.rotatableNode){this.rgRotate();this.update();return}this.updateTransformation()},updateTransformation:function(){var transformation=this.getTranslateString();var rotateString=this.getRotateString();if(rotateString){transformation+=" "+rotateString}this.vel.attr("transform",transformation)},getTranslateString:function(){var position=this.model.attributes.position;return"translate("+position.x+","+position.y+")"},getRotateString:function(){var attributes=this.model.attributes;var angle=attributes.angle;if(!angle){return null}var size=attributes.size;return"rotate("+angle+","+size.width/2+","+size.height/2+")"},rgRotate:function(){this.rotatableNode.attr("transform",this.getRotateString())},rgTranslate:function(){this.vel.attr("transform",this.getTranslateString())},sgResize:function(opt){var model=this.model;var angle=model.angle();var size=model.size();var scalable=this.scalableNode;var recursive=false;if(scalable.node.getElementsByTagName("path").length>0){recursive=true}var scalableBBox=scalable.getBBox({recursive:recursive});var sx=size.width/(scalableBBox.width||1);var sy=size.height/(scalableBBox.height||1);scalable.attr("transform","scale("+sx+","+sy+")");var rotatable=this.rotatableNode;var rotation=rotatable&&rotatable.attr("transform");if(rotation){rotatable.attr("transform",rotation+" rotate("+-angle+","+size.width/2+","+size.height/2+")");var rotatableBBox=scalable.getBBox({target:this.paper.cells});model.set("position",{x:rotatableBBox.x,y:rotatableBBox.y},assign({updateHandled:true},opt));this.translate();this.rotate()}this.update()},prepareEmbedding:function(data){if(data===void 0)data={};var element=data.model||this.model;var paper=data.paper||this.paper;var graph=paper.model;var initialZIndices=data.initialZIndices={};var embeddedCells=element.getEmbeddedCells({deep:true});var connectedLinks=graph.getConnectedLinks(element,{deep:true,includeEnclosed:true});[element].concat(embeddedCells,connectedLinks).forEach(function(cell){return initialZIndices[cell.id]=cell.attributes.z});element.startBatch("to-front");element.toFront({deep:true,ui:true});var maxZ=graph.getElements().reduce(function(max,cell){return Math.max(max,cell.attributes.z||0)},0);connectedLinks.forEach(function(link){if(link.attributes.z<=maxZ){link.set("z",maxZ+1,{ui:true})}});element.stopBatch("to-front");var parentId=element.parent();if(parentId){var parent=graph.getCell(parentId);parent.unembed(element,{ui:true});data.initialParentId=parentId}else{data.initialParentId=null}},processEmbedding:function(data,evt,x,y){if(data===void 0)data={};var model=data.model||this.model;var paper=data.paper||this.paper;var graph=paper.model;var ref=paper.options;var findParentBy=ref.findParentBy;var frontParentOnly=ref.frontParentOnly;var validateEmbedding=ref.validateEmbedding;var candidates;if(isFunction(findParentBy)){candidates=toArray(findParentBy.call(graph,this,evt,x,y))}else if(findParentBy==="pointer"){candidates=toArray(graph.findModelsFromPoint({x:x,y:y}))}else{candidates=graph.findModelsUnderElement(model,{searchBy:findParentBy})}candidates=candidates.filter(function(el){return el instanceof Cell&&model.id!==el.id&&!el.isEmbeddedIn(model)});if(frontParentOnly){candidates=candidates.slice(-1)}var newCandidateView=null;var prevCandidateView=data.candidateEmbedView;for(var i=candidates.length-1;i>=0;i--){var candidate=candidates[i];if(prevCandidateView&&prevCandidateView.model.id==candidate.id){newCandidateView=prevCandidateView;break}else{var view=candidate.findView(paper);if(!isFunction(validateEmbedding)||validateEmbedding.call(paper,this,view)){newCandidateView=view;break}}}if(newCandidateView&&newCandidateView!=prevCandidateView){this.clearEmbedding(data);data.candidateEmbedView=newCandidateView.highlight(newCandidateView.findProxyNode(null,"container"),{embedding:true})}if(!newCandidateView&&prevCandidateView){this.clearEmbedding(data)}},clearEmbedding:function(data){data||(data={});var candidateView=data.candidateEmbedView;if(candidateView){candidateView.unhighlight(candidateView.findProxyNode(null,"container"),{embedding:true});data.candidateEmbedView=null}},finalizeEmbedding:function(data){if(data===void 0)data={};var candidateView=data.candidateEmbedView;var element=data.model||this.model;var paper=data.paper||this.paper;if(candidateView){candidateView.model.embed(element,{ui:true});candidateView.unhighlight(candidateView.findProxyNode(null,"container"),{embedding:true});data.candidateEmbedView=null}else{var ref=paper.options;var validateUnembedding=ref.validateUnembedding;var initialParentId=data.initialParentId;if(initialParentId&&typeof validateUnembedding==="function"&&!validateUnembedding.call(paper,this)){this._disallowUnembed(data);return}}paper.model.getConnectedLinks(element,{deep:true}).forEach(function(link){link.reparent({ui:true})})},_disallowUnembed:function(data){var model=data.model;var whenNotAllowed=data.whenNotAllowed;if(whenNotAllowed===void 0)whenNotAllowed="revert";var element=model||this.model;var paper=data.paper||this.paper;var graph=paper.model;switch(whenNotAllowed){case"remove":{element.remove({ui:true});break}case"revert":{var initialParentId=data.initialParentId;var initialPosition=data.initialPosition;var initialZIndices=data.initialZIndices;if(initialPosition){var x=initialPosition.x;var y=initialPosition.y;element.position(x,y,{deep:true,ui:true})}if(initialZIndices){Object.keys(initialZIndices).forEach(function(id){var cell=graph.getCell(id);if(cell){cell.set("z",initialZIndices[id],{ui:true})}})}var parent=graph.getCell(initialParentId);if(parent){parent.embed(element,{ui:true})}break}}},getDelegatedView:function(){var view=this;var model=view.model;var paper=view.paper;while(view){if(model.isLink()){break}if(!model.isEmbedded()||view.can("stopDelegation")){return view}model=model.getParentCell();view=paper.findViewByModel(model)}return null},findProxyNode:function(el,type){el||(el=this.el);var nodeSelector=el.getAttribute(type+"-selector");if(nodeSelector){var port=this.findAttribute("port",el);if(port){var proxyPortNode=this.findPortNode(port,nodeSelector);if(proxyPortNode){return proxyPortNode}}else{var ref=this.findBySelector(nodeSelector);var proxyNode=ref[0];if(proxyNode){return proxyNode}}}return el},notifyPointerdown:function notifyPointerdown(evt,x,y){CellView.prototype.pointerdown.call(this,evt,x,y);this.notify("element:pointerdown",evt,x,y)},notifyPointermove:function notifyPointermove(evt,x,y){CellView.prototype.pointermove.call(this,evt,x,y);this.notify("element:pointermove",evt,x,y)},notifyPointerup:function notifyPointerup(evt,x,y){this.notify("element:pointerup",evt,x,y);CellView.prototype.pointerup.call(this,evt,x,y)},pointerdblclick:function(evt,x,y){CellView.prototype.pointerdblclick.apply(this,arguments);this.notify("element:pointerdblclick",evt,x,y)},pointerclick:function(evt,x,y){CellView.prototype.pointerclick.apply(this,arguments);this.notify("element:pointerclick",evt,x,y)},contextmenu:function(evt,x,y){CellView.prototype.contextmenu.apply(this,arguments);this.notify("element:contextmenu",evt,x,y)},pointerdown:function(evt,x,y){if(this.isPropagationStopped(evt)){return}this.notifyPointerdown(evt,x,y);this.dragStart(evt,x,y)},pointermove:function(evt,x,y){var data=this.eventData(evt);switch(data.action){case"magnet":this.dragMagnet(evt,x,y);break;case"move":(data.delegatedView||this).drag(evt,x,y);default:this.notifyPointermove(evt,x,y);break}this.eventData(evt,data)},pointerup:function(evt,x,y){var data=this.eventData(evt);switch(data.action){case"magnet":this.dragMagnetEnd(evt,x,y);break;case"move":(data.delegatedView||this).dragEnd(evt,x,y);default:this.notifyPointerup(evt,x,y)}var magnet=data.targetMagnet;if(magnet){this.magnetpointerclick(evt,magnet,x,y)}this.checkMouseleave(evt)},mouseover:function(evt){CellView.prototype.mouseover.apply(this,arguments);this.notify("element:mouseover",evt)},mouseout:function(evt){CellView.prototype.mouseout.apply(this,arguments);this.notify("element:mouseout",evt)},mouseenter:function(evt){CellView.prototype.mouseenter.apply(this,arguments);this.notify("element:mouseenter",evt)},mouseleave:function(evt){CellView.prototype.mouseleave.apply(this,arguments);this.notify("element:mouseleave",evt)},mousewheel:function(evt,x,y,delta){CellView.prototype.mousewheel.apply(this,arguments);this.notify("element:mousewheel",evt,x,y,delta)},onmagnet:function(evt,x,y){this.dragMagnetStart(evt,x,y)},magnetpointerdblclick:function(evt,magnet,x,y){this.notify("element:magnet:pointerdblclick",evt,magnet,x,y)},magnetcontextmenu:function(evt,magnet,x,y){this.notify("element:magnet:contextmenu",evt,magnet,x,y)},dragStart:function(evt,x,y){var view=this.getDelegatedView();if(!view||!view.can("elementMove")){return}this.eventData(evt,{action:"move",delegatedView:view});var position=view.model.position();view.eventData(evt,{initialPosition:position,pointerOffset:position.difference(x,y),restrictedArea:this.paper.getRestrictedArea(view,x,y)})},dragMagnetStart:function(evt,x,y){if(!this.can("addLinkFromMagnet")){return}var magnet=evt.currentTarget;var paper=this.paper;this.eventData(evt,{targetMagnet:magnet});evt.stopPropagation();if(paper.options.validateMagnet(this,magnet,evt)){if(paper.options.magnetThreshold<=0){this.dragLinkStart(evt,magnet,x,y)}this.eventData(evt,{action:"magnet"});this.stopPropagation(evt)}else{this.pointerdown(evt,x,y)}paper.delegateDragEvents(this,evt.data)},drag:function(evt,x,y){var paper=this.paper;var grid=paper.options.gridSize;var element=this.model;var data=this.eventData(evt);var pointerOffset=data.pointerOffset;var restrictedArea=data.restrictedArea;var embedding=data.embedding;var elX=snapToGrid(x+pointerOffset.x,grid);var elY=snapToGrid(y+pointerOffset.y,grid);element.position(elX,elY,{restrictedArea:restrictedArea,deep:true,ui:true});if(paper.options.embeddingMode){if(!embedding){this.prepareEmbedding(data);embedding=true}this.processEmbedding(data,evt,x,y)}this.eventData(evt,{embedding:embedding})},dragMagnet:function(evt,x,y){this.dragLink(evt,x,y)},dragEnd:function(evt,x,y){var data=this.eventData(evt);if(data.embedding){this.finalizeEmbedding(data)}},dragMagnetEnd:function(evt,x,y){this.dragLinkEnd(evt,x,y)},magnetpointerclick:function(evt,magnet,x,y){var paper=this.paper;if(paper.eventData(evt).mousemoved>paper.options.clickThreshold){return}this.notify("element:magnet:pointerclick",evt,magnet,x,y)}},{Flags:Flags});assign(ElementView.prototype,elementViewPortPrototype);var normal=function(vertices,opt,linkView){return vertices};var oneSide=function(vertices,opt,linkView){var side=opt.side||"bottom";var padding=normalizeSides(opt.padding||40);var sourceBBox=linkView.sourceBBox;var targetBBox=linkView.targetBBox;var sourcePoint=sourceBBox.center();var targetPoint=targetBBox.center();var coordinate,dimension,direction;switch(side){case"bottom":direction=1;coordinate="y";dimension="height";break;case"top":direction=-1;coordinate="y";dimension="height";break;case"left":direction=-1;coordinate="x";dimension="width";break;case"right":direction=1;coordinate="x";dimension="width";break;default:throw new Error("Router: invalid side")}sourcePoint[coordinate]+=direction*(sourceBBox[dimension]/2+padding[side]);targetPoint[coordinate]+=direction*(targetBBox[dimension]/2+padding[side]);if(direction*(sourcePoint[coordinate]-targetPoint[coordinate])>0){targetPoint[coordinate]=sourcePoint[coordinate]}else{sourcePoint[coordinate]=targetPoint[coordinate]}return[sourcePoint].concat(vertices,targetPoint)};var opposites={N:"S",S:"N",E:"W",W:"E"};var radians={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function freeJoin(p1,p2,bbox){var p=new Point(p1.x,p2.y);if(bbox.containsPoint(p)){p=new Point(p2.x,p1.y)}return p}function getBBoxSize(bbox,bearing){return bbox[bearing==="W"||bearing==="E"?"width":"height"]}function getBearing(from,to){if(from.x===to.x){return from.y>to.y?"N":"S"}if(from.y===to.y){return from.x>to.x?"W":"E"}return null}function getPointBox(p){return new Rect(p.x,p.y,0,0)}function getPaddingBox(opt){var sides=normalizeSides(opt.padding||opt.elementPadding||20);return{x:-sides.left,y:-sides.top,width:sides.left+sides.right,height:sides.top+sides.bottom}}function getSourceBBox(linkView,opt){return linkView.sourceBBox.clone().moveAndExpand(getPaddingBox(opt))}function getTargetBBox(linkView,opt){return linkView.targetBBox.clone().moveAndExpand(getPaddingBox(opt))}function getSourceAnchor(linkView,opt){if(linkView.sourceAnchor){return linkView.sourceAnchor}var sourceBBox=getSourceBBox(linkView,opt);return sourceBBox.center()}function getTargetAnchor(linkView,opt){if(linkView.targetAnchor){return linkView.targetAnchor}var targetBBox=getTargetBBox(linkView,opt);return targetBBox.center()}function vertexVertex(from,to,bearing){var p1=new Point(from.x,to.y);var p2=new Point(to.x,from.y);var d1=getBearing(from,p1);var d2=getBearing(from,p2);var opposite=opposites[bearing];var p=d1===bearing||d1!==opposite&&(d2===opposite||d2!==bearing)?p1:p2;return{points:[p],direction:getBearing(p,to)}}function elementVertex(from,to,fromBBox){var p=freeJoin(from,to,fromBBox);return{points:[p],direction:getBearing(p,to)}}function vertexElement(from,to,toBBox,bearing){var route={};var points=[new Point(from.x,to.y),new Point(to.x,from.y)];var freePoints=points.filter(function(pt){return!toBBox.containsPoint(pt)});var freeBearingPoints=freePoints.filter(function(pt){return getBearing(pt,from)!==bearing});var p;if(freeBearingPoints.length>0){p=freeBearingPoints.filter(function(pt){return getBearing(from,pt)===bearing}).pop();p=p||freeBearingPoints[0];route.points=[p];route.direction=getBearing(p,to)}else{p=difference(points,freePoints)[0];var p2=new Point(to).move(p,-getBBoxSize(toBBox,bearing)/2);var p1=freeJoin(p2,from,toBBox);route.points=[p1,p2];route.direction=getBearing(p2,to)}return route}function elementElement(from,to,fromBBox,toBBox){var route=elementVertex(to,from,toBBox);var p1=route.points[0];if(fromBBox.containsPoint(p1)){route=elementVertex(from,to,fromBBox);var p2=route.points[0];if(toBBox.containsPoint(p2)){var fromBorder=new Point(from).move(p2,-getBBoxSize(fromBBox,getBearing(from,p2))/2);var toBorder=new Point(to).move(p1,-getBBoxSize(toBBox,getBearing(to,p1))/2);var mid=new Line(fromBorder,toBorder).midpoint();var startRoute=elementVertex(from,mid,fromBBox);var endRoute=vertexVertex(mid,to,startRoute.direction);route.points=[startRoute.points[0],endRoute.points[0]];route.direction=endRoute.direction}}return route}function insideElement(from,to,fromBBox,toBBox,bearing){var route={};var boundary=fromBBox.union(toBBox).inflate(1);var reversed=boundary.center().distance(to)>boundary.center().distance(from);var start=reversed?to:from;var end=reversed?from:to;var p1,p2,p3;if(bearing){p1=Point.fromPolar(boundary.width+boundary.height,radians[bearing],start);p1=boundary.pointNearestToPoint(p1).move(p1,-1)}else{p1=boundary.pointNearestToPoint(start).move(start,1)}p2=freeJoin(p1,end,boundary);if(p1.round().equals(p2.round())){p2=Point.fromPolar(boundary.width+boundary.height,toRad(p1.theta(start))+Math.PI/2,end);p2=boundary.pointNearestToPoint(p2).move(end,1).round();p3=freeJoin(p1,p2,boundary);route.points=reversed?[p2,p3,p1]:[p1,p3,p2]}else{route.points=reversed?[p2,p1]:[p1,p2]}route.direction=reversed?getBearing(p1,to):getBearing(p2,to);return route}function orthogonal(vertices,opt,linkView){var sourceBBox=getSourceBBox(linkView,opt);var targetBBox=getTargetBBox(linkView,opt);var sourceAnchor=getSourceAnchor(linkView,opt);var targetAnchor=getTargetAnchor(linkView,opt);sourceBBox=sourceBBox.union(getPointBox(sourceAnchor));targetBBox=targetBBox.union(getPointBox(targetAnchor));vertices=toArray(vertices).map(Point);vertices.unshift(sourceAnchor);vertices.push(targetAnchor);var bearing;var orthogonalVertices=[];for(var i=0,max=vertices.length-1;i<max;i++){var route=null;var from=vertices[i];var to=vertices[i+1];var isOrthogonal=!!getBearing(from,to);if(i===0){if(i+1===max){if(sourceBBox.intersect(targetBBox.clone().inflate(1))){route=insideElement(from,to,sourceBBox,targetBBox)}else if(!isOrthogonal){route=elementElement(from,to,sourceBBox,targetBBox)}}else{if(sourceBBox.containsPoint(to)){route=insideElement(from,to,sourceBBox,getPointBox(to).moveAndExpand(getPaddingBox(opt)))}else if(!isOrthogonal){route=elementVertex(from,to,sourceBBox)}}}else if(i+1===max){var isOrthogonalLoop=isOrthogonal&&getBearing(to,from)===bearing;if(targetBBox.containsPoint(from)||isOrthogonalLoop){route=insideElement(from,to,getPointBox(from).moveAndExpand(getPaddingBox(opt)),targetBBox,bearing)}else if(!isOrthogonal){route=vertexElement(from,to,targetBBox,bearing)}}else if(!isOrthogonal){route=vertexVertex(from,to,bearing)}if(route){Array.prototype.push.apply(orthogonalVertices,route.points);bearing=route.direction}else{bearing=getBearing(from,to)}if(i+1<max){orthogonalVertices.push(to)}}return orthogonalVertices}var config$1={step:10,maximumLoops:2e3,precision:1,maxAllowedDirectionChange:90,perpendicular:true,excludeEnds:[],excludeTypes:["basic.Text"],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost:function(){return this.step},directions:function(){var step=this.step;var cost=this.cost();return[{offsetX:step,offsetY:0,cost:cost},{offsetX:-step,offsetY:0,cost:cost},{offsetX:0,offsetY:step,cost:cost},{offsetX:0,offsetY:-step,cost:cost}]},penalties:function(){return{0:0,45:this.step/2,90:this.step/2}},paddingBox:function(){var step=this.step;return{x:-step,y:-step,width:2*step,height:2*step}},isPointObstacle:null,fallbackRouter:function(vertices,opt,linkView){if(!isFunction(orthogonal)){throw new Error("Manhattan requires the orthogonal router as default fallback.")}return orthogonal(vertices,assign({},config$1,opt),linkView)},fallbackRoute:function(from,to,opt){return null},draggingRoute:null};function ObstacleMap(opt){this.map={};this.options=opt;this.mapGridSize=100}ObstacleMap.prototype.build=function(graph,link){var opt=this.options;var excludedEnds=toArray(opt.excludeEnds).reduce(function(res,item){var end=link.get(item);if(end){var cell=graph.getCell(end.id);if(cell){res.push(cell)}}return res},[]);var excludedAncestors=[];var source=graph.getCell(link.get("source").id);if(source){excludedAncestors=union(excludedAncestors,source.getAncestors().map(function(cell){return cell.id}))}var target=graph.getCell(link.get("target").id);if(target){excludedAncestors=union(excludedAncestors,target.getAncestors().map(function(cell){return cell.id}))}var mapGridSize=this.mapGridSize;graph.getElements().reduce(function(map,element){var isExcludedType=toArray(opt.excludeTypes).includes(element.get("type"));var isExcludedEnd=excludedEnds.find(function(excluded){return excluded.id===element.id});var isExcludedAncestor=excludedAncestors.includes(element.id);var isExcluded=isExcludedType||isExcludedEnd||isExcludedAncestor;if(!isExcluded){var bbox=element.getBBox().moveAndExpand(opt.paddingBox);var origin=bbox.origin().snapToGrid(mapGridSize);var corner=bbox.corner().snapToGrid(mapGridSize);for(var x=origin.x;x<=corner.x;x+=mapGridSize){for(var y=origin.y;y<=corner.y;y+=mapGridSize){var gridKey=x+"@"+y;map[gridKey]=map[gridKey]||[];map[gridKey].push(bbox)}}}return map},this.map);return this};ObstacleMap.prototype.isPointAccessible=function(point){var mapKey=point.clone().snapToGrid(this.mapGridSize).toString();return toArray(this.map[mapKey]).every(function(obstacle){return!obstacle.containsPoint(point)})};function SortedSet(){this.items=[];this.hash={};this.values={};this.OPEN=1;this.CLOSE=2}SortedSet.prototype.add=function(item,value){if(this.hash[item]){this.items.splice(this.items.indexOf(item),1)}else{this.hash[item]=this.OPEN}this.values[item]=value;var index$1=sortedIndex(this.items,item,function(i){return this.values[i]}.bind(this));this.items.splice(index$1,0,item)};SortedSet.prototype.remove=function(item){this.hash[item]=this.CLOSE};SortedSet.prototype.isOpen=function(item){return this.hash[item]===this.OPEN};SortedSet.prototype.isClose=function(item){return this.hash[item]===this.CLOSE};SortedSet.prototype.isEmpty=function(){return this.items.length===0};SortedSet.prototype.pop=function(){var item=this.items.shift();this.remove(item);return item};function getSourceBBox$1(linkView,opt){if(opt&&opt.paddingBox){return linkView.sourceBBox.clone().moveAndExpand(opt.paddingBox)}return linkView.sourceBBox.clone()}function getTargetBBox$1(linkView,opt){if(opt&&opt.paddingBox){return linkView.targetBBox.clone().moveAndExpand(opt.paddingBox)}return linkView.targetBBox.clone()}function getSourceAnchor$1(linkView,opt){if(linkView.sourceAnchor){return linkView.sourceAnchor}var sourceBBox=getSourceBBox$1(linkView,opt);return sourceBBox.center()}function getTargetAnchor$1(linkView,opt){if(linkView.targetAnchor){return linkView.targetAnchor}var targetBBox=getTargetBBox$1(linkView,opt);return targetBBox.center()}function getDirectionAngle(start,end,numDirections,grid,opt){var quadrant=360/numDirections;var angleTheta=start.theta(fixAngleEnd(start,end,grid,opt));var normalizedAngle=normalizeAngle(angleTheta+quadrant/2);return quadrant*Math.floor(normalizedAngle/quadrant)}function fixAngleEnd(start,end,grid,opt){var step=opt.step;var diffX=end.x-start.x;var diffY=end.y-start.y;var gridStepsX=diffX/grid.x;var gridStepsY=diffY/grid.y;var distanceX=gridStepsX*step;var distanceY=gridStepsY*step;return new Point(start.x+distanceX,start.y+distanceY)}function getDirectionChange(angle1,angle2){var directionChange=Math.abs(angle1-angle2);return directionChange>180?360-directionChange:directionChange}function getGridOffsets(directions,grid,opt){var step=opt.step;toArray(opt.directions).forEach(function(direction){direction.gridOffsetX=direction.offsetX/step*grid.x;direction.gridOffsetY=direction.offsetY/step*grid.y})}function getGrid(step,source,target){return{source:source.clone(),x:getGridDimension(target.x-source.x,step),y:getGridDimension(target.y-source.y,step)}}function getGridDimension(diff,step){if(!diff){return step}var absDiff=Math.abs(diff);var numSteps=Math.round(absDiff/step);if(!numSteps){return absDiff}var roundedDiff=numSteps*step;var remainder=absDiff-roundedDiff;var stepCorrection=remainder/numSteps;return step+stepCorrection}function snapToGrid$1(point,grid){var source=grid.source;var snappedX=snapToGrid(point.x-source.x,grid.x)+source.x;var snappedY=snapToGrid(point.y-source.y,grid.y)+source.y;return new Point(snappedX,snappedY)}function round$4(point,precision){return point.round(precision)}function align(point,grid,precision){return round$4(snapToGrid$1(point.clone(),grid),precision)}function getKey(point){return point.clone().toString()}function normalizePoint(point){return new Point(point.x===0?0:Math.abs(point.x)/point.x,point.y===0?0:Math.abs(point.y)/point.y)}function reconstructRoute(parents,points,tailPoint,from,to,grid,opt){var route=[];var prevDiff=normalizePoint(to.difference(tailPoint));var currentKey=getKey(tailPoint);var parent=parents[currentKey];var point;while(parent){point=points[currentKey];var diff=normalizePoint(point.difference(parent));if(!diff.equals(prevDiff)){route.unshift(point);prevDiff=diff}currentKey=getKey(parent);parent=parents[currentKey]}var leadPoint=points[currentKey];var fromDiff=normalizePoint(leadPoint.difference(from));if(!fromDiff.equals(prevDiff)){route.unshift(leadPoint)}return route}function estimateCost(from,endPoints){var min=Infinity;for(var i=0,len=endPoints.length;i<len;i++){var cost=from.manhattanDistance(endPoints[i]);if(cost<min){min=cost}}return min}function getRectPoints(anchor,bbox,directionList,grid,opt){var precision=opt.precision;var directionMap=opt.directionMap;var anchorCenterVector=anchor.difference(bbox.center());var keys=isObject$1(directionMap)?Object.keys(directionMap):[];var dirList=toArray(directionList);var rectPoints=keys.reduce(function(res,key){if(dirList.includes(key)){var direction=directionMap[key];var endpoint=new Point(anchor.x+direction.x*(Math.abs(anchorCenterVector.x)+bbox.width),anchor.y+direction.y*(Math.abs(anchorCenterVector.y)+bbox.height));var intersectionLine=new Line(anchor,endpoint);var intersections=intersectionLine.intersect(bbox)||[];var numIntersections=intersections.length;var farthestIntersectionDistance;var farthestIntersection=null;for(var i=0;i<numIntersections;i++){var currentIntersection=intersections[i];var distance=anchor.squaredDistance(currentIntersection);if(farthestIntersectionDistance===undefined||distance>farthestIntersectionDistance){farthestIntersectionDistance=distance;farthestIntersection=currentIntersection}}if(farthestIntersection){var point=align(farthestIntersection,grid,precision);if(bbox.containsPoint(point)){point=align(point.offset(direction.x*grid.x,direction.y*grid.y),grid,precision)}res.push(point)}}return res},[]);if(!bbox.containsPoint(anchor)){rectPoints.push(align(anchor,grid,precision))}return rectPoints}function findRoute(from,to,isPointObstacle,opt){var precision=opt.precision;var sourceAnchor,targetAnchor;if(from instanceof Rect){sourceAnchor=round$4(getSourceAnchor$1(this,opt).clone(),precision)}else{sourceAnchor=round$4(from.clone(),precision)}if(to instanceof Rect){targetAnchor=round$4(getTargetAnchor$1(this,opt).clone(),precision)}else{targetAnchor=round$4(to.clone(),precision)}var grid=getGrid(opt.step,sourceAnchor,targetAnchor);var start,end;var startPoints,endPoints;if(from instanceof Rect){start=sourceAnchor;startPoints=getRectPoints(start,from,opt.startDirections,grid,opt)}else{start=sourceAnchor;startPoints=[start]}if(to instanceof Rect){end=targetAnchor;endPoints=getRectPoints(targetAnchor,to,opt.endDirections,grid,opt)}else{end=targetAnchor;endPoints=[end]}startPoints=startPoints.filter(function(p){return!isPointObstacle(p)});endPoints=endPoints.filter(function(p){return!isPointObstacle(p)});if(startPoints.length>0&&endPoints.length>0){var openSet=new SortedSet;var points={};var parents={};var costs={};for(var i=0,n=startPoints.length;i<n;i++){var startPoint=startPoints[i];var key=getKey(startPoint);openSet.add(key,estimateCost(startPoint,endPoints));points[key]=startPoint;costs[key]=0}var previousRouteDirectionAngle=opt.previousDirectionAngle;var isPathBeginning=previousRouteDirectionAngle===undefined;var direction,directionChange;var directions=opt.directions;getGridOffsets(directions,grid,opt);var numDirections=directions.length;var endPointsKeys=toArray(endPoints).reduce(function(res,endPoint){var key=getKey(endPoint);res.push(key);return res},[]);var loopsRemaining=opt.maximumLoops;while(!openSet.isEmpty()&&loopsRemaining>0){var currentKey=openSet.pop();var currentPoint=points[currentKey];var currentParent=parents[currentKey];var currentCost=costs[currentKey];var isRouteBeginning=currentParent===undefined;var isStart=currentPoint.equals(start);var previousDirectionAngle;if(!isRouteBeginning){previousDirectionAngle=getDirectionAngle(currentParent,currentPoint,numDirections,grid,opt)}else if(!isPathBeginning){previousDirectionAngle=previousRouteDirectionAngle}else if(!isStart){previousDirectionAngle=getDirectionAngle(start,currentPoint,numDirections,grid,opt)}else{previousDirectionAngle=null}var samePoints=startPoints.length===endPoints.length;if(samePoints){for(var j=0;j<startPoints.length;j++){if(!startPoints[j].equals(endPoints[j])){samePoints=false;break}}}var skipEndCheck=isRouteBeginning&&samePoints;if(!skipEndCheck&&endPointsKeys.indexOf(currentKey)>=0){opt.previousDirectionAngle=previousDirectionAngle;return reconstructRoute(parents,points,currentPoint,start,end,grid,opt)}for(i=0;i<numDirections;i++){direction=directions[i];var directionAngle=direction.angle;directionChange=getDirectionChange(previousDirectionAngle,directionAngle);if(!(isPathBeginning&&isStart)&&directionChange>opt.maxAllowedDirectionChange){continue}var neighborPoint=align(currentPoint.clone().offset(direction.gridOffsetX,direction.gridOffsetY),grid,precision);var neighborKey=getKey(neighborPoint);if(openSet.isClose(neighborKey)||isPointObstacle(neighborPoint)){continue}if(endPointsKeys.indexOf(neighborKey)>=0){var isNeighborEnd=neighborPoint.equals(end);if(!isNeighborEnd){var endDirectionAngle=getDirectionAngle(neighborPoint,end,numDirections,grid,opt);var endDirectionChange=getDirectionChange(directionAngle,endDirectionAngle);if(endDirectionChange>opt.maxAllowedDirectionChange){continue}}}var neighborCost=direction.cost;var neighborPenalty=isStart?0:opt.penalties[directionChange];var costFromStart=currentCost+neighborCost+neighborPenalty;if(!openSet.isOpen(neighborKey)||costFromStart<costs[neighborKey]){points[neighborKey]=neighborPoint;parents[neighborKey]=currentPoint;costs[neighborKey]=costFromStart;openSet.add(neighborKey,costFromStart+estimateCost(neighborPoint,endPoints))}}loopsRemaining--}}return opt.fallbackRoute.call(this,start,end,opt)}function resolveOptions(opt){opt.directions=result(opt,"directions");opt.penalties=result(opt,"penalties");opt.paddingBox=result(opt,"paddingBox");opt.padding=result(opt,"padding");if(opt.padding){var sides=normalizeSides(opt.padding);opt.paddingBox={x:-sides.left,y:-sides.top,width:sides.left+sides.right,height:sides.top+sides.bottom}}toArray(opt.directions).forEach(function(direction){var point1=new Point(0,0);var point2=new Point(direction.offsetX,direction.offsetY);direction.angle=normalizeAngle(point1.theta(point2))})}function router(vertices,opt,linkView){resolveOptions(opt);linkView.options.perpendicular=!!opt.perpendicular;var sourceBBox=getSourceBBox$1(linkView,opt);var targetBBox=getTargetBBox$1(linkView,opt);var sourceAnchor=getSourceAnchor$1(linkView,opt);var isPointObstacle;if(typeof opt.isPointObstacle==="function"){isPointObstacle=opt.isPointObstacle}else{var map=new ObstacleMap(opt);map.build(linkView.paper.model,linkView.model);isPointObstacle=function(point){return!map.isPointAccessible(point)}}var oldVertices=toArray(vertices).map(Point);var newVertices=[];var tailPoint=sourceAnchor;var to,from;for(var i=0,len=oldVertices.length;i<=len;i++){var partialRoute=null;from=to||sourceBBox;to=oldVertices[i];if(!to){to=targetBBox;var isEndingAtPoint=!linkView.model.get("source").id||!linkView.model.get("target").id;if(isEndingAtPoint&&isFunction(opt.draggingRoute)){var dragFrom=from===sourceBBox?sourceAnchor:from;var dragTo=to.origin();partialRoute=opt.draggingRoute.call(linkView,dragFrom,dragTo,opt)}}partialRoute=partialRoute||findRoute.call(linkView,from,to,isPointObstacle,opt);if(partialRoute===null){return opt.fallbackRouter(vertices,opt,linkView)}var leadPoint=partialRoute[0];if(leadPoint&&leadPoint.equals(tailPoint)){partialRoute.shift()}tailPoint=partialRoute[partialRoute.length-1]||tailPoint;Array.prototype.push.apply(newVertices,partialRoute)}return newVertices}var manhattan=function(vertices,opt,linkView){return router(vertices,assign({},config$1,opt),linkView)};var config$2={maxAllowedDirectionChange:45,diagonalCost:function(){var step=this.step;return Math.ceil(Math.sqrt(step*step<<1))},directions:function(){var step=this.step;var cost=this.cost();var diagonalCost=this.diagonalCost();return[{offsetX:step,offsetY:0,cost:cost},{offsetX:step,offsetY:step,cost:diagonalCost},{offsetX:0,offsetY:step,cost:cost},{offsetX:-step,offsetY:step,cost:diagonalCost},{offsetX:-step,offsetY:0,cost:cost},{offsetX:-step,offsetY:-step,cost:diagonalCost},{offsetX:0,offsetY:-step,cost:cost},{offsetX:step,offsetY:-step,cost:diagonalCost}]},fallbackRoute:function(from,to,opt){var theta=from.theta(to);var route=[];var a={x:to.x,y:from.y};var b={x:from.x,y:to.y};if(theta%180>90){var t=a;a=b;b=t}var p1=theta%90<45?a:b;var l1=new Line(from,p1);var alpha=90*Math.ceil(theta/90);var p2=Point.fromPolar(l1.squaredLength(),toRad(alpha+135),p1);var l2=new Line(to,p2);var intersectionPoint=l1.intersection(l2);var point=intersectionPoint?intersectionPoint:to;var directionFrom=intersectionPoint?point:from;var quadrant=360/opt.directions.length;var angleTheta=directionFrom.theta(to);var normalizedAngle=normalizeAngle(angleTheta+quadrant/2);var directionAngle=quadrant*Math.floor(normalizedAngle/quadrant);opt.previousDirectionAngle=directionAngle;if(point){route.push(point.round())}route.push(to);return route}};var metro=function(vertices,opt,linkView){if(!isFunction(manhattan)){throw new Error("Metro requires the manhattan router.")}return manhattan(vertices,assign({},config$2,opt),linkView)};var routers={normal:normal,oneSide:oneSide,orthogonal:orthogonal,manhattan:manhattan,metro:metro};var JUMP_SIZE=5;var JUMP_TYPES=["arc","gap","cubic"];var RADIUS=0;var CLOSE_PROXIMITY_PADDING=1;var IGNORED_CONNECTORS=["smooth"];var _13=1/3;var _23=2/3;function createLines(sourcePoint,targetPoint,route){var points=[].concat(sourcePoint,route,targetPoint);return points.reduce(function(resultLines,point,idx){var nextPoint=points[idx+1];if(nextPoint!=null){resultLines[idx]=line(point,nextPoint)}return resultLines},[])}function setupUpdating(jumpOverLinkView){var paper=jumpOverLinkView.paper;var updateList=paper._jumpOverUpdateList;if(updateList==null){updateList=paper._jumpOverUpdateList=[];var graph=paper.model;graph.on("batch:stop",function(){if(this.hasActiveBatch()){return}updateJumpOver(paper)});graph.on("reset",function(){updateList=paper._jumpOverUpdateList=[]})}if(updateList.indexOf(jumpOverLinkView)<0){updateList.push(jumpOverLinkView);jumpOverLinkView.listenToOnce(jumpOverLinkView.model,"change:connector remove",function(){updateList.splice(updateList.indexOf(jumpOverLinkView),1)})}}function updateJumpOver(paper){var updateList=paper._jumpOverUpdateList;for(var i=0;i<updateList.length;i++){var linkView=updateList[i];var updateFlag=linkView.getFlag(linkView.constructor.Flags.CONNECTOR);linkView.requestUpdate(updateFlag)}}function findLineIntersections(line,crossCheckLines){return toArray(crossCheckLines).reduce(function(res,crossCheckLine){var intersection=line.intersection(crossCheckLine);if(intersection){res.push(intersection)}return res},[])}function sortPoints(p1,p2){return line(p1,p2).squaredLength()}function createJumps(line$1,intersections,jumpSize){return intersections.reduce(function(resultLines,point$1,idx){if(point$1.skip===true){return resultLines}var lastLine=resultLines.pop()||line$1;var jumpStart=point(point$1).move(lastLine.start,-jumpSize);var jumpEnd=point(point$1).move(lastLine.start,+jumpSize);var nextPoint=intersections[idx+1];if(nextPoint!=null){var distance=jumpEnd.distance(nextPoint);if(distance<=jumpSize){jumpEnd=nextPoint.move(lastLine.start,distance);nextPoint.skip=true}}else{var endDistance=jumpStart.distance(lastLine.end);if(endDistance<jumpSize*2+CLOSE_PROXIMITY_PADDING){resultLines.push(lastLine);return resultLines}}var startDistance=jumpEnd.distance(lastLine.start);if(startDistance<jumpSize*2+CLOSE_PROXIMITY_PADDING){resultLines.push(lastLine);return resultLines}var jumpLine=line(jumpStart,jumpEnd);jumpLine.isJump=true;resultLines.push(line(lastLine.start,jumpStart),jumpLine,line(jumpEnd,lastLine.end));return resultLines},[])}function buildPath(lines,jumpSize,jumpType,radius){var path=new Path;var segment;segment=Path.createSegment("M",lines[0].start);path.appendSegment(segment);toArray(lines).forEach(function(line,index){if(line.isJump){var angle,diff;var control1,control2;if(jumpType==="arc"){angle=-90;diff=line.start.difference(line.end);var xAxisRotate=Number(diff.x<0||diff.x===0&&diff.y<0);if(xAxisRotate){angle+=180}var midpoint=line.midpoint();var centerLine=new Line(midpoint,line.end).rotate(midpoint,angle);var halfLine;halfLine=new Line(line.start,midpoint);control1=halfLine.pointAt(2/3).rotate(line.start,angle);control2=centerLine.pointAt(1/3).rotate(centerLine.end,-angle);segment=Path.createSegment("C",control1,control2,centerLine.end);path.appendSegment(segment);halfLine=new Line(midpoint,line.end);control1=centerLine.pointAt(1/3).rotate(centerLine.end,angle);control2=halfLine.pointAt(1/3).rotate(line.end,-angle);segment=Path.createSegment("C",control1,control2,line.end);path.appendSegment(segment)}else if(jumpType==="gap"){segment=Path.createSegment("M",line.end);path.appendSegment(segment)}else if(jumpType==="cubic"){angle=line.start.theta(line.end);var xOffset=jumpSize*.6;var yOffset=jumpSize*1.35;diff=line.start.difference(line.end);xAxisRotate=Number(diff.x<0||diff.x===0&&diff.y<0);if(xAxisRotate){yOffset*=-1}control1=Point(line.start.x+xOffset,line.start.y+yOffset).rotate(line.start,angle);control2=Point(line.end.x-xOffset,line.end.y+yOffset).rotate(line.end,angle);segment=Path.createSegment("C",control1,control2,line.end);path.appendSegment(segment)}}else{var nextLine=lines[index+1];if(radius==0||!nextLine||nextLine.isJump){segment=Path.createSegment("L",line.end);path.appendSegment(segment)}else{buildRoundedSegment(radius,path,line.end,line.start,nextLine.end)}}});return path}function buildRoundedSegment(offset,path,curr,prev,next){var prevDistance=curr.distance(prev)/2;var nextDistance=curr.distance(next)/2;var startMove=-Math.min(offset,prevDistance);var endMove=-Math.min(offset,nextDistance);var roundedStart=curr.clone().move(prev,startMove).round();var roundedEnd=curr.clone().move(next,endMove).round();var control1=new Point(_13*roundedStart.x+_23*curr.x,_23*curr.y+_13*roundedStart.y);var control2=new Point(_13*roundedEnd.x+_23*curr.x,_23*curr.y+_13*roundedEnd.y);var segment;segment=Path.createSegment("L",roundedStart);path.appendSegment(segment);segment=Path.createSegment("C",control1,control2,roundedEnd);path.appendSegment(segment)}var jumpover=function(sourcePoint,targetPoint,route,opt){setupUpdating(this);var raw=opt.raw;var jumpSize=opt.size||JUMP_SIZE;var jumpType=opt.jump&&(""+opt.jump).toLowerCase();var radius=opt.radius||RADIUS;var ignoreConnectors=opt.ignoreConnectors||IGNORED_CONNECTORS;if(JUMP_TYPES.indexOf(jumpType)===-1){jumpType=JUMP_TYPES[0]}var paper=this.paper;var graph=paper.model;var allLinks=graph.getLinks();if(allLinks.length===1){return buildPath(createLines(sourcePoint,targetPoint,route),jumpSize,jumpType,radius)}var thisModel=this.model;var thisIndex=allLinks.indexOf(thisModel);var defaultConnector=paper.options.defaultConnector||{};var links=allLinks.filter(function(link,idx){var connector=link.get("connector")||defaultConnector;if(toArray(ignoreConnectors).includes(connector.name)){return false}if(idx>thisIndex){return connector.name!=="jumpover"}return true});var linkViews=links.map(function(link){return paper.findViewByModel(link)});var thisLines=createLines(sourcePoint,targetPoint,route);var linkLines=linkViews.map(function(linkView){if(linkView==null){return[]}if(linkView===this){return thisLines}return createLines(linkView.sourcePoint,linkView.targetPoint,linkView.route)},this);var jumpingLines=thisLines.reduce(function(resultLines,thisLine){var intersections=links.reduce(function(res,link,i){if(link!==thisModel){var lineIntersections=findLineIntersections(thisLine,linkLines[i]);res.push.apply(res,lineIntersections)}return res},[]).sort(function(a,b){return sortPoints(thisLine.start,a)-sortPoints(thisLine.start,b)});if(intersections.length>0){resultLines.push.apply(resultLines,createJumps(thisLine,intersections,jumpSize))}else{resultLines.push(thisLine)}return resultLines},[]);var path=buildPath(jumpingLines,jumpSize,jumpType,radius);return raw?path:path.serialize()};var normal$1=function(sourcePoint,targetPoint,route,opt){var raw=opt&&opt.raw;var points=[sourcePoint].concat(route).concat([targetPoint]);var polyline=new Polyline(points);var path=new Path(polyline);return raw?path:path.serialize()};var rounded=function(sourcePoint,targetPoint,route,opt){opt||(opt={});var offset=opt.radius||10;var raw=opt.raw;var path=new Path;var segment;segment=Path.createSegment("M",sourcePoint);path.appendSegment(segment);var _13=1/3;var _23=2/3;var curr;var prev,next;var prevDistance,nextDistance;var startMove,endMove;var roundedStart,roundedEnd;var control1,control2;for(var index=0,n=route.length;index<n;index++){curr=new Point(route[index]);prev=route[index-1]||sourcePoint;next=route[index+1]||targetPoint;prevDistance=nextDistance||curr.distance(prev)/2;nextDistance=curr.distance(next)/2;startMove=-Math.min(offset,prevDistance);endMove=-Math.min(offset,nextDistance);roundedStart=curr.clone().move(prev,startMove).round();roundedEnd=curr.clone().move(next,endMove).round();control1=new Point(_13*roundedStart.x+_23*curr.x,_23*curr.y+_13*roundedStart.y);control2=new Point(_13*roundedEnd.x+_23*curr.x,_23*curr.y+_13*roundedEnd.y);segment=Path.createSegment("L",roundedStart);path.appendSegment(segment);segment=Path.createSegment("C",control1,control2,roundedEnd);path.appendSegment(segment)}segment=Path.createSegment("L",targetPoint);path.appendSegment(segment);return raw?path:path.serialize()};var smooth=function(sourcePoint,targetPoint,route,opt){var raw=opt&&opt.raw;var path;if(route&&route.length!==0){var points=[sourcePoint].concat(route).concat([targetPoint]);var curves=Curve.throughPoints(points);path=new Path(curves)}else{path=new Path;var segment;segment=Path.createSegment("M",sourcePoint);path.appendSegment(segment);if(Math.abs(sourcePoint.x-targetPoint.x)>=Math.abs(sourcePoint.y-targetPoint.y)){var controlPointX=(sourcePoint.x+targetPoint.x)/2;segment=Path.createSegment("C",controlPointX,sourcePoint.y,controlPointX,targetPoint.y,targetPoint.x,targetPoint.y);path.appendSegment(segment)}else{var controlPointY=(sourcePoint.y+targetPoint.y)/2;segment=Path.createSegment("C",sourcePoint.x,controlPointY,targetPoint.x,controlPointY,targetPoint.x,targetPoint.y);path.appendSegment(segment)}}return raw?path:path.serialize()};var Directions={AUTO:"auto",HORIZONTAL:"horizontal",VERTICAL:"vertical",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"};var TangentDirections={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right",AUTO:"auto",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"};var curve=function(sourcePoint,targetPoint,route,opt,linkView){if(route===void 0)route=[];if(opt===void 0)opt={};var raw=Boolean(opt.raw);var direction=opt.direction;if(direction===void 0)direction=Directions.AUTO;var precision=opt.precision;if(precision===void 0)precision=3;var options={coeff:opt.distanceCoefficient||.6,angleTangentCoefficient:opt.angleTangentCoefficient||80,tau:opt.tension||.5,sourceTangent:opt.sourceTangent?new Point(opt.sourceTangent):null,targetTangent:opt.targetTangent?new Point(opt.targetTangent):null,rotate:Boolean(opt.rotate)};if(typeof opt.sourceDirection==="string"){options.sourceDirection=opt.sourceDirection}else if(typeof opt.sourceDirection==="number"){options.sourceDirection=new Point(1,0).rotate(null,opt.sourceDirection)}else{options.sourceDirection=opt.sourceDirection?new Point(opt.sourceDirection).normalize():null}if(typeof opt.targetDirection==="string"){options.targetDirection=opt.targetDirection}else if(typeof opt.targetDirection==="number"){options.targetDirection=new Point(1,0).rotate(null,opt.targetDirection)}else{options.targetDirection=opt.targetDirection?new Point(opt.targetDirection).normalize():null}var completeRoute=[sourcePoint].concat(route.map(function(p){return new Point(p)}),[targetPoint]);var sourceTangent;if(options.sourceTangent){sourceTangent=options.sourceTangent}else{var sourceDirection=getSourceTangentDirection(linkView,completeRoute,direction,options);var tangentLength=completeRoute[0].distance(completeRoute[1])*options.coeff;var pointsVector=completeRoute[1].difference(completeRoute[0]).normalize();var angle=angleBetweenVectors(sourceDirection,pointsVector);if(angle>Math.PI/4){var updatedLength=tangentLength+(angle-Math.PI/4)*options.angleTangentCoefficient;sourceTangent=sourceDirection.clone().scale(updatedLength,updatedLength)}else{sourceTangent=sourceDirection.clone().scale(tangentLength,tangentLength)}}var targetTangent;if(options.targetTangent){targetTangent=options.targetTangent}else{var targetDirection=getTargetTangentDirection(linkView,completeRoute,direction,options);var last=completeRoute.length-1;var tangentLength$1=completeRoute[last-1].distance(completeRoute[last])*options.coeff;var pointsVector$1=completeRoute[last-1].difference(completeRoute[last]).normalize();var angle$1=angleBetweenVectors(targetDirection,pointsVector$1);if(angle$1>Math.PI/4){var updatedLength$1=tangentLength$1+(angle$1-Math.PI/4)*options.angleTangentCoefficient;targetTangent=targetDirection.clone().scale(updatedLength$1,updatedLength$1)}else{targetTangent=targetDirection.clone().scale(tangentLength$1,tangentLength$1)}}var catmullRomCurves=createCatmullRomCurves(completeRoute,sourceTangent,targetTangent,options);var bezierCurves=catmullRomCurves.map(function(curve){return catmullRomToBezier(curve,options)});var path=new Path(bezierCurves).round(precision);return raw?path:path.serialize()};curve.Directions=Directions;curve.TangentDirections=TangentDirections;function getHorizontalSourceDirection(linkView,route,options){var sourceBBox=linkView.sourceBBox;var sourceSide;var rotation;if(!linkView.sourceView){if(sourceBBox.x>route[1].x){sourceSide="right"}else{sourceSide="left"}}else{rotation=linkView.sourceView.model.angle();if(options.rotate&&rotation){var unrotatedBBox=linkView.sourceView.getNodeUnrotatedBBox(linkView.sourceView.el);var sourcePoint=route[0].clone();sourcePoint.rotate(sourceBBox.center(),rotation);sourceSide=unrotatedBBox.sideNearestToPoint(sourcePoint)}else{sourceSide=sourceBBox.sideNearestToPoint(route[0])}}var direction;switch(sourceSide){case"left":direction=new Point(-1,0);break;case"right":default:direction=new Point(1,0);break}if(options.rotate&&rotation){direction.rotate(null,-rotation)}return direction}function getHorizontalTargetDirection(linkView,route,options){var targetBBox=linkView.targetBBox;var targetSide;var rotation;if(!linkView.targetView){if(targetBBox.x>route[route.length-2].x){targetSide="left"}else{targetSide="right"}}else{rotation=linkView.targetView.model.angle();if(options.rotate&&rotation){var unrotatedBBox=linkView.targetView.getNodeUnrotatedBBox(linkView.targetView.el);var targetPoint=route[route.length-1].clone();targetPoint.rotate(targetBBox.center(),rotation);targetSide=unrotatedBBox.sideNearestToPoint(targetPoint)}else{targetSide=targetBBox.sideNearestToPoint(route[route.length-1])}}var direction;switch(targetSide){case"left":direction=new Point(-1,0);break;case"right":default:direction=new Point(1,0);break}if(options.rotate&&rotation){direction.rotate(null,-rotation)}return direction}function getVerticalSourceDirection(linkView,route,options){var sourceBBox=linkView.sourceBBox;var sourceSide;var rotation;if(!linkView.sourceView){if(sourceBBox.y>route[1].y){sourceSide="bottom"}else{sourceSide="top"}}else{rotation=linkView.sourceView.model.angle();if(options.rotate&&rotation){var unrotatedBBox=linkView.sourceView.getNodeUnrotatedBBox(linkView.sourceView.el);var sourcePoint=route[0].clone();sourcePoint.rotate(sourceBBox.center(),rotation);sourceSide=unrotatedBBox.sideNearestToPoint(sourcePoint)}else{sourceSide=sourceBBox.sideNearestToPoint(route[0])}}var direction;switch(sourceSide){case"top":direction=new Point(0,-1);break;case"bottom":default:direction=new Point(0,1);break}if(options.rotate&&rotation){direction.rotate(null,-rotation)}return direction}function getVerticalTargetDirection(linkView,route,options){var targetBBox=linkView.targetBBox;var targetSide;var rotation;if(!linkView.targetView){if(targetBBox.y>route[route.length-2].y){targetSide="top"}else{targetSide="bottom"}}else{rotation=linkView.targetView.model.angle();if(options.rotate&&rotation){var unrotatedBBox=linkView.targetView.getNodeUnrotatedBBox(linkView.targetView.el);var targetPoint=route[route.length-1].clone();targetPoint.rotate(targetBBox.center(),rotation);targetSide=unrotatedBBox.sideNearestToPoint(targetPoint)}else{targetSide=targetBBox.sideNearestToPoint(route[route.length-1])}}var direction;switch(targetSide){case"top":direction=new Point(0,-1);break;case"bottom":default:direction=new Point(0,1);break}if(options.rotate&&rotation){direction.rotate(null,-rotation)}return direction}function getAutoSourceDirection(linkView,route,options){var sourceBBox=linkView.sourceBBox;var sourceSide;var rotation;if(!linkView.sourceView){sourceSide=sourceBBox.sideNearestToPoint(route[1])}else{rotation=linkView.sourceView.model.angle();if(options.rotate&&rotation){var unrotatedBBox=linkView.sourceView.getNodeUnrotatedBBox(linkView.sourceView.el);var sourcePoint=route[0].clone();sourcePoint.rotate(sourceBBox.center(),rotation);sourceSide=unrotatedBBox.sideNearestToPoint(sourcePoint)}else{sourceSide=sourceBBox.sideNearestToPoint(route[0])}}var direction;switch(sourceSide){case"top":direction=new Point(0,-1);break;case"bottom":direction=new Point(0,1);break;case"right":direction=new Point(1,0);break;case"left":direction=new Point(-1,0);break}if(options.rotate&&rotation){direction.rotate(null,-rotation)}return direction}function getAutoTargetDirection(linkView,route,options){var targetBBox=linkView.targetBBox;var targetSide;var rotation;if(!linkView.targetView){targetSide=targetBBox.sideNearestToPoint(route[route.length-2])}else{rotation=linkView.targetView.model.angle();if(options.rotate&&rotation){var unrotatedBBox=linkView.targetView.getNodeUnrotatedBBox(linkView.targetView.el);var targetPoint=route[route.length-1].clone();targetPoint.rotate(targetBBox.center(),rotation);targetSide=unrotatedBBox.sideNearestToPoint(targetPoint)}else{targetSide=targetBBox.sideNearestToPoint(route[route.length-1])}}var direction;switch(targetSide){case"top":direction=new Point(0,-1);break;case"bottom":direction=new Point(0,1);break;case"right":direction=new Point(1,0);break;case"left":direction=new Point(-1,0);break}if(options.rotate&&rotation){direction.rotate(null,-rotation)}return direction}function getClosestPointSourceDirection(linkView,route,options){return route[1].difference(route[0]).normalize()}function getClosestPointTargetDirection(linkView,route,options){var last=route.length-1;return route[last-1].difference(route[last]).normalize()}function getOutwardsSourceDirection(linkView,route,options){var sourceBBox=linkView.sourceBBox;var sourceCenter=sourceBBox.center();return route[0].difference(sourceCenter).normalize()}function getOutwardsTargetDirection(linkView,route,options){var targetBBox=linkView.targetBBox;var targetCenter=targetBBox.center();return route[route.length-1].difference(targetCenter).normalize()}function getSourceTangentDirection(linkView,route,direction,options){if(options.sourceDirection){switch(options.sourceDirection){case TangentDirections.UP:return new Point(0,-1);case TangentDirections.DOWN:return new Point(0,1);case TangentDirections.LEFT:return new Point(-1,0);case TangentDirections.RIGHT:return new Point(1,0);case TangentDirections.AUTO:return getAutoSourceDirection(linkView,route,options);case TangentDirections.CLOSEST_POINT:return getClosestPointSourceDirection(linkView,route,options);case TangentDirections.OUTWARDS:return getOutwardsSourceDirection(linkView,route,options);default:return options.sourceDirection}}switch(direction){case Directions.HORIZONTAL:return getHorizontalSourceDirection(linkView,route,options);case Directions.VERTICAL:return getVerticalSourceDirection(linkView,route,options);case Directions.CLOSEST_POINT:return getClosestPointSourceDirection(linkView,route,options);case Directions.OUTWARDS:return getOutwardsSourceDirection(linkView,route,options);case Directions.AUTO:default:return getAutoSourceDirection(linkView,route,options)}}function getTargetTangentDirection(linkView,route,direction,options){if(options.targetDirection){switch(options.targetDirection){case TangentDirections.UP:return new Point(0,-1);case TangentDirections.DOWN:return new Point(0,1);case TangentDirections.LEFT:return new Point(-1,0);case TangentDirections.RIGHT:return new Point(0,1);case TangentDirections.AUTO:return getAutoTargetDirection(linkView,route,options);case TangentDirections.CLOSEST_POINT:return getClosestPointTargetDirection(linkView,route,options);case TangentDirections.OUTWARDS:return getOutwardsTargetDirection(linkView,route,options);default:return options.targetDirection}}switch(direction){case Directions.HORIZONTAL:return getHorizontalTargetDirection(linkView,route,options);case Directions.VERTICAL:return getVerticalTargetDirection(linkView,route,options);case Directions.CLOSEST_POINT:return getClosestPointTargetDirection(linkView,route,options);case Directions.OUTWARDS:return getOutwardsTargetDirection(linkView,route,options);case Directions.AUTO:default:return getAutoTargetDirection(linkView,route,options)}}function rotateVector(vector,angle){var cos=Math.cos(angle);var sin=Math.sin(angle);var x=cos*vector.x-sin*vector.y;var y=sin*vector.x+cos*vector.y;vector.x=x;vector.y=y}function angleBetweenVectors(v1,v2){var cos=v1.dot(v2)/(v1.magnitude()*v2.magnitude());if(cos<-1){cos=-1}if(cos>1){cos=1}return Math.acos(cos)}function determinant(v1,v2){return v1.x*v2.y-v1.y*v2.x}function createCatmullRomCurves(points,sourceTangent,targetTangent,options){var tau=options.tau;var coeff=options.coeff;var distances=[];var tangents=[];var catmullRomCurves=[];var n=points.length-1;for(var i=0;i<n;i++){distances[i]=points[i].distance(points[i+1])}tangents[0]=sourceTangent;tangents[n]=targetTangent;for(var i$1=1;i$1<n;i$1++){var tpPrev=void 0;var tpNext=void 0;if(i$1===1){tpPrev=points[i$1-1].clone().offset(tangents[i$1-1].x,tangents[i$1-1].y)}else{tpPrev=points[i$1-1].clone()}if(i$1===n-1){tpNext=points[i$1+1].clone().offset(tangents[i$1+1].x,tangents[i$1+1].y)}else{tpNext=points[i$1+1].clone()}var v1=tpPrev.difference(points[i$1]).normalize();var v2=tpNext.difference(points[i$1]).normalize();var vAngle=angleBetweenVectors(v1,v2);var rot=(Math.PI-vAngle)/2;var t=void 0;var vectorDeterminant=determinant(v1,v2);var pointsDeterminant=void 0;pointsDeterminant=determinant(points[i$1].difference(points[i$1+1]),points[i$1].difference(points[i$1-1]));if(vectorDeterminant<0){rot=-rot}if(vAngle<Math.PI/2&&(rot<0&&pointsDeterminant<0||rot>0&&pointsDeterminant>0)){rot=rot-Math.PI}t=v2.clone();rotateVector(t,rot);var t1=t.clone();var t2=t.clone();var scaleFactor1=distances[i$1-1]*coeff;var scaleFactor2=distances[i$1]*coeff;t1.scale(scaleFactor1,scaleFactor1);t2.scale(scaleFactor2,scaleFactor2);tangents[i$1]=[t1,t2]}for(var i$2=0;i$2<n;i$2++){var p0=void 0;var p3=void 0;if(i$2===0){p0=points[i$2+1].difference(tangents[i$2].x/tau,tangents[i$2].y/tau)}else{p0=points[i$2+1].difference(tangents[i$2][1].x/tau,tangents[i$2][1].y/tau)}if(i$2===n-1){p3=points[i$2].clone().offset(tangents[i$2+1].x/tau,tangents[i$2+1].y/tau)}else{p3=points[i$2].difference(tangents[i$2+1][0].x/tau,tangents[i$2+1][0].y/tau)}catmullRomCurves[i$2]=[p0,points[i$2],points[i$2+1],p3]}return catmullRomCurves}function catmullRomToBezier(points,options){var tau=options.tau;var bcp1=new Point;bcp1.x=points[1].x+(points[2].x-points[0].x)/(6*tau);bcp1.y=points[1].y+(points[2].y-points[0].y)/(6*tau);var bcp2=new Point;bcp2.x=points[2].x+(points[3].x-points[1].x)/(6*tau);bcp2.y=points[2].y+(points[3].y-points[1].y)/(6*tau);return new Curve(points[1],bcp1,bcp2,points[2])}var connectors={jumpover:jumpover,normal:normal$1,rounded:rounded,smooth:smooth,curve:curve};var Flags$1={RENDER:"RENDER",UPDATE:"UPDATE",TOOLS:"TOOLS",LEGACY_TOOLS:"LEGACY_TOOLS",LABELS:"LABELS",VERTICES:"VERTICES",SOURCE:"SOURCE",TARGET:"TARGET",CONNECTOR:"CONNECTOR"};var LinkView=CellView.extend({className:function(){var classNames=CellView.prototype.className.apply(this).split(" ");classNames.push("link");return classNames.join(" ")},options:{shortLinkLength:105,doubleLinkTools:false,longLinkLength:155,linkToolsOffset:40,doubleLinkToolsOffset:65,sampleInterval:50},_labelCache:null,_labelSelectors:null,_markerCache:null,_V:null,_dragData:null,metrics:null,decimalsRounding:2,initialize:function(){CellView.prototype.initialize.apply(this,arguments);this._labelCache={};this._labelSelectors={};this._markerCache={};this._V={};this.cleanNodesCache()},presentationAttributes:{markup:[Flags$1.RENDER],attrs:[Flags$1.UPDATE],router:[Flags$1.UPDATE],connector:[Flags$1.CONNECTOR],smooth:[Flags$1.UPDATE],manhattan:[Flags$1.UPDATE],toolMarkup:[Flags$1.LEGACY_TOOLS],labels:[Flags$1.LABELS],labelMarkup:[Flags$1.LABELS],vertices:[Flags$1.VERTICES,Flags$1.UPDATE],vertexMarkup:[Flags$1.VERTICES],source:[Flags$1.SOURCE,Flags$1.UPDATE],target:[Flags$1.TARGET,Flags$1.UPDATE]},initFlag:[Flags$1.RENDER,Flags$1.SOURCE,Flags$1.TARGET,Flags$1.TOOLS],UPDATE_PRIORITY:1,confirmUpdate:function(flags,opt){opt||(opt={});if(this.hasFlag(flags,Flags$1.SOURCE)){if(!this.updateEndProperties("source")){return flags}flags=this.removeFlag(flags,Flags$1.SOURCE)}if(this.hasFlag(flags,Flags$1.TARGET)){if(!this.updateEndProperties("target")){return flags}flags=this.removeFlag(flags,Flags$1.TARGET)}var ref=this;var paper=ref.paper;var sourceView=ref.sourceView;var targetView=ref.targetView;if(paper&&(sourceView&&!paper.isViewMounted(sourceView)||targetView&&!paper.isViewMounted(targetView))){return flags}if(this.hasFlag(flags,Flags$1.RENDER)){this.render();this.updateHighlighters(true);this.updateTools(opt);flags=this.removeFlag(flags,[Flags$1.RENDER,Flags$1.UPDATE,Flags$1.VERTICES,Flags$1.LABELS,Flags$1.TOOLS,Flags$1.LEGACY_TOOLS,Flags$1.CONNECTOR]);return flags}var updateHighlighters=false;if(this.hasFlag(flags,Flags$1.VERTICES)){this.renderVertexMarkers();flags=this.removeFlag(flags,Flags$1.VERTICES)}var ref$1=this;var model=ref$1.model;var attributes=model.attributes;var updateLabels=this.hasFlag(flags,Flags$1.LABELS);var updateLegacyTools=this.hasFlag(flags,Flags$1.LEGACY_TOOLS);if(updateLabels){this.onLabelsChange(model,attributes.labels,opt);flags=this.removeFlag(flags,Flags$1.LABELS);updateHighlighters=true}if(updateLegacyTools){this.renderTools();flags=this.removeFlag(flags,Flags$1.LEGACY_TOOLS)}var updateAll=this.hasFlag(flags,Flags$1.UPDATE);var updateConnector=this.hasFlag(flags,Flags$1.CONNECTOR);if(updateAll||updateConnector){if(!updateAll){this.updatePath();this.updateDOM()}else if(opt.translateBy&&model.isRelationshipEmbeddedIn(opt.translateBy)){this.translate(opt.tx,opt.ty)}else{this.update()}this.updateTools(opt);flags=this.removeFlag(flags,[Flags$1.UPDATE,Flags$1.TOOLS,Flags$1.CONNECTOR]);updateLabels=false;updateLegacyTools=false;updateHighlighters=true}if(updateLabels){this.updateLabelPositions()}if(updateLegacyTools){this.updateToolsPosition()}if(updateHighlighters){this.updateHighlighters()}if(this.hasFlag(flags,Flags$1.TOOLS)){this.updateTools(opt);flags=this.removeFlag(flags,Flags$1.TOOLS)}return flags},requestConnectionUpdate:function(opt){this.requestUpdate(this.getFlag(Flags$1.UPDATE),opt)},isLabelsRenderRequired:function(opt){if(opt===void 0)opt={};var previousLabels=this.model.previous("labels");if(!previousLabels){return true}if("propertyPathArray"in opt&&"propertyValue"in opt){var pathArray=opt.propertyPathArray||[];var pathLength=pathArray.length;if(pathLength>1){var labelExists=!!previousLabels[pathArray[1]];if(labelExists){if(pathLength===2){return"markup"in Object(opt.propertyValue)}else if(pathArray[2]!=="markup"){return false}}}}return true},onLabelsChange:function(_link,_labels,opt){if(this.isLabelsRenderRequired(opt)){this.renderLabels()}else{this.updateLabels()}},render:function(){this.vel.empty();this.unmountLabels();this._V={};this.renderMarkup();this.renderLabels();this.update();return this},renderMarkup:function(){var link=this.model;var markup=link.get("markup")||link.markup;if(!markup){throw new Error("dia.LinkView: markup required")}if(Array.isArray(markup)){return this.renderJSONMarkup(markup)}if(typeof markup==="string"){return this.renderStringMarkup(markup)}throw new Error("dia.LinkView: invalid markup")},renderJSONMarkup:function(markup){var doc=this.parseDOMJSON(markup,this.el);this.selectors=doc.selectors;this.vel.append(doc.fragment)},renderStringMarkup:function(markup){var children=V(markup);if(!Array.isArray(children)){children=[children]}var cache=this._V;for(var i=0,n=children.length;i<n;i++){var child=children[i];var className=child.attr("class");if(className){className=removeClassNamePrefix(className);cache[$.camelCase(className)]=child}}this.renderTools();this.renderVertexMarkers();this.renderArrowheadMarkers();this.vel.append(children)},_getLabelMarkup:function(labelMarkup){if(!labelMarkup){return undefined}if(Array.isArray(labelMarkup)){return this.parseDOMJSON(labelMarkup,null)}if(typeof labelMarkup==="string"){return this._getLabelStringMarkup(labelMarkup)}throw new Error("dia.linkView: invalid label markup")},_getLabelStringMarkup:function(labelMarkup){var children=V(labelMarkup);var fragment=document.createDocumentFragment();if(!Array.isArray(children)){fragment.appendChild(children.node)}else{for(var i=0,n=children.length;i<n;i++){var currentChild=children[i].node;fragment.appendChild(currentChild)}}return{fragment:fragment,selectors:{}}},_normalizeLabelMarkup:function(markup){if(!markup){return undefined}var fragment=markup.fragment;if(!(markup.fragment instanceof DocumentFragment)||!markup.fragment.hasChildNodes()){throw new Error("dia.LinkView: invalid label markup.")}var vNode;var childNodes=fragment.childNodes;if(childNodes.length>1||childNodes[0].nodeName.toUpperCase()!=="G"){vNode=V("g").append(fragment)}else{vNode=V(childNodes[0])}vNode.addClass("label");return{node:vNode.node,selectors:markup.selectors}},renderLabels:function(){var cache=this._V;var vLabels=cache.labels;var labelCache=this._labelCache={};var labelSelectors=this._labelSelectors={};var model=this.model;var labels=model.attributes.labels||[];var labelsCount=labels.length;if(labelsCount===0){if(vLabels){vLabels.remove()}return this}if(vLabels){vLabels.empty()}else{vLabels=cache.labels=V("g").addClass("labels");if(this.options.labelsLayer){vLabels.addClass(addClassNamePrefix(result(this,"className")));vLabels.attr("model-id",model.id)}}for(var i=0;i<labelsCount;i++){var label=labels[i];var labelMarkup=this._normalizeLabelMarkup(this._getLabelMarkup(label.markup));var labelNode;var selectors;if(labelMarkup){labelNode=labelMarkup.node;selectors=labelMarkup.selectors}else{var builtinDefaultLabel=model._builtins.defaultLabel;var builtinDefaultLabelMarkup=this._normalizeLabelMarkup(this._getLabelMarkup(builtinDefaultLabel.markup));var defaultLabel=model._getDefaultLabel();var defaultLabelMarkup=this._normalizeLabelMarkup(this._getLabelMarkup(defaultLabel.markup));var defaultMarkup=defaultLabelMarkup||builtinDefaultLabelMarkup;labelNode=defaultMarkup.node;selectors=defaultMarkup.selectors}labelNode.setAttribute("label-idx",i);vLabels.append(labelNode);labelCache[i]=labelNode;var rootSelector=this.selector;if(selectors[rootSelector]){throw new Error("dia.LinkView: ambiguous label root selector.")}selectors[rootSelector]=labelNode;labelSelectors[i]=selectors}if(!vLabels.parent()){this.mountLabels()}this.updateLabels();return this},mountLabels:function(){var ref=this;var el=ref.el;var paper=ref.paper;var model=ref.model;var _V=ref._V;var options=ref.options;var vLabels=_V.labels;if(!vLabels||!model.hasLabels()){return}var node=vLabels.node;if(options.labelsLayer){paper.getLayerView(options.labelsLayer).insertSortedNode(node,model.get("z"))}else{if(node.parentNode!==el){el.appendChild(node)}}},unmountLabels:function(){var ref=this;var options=ref.options;var _V=ref._V;if(!_V){return}var vLabels=_V.labels;if(vLabels&&options.labelsLayer){vLabels.remove()}},onMount:function(){this.mountLabels()},unmount:function(){CellView.prototype.unmount.apply(this,arguments);this.unmountLabels()},findLabelNode:function(labelIndex,selector){var labelRoot=this._labelCache[labelIndex];if(!labelRoot){return null}var labelSelectors=this._labelSelectors[labelIndex];var ref=this.findBySelector(selector,labelRoot,labelSelectors);var node=ref[0];if(node===void 0)node=null;return node},_mergeLabelAttrs:function(hasCustomMarkup,labelAttrs,defaultLabelAttrs,builtinDefaultLabelAttrs){if(labelAttrs===null){return null}if(labelAttrs===undefined){if(defaultLabelAttrs===null){return null}if(defaultLabelAttrs===undefined){if(hasCustomMarkup){return undefined}return builtinDefaultLabelAttrs}if(hasCustomMarkup){return defaultLabelAttrs}return merge({},builtinDefaultLabelAttrs,defaultLabelAttrs)}if(hasCustomMarkup){return merge({},defaultLabelAttrs,labelAttrs)}return merge({},builtinDefaultLabelAttrs,defaultLabelAttrs,labelAttrs)},updateLabels:function(){if(!this._V.labels){return this}var model=this.model;var labels=model.get("labels")||[];var canLabelMove=this.can("labelMove");var builtinDefaultLabel=model._builtins.defaultLabel;var builtinDefaultLabelAttrs=builtinDefaultLabel.attrs;var defaultLabel=model._getDefaultLabel();var defaultLabelMarkup=defaultLabel.markup;var defaultLabelAttrs=defaultLabel.attrs;for(var i=0,n=labels.length;i<n;i++){var labelNode=this._labelCache[i];labelNode.setAttribute("cursor",canLabelMove?"move":"default");var selectors=this._labelSelectors[i];var label=labels[i];var labelMarkup=label.markup;var labelAttrs=label.attrs;var attrs=this._mergeLabelAttrs(labelMarkup||defaultLabelMarkup,labelAttrs,defaultLabelAttrs,builtinDefaultLabelAttrs);this.updateDOMSubtreeAttributes(labelNode,attrs,{rootBBox:new Rect(label.size),selectors:selectors})}return this},renderTools:function(){if(!this._V.linkTools){return this}var $tools=$(this._V.linkTools.node).empty();var toolTemplate=template(this.model.get("toolMarkup")||this.model.toolMarkup);var tool=V(toolTemplate());$tools.append(tool.node);this._toolCache=tool;if(this.options.doubleLinkTools){var tool2;if(this.model.get("doubleToolMarkup")||this.model.doubleToolMarkup){toolTemplate=template(this.model.get("doubleToolMarkup")||this.model.doubleToolMarkup);tool2=V(toolTemplate())}else{tool2=tool.clone()}$tools.append(tool2.node);this._tool2Cache=tool2}return this},renderVertexMarkers:function(){if(!this._V.markerVertices){return this}var $markerVertices=$(this._V.markerVertices.node).empty();var markupTemplate=template(this.model.get("vertexMarkup")||this.model.vertexMarkup);this.model.vertices().forEach(function(vertex,idx){$markerVertices.append(V(markupTemplate(assign({idx:idx},vertex))).node)});return this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads){return this}var $markerArrowheads=$(this._V.markerArrowheads.node);$markerArrowheads.empty();var markupTemplate=template(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);this._V.sourceArrowhead=V(markupTemplate({end:"source"}));this._V.targetArrowhead=V(markupTemplate({end:"target"}));$markerArrowheads.append(this._V.sourceArrowhead.node,this._V.targetArrowhead.node);return this},removeRedundantLinearVertices:function(opt){var SIMPLIFY_THRESHOLD=.001;var link=this.model;var vertices=link.vertices();var routePoints=[this.sourceAnchor].concat(vertices,[this.targetAnchor]);var numRoutePoints=routePoints.length;var polyline=new Polyline(routePoints);polyline.simplify({threshold:SIMPLIFY_THRESHOLD});var polylinePoints=polyline.points.map(function(point){return point.toJSON()});var numPolylinePoints=polylinePoints.length;if(numRoutePoints===numPolylinePoints){return 0}link.vertices(polylinePoints.slice(1,numPolylinePoints-1),opt);return numRoutePoints-numPolylinePoints},updateDefaultConnectionPath:function(){var cache=this._V;if(cache.connection){cache.connection.attr("d",this.getSerializedConnection())}if(cache.connectionWrap){cache.connectionWrap.attr("d",this.getSerializedConnection())}if(cache.markerSource&&cache.markerTarget){this._translateAndAutoOrientArrows(cache.markerSource,cache.markerTarget)}},getEndView:function(type){switch(type){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw new Error("dia.LinkView: type parameter required.")}},getEndAnchor:function(type){switch(type){case"source":return new Point(this.sourceAnchor);case"target":return new Point(this.targetAnchor);default:throw new Error("dia.LinkView: type parameter required.")}},getEndConnectionPoint:function(type){switch(type){case"source":return new Point(this.sourcePoint);case"target":return new Point(this.targetPoint);default:throw new Error("dia.LinkView: type parameter required.")}},getEndMagnet:function(type){switch(type){case"source":var sourceView=this.sourceView;if(!sourceView){break}return this.sourceMagnet||sourceView.el;case"target":var targetView=this.targetView;if(!targetView){break}return this.targetMagnet||targetView.el;default:throw new Error("dia.LinkView: type parameter required.")}return null},update:function(){this.updateRoute();this.updatePath();this.updateDOM();return this},translate:function(tx,ty){if(tx===void 0)tx=0;if(ty===void 0)ty=0;var ref=this;var route=ref.route;var path=ref.path;if(!route||!path){return}var polyline=new Polyline(route);polyline.translate(tx,ty);this.route=polyline.points;this._translateConnectionPoints(tx,ty);path.translate(tx,ty);this.updateDOM()},updateDOM:function updateDOM(){var ref=this;var el=ref.el;var model=ref.model;var selectors=ref.selectors;this.cleanNodesCache();this.updateDOMSubtreeAttributes(el,model.attr(),{selectors:selectors});this.updateDefaultConnectionPath();this.updateLabelPositions();this.updateToolsPosition();this.updateArrowheadMarkers();this.options.perpendicular=null},updateRoute:function(){var ref=this;var model=ref.model;var vertices=model.vertices();var anchors=this.findAnchors(vertices);var sourceAnchor=this.sourceAnchor=anchors.source;var targetAnchor=this.targetAnchor=anchors.target;var route=this.findRoute(vertices);this.route=route;var connectionPoints=this.findConnectionPoints(route,sourceAnchor,targetAnchor);this.sourcePoint=connectionPoints.source;this.targetPoint=connectionPoints.target},updatePath:function(){var ref=this;var route=ref.route;var sourcePoint=ref.sourcePoint;var targetPoint=ref.targetPoint;var markerPoints=this.findMarkerPoints(route,sourcePoint,targetPoint);var path=this.findPath(route,markerPoints.source||sourcePoint,markerPoints.target||targetPoint);this.path=path},findMarkerPoints:function(route,sourcePoint,targetPoint){var firstWaypoint=route[0];var lastWaypoint=route[route.length-1];var cache=this._markerCache;var sourceMarkerPoint,targetMarkerPoint;if(this._V.markerSource){cache.sourceBBox=cache.sourceBBox||this._V.markerSource.getBBox();sourceMarkerPoint=Point(sourcePoint).move(firstWaypoint||targetPoint,cache.sourceBBox.width*this._V.markerSource.scale().sx*-1).round()}if(this._V.markerTarget){cache.targetBBox=cache.targetBBox||this._V.markerTarget.getBBox();targetMarkerPoint=Point(targetPoint).move(lastWaypoint||sourcePoint,cache.targetBBox.width*this._V.markerTarget.scale().sx*-1).round()}cache.sourcePoint=sourceMarkerPoint||sourcePoint.clone();cache.targetPoint=targetMarkerPoint||targetPoint.clone();return{source:sourceMarkerPoint,target:targetMarkerPoint}},findAnchorsOrdered:function(firstEndType,firstRef,secondEndType,secondRef){var firstAnchor,secondAnchor;var firstAnchorRef,secondAnchorRef;var model=this.model;var firstDef=model.get(firstEndType);var secondDef=model.get(secondEndType);var firstView=this.getEndView(firstEndType);var secondView=this.getEndView(secondEndType);var firstMagnet=this.getEndMagnet(firstEndType);var secondMagnet=this.getEndMagnet(secondEndType);if(firstView){if(firstRef){firstAnchorRef=new Point(firstRef)}else if(secondView){firstAnchorRef=secondMagnet}else{firstAnchorRef=new Point(secondDef)}firstAnchor=this.getAnchor(firstDef.anchor,firstView,firstMagnet,firstAnchorRef,firstEndType)}else{firstAnchor=new Point(firstDef)}if(secondView){secondAnchorRef=new Point(secondRef||firstAnchor);secondAnchor=this.getAnchor(secondDef.anchor,secondView,secondMagnet,secondAnchorRef,secondEndType)}else{secondAnchor=new Point(secondDef)}var res={};res[firstEndType]=firstAnchor;res[secondEndType]=secondAnchor;return res},findAnchors:function(vertices){var model=this.model;var firstVertex=vertices[0];var lastVertex=vertices[vertices.length-1];if(model.target().priority&&!model.source().priority){return this.findAnchorsOrdered("target",lastVertex,"source",firstVertex)}return this.findAnchorsOrdered("source",firstVertex,"target",lastVertex)},findConnectionPoints:function(route,sourceAnchor,targetAnchor){var firstWaypoint=route[0];var lastWaypoint=route[route.length-1];var model=this.model;var sourceDef=model.get("source");var targetDef=model.get("target");var sourceView=this.sourceView;var targetView=this.targetView;var paperOptions=this.paper.options;var sourceMagnet,targetMagnet;var sourcePoint;if(sourceView&&!sourceView.isNodeConnection(this.sourceMagnet)){sourceMagnet=this.sourceMagnet||sourceView.el;var sourceConnectionPointDef=sourceDef.connectionPoint||paperOptions.defaultConnectionPoint;var sourcePointRef=firstWaypoint||targetAnchor;var sourceLine=new Line(sourcePointRef,sourceAnchor);sourcePoint=this.getConnectionPoint(sourceConnectionPointDef,sourceView,sourceMagnet,sourceLine,"source")}else{sourcePoint=sourceAnchor}var targetPoint;if(targetView&&!targetView.isNodeConnection(this.targetMagnet)){targetMagnet=this.targetMagnet||targetView.el;var targetConnectionPointDef=targetDef.connectionPoint||paperOptions.defaultConnectionPoint;var targetPointRef=lastWaypoint||sourceAnchor;var targetLine=new Line(targetPointRef,targetAnchor);targetPoint=this.getConnectionPoint(targetConnectionPointDef,targetView,targetMagnet,targetLine,"target")}else{targetPoint=targetAnchor}return{source:sourcePoint,target:targetPoint}},getAnchor:function(anchorDef,cellView,magnet,ref,endType){var isConnection=cellView.isNodeConnection(magnet);var paperOptions=this.paper.options;if(!anchorDef){if(isConnection){anchorDef=paperOptions.defaultLinkAnchor}else{if(paperOptions.perpendicularLinks||this.options.perpendicular){anchorDef={name:"perpendicular"}}else{anchorDef=paperOptions.defaultAnchor}}}if(!anchorDef){throw new Error("Anchor required.")}var anchorFn;if(typeof anchorDef==="function"){anchorFn=anchorDef}else{var anchorName=anchorDef.name;var anchorNamespace=isConnection?"linkAnchorNamespace":"anchorNamespace";anchorFn=paperOptions[anchorNamespace][anchorName];if(typeof anchorFn!=="function"){throw new Error("Unknown anchor: "+anchorName)}}var anchor=anchorFn.call(this,cellView,magnet,ref,anchorDef.args||{},endType,this);if(!anchor){return new Point}return anchor.round(this.decimalsRounding)},getConnectionPoint:function(connectionPointDef,view,magnet,line,endType){var connectionPoint;var anchor=line.end;var paperOptions=this.paper.options;if(typeof paperOptions.linkConnectionPoint==="function"){var linkConnectionMagnet=magnet===view.el?undefined:magnet;connectionPoint=paperOptions.linkConnectionPoint(this,view,linkConnectionMagnet,line.start,endType);if(connectionPoint){return connectionPoint}}if(!connectionPointDef){return anchor}var connectionPointFn;if(typeof connectionPointDef==="function"){connectionPointFn=connectionPointDef}else{var connectionPointName=connectionPointDef.name;connectionPointFn=paperOptions.connectionPointNamespace[connectionPointName];if(typeof connectionPointFn!=="function"){throw new Error("Unknown connection point: "+connectionPointName)}}connectionPoint=connectionPointFn.call(this,line,view,magnet,connectionPointDef.args||{},endType,this);if(!connectionPoint){return anchor}return connectionPoint.round(this.decimalsRounding)},_translateConnectionPoints:function(tx,ty){var cache=this._markerCache;cache.sourcePoint.offset(tx,ty);cache.targetPoint.offset(tx,ty);this.sourcePoint.offset(tx,ty);this.targetPoint.offset(tx,ty);this.sourceAnchor.offset(tx,ty);this.targetAnchor.offset(tx,ty)},_normalizeLabelPosition:function(labelPosition){if(typeof labelPosition==="number"){return{distance:labelPosition,offset:null,angle:0,args:null}}return labelPosition},updateLabelPositions:function(){if(!this._V.labels){return this}var path=this.path;if(!path){return this}var model=this.model;var labels=model.get("labels")||[];if(!labels.length){return this}var builtinDefaultLabel=model._builtins.defaultLabel;var builtinDefaultLabelPosition=builtinDefaultLabel.position;var defaultLabel=model._getDefaultLabel();var defaultLabelPosition=this._normalizeLabelPosition(defaultLabel.position);var defaultPosition=merge({},builtinDefaultLabelPosition,defaultLabelPosition);for(var idx=0,n=labels.length;idx<n;idx++){var labelNode=this._labelCache[idx];if(!labelNode){continue}var label=labels[idx];var labelPosition=this._normalizeLabelPosition(label.position);var position=merge({},defaultPosition,labelPosition);var transformationMatrix=this._getLabelTransformationMatrix(position);labelNode.setAttribute("transform",V.matrixToTransformString(transformationMatrix));this._cleanLabelMatrices(idx)}return this},_cleanLabelMatrices:function(index){var ref=this;var metrics=ref.metrics;var _labelSelectors=ref._labelSelectors;var selectors=_labelSelectors[index];if(!selectors){return}for(var selector in selectors){var ref$1=selectors[selector];var id=ref$1.id;if(id&&id in metrics){delete metrics[id].magnetMatrix}}},updateToolsPosition:function(){if(!this._V.linkTools){return this}var scale="";var offset=this.options.linkToolsOffset;var connectionLength=this.getConnectionLength();if(!Number.isNaN(connectionLength)){if(connectionLength<this.options.shortLinkLength){scale="scale(.5)";offset/=2}var toolPosition=this.getPointAtLength(offset);this._toolCache.attr("transform","translate("+toolPosition.x+", "+toolPosition.y+") "+scale);if(this.options.doubleLinkTools&&connectionLength>=this.options.longLinkLength){var doubleLinkToolsOffset=this.options.doubleLinkToolsOffset||offset;toolPosition=this.getPointAtLength(connectionLength-doubleLinkToolsOffset);this._tool2Cache.attr("transform","translate("+toolPosition.x+", "+toolPosition.y+") "+scale);this._tool2Cache.attr("visibility","visible")}else if(this.options.doubleLinkTools){this._tool2Cache.attr("visibility","hidden")}}return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads){return this}if($.css(this._V.markerArrowheads.node,"display")==="none"){return this}var sx=this.getConnectionLength()<this.options.shortLinkLength?.5:1;this._V.sourceArrowhead.scale(sx);this._V.targetArrowhead.scale(sx);this._translateAndAutoOrientArrows(this._V.sourceArrowhead,this._V.targetArrowhead);return this},updateEndProperties:function(endType){var ref=this;var model=ref.model;var paper=ref.paper;var endViewProperty=endType+"View";var endDef=model.get(endType);var endId=endDef&&endDef.id;if(!endId){this[endViewProperty]=null;this.updateEndMagnet(endType);return true}var endModel=paper.getModelById(endId);if(!endModel){throw new Error("LinkView: invalid "+endType+" cell.")}var endView=endModel.findView(paper);if(!endView){return false}this[endViewProperty]=endView;this.updateEndMagnet(endType);return true},updateEndMagnet:function(endType){var endMagnetProperty=endType+"Magnet";var endView=this.getEndView(endType);if(endView){var connectedMagnet=endView.getMagnetFromLinkEnd(this.model.get(endType));if(connectedMagnet===endView.el){connectedMagnet=null}this[endMagnetProperty]=connectedMagnet}else{this[endMagnetProperty]=null}},_translateAndAutoOrientArrows:function(sourceArrow,targetArrow){var route=toArray(this.route);if(sourceArrow){sourceArrow.translateAndAutoOrient(this.sourcePoint,route[0]||this.targetPoint,this.paper.cells)}if(targetArrow){targetArrow.translateAndAutoOrient(this.targetPoint,route[route.length-1]||this.sourcePoint,this.paper.cells)}},_getLabelPositionAngle:function(idx){var labelPosition=this.model.label(idx).position||{};return labelPosition.angle||0},_getLabelPositionArgs:function(idx){var labelPosition=this.model.label(idx).position||{};return labelPosition.args},_getDefaultLabelPositionArgs:function(){var defaultLabel=this.model._getDefaultLabel();var defaultLabelPosition=defaultLabel.position||{};return defaultLabelPosition.args},_mergeLabelPositionArgs:function(labelPositionArgs,defaultLabelPositionArgs){if(labelPositionArgs===null){return null}if(labelPositionArgs===undefined){if(defaultLabelPositionArgs===null){return null}return defaultLabelPositionArgs}return merge({},defaultLabelPositionArgs,labelPositionArgs)},addLabel:function(p1,p2,p3,p4){var localX;var localY;var localAngle=0;var localOpt;if(typeof p1!=="number"){localX=p1.x;localY=p1.y;if(typeof p2==="number"){localAngle=p2;localOpt=p3}else{localOpt=p2}}else{localX=p1;localY=p2;if(typeof p3==="number"){localAngle=p3;localOpt=p4}else{localOpt=p3}}var defaultLabelPositionArgs=this._getDefaultLabelPositionArgs();var labelPositionArgs=localOpt;var positionArgs=this._mergeLabelPositionArgs(labelPositionArgs,defaultLabelPositionArgs);var label={position:this.getLabelPosition(localX,localY,localAngle,positionArgs)};var idx=-1;this.model.insertLabel(idx,label,localOpt);return idx},addVertex:function(x,y,opt){var isPointProvided=typeof x!=="number";var localX=isPointProvided?x.x:x;var localY=isPointProvided?x.y:y;var localOpt=isPointProvided?y:opt;var vertex={x:localX,y:localY};var idx=this.getVertexIndex(localX,localY);this.model.insertVertex(idx,vertex,localOpt);return idx},sendToken:function(token,opt,callback){function onAnimationEnd(vToken,callback){return function(){vToken.remove();if(typeof callback==="function"){callback()}}}var duration,isReversed,selector;if(isObject$1(opt)){duration=opt.duration;isReversed=opt.direction==="reverse";selector=opt.connection}else{duration=opt;isReversed=false;selector=null}duration=duration||1e3;var animationAttributes={dur:duration+"ms",repeatCount:1,calcMode:"linear",fill:"freeze"};if(isReversed){animationAttributes.keyPoints="1;0";animationAttributes.keyTimes="0;1"}var vToken=V(token);var connection;if(typeof selector==="string"){connection=this.findBySelector(selector,this.el,this.selectors)[0]}else{var cache=this._V;connection=cache.connection?cache.connection.node:this.el.querySelector("path")}if(!(connection instanceof SVGPathElement)){throw new Error("dia.LinkView: token animation requires a valid connection path.")}vToken.appendTo(this.paper.cells).animateAlongPath(animationAttributes,connection);setTimeout(onAnimationEnd(vToken,callback),duration)},findRoute:function(vertices){vertices||(vertices=[]);var namespace=this.paper.options.routerNamespace||routers;var router=this.model.router();var defaultRouter=this.paper.options.defaultRouter;if(!router){if(defaultRouter){router=defaultRouter}else{return vertices.map(Point)}}var routerFn=isFunction(router)?router:namespace[router.name];if(!isFunction(routerFn)){throw new Error('dia.LinkView: unknown router: "'+router.name+'".')}var args=router.args||{};var route=routerFn.call(this,vertices,args,this);if(!route){return vertices.map(Point)}return route},findPath:function(route,sourcePoint,targetPoint){var namespace=this.paper.options.connectorNamespace||connectors;var connector=this.model.connector();var defaultConnector=this.paper.options.defaultConnector;if(!connector){connector=defaultConnector||{}}var connectorFn=isFunction(connector)?connector:namespace[connector.name];if(!isFunction(connectorFn)){throw new Error('dia.LinkView: unknown connector: "'+connector.name+'".')}var args=clone(connector.args||{});args.raw=true;var path=connectorFn.call(this,sourcePoint,targetPoint,route,args,this);if(typeof path==="string"){path=new Path(V.normalizePathData(path))}return path},getConnection:function(){var path=this.path;if(!path){return null}return path.clone()},getSerializedConnection:function(){var path=this.path;if(!path){return null}var metrics=this.metrics;if(metrics.hasOwnProperty("data")){return metrics.data}var data=path.serialize();metrics.data=data;return data},getConnectionSubdivisions:function(){var path=this.path;if(!path){return null}var metrics=this.metrics;if(metrics.hasOwnProperty("segmentSubdivisions")){return metrics.segmentSubdivisions}var subdivisions=path.getSegmentSubdivisions();metrics.segmentSubdivisions=subdivisions;return subdivisions},getConnectionLength:function(){var path=this.path;if(!path){return 0}var metrics=this.metrics;if(metrics.hasOwnProperty("length")){return metrics.length}var length=path.length({segmentSubdivisions:this.getConnectionSubdivisions()});metrics.length=length;return length},getPointAtLength:function(length){var path=this.path;if(!path){return null}return path.pointAtLength(length,{segmentSubdivisions:this.getConnectionSubdivisions()})},getPointAtRatio:function(ratio){var path=this.path;if(!path){return null}if(isPercentage(ratio)){ratio=parseFloat(ratio)/100}return path.pointAt(ratio,{segmentSubdivisions:this.getConnectionSubdivisions()})},getTangentAtLength:function(length){var path=this.path;if(!path){return null}return path.tangentAtLength(length,{segmentSubdivisions:this.getConnectionSubdivisions()})},getTangentAtRatio:function(ratio){var path=this.path;if(!path){return null}return path.tangentAt(ratio,{segmentSubdivisions:this.getConnectionSubdivisions()})},getClosestPoint:function(point){var path=this.path;if(!path){return null}return path.closestPoint(point,{segmentSubdivisions:this.getConnectionSubdivisions()})},getClosestPointLength:function(point){var path=this.path;if(!path){return null}return path.closestPointLength(point,{segmentSubdivisions:this.getConnectionSubdivisions()})},getClosestPointRatio:function(point){var path=this.path;if(!path){return null}return path.closestPointNormalizedLength(point,{segmentSubdivisions:this.getConnectionSubdivisions()})},getLabelPosition:function(x,y,p3,p4){var position={};var localAngle=0;var localOpt;if(typeof p3==="number"){localAngle=p3;localOpt=p4}else{localOpt=p3}if(localOpt){position.args=localOpt}var isDistanceRelative=!(localOpt&&localOpt.absoluteDistance);var isDistanceAbsoluteReverse=localOpt&&localOpt.absoluteDistance&&localOpt.reverseDistance;var isOffsetAbsolute=localOpt&&localOpt.absoluteOffset;var path=this.path;var pathOpt={segmentSubdivisions:this.getConnectionSubdivisions()};var labelPoint=new Point(x,y);var t=path.closestPointT(labelPoint,pathOpt);var labelDistance=path.lengthAtT(t,pathOpt);if(isDistanceRelative){labelDistance=labelDistance/this.getConnectionLength()||0}if(isDistanceAbsoluteReverse){labelDistance=-1*(this.getConnectionLength()-labelDistance)||1}position.distance=labelDistance;var tangent;if(!isOffsetAbsolute){tangent=path.tangentAtT(t)}var labelOffset;if(tangent){labelOffset=tangent.pointOffset(labelPoint)}else{var closestPoint=path.pointAtT(t);var labelOffsetDiff=labelPoint.difference(closestPoint);labelOffset={x:labelOffsetDiff.x,y:labelOffsetDiff.y}}position.offset=labelOffset;position.angle=localAngle;return position},_getLabelTransformationMatrix:function(labelPosition){var labelDistance;var labelAngle=0;var args={};if(typeof labelPosition==="number"){labelDistance=labelPosition}else if(typeof labelPosition.distance==="number"){args=labelPosition.args||{};labelDistance=labelPosition.distance;labelAngle=labelPosition.angle||0}else{throw new Error("dia.LinkView: invalid label position distance.")}var isDistanceRelative=labelDistance>0&&labelDistance<=1;var labelOffset=0;var labelOffsetCoordinates={x:0,y:0};if(labelPosition.offset){var positionOffset=labelPosition.offset;if(typeof positionOffset==="number"){labelOffset=positionOffset}if(positionOffset.x){labelOffsetCoordinates.x=positionOffset.x}if(positionOffset.y){labelOffsetCoordinates.y=positionOffset.y}}var isOffsetAbsolute=labelOffsetCoordinates.x!==0||labelOffsetCoordinates.y!==0||labelOffset===0;var isKeepGradient=args.keepGradient;var isEnsureLegibility=args.ensureLegibility;var path=this.path;var pathOpt={segmentSubdivisions:this.getConnectionSubdivisions()};var distance=isDistanceRelative?labelDistance*this.getConnectionLength():labelDistance;var tangent=path.tangentAtLength(distance,pathOpt);var translation;var angle=labelAngle;if(tangent){if(isOffsetAbsolute){translation=tangent.start;translation.offset(labelOffsetCoordinates)}else{var normal=tangent.clone();normal.rotate(tangent.start,-90);normal.setLength(labelOffset);translation=normal.end}if(isKeepGradient){angle=tangent.angle()+labelAngle;if(isEnsureLegibility){angle=normalizeAngle((angle+90)%180-90)}}}else{translation=path.start;if(isOffsetAbsolute){translation.offset(labelOffsetCoordinates)}}return V.createSVGMatrix().translate(translation.x,translation.y).rotate(angle)},getLabelCoordinates:function(labelPosition){var transformationMatrix=this._getLabelTransformationMatrix(labelPosition);return new Point(transformationMatrix.e,transformationMatrix.f)},getVertexIndex:function(x,y){var model=this.model;var vertices=model.vertices();var vertexLength=this.getClosestPointLength(new Point(x,y));var idx=0;for(var n=vertices.length;idx<n;idx++){var currentVertex=vertices[idx];var currentVertexLength=this.getClosestPointLength(currentVertex);if(vertexLength<currentVertexLength){break}}return idx},notifyPointerdown:function notifyPointerdown(evt,x,y){CellView.prototype.pointerdown.call(this,evt,x,y);this.notify("link:pointerdown",evt,x,y)},notifyPointermove:function notifyPointermove(evt,x,y){CellView.prototype.pointermove.call(this,evt,x,y);this.notify("link:pointermove",evt,x,y)},notifyPointerup:function notifyPointerup(evt,x,y){this.notify("link:pointerup",evt,x,y);CellView.prototype.pointerup.call(this,evt,x,y)},pointerdblclick:function(evt,x,y){CellView.prototype.pointerdblclick.apply(this,arguments);this.notify("link:pointerdblclick",evt,x,y)},pointerclick:function(evt,x,y){CellView.prototype.pointerclick.apply(this,arguments);this.notify("link:pointerclick",evt,x,y)},contextmenu:function(evt,x,y){CellView.prototype.contextmenu.apply(this,arguments);this.notify("link:contextmenu",evt,x,y)},pointerdown:function(evt,x,y){this.notifyPointerdown(evt,x,y);var className=evt.target.getAttribute("class");switch(className){case"marker-vertex":this.dragVertexStart(evt,x,y);return;case"marker-vertex-remove":case"marker-vertex-remove-area":this.dragVertexRemoveStart(evt,x,y);return;case"marker-arrowhead":this.dragArrowheadStart(evt,x,y);return;case"connection":case"connection-wrap":this.dragConnectionStart(evt,x,y);return;case"marker-source":case"marker-target":return}this.dragStart(evt,x,y)},pointermove:function(evt,x,y){var dragData=this._dragData;if(dragData){this.eventData(evt,dragData)}var data=this.eventData(evt);switch(data.action){case"vertex-move":this.dragVertex(evt,x,y);break;case"label-move":this.dragLabel(evt,x,y);break;case"arrowhead-move":this.dragArrowhead(evt,x,y);break;case"move":this.drag(evt,x,y);break}if(dragData){assign(dragData,this.eventData(evt))}this.notifyPointermove(evt,x,y)},pointerup:function(evt,x,y){var dragData=this._dragData;if(dragData){this.eventData(evt,dragData);this._dragData=null}var data=this.eventData(evt);switch(data.action){case"vertex-move":this.dragVertexEnd(evt,x,y);break;case"label-move":this.dragLabelEnd(evt,x,y);break;case"arrowhead-move":this.dragArrowheadEnd(evt,x,y);break;case"move":this.dragEnd(evt,x,y)}this.notifyPointerup(evt,x,y);this.checkMouseleave(evt)},mouseover:function(evt){CellView.prototype.mouseover.apply(this,arguments);this.notify("link:mouseover",evt)},mouseout:function(evt){CellView.prototype.mouseout.apply(this,arguments);this.notify("link:mouseout",evt)},mouseenter:function(evt){CellView.prototype.mouseenter.apply(this,arguments);this.notify("link:mouseenter",evt)},mouseleave:function(evt){CellView.prototype.mouseleave.apply(this,arguments);this.notify("link:mouseleave",evt)},mousewheel:function(evt,x,y,delta){CellView.prototype.mousewheel.apply(this,arguments);this.notify("link:mousewheel",evt,x,y,delta)},onevent:function(evt,eventName,x,y){var linkTool=V(evt.target).findParentByClass("link-tool",this.el);if(linkTool){evt.stopPropagation();if(this.can("useLinkTools")){if(eventName==="remove"){this.model.remove({ui:true});return}else{this.notify(eventName,evt,x,y)}}this.notifyPointerdown(evt,x,y);this.paper.delegateDragEvents(this,evt.data)}else{CellView.prototype.onevent.apply(this,arguments)}},onlabel:function(evt,x,y){this.notifyPointerdown(evt,x,y);this.dragLabelStart(evt,x,y);var stopPropagation=this.eventData(evt).stopPropagation;if(stopPropagation){evt.stopPropagation()}},dragConnectionStart:function(evt,x,y){if(!this.can("vertexAdd")){return}var vertexIdx=this.addVertex({x:x,y:y},{ui:true});this.eventData(evt,{action:"vertex-move",vertexIdx:vertexIdx})},dragLabelStart:function(evt,_x,_y){if(this.can("labelMove")){var labelNode=evt.currentTarget;var labelIdx=parseInt(labelNode.getAttribute("label-idx"),10);var positionAngle=this._getLabelPositionAngle(labelIdx);var labelPositionArgs=this._getLabelPositionArgs(labelIdx);var defaultLabelPositionArgs=this._getDefaultLabelPositionArgs();var positionArgs=this._mergeLabelPositionArgs(labelPositionArgs,defaultLabelPositionArgs);this.eventData(evt,{action:"label-move",labelIdx:labelIdx,positionAngle:positionAngle,positionArgs:positionArgs,stopPropagation:true})}else{this.eventData(evt,{stopPropagation:true})}this.paper.delegateDragEvents(this,evt.data)},dragVertexStart:function(evt,x,y){if(!this.can("vertexMove")){return}var vertexNode=evt.target;var vertexIdx=parseInt(vertexNode.getAttribute("idx"),10);this.eventData(evt,{action:"vertex-move",vertexIdx:vertexIdx})},dragVertexRemoveStart:function(evt,x,y){if(!this.can("vertexRemove")){return}var removeNode=evt.target;var vertexIdx=parseInt(removeNode.getAttribute("idx"),10);this.model.removeVertex(vertexIdx)},dragArrowheadStart:function(evt,x,y){if(!this.can("arrowheadMove")){return}var arrowheadNode=evt.target;var arrowheadType=arrowheadNode.getAttribute("end");var data=this.startArrowheadMove(arrowheadType,{ignoreBackwardsCompatibility:true});this.eventData(evt,data)},dragStart:function(evt,x,y){if(!this.can("linkMove")){return}this.eventData(evt,{action:"move",dx:x,dy:y})},dragLabel:function(evt,x,y){var data=this.eventData(evt);var label={position:this.getLabelPosition(x,y,data.positionAngle,data.positionArgs)};if(this.paper.options.snapLabels){delete label.position.offset}this.model.label(data.labelIdx,label)},dragVertex:function(evt,x,y){var data=this.eventData(evt);this.model.vertex(data.vertexIdx,{x:x,y:y},{ui:true})},dragArrowhead:function(evt,x,y){if(this.paper.options.snapLinks){var isSnapped=this._snapArrowhead(evt,x,y);if(!isSnapped&&this.paper.options.snapLinksSelf){this._snapArrowheadSelf(evt,x,y)}}else{if(this.paper.options.snapLinksSelf){this._snapArrowheadSelf(evt,x,y)}else{this._connectArrowhead(this.getEventTarget(evt),x,y,this.eventData(evt))}}},drag:function(evt,x,y){var data=this.eventData(evt);this.model.translate(x-data.dx,y-data.dy,{ui:true});this.eventData(evt,{dx:x,dy:y})},dragLabelEnd:function(){},dragVertexEnd:function(){},dragArrowheadEnd:function(evt,x,y){var data=this.eventData(evt);var paper=this.paper;if(paper.options.snapLinks){this._snapArrowheadEnd(data)}else{this._connectArrowheadEnd(data,x,y)}if(!paper.linkAllowed(this)){this._disallow(data)}else{this._finishEmbedding(data);this._notifyConnectEvent(data,evt)}this._afterArrowheadMove(data)},dragEnd:function(){},_disallow:function(data){switch(data.whenNotAllowed){case"remove":this.model.remove({ui:true});break;case"revert":default:this.model.set(data.arrowhead,data.initialEnd,{ui:true});break}},_finishEmbedding:function(data){if(this.paper.options.embeddingMode&&this.model.reparent()){data.z=null}},_notifyConnectEvent:function(data,evt){var arrowhead=data.arrowhead;var initialEnd=data.initialEnd;var currentEnd=this.model.prop(arrowhead);var endChanged=currentEnd&&!Link.endsEqual(initialEnd,currentEnd);if(endChanged){var paper=this.paper;if(initialEnd.id){this.notify("link:disconnect",evt,paper.findViewByModel(initialEnd.id),data.initialMagnet,arrowhead)}if(currentEnd.id){this.notify("link:connect",evt,paper.findViewByModel(currentEnd.id),data.magnetUnderPointer,arrowhead)}}},_snapToPoints:function(snapPoint,points,radius){var closestPointX=null;var closestDistanceX=Infinity;var closestPointY=null;var closestDistanceY=Infinity;var x=snapPoint.x;var y=snapPoint.y;for(var i=0;i<points.length;i++){var distX=Math.abs(points[i].x-snapPoint.x);if(distX<closestDistanceX){closestDistanceX=distX;closestPointX=points[i]}var distY=Math.abs(points[i].y-snapPoint.y);if(distY<closestDistanceY){closestDistanceY=distY;closestPointY=points[i]}}if(closestDistanceX<radius){x=closestPointX.x}if(closestDistanceY<radius){y=closestPointY.y}return{x:x,y:y}},_snapArrowheadSelf:function(evt,x,y){var ref=this;var paper=ref.paper;var model=ref.model;var ref$1=paper.options;var snapLinksSelf=ref$1.snapLinksSelf;var data=this.eventData(evt);var radius=snapLinksSelf.radius||20;var anchor=this.getEndAnchor(data.arrowhead==="source"?"target":"source");var vertices=model.vertices();var points=[anchor].concat(vertices);var snapPoint=this._snapToPoints({x:x,y:y},points,radius);this._connectArrowhead(document.elementFromPoint(snapPoint.x,snapPoint.y),snapPoint.x,snapPoint.y,this.eventData(evt))},_snapArrowhead:function(evt,x,y){var ref=this;var paper=ref.paper;var ref$1=paper.options;var snapLinks=ref$1.snapLinks;var connectionStrategy=ref$1.connectionStrategy;var data=this.eventData(evt);var isSnapped=false;var r=snapLinks.radius||50;var viewsInArea=paper.findViewsInArea({x:x-r,y:y-r,width:2*r,height:2*r});var prevClosestView=data.closestView||null;var prevClosestMagnet=data.closestMagnet||null;var prevMagnetProxy=data.magnetProxy||null;data.closestView=data.closestMagnet=data.magnetProxy=null;var minDistance=Number.MAX_VALUE;var pointer=new Point(x,y);viewsInArea.forEach(function(view){var candidates=[];if(view.el.getAttribute("magnet")!=="false"){candidates.push({bbox:view.model.getBBox(),magnet:view.el})}view.$("[magnet]").toArray().forEach(function(magnet){candidates.push({bbox:view.getNodeBBox(magnet),magnet:magnet})});candidates.forEach(function(candidate){var magnet=candidate.magnet;var bbox=candidate.bbox;var distance=bbox.center().squaredDistance(pointer);if(distance<minDistance){var isAlreadyValidated=prevClosestMagnet===magnet;if(isAlreadyValidated||paper.options.validateConnection.apply(paper,data.validateConnectionArgs(view,view.el===magnet?null:magnet))){minDistance=distance;data.closestView=view;data.closestMagnet=magnet}}})},this);var end;var magnetProxy=null;var closestView=data.closestView;var closestMagnet=data.closestMagnet;if(closestMagnet){magnetProxy=data.magnetProxy=closestView.findProxyNode(closestMagnet,"highlighter")}var endType=data.arrowhead;var newClosestMagnet=prevClosestMagnet!==closestMagnet;if(prevClosestView&&newClosestMagnet){prevClosestView.unhighlight(prevMagnetProxy,{connecting:true,snapping:true})}if(closestView){var prevEnd=data.prevEnd;var prevX=data.prevX;var prevY=data.prevY;data.prevX=x;data.prevY=y;isSnapped=true;if(!newClosestMagnet){if(typeof connectionStrategy!=="function"||prevX===x&&prevY===y){return isSnapped}}end=closestView.getLinkEnd(closestMagnet,x,y,this.model,endType);if(!newClosestMagnet&&isEqual(prevEnd,end)){return isSnapped}data.prevEnd=end;if(newClosestMagnet){closestView.highlight(magnetProxy,{connecting:true,snapping:true})}}else{end={x:x,y:y}}this.model.set(endType,end||{x:x,y:y},{ui:true});if(prevClosestView){this.notify("link:snap:disconnect",evt,prevClosestView,prevClosestMagnet,endType)}if(closestView){this.notify("link:snap:connect",evt,closestView,closestMagnet,endType)}return isSnapped},_snapArrowheadEnd:function(data){var closestView=data.closestView;var closestMagnet=data.closestMagnet;if(closestView&&closestMagnet){closestView.unhighlight(data.magnetProxy,{connecting:true,snapping:true});data.magnetUnderPointer=closestView.findMagnet(closestMagnet)}data.closestView=data.closestMagnet=null},_connectArrowhead:function(target,x,y,data){var ref=this;var paper=ref.paper;var model=ref.model;if(data.eventTarget!==target){if(data.magnetProxy){data.viewUnderPointer.unhighlight(data.magnetProxy,{connecting:true})}var viewUnderPointer=data.viewUnderPointer=paper.findView(target);if(viewUnderPointer){var magnetUnderPointer=data.magnetUnderPointer=viewUnderPointer.findMagnet(target);var magnetProxy=data.magnetProxy=viewUnderPointer.findProxyNode(magnetUnderPointer,"highlighter");if(magnetUnderPointer&&this.paper.options.validateConnection.apply(paper,data.validateConnectionArgs(viewUnderPointer,magnetUnderPointer))){if(magnetProxy){viewUnderPointer.highlight(magnetProxy,{connecting:true})}}else{data.magnetUnderPointer=null;data.magnetProxy=null}}else{data.magnetUnderPointer=null;data.magnetProxy=null}}data.eventTarget=target;model.set(data.arrowhead,{x:x,y:y},{ui:true})},_connectArrowheadEnd:function(data,x,y){if(data===void 0)data={};var ref=this;var model=ref.model;var viewUnderPointer=data.viewUnderPointer;var magnetUnderPointer=data.magnetUnderPointer;var magnetProxy=data.magnetProxy;var arrowhead=data.arrowhead;if(!magnetUnderPointer||!magnetProxy||!viewUnderPointer){return}viewUnderPointer.unhighlight(magnetProxy,{connecting:true});var end=viewUnderPointer.getLinkEnd(magnetUnderPointer,x,y,model,arrowhead);model.set(arrowhead,end,{ui:true})},_beforeArrowheadMove:function(data){data.z=this.model.get("z");this.model.toFront();var style=this.el.style;data.pointerEvents=style.pointerEvents;style.pointerEvents="none";if(this.paper.options.markAvailable){this._markAvailableMagnets(data)}},_afterArrowheadMove:function(data){if(data.z!==null){this.model.set("z",data.z,{ui:true});data.z=null}this.el.style.pointerEvents=data.pointerEvents;if(this.paper.options.markAvailable){this._unmarkAvailableMagnets(data)}},_createValidateConnectionArgs:function(arrowhead){var args=[];args[4]=arrowhead;args[5]=this;var oppositeArrowhead;var i=0;var j=0;if(arrowhead==="source"){i=2;oppositeArrowhead="target"}else{j=2;oppositeArrowhead="source"}var end=this.model.get(oppositeArrowhead);if(end.id){var view=args[i]=this.paper.findViewByModel(end.id);var magnet=view.getMagnetFromLinkEnd(end);if(magnet===view.el){magnet=undefined}args[i+1]=magnet}function validateConnectionArgs(cellView,magnet){args[j]=cellView;args[j+1]=cellView.el===magnet?undefined:magnet;return args}return validateConnectionArgs},_markAvailableMagnets:function(data){function isMagnetAvailable(view,magnet){var paper=view.paper;var validate=paper.options.validateConnection;return validate.apply(paper,this.validateConnectionArgs(view,magnet))}var paper=this.paper;var elements=paper.model.getCells();data.marked={};for(var i=0,n=elements.length;i<n;i++){var view=elements[i].findView(paper);if(!view){continue}var magnets=Array.prototype.slice.call(view.el.querySelectorAll("[magnet]"));if(view.el.getAttribute("magnet")!=="false"){magnets.push(view.el)}var availableMagnets=magnets.filter(isMagnetAvailable.bind(data,view));if(availableMagnets.length>0){for(var j=0,m=availableMagnets.length;j<m;j++){view.highlight(availableMagnets[j],{magnetAvailability:true})}view.highlight(null,{elementAvailability:true});data.marked[view.model.id]=availableMagnets}}},_unmarkAvailableMagnets:function(data){var markedKeys=Object.keys(data.marked);var id;var markedMagnets;for(var i=0,n=markedKeys.length;i<n;i++){id=markedKeys[i];markedMagnets=data.marked[id];var view=this.paper.findViewByModel(id);if(view){for(var j=0,m=markedMagnets.length;j<m;j++){view.unhighlight(markedMagnets[j],{magnetAvailability:true})}view.unhighlight(null,{elementAvailability:true})}}data.marked=null},startArrowheadMove:function(end,opt){opt||(opt={});var data={action:"arrowhead-move",arrowhead:end,whenNotAllowed:opt.whenNotAllowed||"revert",initialMagnet:this[end+"Magnet"]||(this[end+"View"]?this[end+"View"].el:null),initialEnd:clone(this.model.get(end)),validateConnectionArgs:this._createValidateConnectionArgs(end)};this._beforeArrowheadMove(data);if(opt.ignoreBackwardsCompatibility!==true){this._dragData=data}return data},onRemove:function(){CellView.prototype.onRemove.apply(this,arguments);this.unmountLabels()}},{Flags:Flags$1});Object.defineProperty(LinkView.prototype,"sourceBBox",{enumerable:true,get:function(){var sourceView=this.sourceView;if(!sourceView){var sourceDef=this.model.source();return new Rect(sourceDef.x,sourceDef.y)}var sourceMagnet=this.sourceMagnet;if(sourceView.isNodeConnection(sourceMagnet)){return new Rect(this.sourceAnchor)}return sourceView.getNodeBBox(sourceMagnet||sourceView.el)}});Object.defineProperty(LinkView.prototype,"targetBBox",{enumerable:true,get:function(){var targetView=this.targetView;if(!targetView){var targetDef=this.model.target();return new Rect(targetDef.x,targetDef.y)}var targetMagnet=this.targetMagnet;if(targetView.isNodeConnection(targetMagnet)){return new Rect(this.targetAnchor)}return targetView.getNodeBBox(targetMagnet||targetView.el)}});var stroke=HighlighterView.extend({tagName:"path",className:"highlight-stroke",attributes:{"pointer-events":"none","vector-effect":"non-scaling-stroke",fill:"none"},options:{padding:3,rx:0,ry:0,useFirstSubpath:false,attrs:{"stroke-width":3,stroke:"#FEB663"}},getPathData:function getPathData(cellView,node){var ref=this;var options=ref.options;var useFirstSubpath=options.useFirstSubpath;var d;try{var vNode=V(node);d=vNode.convertToPathData().trim();if(vNode.tagName()==="PATH"&&useFirstSubpath){var secondSubpathIndex=d.search(/.M/i)+1;if(secondSubpathIndex>0){d=d.substr(0,secondSubpathIndex)}}}catch(error){var nodeBBox=cellView.getNodeBoundingRect(node);d=V.rectToPath(assign({},options,nodeBBox.toJSON()))}return d},highlightConnection:function highlightConnection(cellView){this.vel.attr("d",cellView.getSerializedConnection())},highlightNode:function highlightNode(cellView,node){var ref=this;var vel=ref.vel;var options=ref.options;var padding=options.padding;var layer=options.layer;var highlightMatrix=this.getNodeMatrix(cellView,node);if(padding){if(!layer&&node===cellView.el){vel.remove()}var nodeBBox=cellView.getNodeBoundingRect(node);var cx=nodeBBox.x+nodeBBox.width/2;var cy=nodeBBox.y+nodeBBox.height/2;nodeBBox=V.transformRect(nodeBBox,highlightMatrix);var width=Math.max(nodeBBox.width,1);var height=Math.max(nodeBBox.height,1);var sx=(width+padding)/width;var sy=(height+padding)/height;var paddingMatrix=V.createSVGMatrix({a:sx,b:0,c:0,d:sy,e:cx-sx*cx,f:cy-sy*cy});highlightMatrix=highlightMatrix.multiply(paddingMatrix)}vel.attr({d:this.getPathData(cellView,node),transform:V.matrixToTransformString(highlightMatrix)})},highlight:function highlight(cellView,node){var ref=this;var vel=ref.vel;var options=ref.options;vel.attr(options.attrs);if(cellView.isNodeConnection(node)){this.highlightConnection(cellView)}else{this.highlightNode(cellView,node)}}});var MASK_CLIP=20;function forEachDescendant(vel,fn){var descendants=vel.children();while(descendants.length>0){var descendant=descendants.shift();if(fn(descendant)){descendants.push.apply(descendants,descendant.children())}}}var mask=HighlighterView.extend({tagName:"rect",className:"highlight-mask",attributes:{"pointer-events":"none"},options:{padding:3,maskClip:MASK_CLIP,deep:false,attrs:{stroke:"#FEB663","stroke-width":3,"stroke-linecap":"butt","stroke-linejoin":"miter"}},VISIBLE:"white",INVISIBLE:"black",MASK_ROOT_ATTRIBUTE_BLACKLIST:["marker-start","marker-end","marker-mid","transform","stroke-dasharray"],MASK_CHILD_ATTRIBUTE_BLACKLIST:["stroke","fill","stroke-width","stroke-opacity","stroke-dasharray","fill-opacity","marker-start","marker-end","marker-mid"],MASK_REPLACE_TAGS:["FOREIGNOBJECT","IMAGE","USE","TEXT","TSPAN","TEXTPATH"],MASK_REMOVE_TAGS:["TEXT","TSPAN","TEXTPATH"],transformMaskChild:function transformMaskChild(cellView,childEl){var ref=this;var MASK_CHILD_ATTRIBUTE_BLACKLIST=ref.MASK_CHILD_ATTRIBUTE_BLACKLIST;var MASK_REPLACE_TAGS=ref.MASK_REPLACE_TAGS;var MASK_REMOVE_TAGS=ref.MASK_REMOVE_TAGS;var childTagName=childEl.tagName();if(!V.isSVGGraphicsElement(childEl)||MASK_REMOVE_TAGS.includes(childTagName)){childEl.remove();return false}if(MASK_REPLACE_TAGS.includes(childTagName)){var originalChild=cellView.vel.findOne("#"+childEl.id);if(originalChild){var originalNode=originalChild.node;var childBBox=cellView.getNodeBoundingRect(originalNode);if(cellView.model.isElement()){childBBox=V.transformRect(childBBox,cellView.getNodeMatrix(originalNode))}var replacement=V("rect",childBBox.toJSON());var ref$1=childBBox.center();var ox=ref$1.x;var oy=ref$1.y;var ref$2=originalChild.rotate();var angle=ref$2.angle;var cx=ref$2.cx;if(cx===void 0)cx=ox;var cy=ref$2.cy;if(cy===void 0)cy=oy;if(angle){replacement.rotate(angle,cx,cy)}childEl.parent().append(replacement)}childEl.remove();return false}MASK_CHILD_ATTRIBUTE_BLACKLIST.forEach(function(attrName){if(attrName==="fill"&&childEl.attr("fill")==="none"){return}childEl.removeAttr(attrName)});return true},transformMaskRoot:function transformMaskRoot(_cellView,rootEl){var ref=this;var MASK_ROOT_ATTRIBUTE_BLACKLIST=ref.MASK_ROOT_ATTRIBUTE_BLACKLIST;MASK_ROOT_ATTRIBUTE_BLACKLIST.forEach(function(attrName){rootEl.removeAttr(attrName)})},getMaskShape:function getMaskShape(cellView,vel){var this$1=this;var ref=this;var options=ref.options;var MASK_REPLACE_TAGS=ref.MASK_REPLACE_TAGS;var deep=options.deep;var tagName=vel.tagName();var maskRoot;if(tagName==="G"){if(!deep){return null}maskRoot=vel.clone();forEachDescendant(maskRoot,function(maskChild){return this$1.transformMaskChild(cellView,maskChild)})}else{if(MASK_REPLACE_TAGS.includes(tagName)){return null}maskRoot=vel.clone()}this.transformMaskRoot(cellView,maskRoot);return maskRoot},getMaskId:function getMaskId(){return"highlight-mask-"+this.cid},getMask:function getMask(cellView,vNode){var ref=this;var VISIBLE=ref.VISIBLE;var INVISIBLE=ref.INVISIBLE;var options=ref.options;var padding=options.padding;var attrs=options.attrs;var strokeWidth="stroke-width"in attrs?attrs["stroke-width"]:1;var hasNodeFill=vNode.attr("fill")!=="none";var magnetStrokeWidth=parseFloat(vNode.attr("stroke-width"));if(isNaN(magnetStrokeWidth)){magnetStrokeWidth=1}var minStrokeWidth=magnetStrokeWidth+padding*2;var maxStrokeWidth=minStrokeWidth+strokeWidth*2;var maskEl=this.getMaskShape(cellView,vNode);if(!maskEl){var nodeBBox=cellView.getNodeBoundingRect(vNode.node);nodeBBox.inflate(nodeBBox.width?0:.5,nodeBBox.height?0:.5);maskEl=V("rect",nodeBBox.toJSON())}maskEl.attr(attrs);return V("mask",{id:this.getMaskId()}).append([maskEl.clone().attr({fill:hasNodeFill?VISIBLE:"none",stroke:VISIBLE,"stroke-width":maxStrokeWidth}),maskEl.clone().attr({fill:hasNodeFill?INVISIBLE:"none",stroke:INVISIBLE,"stroke-width":minStrokeWidth})])},removeMask:function removeMask(paper){var maskNode=paper.svg.getElementById(this.getMaskId());if(maskNode){paper.defs.removeChild(maskNode)}},addMask:function addMask(paper,maskEl){paper.defs.appendChild(maskEl.node)},highlight:function highlight(cellView,node){var ref=this;var options=ref.options;var vel=ref.vel;var padding=options.padding;var attrs=options.attrs;var maskClip=options.maskClip;if(maskClip===void 0)maskClip=MASK_CLIP;var layer=options.layer;var color="stroke"in attrs?attrs["stroke"]:"#000000";if(!layer&&node===cellView.el){vel.remove()}var highlighterBBox=cellView.getNodeBoundingRect(node).inflate(padding+maskClip);var highlightMatrix=this.getNodeMatrix(cellView,node);var maskEl=this.getMask(cellView,V(node));this.addMask(cellView.paper,maskEl);vel.attr(highlighterBBox.toJSON());vel.attr({transform:V.matrixToTransformString(highlightMatrix),mask:"url(#"+maskEl.id+")",fill:color})},unhighlight:function unhighlight(cellView){this.removeMask(cellView.paper)}});var opacity=HighlighterView.extend({UPDATABLE:false,MOUNTABLE:false,opacityClassName:addClassNamePrefix("highlight-opacity"),highlight:function(_cellView,node){V(node).addClass(this.opacityClassName)},unhighlight:function(_cellView,node){V(node).removeClass(this.opacityClassName)}});var className=addClassNamePrefix("highlighted");var addClass=HighlighterView.extend({UPDATABLE:false,MOUNTABLE:false,options:{className:className},highlight:function(_cellView,node){V(node).addClass(this.options.className)},unhighlight:function(_cellView,node){V(node).removeClass(this.options.className)}},{className:className});var Directions$1={ROW:"row",COLUMN:"column"};var list=HighlighterView.extend({tagName:"g",MOUNTABLE:true,UPDATE_ATTRIBUTES:function(){return[this.options.attribute]},_prevItems:null,highlight:function highlight(elementView,node){var this$1=this;var element=elementView.model;var ref=this.options;var attribute=ref.attribute;var size=ref.size;if(size===void 0)size=20;var gap=ref.gap;if(gap===void 0)gap=5;var direction=ref.direction;if(direction===void 0)direction=Directions$1.ROW;if(!attribute){throw new Error("List: attribute is required")}var normalizedSize=typeof size==="number"?{width:size,height:size}:size;var isRowDirection=direction===Directions$1.ROW;var itemWidth=isRowDirection?normalizedSize.width:normalizedSize.height;var items=element.get(attribute);if(!Array.isArray(items)){items=[]}var prevItems=this._prevItems||[];var comparison=items.map(function(item,index){return isEqual(prevItems[index],items[index])});if(prevItems.length!==items.length||comparison.some(function(unchanged){return!unchanged})){var prevEls=this.vel.children();var itemsEls=items.map(function(item,index){var prevEl=index in prevEls?prevEls[index].node:null;if(comparison[index]){return prevEl}var itemEl=this$1.createListItem(item,normalizedSize,prevEl);if(!itemEl){return null}if(!(itemEl instanceof SVGElement)){throw new Error("List: item must be an SVGElement")}itemEl.dataset.index=index;itemEl.dataset.attribute=attribute;var offset=index*(itemWidth+gap);itemEl.setAttribute("transform",isRowDirection?"translate("+offset+", 0)":"translate(0, "+offset+")");return itemEl});this.vel.empty().append(itemsEls);this._prevItems=items}var itemsCount=items.length;var length=itemsCount===0?0:itemsCount*itemWidth+(itemsCount-1)*gap;var listSize=isRowDirection?{width:length,height:normalizedSize.height}:{width:normalizedSize.width,height:length};this.position(element,listSize)},position:function position(element,listSize){var ref=this;var vel=ref.vel;var options=ref.options;var margin=options.margin;if(margin===void 0)margin=5;var position=options.position;if(position===void 0)position="top-left";var ref$1=element.size();var width=ref$1.width;var height=ref$1.height;var ref$2=normalizeSides(margin);var left=ref$2.left;var right=ref$2.right;var top=ref$2.top;var bottom=ref$2.bottom;var bbox=new Rect(left,top,width-(left+right),height-(top+bottom));var ref$3=getRectPoint(bbox,position);var x=ref$3.x;var y=ref$3.y;switch(position){case Positions.CENTER:case Positions.TOP:case Positions.BOTTOM:{x-=listSize.width/2;break}case Positions.RIGHT:case Positions.BOTTOM_RIGHT:case Positions.TOP_RIGHT:{x-=listSize.width;break}}switch(position){case Positions.CENTER:case Positions.RIGHT:case Positions.LEFT:{y-=listSize.height/2;break}case Positions.BOTTOM:case Positions.BOTTOM_RIGHT:case Positions.BOTTOM_LEFT:{y-=listSize.height;break}}vel.attr("transform","translate("+x+", "+y+")")}},{Directions:Directions$1,Positions:Positions});var highlighters={stroke:stroke,mask:mask,opacity:opacity,addClass:addClass,list:list};function connectionRatio(view,_magnet,_refPoint,opt){var ratio="ratio"in opt?opt.ratio:.5;return view.getPointAtRatio(ratio)}function connectionLength(view,_magnet,_refPoint,opt){var length="length"in opt?opt.length:20;return view.getPointAtLength(length)}function _connectionPerpendicular(view,_magnet,refPoint,opt){var OFFSET=1e6;var path=view.getConnection();var segmentSubdivisions=view.getConnectionSubdivisions();var verticalLine=new Line(refPoint.clone().offset(0,OFFSET),refPoint.clone().offset(0,-OFFSET));var horizontalLine=new Line(refPoint.clone().offset(OFFSET,0),refPoint.clone().offset(-OFFSET,0));var verticalIntersections=verticalLine.intersect(path,{segmentSubdivisions:segmentSubdivisions});var horizontalIntersections=horizontalLine.intersect(path,{segmentSubdivisions:segmentSubdivisions});var intersections=[];if(verticalIntersections){Array.prototype.push.apply(intersections,verticalIntersections)}if(horizontalIntersections){Array.prototype.push.apply(intersections,horizontalIntersections)}if(intersections.length>0){return refPoint.chooseClosest(intersections)}if("fallbackAt"in opt){return getPointAtLink(view,opt.fallbackAt)}return connectionClosest(view,_magnet,refPoint,opt)}function _connectionClosest(view,_magnet,refPoint,_opt){var closestPoint=view.getClosestPoint(refPoint);if(!closestPoint){return new Point}return closestPoint}function resolveRef(fn){return function(view,magnet,ref,opt){if(ref instanceof Element){var refView=this.paper.findView(ref);var refPoint;if(refView){if(refView.isNodeConnection(ref)){var distance="fixedAt"in opt?opt.fixedAt:"50%";refPoint=getPointAtLink(refView,distance)}else{refPoint=refView.getNodeBBox(ref).center()}}else{refPoint=new Point}return fn.call(this,view,magnet,refPoint,opt)}return fn.apply(this,arguments)}}function getPointAtLink(view,value){var parsedValue=parseFloat(value);if(isPercentage(value)){return view.getPointAtRatio(parsedValue/100)}else{return view.getPointAtLength(parsedValue)}}var connectionPerpendicular=resolveRef(_connectionPerpendicular);var connectionClosest=resolveRef(_connectionClosest);var linkAnchors={resolveRef:resolveRef,connectionRatio:connectionRatio,connectionLength:connectionLength,connectionPerpendicular:connectionPerpendicular,connectionClosest:connectionClosest};function offsetPoint(p1,p2,offset){if(isPlainObject(offset)){var x=offset.x;var y=offset.y;if(isFinite(y)){var line=new Line(p2,p1);var ref=line.parallel(y);var start=ref.start;var end=ref.end;p2=start;p1=end}offset=x}if(!isFinite(offset)){return p1}var length=p1.distance(p2);if(offset===0&&length>0){return p1}return p1.move(p2,-Math.min(offset,length-1))}function stroke$1(magnet){var stroke=magnet.getAttribute("stroke-width");if(stroke===null){return 0}return parseFloat(stroke)||0}function alignLine(line,type,offset){if(offset===void 0)offset=0;var coordinate,a,b,direction;var start=line.start;var end=line.end;switch(type){case"left":coordinate="x";a=end;b=start;direction=-1;break;case"right":coordinate="x";a=start;b=end;direction=1;break;case"top":coordinate="y";a=end;b=start;direction=-1;break;case"bottom":coordinate="y";a=start;b=end;direction=1;break;default:return}if(start[coordinate]<end[coordinate]){a[coordinate]=b[coordinate]}else{b[coordinate]=a[coordinate]}if(isFinite(offset)){a[coordinate]+=direction*offset;b[coordinate]+=direction*offset}}function anchorConnectionPoint(line,_view,_magnet,opt){var offset=opt.offset;var alignOffset=opt.alignOffset;var align=opt.align;if(align){alignLine(line,align,alignOffset)}return offsetPoint(line.end,line.start,offset)}function bboxIntersection(line,view,magnet,opt){var bbox=view.getNodeBBox(magnet);if(opt.stroke){bbox.inflate(stroke$1(magnet)/2)}var intersections=line.intersect(bbox);var cp=intersections?line.start.chooseClosest(intersections):line.end;return offsetPoint(cp,line.start,opt.offset)}function rectangleIntersection(line,view,magnet,opt){var angle=view.model.angle();if(angle===0){return bboxIntersection(line,view,magnet,opt)}var bboxWORotation=view.getNodeUnrotatedBBox(magnet);if(opt.stroke){bboxWORotation.inflate(stroke$1(magnet)/2)}var center=bboxWORotation.center();var lineWORotation=line.clone().rotate(center,angle);var intersections=lineWORotation.setLength(1e6).intersect(bboxWORotation);var cp=intersections?lineWORotation.start.chooseClosest(intersections).rotate(center,-angle):line.end;return offsetPoint(cp,line.start,opt.offset)}function findShapeNode(magnet){if(!magnet){return null}var node=magnet;do{var tagName=node.tagName;if(typeof tagName!=="string"){return null}tagName=tagName.toUpperCase();if(tagName==="G"){node=node.firstElementChild}else if(tagName==="TITLE"){node=node.nextElementSibling}else{break}}while(node);return node}var BNDR_SUBDIVISIONS="segmentSubdivisons";var BNDR_SHAPE_BBOX="shapeBBox";function boundaryIntersection(line,view,magnet,opt){var node,intersection;var selector=opt.selector;var anchor=line.end;if(typeof selector==="string"){node=view.findBySelector(selector)[0]}else if(Array.isArray(selector)){node=getByPath(magnet,selector)}else{node=findShapeNode(magnet)}if(!V.isSVGGraphicsElement(node)){if(node===magnet||!V.isSVGGraphicsElement(magnet)){return anchor}node=magnet}var localShape=view.getNodeShape(node);var magnetMatrix=view.getNodeMatrix(node);var translateMatrix=view.getRootTranslateMatrix();var rotateMatrix=view.getRootRotateMatrix();var targetMatrix=translateMatrix.multiply(rotateMatrix).multiply(magnetMatrix);var localMatrix=targetMatrix.inverse();var localLine=V.transformLine(line,localMatrix);var localRef=localLine.start.clone();var data=view.getNodeData(node);if(opt.insideout===false){if(!data[BNDR_SHAPE_BBOX]){data[BNDR_SHAPE_BBOX]=localShape.bbox()}var localBBox=data[BNDR_SHAPE_BBOX];if(localBBox.containsPoint(localRef)){return anchor}}var pathOpt;if(localShape instanceof Path){var precision=opt.precision||2;if(!data[BNDR_SUBDIVISIONS]){data[BNDR_SUBDIVISIONS]=localShape.getSegmentSubdivisions({precision:precision})}pathOpt={precision:precision,segmentSubdivisions:data[BNDR_SUBDIVISIONS]}}if(opt.extrapolate===true){localLine.setLength(1e6)}intersection=localLine.intersect(localShape,pathOpt);if(intersection){if(V.isArray(intersection)){intersection=localRef.chooseClosest(intersection)}}else if(opt.sticky===true){if(localShape instanceof Rect){intersection=localShape.pointNearestToPoint(localRef)}else if(localShape instanceof Ellipse){intersection=localShape.intersectionWithLineFromCenterToPoint(localRef)}else{intersection=localShape.closestPoint(localRef,pathOpt)}}var cp=intersection?V.transformPoint(intersection,targetMatrix):anchor;var cpOffset=opt.offset||0;if(opt.stroke){cpOffset+=stroke$1(node)/2}return offsetPoint(cp,line.start,cpOffset)}var anchor=anchorConnectionPoint;var bbox=bboxIntersection;var rectangle=rectangleIntersection;var boundary=boundaryIntersection;var connectionPoints={anchor:anchor,bbox:bbox,rectangle:rectangle,boundary:boundary};function bboxWrapper(method){return function(view,magnet,ref,opt){var rotate=!!opt.rotate;var bbox=rotate?view.getNodeUnrotatedBBox(magnet):view.getNodeBBox(magnet);var anchor=bbox[method]();var dx=opt.dx;if(dx){var dxPercentage=isPercentage(dx);dx=parseFloat(dx);if(isFinite(dx)){if(dxPercentage){dx/=100;dx*=bbox.width}anchor.x+=dx}}var dy=opt.dy;if(dy){var dyPercentage=isPercentage(dy);dy=parseFloat(dy);if(isFinite(dy)){if(dyPercentage){dy/=100;dy*=bbox.height}anchor.y+=dy}}return rotate?anchor.rotate(view.model.getBBox().center(),-view.model.angle()):anchor}}function _perpendicular(view,magnet,refPoint,opt){var angle=view.model.angle();var bbox=view.getNodeBBox(magnet);var anchor=bbox.center();var topLeft=bbox.origin();var bottomRight=bbox.corner();var padding=opt.padding;if(!isFinite(padding)){padding=0}if(topLeft.y+padding<=refPoint.y&&refPoint.y<=bottomRight.y-padding){var dy=refPoint.y-anchor.y;anchor.x+=angle===0||angle===180?0:dy*1/Math.tan(toRad(angle));anchor.y+=dy}else if(topLeft.x+padding<=refPoint.x&&refPoint.x<=bottomRight.x-padding){var dx=refPoint.x-anchor.x;anchor.y+=angle===90||angle===270?0:dx*Math.tan(toRad(angle));anchor.x+=dx}return anchor}function _midSide(view,magnet,refPoint,opt){var rotate=!!opt.rotate;var bbox,angle,center;if(rotate){bbox=view.getNodeUnrotatedBBox(magnet);center=view.model.getBBox().center();angle=view.model.angle()}else{bbox=view.getNodeBBox(magnet)}var padding=opt.padding;if(isFinite(padding)){bbox.inflate(padding)}if(rotate){refPoint.rotate(center,angle)}var side=bbox.sideNearestToPoint(refPoint);var anchor;switch(side){case"left":anchor=bbox.leftMiddle();break;case"right":anchor=bbox.rightMiddle();break;case"top":anchor=bbox.topMiddle();break;case"bottom":anchor=bbox.bottomMiddle();break}return rotate?anchor.rotate(center,-angle):anchor}function _modelCenter(view,_magnet,_refPoint,opt,endType){return view.model.getPointFromConnectedLink(this.model,endType).offset(opt.dx,opt.dy)}var center=bboxWrapper("center");var top$2=bboxWrapper("topMiddle");var bottom$2=bboxWrapper("bottomMiddle");var left$2=bboxWrapper("leftMiddle");var right$2=bboxWrapper("rightMiddle");var topLeft=bboxWrapper("origin");var topRight=bboxWrapper("topRight");var bottomLeft=bboxWrapper("bottomLeft");var bottomRight=bboxWrapper("corner");var perpendicular=resolveRef(_perpendicular);var midSide=resolveRef(_midSide);var modelCenter=_modelCenter;var anchors={center:center,top:top$2,bottom:bottom$2,left:left$2,right:right$2,topLeft:topLeft,topRight:topRight,bottomLeft:bottomLeft,bottomRight:bottomRight,perpendicular:perpendicular,midSide:midSide,modelCenter:modelCenter};var sortingTypes={NONE:"sorting-none",APPROX:"sorting-approximate",EXACT:"sorting-exact"};var WHEEL_CAP=50;var WHEEL_WAIT_MS=20;var MOUNT_BATCH_SIZE=1e3;var UPDATE_BATCH_SIZE=Infinity;var MIN_PRIORITY=9007199254740991;var HighlightingTypes$1=CellView.Highlighting;var defaultHighlighting={};defaultHighlighting[HighlightingTypes$1.DEFAULT]={name:"stroke",options:{padding:3}};defaultHighlighting[HighlightingTypes$1.MAGNET_AVAILABILITY]={name:"addClass",options:{className:"available-magnet"}};defaultHighlighting[HighlightingTypes$1.ELEMENT_AVAILABILITY]={name:"addClass",options:{className:"available-cell"}};var defaultLayers=[{name:LayersNames.BACK},{name:LayersNames.CELLS},{name:LayersNames.LABELS},{name:LayersNames.FRONT},{name:LayersNames.TOOLS}];var Paper=View.extend({className:"paper",options:{width:800,height:600,origin:{x:0,y:0},gridSize:1,drawGrid:false,background:false,perpendicularLinks:false,elementView:ElementView,linkView:LinkView,snapLabels:false,snapLinks:false,snapLinksSelf:false,labelsLayer:false,multiLinks:true,guard:function(evt,view){return false},highlighting:defaultHighlighting,preventContextMenu:true,preventDefaultBlankAction:true,restrictTranslate:false,markAvailable:false,defaultLink:new Link,defaultConnector:{name:"normal"},defaultRouter:{name:"normal"},defaultAnchor:{name:"center"},defaultLinkAnchor:{name:"connectionRatio"},defaultConnectionPoint:{name:"bbox"},connectionStrategy:null,validateMagnet:function(_cellView,magnet,_evt){return magnet.getAttribute("magnet")!=="passive"},validateConnection:function(cellViewS,_magnetS,cellViewT,_magnetT,end,_linkView){return(end==="target"?cellViewT:cellViewS)instanceof ElementView},embeddingMode:false,validateEmbedding:function(childView,parentView){return true},validateUnembedding:function(childView){return true},findParentBy:"bbox",frontParentOnly:true,interactive:{labelMove:false},linkPinning:true,allowLink:null,clickThreshold:0,moveThreshold:0,magnetThreshold:0,sorting:sortingTypes.EXACT,frozen:false,onViewUpdate:function(view,flag,priority,opt,paper){if(flag&(view.FLAG_INSERT|view.FLAG_REMOVE)||opt.mounting||opt.isolate){return}paper.requestConnectedLinksUpdate(view,priority,opt)},onViewPostponed:function(view,flag,paper){return paper.forcePostponedViewUpdate(view,flag)},beforeRender:null,afterRender:null,viewport:null,cellViewNamespace:null,routerNamespace:null,connectorNamespace:null,highlighterNamespace:highlighters,anchorNamespace:anchors,linkAnchorNamespace:linkAnchors,connectionPointNamespace:connectionPoints},events:{dblclick:"pointerdblclick",dbltap:"pointerdblclick",contextmenu:"contextmenu",mousedown:"pointerdown",touchstart:"pointerdown",mouseover:"mouseover",mouseout:"mouseout",mouseenter:"mouseenter",mouseleave:"mouseleave",wheel:"mousewheel","mouseenter .joint-cell":"mouseenter","mouseleave .joint-cell":"mouseleave","mouseenter .joint-tools":"mouseenter","mouseleave .joint-tools":"mouseleave","mousedown .joint-cell [event]":"onevent","touchstart .joint-cell [event]":"onevent","mousedown .joint-cell [magnet]":"onmagnet","touchstart .joint-cell [magnet]":"onmagnet","dblclick .joint-cell [magnet]":"magnetpointerdblclick","contextmenu .joint-cell [magnet]":"magnetcontextmenu","mousedown .joint-link .label":"onlabel","touchstart .joint-link .label":"onlabel","dragstart .joint-cell image":"onImageDragStart"},documentEvents:{mousemove:"pointermove",touchmove:"pointermove",mouseup:"pointerup",touchend:"pointerup",touchcancel:"pointerup"},svg:null,viewport:null,defs:null,tools:null,$background:null,layers:null,$grid:null,$document:null,_viewportMatrix:null,_viewportTransformString:null,_updates:null,_layers:null,SORT_DELAYING_BATCHES:["add","to-front","to-back"],UPDATE_DELAYING_BATCHES:["translate"],MIN_SCALE:1e-6,init:function(){var ref=this;var options=ref.options;var el=ref.el;if(!options.cellViewNamespace){options.cellViewNamespace=typeof joint!=="undefined"&&has$2(joint,"shapes")?joint.shapes:null}var model=this.model=options.model||new Graph;this._layers={};this.setGrid(options.drawGrid);this.cloneOptions();this.render();this._setDimensions();this.startListening();this._views={};this._mw_evt_buffer={event:null,deltas:[]};this.$document=$(el.ownerDocument);this.resetViews(model.attributes.cells.models);if(!this.isFrozen()&&this.isAsync()){this.updateViewsAsync()}},_resetUpdates:function(){return this._updates={id:null,priorities:[{},{},{}],unmountedCids:[],mountedCids:[],unmounted:{},mounted:{},count:0,keyFrozen:false,freezeKey:null,sort:false}},startListening:function(){var model=this.model;this.listenTo(model,"add",this.onCellAdded).listenTo(model,"remove",this.onCellRemoved).listenTo(model,"change",this.onCellChange).listenTo(model,"reset",this.onGraphReset).listenTo(model,"sort",this.onGraphSort).listenTo(model,"batch:stop",this.onGraphBatchStop);this.on("cell:highlight",this.onCellHighlight).on("cell:unhighlight",this.onCellUnhighlight).on("scale translate",this.update)},onCellAdded:function(cell,_,opt){var position=opt.position;if(this.isAsync()||!isNumber(position)){this.renderView(cell,opt)}else{if(opt.maxPosition===position){this.freeze({key:"addCells"})}this.renderView(cell,opt);if(position===0){this.unfreeze({key:"addCells"})}}},onCellRemoved:function(cell,_,opt){var view=this.findViewByModel(cell);if(view){this.requestViewUpdate(view,view.FLAG_REMOVE,view.UPDATE_PRIORITY,opt)}},onCellChange:function(cell,opt){if(cell===this.model.attributes.cells){return}if(cell.hasChanged("z")&&this.options.sorting===sortingTypes.APPROX){var view=this.findViewByModel(cell);if(view){this.requestViewUpdate(view,view.FLAG_INSERT,view.UPDATE_PRIORITY,opt)}}},onGraphReset:function(collection,opt){this.resetLayers();this.resetViews(collection.models,opt)},onGraphSort:function(){if(this.model.hasActiveBatch(this.SORT_DELAYING_BATCHES)){return}this.sortViews()},onGraphBatchStop:function(data){if(this.isFrozen()){return}var name=data&&data.batchName;var graph=this.model;if(!this.isAsync()){var updateDelayingBatches=this.UPDATE_DELAYING_BATCHES;if(updateDelayingBatches.includes(name)&&!graph.hasActiveBatch(updateDelayingBatches)){this.updateViews(data)}}var sortDelayingBatches=this.SORT_DELAYING_BATCHES;if(sortDelayingBatches.includes(name)&&!graph.hasActiveBatch(sortDelayingBatches)){this.sortViews()}},cloneOptions:function(){var ref=this;var options=ref.options;var defaultConnector=options.defaultConnector;var defaultRouter=options.defaultRouter;var defaultConnectionPoint=options.defaultConnectionPoint;var defaultAnchor=options.defaultAnchor;var defaultLinkAnchor=options.defaultLinkAnchor;var origin=options.origin;var highlighting=options.highlighting;var cellViewNamespace=options.cellViewNamespace;var interactive=options.interactive;if(!cellViewNamespace&&typeof joint!=="undefined"&&has$2(joint,"shapes")){options.cellViewNamespace=joint.shapes}if(!isFunction(defaultConnector)){options.defaultConnector=cloneDeep(defaultConnector)}if(!isFunction(defaultRouter)){options.defaultRouter=cloneDeep(defaultRouter)}if(!isFunction(defaultConnectionPoint)){options.defaultConnectionPoint=cloneDeep(defaultConnectionPoint)}if(!isFunction(defaultAnchor)){options.defaultAnchor=cloneDeep(defaultAnchor)}if(!isFunction(defaultLinkAnchor)){options.defaultLinkAnchor=cloneDeep(defaultLinkAnchor)}if(isPlainObject(interactive)){options.interactive=assign({},interactive)}if(isPlainObject(highlighting)){options.highlighting=defaultsDeep({},highlighting,defaultHighlighting)}options.origin=assign({},origin)},children:function(){var ns=V.namespace;return[{namespaceURI:ns.xhtml,tagName:"div",className:addClassNamePrefix("paper-background"),selector:"background"},{namespaceURI:ns.xhtml,tagName:"div",className:addClassNamePrefix("paper-grid"),selector:"grid"},{namespaceURI:ns.svg,tagName:"svg",attributes:{width:"100%",height:"100%","xmlns:xlink":ns.xlink},selector:"svg",children:[{tagName:"defs",selector:"defs"},{tagName:"g",className:addClassNamePrefix("layers"),selector:"layers"}]}]},hasLayerView:function hasLayerView(layerName){return layerName in this._layers},getLayerView:function getLayerView(layerName){var ref=this;var _layers=ref._layers;if(layerName in _layers){return _layers[layerName]}throw new Error('dia.Paper: Unknown layer "'+layerName+'"')},getLayerNode:function getLayerNode(layerName){return this.getLayerView(layerName).el},render:function(){this.renderChildren();var ref=this;var childNodes=ref.childNodes;var options=ref.options;var svg=childNodes.svg;var defs=childNodes.defs;var layers=childNodes.layers;var background=childNodes.background;var grid=childNodes.grid;this.svg=svg;this.defs=defs;this.layers=layers;this.$background=$(background);this.$grid=$(grid);this.renderLayers();V.ensureId(svg);if(options.background){this.drawBackground(options.background)}if(options.drawGrid){this.drawGrid()}return this},renderLayers:function(layers){var this$1=this;if(layers===void 0)layers=defaultLayers;this.removeLayers();layers.forEach(function(ref){var name=ref.name;var sorted=ref.sorted;var layerView=new PaperLayer({name:name});this$1.layers.appendChild(layerView.el);this$1._layers[name]=layerView});var cellsLayerView=this.getLayerView(LayersNames.CELLS);var toolsLayerView=this.getLayerView(LayersNames.TOOLS);var labelsLayerView=this.getLayerView(LayersNames.LABELS);this.tools=toolsLayerView.el;this.cells=this.viewport=cellsLayerView.el;cellsLayerView.vel.addClass(addClassNamePrefix("viewport"));labelsLayerView.vel.addClass(addClassNamePrefix("viewport"))},removeLayers:function(){var ref=this;var _layers=ref._layers;Object.keys(_layers).forEach(function(name){_layers[name].remove();delete _layers[name]})},resetLayers:function(){var ref=this;var _layers=ref._layers;Object.keys(_layers).forEach(function(name){_layers[name].removePivots()})},update:function(){if(this.options.drawGrid){this.drawGrid()}if(this._background){this.updateBackgroundImage(this._background)}return this},matrix:function(ctm){var viewport=this.layers;if(ctm===undefined){var transformString=viewport.getAttribute("transform");if((this._viewportTransformString||null)===transformString){ctm=this._viewportMatrix}else{ctm=viewport.getCTM();this._viewportMatrix=ctm;this._viewportTransformString=transformString}return V.createSVGMatrix(ctm)}ctm=V.createSVGMatrix(ctm);var ctmString=V.matrixToTransformString(ctm);viewport.setAttribute("transform",ctmString);this._viewportMatrix=ctm;this._viewportTransformString=viewport.getAttribute("transform");return this},clientMatrix:function(){return V.createSVGMatrix(this.cells.getScreenCTM())},requestConnectedLinksUpdate:function(view,priority,opt){if(view instanceof CellView){var model=view.model;var links=this.model.getConnectedLinks(model);for(var j=0,n=links.length;j<n;j++){var link=links[j];var linkView=this.findViewByModel(link);if(!linkView){continue}var flagLabels=["UPDATE"];if(link.getTargetCell()===model){flagLabels.push("TARGET")}if(link.getSourceCell()===model){flagLabels.push("SOURCE")}var nextPriority=Math.max(priority+1,linkView.UPDATE_PRIORITY);this.scheduleViewUpdate(linkView,linkView.getFlag(flagLabels),nextPriority,opt)}}},forcePostponedViewUpdate:function(view,flag){if(!view||!(view instanceof CellView)){return false}var model=view.model;if(model.isElement()){return false}if((flag&view.getFlag(["SOURCE","TARGET"]))===0){var sourceFlag=0;var sourceView=this.findViewByModel(model.getSourceCell());if(sourceView&&!this.isViewMounted(sourceView)){sourceFlag=this.dumpView(sourceView);view.updateEndMagnet("source")}var targetFlag=0;var targetView=this.findViewByModel(model.getTargetCell());if(targetView&&!this.isViewMounted(targetView)){targetFlag=this.dumpView(targetView);view.updateEndMagnet("target")}if(sourceFlag===0&&targetFlag===0){return!this.dumpView(view)}}return false},requestViewUpdate:function(view,flag,priority,opt){opt||(opt={});this.scheduleViewUpdate(view,flag,priority,opt);var isAsync=this.isAsync();if(this.isFrozen()||isAsync&&opt.async!==false){return}if(this.model.hasActiveBatch(this.UPDATE_DELAYING_BATCHES)){return}var stats=this.updateViews(opt);if(isAsync){this.notifyAfterRender(stats,opt)}},scheduleViewUpdate:function(view,type,priority,opt){var ref=this;var updates=ref._updates;var options=ref.options;var FLAG_REMOVE=view.FLAG_REMOVE;var FLAG_INSERT=view.FLAG_INSERT;var UPDATE_PRIORITY=view.UPDATE_PRIORITY;var cid=view.cid;var priorityUpdates=updates.priorities[priority];if(!priorityUpdates){priorityUpdates=updates.priorities[priority]={}}if(priority>UPDATE_PRIORITY){for(var i=priority-1;i>=UPDATE_PRIORITY;i--){var prevPriorityUpdates=updates.priorities[i];if(!prevPriorityUpdates||!(cid in prevPriorityUpdates)){continue}priorityUpdates[cid]|=prevPriorityUpdates[cid];delete prevPriorityUpdates[cid]}}var currentType=priorityUpdates[cid]||0;if((currentType&type)===type){return}if(!currentType){updates.count++}if(type&FLAG_REMOVE&&currentType&FLAG_INSERT){priorityUpdates[cid]^=FLAG_INSERT}else if(type&FLAG_INSERT&&currentType&FLAG_REMOVE){priorityUpdates[cid]^=FLAG_REMOVE}priorityUpdates[cid]|=type;var viewUpdateFn=options.onViewUpdate;if(typeof viewUpdateFn==="function"){viewUpdateFn.call(this,view,type,priority,opt||{},this)}},dumpViewUpdate:function(view){if(!view){return 0}var updates=this._updates;var cid=view.cid;var priorityUpdates=updates.priorities[view.UPDATE_PRIORITY];var flag=this.registerMountedView(view)|priorityUpdates[cid];delete priorityUpdates[cid];return flag},dumpView:function(view,opt){var flag=this.dumpViewUpdate(view);if(!flag){return 0}return this.updateView(view,flag,opt)},updateView:function(view,flag,opt){if(!view){return 0}var FLAG_REMOVE=view.FLAG_REMOVE;var FLAG_INSERT=view.FLAG_INSERT;var model=view.model;if(view instanceof CellView){if(flag&FLAG_REMOVE){this.removeView(model);return 0}if(flag&FLAG_INSERT){this.insertView(view);flag^=FLAG_INSERT}}if(!flag){return 0}return view.confirmUpdate(flag,opt||{})},requireView:function(model,opt){var view=this.findViewByModel(model);if(!view){return null}this.dumpView(view,opt);return view},registerUnmountedView:function(view){var cid=view.cid;var updates=this._updates;if(cid in updates.unmounted){return 0}var flag=updates.unmounted[cid]|=view.FLAG_INSERT;updates.unmountedCids.push(cid);delete updates.mounted[cid];return flag},registerMountedView:function(view){var cid=view.cid;var updates=this._updates;if(cid in updates.mounted){return 0}updates.mounted[cid]=true;updates.mountedCids.push(cid);var flag=updates.unmounted[cid]||0;delete updates.unmounted[cid];return flag},isViewMounted:function(view){if(!view){return false}var cid=view.cid;var updates=this._updates;return cid in updates.mounted},dumpViews:function(opt){var passingOpt=defaults({},opt,{viewport:null});this.checkViewport(passingOpt);this.updateViews(passingOpt)},updateViews:function(opt){this.notifyBeforeRender(opt);var batchStats;var updateCount=0;var batchCount=0;var priority=MIN_PRIORITY;do{batchCount++;batchStats=this.updateViewsBatch(opt);updateCount+=batchStats.updated;priority=Math.min(batchStats.priority,priority)}while(!batchStats.empty);var stats={updated:updateCount,batches:batchCount,priority:priority};this.notifyAfterRender(stats,opt);return stats},hasScheduledUpdates:function(){var priorities=this._updates.priorities;var priorityIndexes=Object.keys(priorities);var i=priorityIndexes.length;while(i>0&&i--){for(var _key in priorities[priorityIndexes[i]]){return true}}return false},updateViewsAsync:function(opt,data){opt||(opt={});data||(data={processed:0,priority:MIN_PRIORITY});var updates=this._updates;var id=updates.id;if(id){cancelFrame(id);if(data.processed===0&&this.hasScheduledUpdates()){this.notifyBeforeRender(opt)}var stats=this.updateViewsBatch(opt);var passingOpt=defaults({},opt,{mountBatchSize:MOUNT_BATCH_SIZE-stats.mounted,unmountBatchSize:MOUNT_BATCH_SIZE-stats.unmounted});var checkStats=this.checkViewport(passingOpt);var unmountCount=checkStats.unmounted;var mountCount=checkStats.mounted;var processed=data.processed;var total=updates.count;if(stats.updated>0){processed+=stats.updated+stats.unmounted;stats.processed=processed;data.priority=Math.min(stats.priority,data.priority);if(stats.empty&&mountCount===0){stats.unmounted+=unmountCount;stats.mounted+=mountCount;stats.priority=data.priority;this.notifyAfterRender(stats,opt);data.processed=0;data.priority=MIN_PRIORITY;updates.count=0}else{data.processed=processed}}var progressFn=opt.progress;if(total&&typeof progressFn==="function"){progressFn.call(this,stats.empty,processed,total,stats,this)}if(updates.id!==id){return}}updates.id=nextFrame(this.updateViewsAsync,this,opt,data)},notifyBeforeRender:function(opt){if(opt===void 0)opt={};var beforeFn=opt.beforeRender;if(typeof beforeFn!=="function"){beforeFn=this.options.beforeRender;if(typeof beforeFn!=="function"){return}}beforeFn.call(this,opt,this)},notifyAfterRender:function(stats,opt){if(opt===void 0)opt={};var afterFn=opt.afterRender;if(typeof afterFn!=="function"){afterFn=this.options.afterRender}if(typeof afterFn==="function"){afterFn.call(this,stats,opt,this)}this.trigger("render:done",stats,opt)},updateViewsBatch:function(opt){opt||(opt={});var batchSize=opt.batchSize||UPDATE_BATCH_SIZE;var updates=this._updates;var updateCount=0;var postponeCount=0;var unmountCount=0;var mountCount=0;var maxPriority=MIN_PRIORITY;var empty=true;var options=this.options;var priorities=updates.priorities;var viewportFn="viewport"in opt?opt.viewport:options.viewport;if(typeof viewportFn!=="function"){viewportFn=null}var postponeViewFn=options.onViewPostponed;if(typeof postponeViewFn!=="function"){postponeViewFn=null}var priorityIndexes=Object.keys(priorities);main:for(var i=0,n=priorityIndexes.length;i<n;i++){var priority=+priorityIndexes[i];var priorityUpdates=priorities[priority];for(var cid in priorityUpdates){if(updateCount>=batchSize){empty=false;break main}var view=views[cid];if(!view){delete priorityUpdates[cid];continue}var currentFlag=priorityUpdates[cid];if((currentFlag&view.FLAG_REMOVE)===0){var isDetached=cid in updates.unmounted;if(view.DETACHABLE&&viewportFn&&!viewportFn.call(this,view,!isDetached,this)){if(!isDetached){this.registerUnmountedView(view);view.unmount()}updates.unmounted[cid]|=currentFlag;delete priorityUpdates[cid];unmountCount++;continue}if(isDetached){currentFlag|=view.FLAG_INSERT;mountCount++}currentFlag|=this.registerMountedView(view)}var leftoverFlag=this.updateView(view,currentFlag,opt);if(leftoverFlag>0){priorityUpdates[cid]=leftoverFlag;if(!postponeViewFn||!postponeViewFn.call(this,view,leftoverFlag,this)||priorityUpdates[cid]){postponeCount++;empty=false;continue}}if(maxPriority>priority){maxPriority=priority}updateCount++;delete priorityUpdates[cid]}}return{priority:maxPriority,updated:updateCount,postponed:postponeCount,unmounted:unmountCount,mounted:mountCount,empty:empty}},getUnmountedViews:function(){var updates=this._updates;var unmountedCids=Object.keys(updates.unmounted);var n=unmountedCids.length;var unmountedViews=new Array(n);for(var i=0;i<n;i++){unmountedViews[i]=views[unmountedCids[i]]}return unmountedViews},getMountedViews:function(){var updates=this._updates;var mountedCids=Object.keys(updates.mounted);var n=mountedCids.length;var mountedViews=new Array(n);for(var i=0;i<n;i++){mountedViews[i]=views[mountedCids[i]]}return mountedViews},checkUnmountedViews:function(viewportFn,opt){opt||(opt={});var mountCount=0;if(typeof viewportFn!=="function"){viewportFn=null}var batchSize="mountBatchSize"in opt?opt.mountBatchSize:Infinity;var updates=this._updates;var unmountedCids=updates.unmountedCids;var unmounted=updates.unmounted;for(var i=0,n=Math.min(unmountedCids.length,batchSize);i<n;i++){var cid=unmountedCids[i];if(!(cid in unmounted)){continue}var view=views[cid];if(!view){continue}if(view.DETACHABLE&&viewportFn&&!viewportFn.call(this,view,false,this)){unmountedCids.push(cid);continue}mountCount++;var flag=this.registerMountedView(view);if(flag){this.scheduleViewUpdate(view,flag,view.UPDATE_PRIORITY,{mounting:true})}}unmountedCids.splice(0,i);return mountCount},checkMountedViews:function(viewportFn,opt){opt||(opt={});var unmountCount=0;if(typeof viewportFn!=="function"){return unmountCount}var batchSize="unmountBatchSize"in opt?opt.unmountBatchSize:Infinity;var updates=this._updates;var mountedCids=updates.mountedCids;var mounted=updates.mounted;for(var i=0,n=Math.min(mountedCids.length,batchSize);i<n;i++){var cid=mountedCids[i];if(!(cid in mounted)){continue}var view=views[cid];if(!view){continue}if(!view.DETACHABLE||viewportFn.call(this,view,true,this)){mountedCids.push(cid);continue}unmountCount++;var flag=this.registerUnmountedView(view);if(flag){view.unmount()}}mountedCids.splice(0,i);return unmountCount},checkViewport:function(opt){var passingOpt=defaults({},opt,{mountBatchSize:Infinity,unmountBatchSize:Infinity});var viewportFn="viewport"in passingOpt?passingOpt.viewport:this.options.viewport;var unmountedCount=this.checkMountedViews(viewportFn,passingOpt);if(unmountedCount>0){var unmountedCids=this._updates.unmountedCids;passingOpt.mountBatchSize=Math.min(unmountedCids.length-unmountedCount,passingOpt.mountBatchSize)}var mountedCount=this.checkUnmountedViews(viewportFn,passingOpt);return{mounted:mountedCount,unmounted:unmountedCount}},freeze:function(opt){opt||(opt={});var updates=this._updates;var key=opt.key;var isFrozen=this.options.frozen;var freezeKey=updates.freezeKey;if(key&&key!==freezeKey){if(isFrozen&&freezeKey){return}updates.freezeKey=key;updates.keyFrozen=isFrozen}this.options.frozen=true;var id=updates.id;updates.id=null;if(this.isAsync()&&id){cancelFrame(id)}},unfreeze:function(opt){opt||(opt={});var updates=this._updates;var key=opt.key;var freezeKey=updates.freezeKey;if(key&&freezeKey&&key!==freezeKey){return}updates.freezeKey=null;if(key&&key===freezeKey&&updates.keyFrozen){return}if(this.isAsync()){this.freeze();this.updateViewsAsync(opt)}else{this.updateViews(opt)}this.options.frozen=updates.keyFrozen=false;if(updates.sort){this.sortViews();updates.sort=false}},isAsync:function(){return!!this.options.async},isFrozen:function(){return!!this.options.frozen},isExactSorting:function(){return this.options.sorting===sortingTypes.EXACT},onRemove:function(){this.freeze();this.removeLayers();this.removeViews()},getComputedSize:function(){var options=this.options;var w=options.width;var h=options.height;if(!isNumber(w)){w=this.el.clientWidth}if(!isNumber(h)){h=this.el.clientHeight}return{width:w,height:h}},setDimensions:function(width,height){var ref=this;var options=ref.options;var currentWidth=options.width;var currentHeight=options.height;var w=width===undefined?currentWidth:width;var h=height===undefined?currentHeight:height;if(currentWidth===w&&currentHeight===h){return}options.width=w;options.height=h;this._setDimensions();var computedSize=this.getComputedSize();this.trigger("resize",computedSize.width,computedSize.height)},_setDimensions:function(){var ref=this;var options=ref.options;var w=options.width;var h=options.height;if(isNumber(w)){w=Math.round(w)}if(isNumber(h)){h=Math.round(h)}this.$el.css({width:w===null?"":w,height:h===null?"":h})},setOrigin:function(ox,oy){return this.translate(ox||0,oy||0)},fitToContent:function(gridWidth,gridHeight,padding,opt){if(isObject$1(gridWidth)){opt=gridWidth}else{opt=assign({gridWidth:gridWidth,gridHeight:gridHeight,padding:padding},opt)}var ref=this.getFitToContentArea(opt);var x=ref.x;var y=ref.y;var width=ref.width;var height=ref.height;var ref$1=this.scale();var sx=ref$1.sx;var sy=ref$1.sy;this.setOrigin(-x*sx,-y*sy);this.setDimensions(width*sx,height*sy);return new Rect(x,y,width,height)},getFitToContentArea:function(opt){if(opt===void 0)opt={};var gridWidth=opt.gridWidth||1;var gridHeight=opt.gridHeight||1;var padding=normalizeSides(opt.padding||0);var minWidth=Math.max(opt.minWidth||0,gridWidth);var minHeight=Math.max(opt.minHeight||0,gridHeight);var maxWidth=opt.maxWidth||Number.MAX_VALUE;var maxHeight=opt.maxHeight||Number.MAX_VALUE;var newOrigin=opt.allowNewOrigin;var area="contentArea"in opt?new Rect(opt.contentArea):this.getContentArea(opt);var ref=this.scale();var sx=ref.sx;var sy=ref.sy;area.x*=sx;area.y*=sy;area.width*=sx;area.height*=sy;var calcWidth=Math.ceil((area.width+area.x)/gridWidth);var calcHeight=Math.ceil((area.height+area.y)/gridHeight);if(!opt.allowNegativeBottomRight){calcWidth=Math.max(calcWidth,1);calcHeight=Math.max(calcHeight,1)}calcWidth*=gridWidth;calcHeight*=gridHeight;var tx=0;if(newOrigin==="negative"&&area.x<0||newOrigin==="positive"&&area.x>=0||newOrigin==="any"){tx=Math.ceil(-area.x/gridWidth)*gridWidth;tx+=padding.left;calcWidth+=tx}var ty=0;if(newOrigin==="negative"&&area.y<0||newOrigin==="positive"&&area.y>=0||newOrigin==="any"){ty=Math.ceil(-area.y/gridHeight)*gridHeight;ty+=padding.top;calcHeight+=ty}calcWidth+=padding.right;calcHeight+=padding.bottom;calcWidth=Math.max(calcWidth,minWidth);calcHeight=Math.max(calcHeight,minHeight);calcWidth=Math.min(calcWidth,maxWidth);calcHeight=Math.min(calcHeight,maxHeight);return new Rect(-tx/sx,-ty/sy,calcWidth/sx,calcHeight/sy)},scaleContentToFit:function(opt){opt||(opt={});var contentBBox,contentLocalOrigin;if("contentArea"in opt){var contentArea=opt.contentArea;contentBBox=this.localToPaperRect(contentArea);contentLocalOrigin=new Point(contentArea)}else{contentBBox=this.getContentBBox(opt);contentLocalOrigin=this.paperToLocalPoint(contentBBox)}if(!contentBBox.width||!contentBBox.height){return}defaults(opt,{padding:0,preserveAspectRatio:true,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE});var padding=normalizeSides(opt.padding);var minScaleX=opt.minScaleX||opt.minScale;var maxScaleX=opt.maxScaleX||opt.maxScale;var minScaleY=opt.minScaleY||opt.minScale;var maxScaleY=opt.maxScaleY||opt.maxScale;var fittingBBox;if(opt.fittingBBox){fittingBBox=opt.fittingBBox}else{var currentTranslate=this.translate();var computedSize=this.getComputedSize();fittingBBox={x:currentTranslate.tx,y:currentTranslate.ty,width:computedSize.width,height:computedSize.height}}fittingBBox=new Rect(fittingBBox).moveAndExpand({x:padding.left,y:padding.top,width:-padding.left-padding.right,height:-padding.top-padding.bottom});var currentScale=this.scale();var newSx=fittingBBox.width/contentBBox.width*currentScale.sx;var newSy=fittingBBox.height/contentBBox.height*currentScale.sy;if(opt.preserveAspectRatio){newSx=newSy=Math.min(newSx,newSy)}if(opt.scaleGrid){var gridSize=opt.scaleGrid;newSx=gridSize*Math.floor(newSx/gridSize);newSy=gridSize*Math.floor(newSy/gridSize)}newSx=Math.min(maxScaleX,Math.max(minScaleX,newSx));newSy=Math.min(maxScaleY,Math.max(minScaleY,newSy));var origin=this.options.origin;var newOx=fittingBBox.x-contentLocalOrigin.x*newSx-origin.x;var newOy=fittingBBox.y-contentLocalOrigin.y*newSy-origin.y;this.scale(newSx,newSy);this.translate(newOx,newOy)},getContentArea:function(opt){if(opt&&opt.useModelGeometry){return this.model.getBBox()||new Rect}return V(this.cells).getBBox()},getContentBBox:function(opt){return this.localToPaperRect(this.getContentArea(opt))},getArea:function(){return this.paperToLocalRect(this.getComputedSize())},getRestrictedArea:function(){var args=[],len=arguments.length;while(len--)args[len]=arguments[len];var ref=this.options;var restrictTranslate=ref.restrictTranslate;var restrictedArea;if(isFunction(restrictTranslate)){restrictedArea=restrictTranslate.apply(this,args)}else if(restrictTranslate===true){restrictedArea=this.getArea()}else if(!restrictTranslate){restrictedArea=null}else{restrictedArea=new Rect(restrictTranslate)}return restrictedArea},createViewForModel:function(cell){var ref=this;var options=ref.options;var optionalViewClass;var defaultViewClass;var namespace=options.cellViewNamespace;var type=cell.get("type")+"View";var namespaceViewClass=getByPath(namespace,type,".");if(cell.isLink()){optionalViewClass=options.linkView;defaultViewClass=LinkView}else{optionalViewClass=options.elementView;defaultViewClass=ElementView}var ViewClass=optionalViewClass.prototype instanceof Backbone.View?namespaceViewClass||optionalViewClass:optionalViewClass.call(this,cell)||namespaceViewClass||defaultViewClass;return new ViewClass({model:cell,interactive:options.interactive,labelsLayer:options.labelsLayer===true?LayersNames.LABELS:options.labelsLayer})},removeView:function(cell){var id=cell.id;var ref=this;var _views=ref._views;var _updates=ref._updates;var view=_views[id];if(view){var cid=view.cid;var mounted=_updates.mounted;var unmounted=_updates.unmounted;view.remove();delete _views[id];delete mounted[cid];delete unmounted[cid]}return view},renderView:function(cell,opt){var id=cell.id;var views=this._views;var view,flag;var create=true;if(id in views){view=views[id];if(view.model===cell){flag=view.FLAG_INSERT;create=false}else{this.removeView(cell)}}if(create){view=views[id]=this.createViewForModel(cell);view.paper=this;flag=this.registerUnmountedView(view)|view.getFlag(result(view,"initFlag"))}this.requestViewUpdate(view,flag,view.UPDATE_PRIORITY,opt);return view},onImageDragStart:function(){return false},resetViews:function(cells,opt){opt||(opt={});cells||(cells=[]);this._resetUpdates();this.removeViews();this.freeze({key:"reset"});for(var i=0,n=cells.length;i<n;i++){this.renderView(cells[i],opt)}this.unfreeze({key:"reset"});this.sortViews()},removeViews:function(){invoke(this._views,"remove");this._views={}},sortViews:function(){if(!this.isExactSorting()){return}if(this.isFrozen()){this._updates.sort=true;return}this.sortViewsExact()},sortViewsExact:function(){var $cells=$(this.cells).children("[model-id]");var cells=this.model.get("cells");sortElements($cells,function(a,b){var cellA=cells.get(a.getAttribute("model-id"));var cellB=cells.get(b.getAttribute("model-id"));var zA=cellA.attributes.z||0;var zB=cellB.attributes.z||0;return zA===zB?0:zA<zB?-1:1})},insertView:function(view){var layerView=this.getLayerView(LayersNames.CELLS);var el=view.el;var model=view.model;switch(this.options.sorting){case sortingTypes.APPROX:layerView.insertSortedNode(el,model.get("z"));break;case sortingTypes.EXACT:default:layerView.insertNode(el);break}view.onMount()},scale:function(sx,sy,ox,oy){if(sx===undefined){return V.matrixToScale(this.matrix())}if(sy===undefined){sy=sx}if(ox===undefined){ox=0;oy=0}var translate=this.translate();if(ox||oy||translate.tx||translate.ty){var newTx=translate.tx-ox*(sx-1);var newTy=translate.ty-oy*(sy-1);this.translate(newTx,newTy)}sx=Math.max(sx||0,this.MIN_SCALE);sy=Math.max(sy||0,this.MIN_SCALE);var ctm=this.matrix();ctm.a=sx;ctm.d=sy;this.matrix(ctm);this.trigger("scale",sx,sy,ox,oy);return this},rotate:function(angle,cx,cy){if(angle===undefined){return V.matrixToRotate(this.matrix())}if(cx===undefined){var bbox=this.cells.getBBox();cx=bbox.width/2;cy=bbox.height/2}var ctm=this.matrix().translate(cx,cy).rotate(angle).translate(-cx,-cy);this.matrix(ctm);return this},translate:function(tx,ty){if(tx===undefined){return V.matrixToTranslate(this.matrix())}var ref=this;var options=ref.options;var origin=options.origin;var drawGrid=options.drawGrid;tx||(tx=0);ty||(ty=0);var ctm=this.matrix();if(ctm.e===tx&&ctm.f===ty){return this}ctm.e=tx;ctm.f=ty;this.matrix(ctm);var ref$1=this.translate();var ox=ref$1.tx;var oy=ref$1.ty;origin.x=ox;origin.y=oy;this.trigger("translate",ox,oy);if(drawGrid){this.drawGrid()}return this},findView:function($el){var el=isString($el)?this.cells.querySelector($el):$el instanceof $?$el[0]:$el;var id=this.findAttribute("model-id",el);if(id){return this._views[id]}return undefined},findViewByModel:function(cell){var id=isString(cell)||isNumber(cell)?cell:cell&&cell.id;return this._views[id]},findViewsFromPoint:function(p){p=new Point(p);var views=this.model.getElements().map(this.findViewByModel,this);return views.filter(function(view){return view&&view.vel.getBBox({target:this.cells}).containsPoint(p)},this)},findViewsInArea:function(rect,opt){opt=defaults(opt||{},{strict:false});rect=new Rect(rect);var views=this.model.getElements().map(this.findViewByModel,this);var method=opt.strict?"containsRect":"intersect";return views.filter(function(view){return view&&rect[method](view.vel.getBBox({target:this.cells}))},this)},removeTools:function(){this.dispatchToolsEvent("remove");return this},hideTools:function(){this.dispatchToolsEvent("hide");return this},showTools:function(){this.dispatchToolsEvent("show");return this},dispatchToolsEvent:function(event){var ref;var args=[],len=arguments.length-1;while(len-- >0)args[len]=arguments[len+1];if(typeof event!=="string"){return}(ref=this).trigger.apply(ref,["tools:event",event].concat(args))},getModelById:function(id){return this.model.getCell(id)},snapToGrid:function(x,y){return this.clientToLocalPoint(x,y).snapToGrid(this.options.gridSize)},localToPaperPoint:function(x,y){var localPoint=new Point(x,y);var paperPoint=V.transformPoint(localPoint,this.matrix());return paperPoint},localToPaperRect:function(x,y,width,height){var localRect=new Rect(x,y,width,height);var paperRect=V.transformRect(localRect,this.matrix());return paperRect},paperToLocalPoint:function(x,y){var paperPoint=new Point(x,y);var localPoint=V.transformPoint(paperPoint,this.matrix().inverse());return localPoint},paperToLocalRect:function(x,y,width,height){var paperRect=new Rect(x,y,width,height);var localRect=V.transformRect(paperRect,this.matrix().inverse());return localRect},localToClientPoint:function(x,y){var localPoint=new Point(x,y);var clientPoint=V.transformPoint(localPoint,this.clientMatrix());return clientPoint},localToClientRect:function(x,y,width,height){var localRect=new Rect(x,y,width,height);var clientRect=V.transformRect(localRect,this.clientMatrix());return clientRect},clientToLocalPoint:function(x,y){var clientPoint=new Point(x,y);var localPoint=V.transformPoint(clientPoint,this.clientMatrix().inverse());return localPoint},clientToLocalRect:function(x,y,width,height){var clientRect=new Rect(x,y,width,height);var localRect=V.transformRect(clientRect,this.clientMatrix().inverse());return localRect},localToPagePoint:function(x,y){return this.localToPaperPoint(x,y).offset(this.pageOffset())},localToPageRect:function(x,y,width,height){return this.localToPaperRect(x,y,width,height).offset(this.pageOffset())},pageToLocalPoint:function(x,y){var pagePoint=new Point(x,y);var paperPoint=pagePoint.difference(this.pageOffset());return this.paperToLocalPoint(paperPoint)},pageToLocalRect:function(x,y,width,height){var pageOffset=this.pageOffset();var paperRect=new Rect(x,y,width,height);paperRect.x-=pageOffset.x;paperRect.y-=pageOffset.y;return this.paperToLocalRect(paperRect)},clientOffset:function(){var clientRect=this.svg.getBoundingClientRect();return new Point(clientRect.left,clientRect.top)},pageOffset:function(){return this.clientOffset().offset(window.scrollX,window.scrollY)},linkAllowed:function(linkView){if(!(linkView instanceof LinkView)){throw new Error("Must provide a linkView.")}var link=linkView.model;var paperOptions=this.options;var graph=this.model;var ns=graph.constructor.validations;if(!paperOptions.multiLinks){if(!ns.multiLinks.call(this,graph,link)){return false}}if(!paperOptions.linkPinning){if(!ns.linkPinning.call(this,graph,link)){return false}}if(typeof paperOptions.allowLink==="function"){if(!paperOptions.allowLink.call(this,linkView,this)){return false}}return true},getDefaultLink:function(cellView,magnet){return isFunction(this.options.defaultLink)?this.options.defaultLink.call(this,cellView,magnet):this.options.defaultLink.clone()},resolveHighlighter:function(opt){if(opt===void 0)opt={};var highlighterDef=opt.highlighter;var type=opt.type;var ref=this.options;var highlighting=ref.highlighting;var highlighterNamespace=ref.highlighterNamespace;if(highlighterDef===undefined){if(!highlighting){return false}if(type){highlighterDef=highlighting[type];if(highlighterDef===false){return false}}if(!highlighterDef){highlighterDef=highlighting["default"]}}if(!highlighterDef){return false}if(isString(highlighterDef)){highlighterDef={name:highlighterDef}}var name=highlighterDef.name;var highlighter=highlighterNamespace[name];if(!highlighter){throw new Error('Unknown highlighter ("'+name+'")')}if(typeof highlighter.highlight!=="function"){throw new Error('Highlighter ("'+name+'") is missing required highlight() method')}if(typeof highlighter.unhighlight!=="function"){throw new Error('Highlighter ("'+name+'") is missing required unhighlight() method')}return{highlighter:highlighter,options:highlighterDef.options||{},name:name}},onCellHighlight:function(cellView,magnetEl,opt){var highlighterDescriptor=this.resolveHighlighter(opt);if(!highlighterDescriptor){return}var highlighter=highlighterDescriptor.highlighter;var options=highlighterDescriptor.options;highlighter.highlight(cellView,magnetEl,options)},onCellUnhighlight:function(cellView,magnetEl,opt){var highlighterDescriptor=this.resolveHighlighter(opt);if(!highlighterDescriptor){return}var highlighter=highlighterDescriptor.highlighter;var options=highlighterDescriptor.options;highlighter.unhighlight(cellView,magnetEl,options)},pointerdblclick:function(evt){evt.preventDefault();evt=normalizeEvent(evt);var view=this.findView(evt.target);if(this.guard(evt,view)){return}var localPoint=this.snapToGrid(evt.clientX,evt.clientY);if(view){view.pointerdblclick(evt,localPoint.x,localPoint.y)}else{this.trigger("blank:pointerdblclick",evt,localPoint.x,localPoint.y)}},pointerclick:function(evt){var data=this.eventData(evt);if(data.mousemoved<=this.options.clickThreshold){evt=normalizeEvent(evt);var view=this.findView(evt.target);if(this.guard(evt,view)){return}var localPoint=this.snapToGrid(evt.clientX,evt.clientY);if(view){view.pointerclick(evt,localPoint.x,localPoint.y)}else{this.trigger("blank:pointerclick",evt,localPoint.x,localPoint.y)}}},contextmenu:function(evt){if(this.options.preventContextMenu){evt.preventDefault()}if(this.contextMenuFired){this.contextMenuFired=false;return}evt=normalizeEvent(evt);this.contextMenuTrigger(evt)},contextMenuTrigger:function(evt){var view=this.findView(evt.target);if(this.guard(evt,view)){return}var localPoint=this.snapToGrid(evt.clientX,evt.clientY);if(view){view.contextmenu(evt,localPoint.x,localPoint.y)}else{this.trigger("blank:contextmenu",evt,localPoint.x,localPoint.y)}},pointerdown:function(evt){evt=normalizeEvent(evt);if(evt.button===2){this.contextMenuFired=true;var contextmenuEvt=$.Event(evt,{type:"contextmenu",data:evt.data});this.contextMenuTrigger(contextmenuEvt)}else{var view=this.findView(evt.target);if(this.guard(evt,view)){return}var localPoint=this.snapToGrid(evt.clientX,evt.clientY);if(view){evt.preventDefault();view.pointerdown(evt,localPoint.x,localPoint.y)}else{if(this.options.preventDefaultBlankAction){evt.preventDefault()}this.trigger("blank:pointerdown",evt,localPoint.x,localPoint.y)}this.delegateDragEvents(view,evt.data)}},pointermove:function(evt){var data=this.eventData(evt);if(!data.mousemoved){data.mousemoved=0;this.undelegateEvents()}var mousemoved=++data.mousemoved;if(mousemoved<=this.options.moveThreshold){return}evt=normalizeEvent(evt);var localPoint=this.snapToGrid(evt.clientX,evt.clientY);var view=data.sourceView;if(view){view.pointermove(evt,localPoint.x,localPoint.y)}else{this.trigger("blank:pointermove",evt,localPoint.x,localPoint.y)}this.eventData(evt,data)},pointerup:function(evt){this.undelegateDocumentEvents();var normalizedEvt=normalizeEvent(evt);var localPoint=this.snapToGrid(normalizedEvt.clientX,normalizedEvt.clientY);var view=this.eventData(evt).sourceView;if(view){view.pointerup(normalizedEvt,localPoint.x,localPoint.y)}else{this.trigger("blank:pointerup",normalizedEvt,localPoint.x,localPoint.y)}if(!normalizedEvt.isPropagationStopped()){this.pointerclick($.Event(evt,{type:"click",data:evt.data}))}evt.stopImmediatePropagation();this.delegateEvents()},mouseover:function(evt){evt=normalizeEvent(evt);var view=this.findView(evt.target);if(this.guard(evt,view)){return}if(view){view.mouseover(evt)}else{if(this.el===evt.target){return}this.trigger("blank:mouseover",evt)}},mouseout:function(evt){evt=normalizeEvent(evt);var view=this.findView(evt.target);if(this.guard(evt,view)){return}if(view){view.mouseout(evt)}else{if(this.el===evt.target){return}this.trigger("blank:mouseout",evt)}},mouseenter:function(evt){evt=normalizeEvent(evt);var target=evt.target;var relatedTarget=evt.relatedTarget;var currentTarget=evt.currentTarget;var view=this.findView(target);if(this.guard(evt,view)){return}var relatedView=this.findView(relatedTarget);if(view){if(relatedView===view){return}view.mouseenter(evt);if(this.el.contains(relatedTarget)){return}}if(relatedView){return}if(currentTarget===this.el){this.trigger("paper:mouseenter",evt)}},mouseleave:function(evt){evt=normalizeEvent(evt);var target=evt.target;var relatedTarget=evt.relatedTarget;var currentTarget=evt.currentTarget;var view=this.findView(target);if(this.guard(evt,view)){return}var relatedView=this.findView(relatedTarget);if(view){if(relatedView===view){return}view.mouseleave(evt);if(this.el.contains(relatedTarget)){return}}if(relatedView){return}if(currentTarget===this.el){this.trigger("paper:mouseleave",evt)}},_processMouseWheelEvtBuf:debounce(function(){var ref=this._mw_evt_buffer;var event=ref.event;var deltas=ref.deltas;var deltaY=deltas.reduce(function(acc,deltaY){return acc+cap(deltaY,WHEEL_CAP)},0);var scale=Math.pow(.995,deltaY);var ref$1=this.clientToLocalPoint(event.clientX,event.clientY);var x=ref$1.x;var y=ref$1.y;this.trigger("paper:pinch",event,x,y,scale);this._mw_evt_buffer={event:null,deltas:[]}},WHEEL_WAIT_MS,{maxWait:WHEEL_WAIT_MS}),mousewheel:function(evt){evt=normalizeEvent(evt);var view=this.findView(evt.target);if(this.guard(evt,view)){return}var originalEvent=evt.originalEvent;var localPoint=this.snapToGrid(originalEvent.clientX,originalEvent.clientY);var ref=normalizeWheel(originalEvent);var deltaX=ref.deltaX;var deltaY=ref.deltaY;if(evt.ctrlKey){var handlers=this._events["paper:pinch"];if(handlers&&handlers.length>0){originalEvent.preventDefault();this._mw_evt_buffer.event=originalEvent;this._mw_evt_buffer.deltas.push(deltaY);this._processMouseWheelEvtBuf()}}else{var delta=Math.max(-1,Math.min(1,originalEvent.wheelDelta));if(view){view.mousewheel(evt,localPoint.x,localPoint.y,delta)}else{this.trigger("blank:mousewheel",evt,localPoint.x,localPoint.y,delta)}this.trigger("paper:pan",evt,deltaX,deltaY)}},onevent:function(evt){var eventNode=evt.currentTarget;var eventName=eventNode.getAttribute("event");if(eventName){var view=this.findView(eventNode);if(view){evt=normalizeEvent(evt);if(this.guard(evt,view)){return}var localPoint=this.snapToGrid(evt.clientX,evt.clientY);view.onevent(evt,eventName,localPoint.x,localPoint.y)}}},magnetEvent:function(evt,handler){var magnetNode=evt.currentTarget;var magnetValue=magnetNode.getAttribute("magnet");if(magnetValue){var view=this.findView(magnetNode);if(view){evt=normalizeEvent(evt);if(this.guard(evt,view)){return}var localPoint=this.snapToGrid(evt.clientX,evt.clientY);handler.call(this,view,evt,magnetNode,localPoint.x,localPoint.y)}}},onmagnet:function(evt){if(evt.button===2){this.contextMenuFired=true;this.magnetContextMenuFired=true;var contextmenuEvt=$.Event(evt,{type:"contextmenu",data:evt.data});this.magnetContextMenuTrigger(contextmenuEvt);if(contextmenuEvt.isPropagationStopped()){evt.stopPropagation()}}else{this.magnetEvent(evt,function(view,evt,_,x,y){view.onmagnet(evt,x,y)})}},magnetpointerdblclick:function(evt){this.magnetEvent(evt,function(view,evt,magnet,x,y){view.magnetpointerdblclick(evt,magnet,x,y)})},magnetcontextmenu:function(evt){if(this.options.preventContextMenu){evt.preventDefault()}if(this.magnetContextMenuFired){this.magnetContextMenuFired=false;return}this.magnetContextMenuTrigger(evt)},magnetContextMenuTrigger:function(evt){this.magnetEvent(evt,function(view,evt,magnet,x,y){view.magnetcontextmenu(evt,magnet,x,y)})},onlabel:function(evt){var labelNode=evt.currentTarget;var view=this.findView(labelNode);if(view){evt=normalizeEvent(evt);if(this.guard(evt,view)){return}var localPoint=this.snapToGrid(evt.clientX,evt.clientY);view.onlabel(evt,localPoint.x,localPoint.y)}},getPointerArgs:function getPointerArgs(evt){var normalizedEvt=normalizeEvent(evt);var ref=this.snapToGrid(normalizedEvt.clientX,normalizedEvt.clientY);var x=ref.x;var y=ref.y;return[normalizedEvt,x,y]},delegateDragEvents:function(view,data){data||(data={});this.eventData({data:data},{sourceView:view||null,mousemoved:0});this.delegateDocumentEvents(null,data)},guard:function(evt,view){if(evt.type==="mousedown"&&evt.button===2){return true}if(this.options.guard&&this.options.guard(evt,view)){return true}if(evt.data&&evt.data.guarded!==undefined){return evt.data.guarded}if(view&&view.model&&view.model instanceof Cell){return false}if(this.svg===evt.target||this.el===evt.target||$.contains(this.svg,evt.target)){return false}return true},setGridSize:function(gridSize){this.options.gridSize=gridSize;if(this.options.drawGrid){this.drawGrid()}return this},clearGrid:function(){if(this.$grid){this.$grid.css("backgroundImage","none")}return this},_getGridRefs:function(){if(!this._gridCache){this._gridCache={root:V("svg",{width:"100%",height:"100%"},V("defs")),patterns:{},add:function(id,vel){V(this.root.node.childNodes[0]).append(vel);this.patterns[id]=vel;this.root.append(V("rect",{width:"100%",height:"100%",fill:"url(#"+id+")"}))},get:function(id){return this.patterns[id]},exist:function(id){return this.patterns[id]!==undefined}}}return this._gridCache},setGrid:function(drawGrid){this.clearGrid();this._gridCache=null;this._gridSettings=[];var optionsList=Array.isArray(drawGrid)?drawGrid:[drawGrid||{}];optionsList.forEach(function(item){this._gridSettings.push.apply(this._gridSettings,this._resolveDrawGridOption(item))},this);return this},_resolveDrawGridOption:function(opt){var namespace=this.constructor.gridPatterns;if(isString(opt)&&Array.isArray(namespace[opt])){return namespace[opt].map(function(item){return assign({},item)})}var options=opt||{args:[{}]};var isArray=Array.isArray(options);var name=options.name;if(!isArray&&!name&&!options.markup){name="dot"}if(name&&Array.isArray(namespace[name])){var pattern=namespace[name].map(function(item){return assign({},item)});var args=Array.isArray(options.args)?options.args:[options.args||{}];defaults(args[0],omit(opt,"args"));for(var i=0;i<args.length;i++){if(pattern[i]){assign(pattern[i],args[i])}}return pattern}return isArray?options:[options]},drawGrid:function(opt){var gridSize=this.options.gridSize;if(gridSize<=1){return this.clearGrid()}var localOptions=Array.isArray(opt)?opt:[opt];var ctm=this.matrix();var refs=this._getGridRefs();this._gridSettings.forEach(function(gridLayerSetting,index){var id="pattern_"+index;var options=merge(gridLayerSetting,localOptions[index],{sx:ctm.a||1,sy:ctm.d||1,ox:ctm.e||0,oy:ctm.f||0});options.width=gridSize*(ctm.a||1)*(options.scaleFactor||1);options.height=gridSize*(ctm.d||1)*(options.scaleFactor||1);if(!refs.exist(id)){refs.add(id,V("pattern",{id:id,patternUnits:"userSpaceOnUse"},V(options.markup)))}var patternDefVel=refs.get(id);if(isFunction(options.update)){options.update(patternDefVel.node.childNodes[0],options)}var x=options.ox%options.width;if(x<0){x+=options.width}var y=options.oy%options.height;if(y<0){y+=options.height}patternDefVel.attr({x:x,y:y,width:options.width,height:options.height})});var patternUri=(new XMLSerializer).serializeToString(refs.root.node);patternUri="url(data:image/svg+xml;base64,"+btoa(patternUri)+")";this.$grid.css("backgroundImage",patternUri);return this},updateBackgroundImage:function(opt){opt=opt||{};var backgroundPosition=opt.position||"center";var backgroundSize=opt.size||"auto auto";var currentScale=this.scale();var currentTranslate=this.translate();if(isObject$1(backgroundPosition)){var x=currentTranslate.tx+currentScale.sx*(backgroundPosition.x||0);var y=currentTranslate.ty+currentScale.sy*(backgroundPosition.y||0);backgroundPosition=x+"px "+y+"px"}if(isObject$1(backgroundSize)){backgroundSize=new Rect(backgroundSize).scale(currentScale.sx,currentScale.sy);backgroundSize=backgroundSize.width+"px "+backgroundSize.height+"px"}this.$background.css({backgroundSize:backgroundSize,backgroundPosition:backgroundPosition})},drawBackgroundImage:function(img,opt){if(!(img instanceof HTMLImageElement)){this.$background.css("backgroundImage","");return}if(!this._background||this._background.id!==opt.id){return}opt=opt||{};var backgroundImage;var backgroundSize=opt.size;var backgroundRepeat=opt.repeat||"no-repeat";var backgroundOpacity=opt.opacity||1;var backgroundQuality=Math.abs(opt.quality)||1;var backgroundPattern=this.constructor.backgroundPatterns[camelCase(backgroundRepeat)];if(isFunction(backgroundPattern)){img.width*=backgroundQuality;img.height*=backgroundQuality;var canvas=backgroundPattern(img,opt);if(!(canvas instanceof HTMLCanvasElement)){throw new Error("dia.Paper: background pattern must return an HTML Canvas instance")}backgroundImage=canvas.toDataURL("image/png");backgroundRepeat="repeat";if(isObject$1(backgroundSize)){backgroundSize.width*=canvas.width/img.width;backgroundSize.height*=canvas.height/img.height}else if(backgroundSize===undefined){opt.size={width:canvas.width/backgroundQuality,height:canvas.height/backgroundQuality}}}else{backgroundImage=img.src;if(backgroundSize===undefined){opt.size={width:img.width,height:img.height}}}this.$background.css({opacity:backgroundOpacity,backgroundRepeat:backgroundRepeat,backgroundImage:"url("+backgroundImage+")"});this.updateBackgroundImage(opt)},updateBackgroundColor:function(color){this.$el.css("backgroundColor",color||"")},drawBackground:function(opt){opt=opt||{};this.updateBackgroundColor(opt.color);if(opt.image){opt=this._background=cloneDeep(opt);guid(opt);var img=document.createElement("img");img.onload=this.drawBackgroundImage.bind(this,img,opt);img.src=opt.image}else{this.drawBackgroundImage(null);this._background=null}return this},setInteractivity:function(value){this.options.interactive=value;invoke(this._views,"setInteractivity",value)},isDefined:function(defId){return!!this.svg.getElementById(defId)},defineFilter:function(filter$1){if(!isObject$1(filter$1)){throw new TypeError("dia.Paper: defineFilter() requires 1. argument to be an object.")}var filterId=filter$1.id;var name=filter$1.name;if(!filterId){filterId=name+this.svg.id+hashCode(JSON.stringify(filter$1))}if(!this.isDefined(filterId)){var namespace=filter;var filterSVGString=namespace[name]&&namespace[name](filter$1.args||{});if(!filterSVGString){throw new Error("Non-existing filter "+name)}var filterAttrs=assign({filterUnits:"objectBoundingBox",x:-1,y:-1,width:3,height:3},filter$1.attrs,{id:filterId});V(filterSVGString,filterAttrs).appendTo(this.defs)}return filterId},defineGradient:function(gradient){if(!isObject$1(gradient)){throw new TypeError("dia.Paper: defineGradient() requires 1. argument to be an object.")}var ref=this;var svg=ref.svg;var defs=ref.defs;var type=gradient.type;var id=gradient.id;if(id===void 0)id=type+svg.id+hashCode(JSON.stringify(gradient));var stops=gradient.stops;var attrs=gradient.attrs;if(attrs===void 0)attrs={};if(this.isDefined(id)){return id}var stopVEls=toArray(stops).map(function(ref){var offset=ref.offset;var color=ref.color;var opacity=ref.opacity;return V("stop").attr({offset:offset,"stop-color":color,"stop-opacity":Number.isFinite(opacity)?opacity:1})});var gradientVEl=V(type,attrs,stopVEls);gradientVEl.id=id;gradientVEl.appendTo(defs);return id},definePattern:function(pattern){if(!isObject$1(pattern)){throw new TypeError("dia.Paper: definePattern() requires 1. argument to be an object.")}var ref=this;var svg=ref.svg;var defs=ref.defs;var id=pattern.id;if(id===void 0)id=svg.id+hashCode(JSON.stringify(pattern));var markup=pattern.markup;var attrs=pattern.attrs;if(attrs===void 0)attrs={};if(!markup){throw new TypeError("dia.Paper: definePattern() requires markup.")}if(this.isDefined(id)){return id}var patternVEl=V("pattern",{patternUnits:"userSpaceOnUse"});patternVEl.id=id;patternVEl.attr(attrs);if(typeof markup==="string"){patternVEl.append(V(markup))}else{var ref$1=parseDOMJSON(markup);var fragment=ref$1.fragment;patternVEl.append(fragment)}patternVEl.appendTo(defs);return id},defineMarker:function(marker){if(!isObject$1(marker)){throw new TypeError("dia.Paper: defineMarker() requires 1. argument to be an object.")}var ref=this;var svg=ref.svg;var defs=ref.defs;var id=marker.id;if(id===void 0)id=svg.id+hashCode(JSON.stringify(marker));var markup=marker.markup;var attrs=marker.attrs;if(attrs===void 0)attrs={};var markerUnits=marker.markerUnits;if(markerUnits===void 0)markerUnits="userSpaceOnUse";if(this.isDefined(id)){return id}var markerVEl=V("marker",{orient:"auto",overflow:"visible",markerUnits:markerUnits});markerVEl.id=id;markerVEl.attr(attrs);if(markup){if(typeof markup==="string"){markerVEl.append(V(markup))}else{var ref$1=parseDOMJSON(markup);var fragment=ref$1.fragment;markerVEl.append(fragment)}}else{var type=marker.type;if(type===void 0)type="path";var markerContentVEl=V(type,omit(marker,"type","id","markup","attrs","markerUnits"));markerVEl.append(markerContentVEl)}markerVEl.appendTo(defs);return id}},{sorting:sortingTypes,Layers:LayersNames,backgroundPatterns:{flipXy:function(img){var canvas=document.createElement("canvas");var imgWidth=img.width;var imgHeight=img.height;canvas.width=2*imgWidth;canvas.height=2*imgHeight;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0,imgWidth,imgHeight);ctx.setTransform(-1,0,0,-1,canvas.width,canvas.height);ctx.drawImage(img,0,0,imgWidth,imgHeight);ctx.setTransform(-1,0,0,1,canvas.width,0);ctx.drawImage(img,0,0,imgWidth,imgHeight);ctx.setTransform(1,0,0,-1,0,canvas.height);ctx.drawImage(img,0,0,imgWidth,imgHeight);return canvas},flipX:function(img){var canvas=document.createElement("canvas");var imgWidth=img.width;var imgHeight=img.height;canvas.width=imgWidth*2;canvas.height=imgHeight;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0,imgWidth,imgHeight);ctx.translate(2*imgWidth,0);ctx.scale(-1,1);ctx.drawImage(img,0,0,imgWidth,imgHeight);return canvas},flipY:function(img){var canvas=document.createElement("canvas");var imgWidth=img.width;var imgHeight=img.height;canvas.width=imgWidth;canvas.height=imgHeight*2;var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0,imgWidth,imgHeight);ctx.translate(0,2*imgHeight);ctx.scale(1,-1);ctx.drawImage(img,0,0,imgWidth,imgHeight);return canvas},watermark:function(img,opt){opt=opt||{};var imgWidth=img.width;var imgHeight=img.height;var canvas=document.createElement("canvas");canvas.width=imgWidth*3;canvas.height=imgHeight*3;var ctx=canvas.getContext("2d");var angle=isNumber(opt.watermarkAngle)?-opt.watermarkAngle:-20;var radians=toRad(angle);var stepX=canvas.width/4;var stepY=canvas.height/4;for(var i=0;i<4;i++){for(var j=0;j<4;j++){if((i+j)%2>0){ctx.setTransform(1,0,0,1,(2*i-1)*stepX,(2*j-1)*stepY);ctx.rotate(radians);ctx.drawImage(img,-imgWidth/2,-imgHeight/2,imgWidth,imgHeight)}}}return canvas}},gridPatterns:{dot:[{color:"#AAAAAA",thickness:1,markup:"rect",update:function(el,opt){V(el).attr({width:opt.thickness*opt.sx,height:opt.thickness*opt.sy,fill:opt.color})}}],fixedDot:[{color:"#AAAAAA",thickness:1,markup:"rect",update:function(el,opt){var size=opt.sx<=1?opt.thickness*opt.sx:opt.thickness;V(el).attr({width:size,height:size,fill:opt.color})}}],mesh:[{color:"#AAAAAA",thickness:1,markup:"path",update:function(el,opt){var d;var width=opt.width;var height=opt.height;var thickness=opt.thickness;if(width-thickness>=0&&height-thickness>=0){d=["M",width,0,"H0 M0 0 V0",height].join(" ")}else{d="M 0 0 0 0"}V(el).attr({d:d,stroke:opt.color,"stroke-width":opt.thickness})}}],doubleMesh:[{color:"#AAAAAA",thickness:1,markup:"path",update:function(el,opt){var d;var width=opt.width;var height=opt.height;var thickness=opt.thickness;if(width-thickness>=0&&height-thickness>=0){d=["M",width,0,"H0 M0 0 V0",height].join(" ")}else{d="M 0 0 0 0"}V(el).attr({d:d,stroke:opt.color,"stroke-width":opt.thickness})}},{color:"#000000",thickness:3,scaleFactor:4,markup:"path",update:function(el,opt){var d;var width=opt.width;var height=opt.height;var thickness=opt.thickness;if(width-thickness>=0&&height-thickness>=0){d=["M",width,0,"H0 M0 0 V0",height].join(" ")}else{d="M 0 0 0 0"}V(el).attr({d:d,stroke:opt.color,"stroke-width":opt.thickness})}}]}});var ToolView=View.extend({name:null,tagName:"g",className:"tool",svgElement:true,_visible:true,init:function(){var name=this.name;if(name){this.vel.attr("data-tool-name",name)}},configure:function(view,toolsView){this.relatedView=view;this.paper=view.paper;this.parentView=toolsView;this.simulateRelatedView(this.el);this.delegateEvents();return this},simulateRelatedView:function(el){if(el){el.setAttribute("model-id",this.relatedView.model.id)}},getName:function(){return this.name},show:function(){this.el.style.display="";this._visible=true},hide:function(){this.el.style.display="none";this._visible=false},isVisible:function(){return!!this._visible},focus:function(){var opacity=this.options.focusOpacity;if(isFinite(opacity)){this.el.style.opacity=opacity}this.parentView.focusTool(this)},blur:function(){this.el.style.opacity="";this.parentView.blurTool(this)},update:function(){},guard:function(evt){var ref=this;var paper=ref.paper;var relatedView=ref.relatedView;if(!paper||!relatedView){return true}return paper.guard(evt,relatedView)}});var ToolsView=View.extend({tagName:"g",className:"tools",svgElement:true,tools:null,isRendered:false,options:{tools:null,relatedView:null,name:null},configure:function(options){options=assign(this.options,options);var tools=options.tools;if(!Array.isArray(tools)){return this}var relatedView=options.relatedView;if(!(relatedView instanceof CellView)){return this}var views=this.tools=[];for(var i=0,n=tools.length;i<n;i++){var tool=tools[i];if(!(tool instanceof ToolView)){continue}tool.configure(relatedView,this);this.vel.append(tool.el);views.push(tool)}this.isRendered=false;relatedView.requestUpdate(relatedView.getFlag("TOOLS"));return this},getName:function(){return this.options.name},update:function(opt){opt||(opt={});var tools=this.tools;if(!tools){return this}var isRendered=this.isRendered;for(var i=0,n=tools.length;i<n;i++){var tool=tools[i];if(!isRendered){tool.render()}else if(opt.tool!==tool.cid&&tool.isVisible()){tool.update()}}if(!isRendered){this.mount();this.blurTool();this.isRendered=true}return this},focusTool:function(focusedTool){var tools=this.tools;if(!tools){return this}for(var i=0,n=tools.length;i<n;i++){var tool=tools[i];if(focusedTool===tool){tool.show()}else{tool.hide()}}return this},blurTool:function(blurredTool){var tools=this.tools;if(!tools){return this}for(var i=0,n=tools.length;i<n;i++){var tool=tools[i];if(tool!==blurredTool&&!tool.isVisible()){tool.show();tool.update()}}return this},hide:function(){return this.focusTool(null)},show:function(){return this.blurTool(null)},onRemove:function(){var tools=this.tools;if(!tools){return this}for(var i=0,n=tools.length;i<n;i++){tools[i].remove()}this.tools=null},mount:function(){var ref=this;var options=ref.options;var el=ref.el;var relatedView=options.relatedView;var layer=options.layer;if(layer===void 0)layer=LayersNames.TOOLS;var z=options.z;if(relatedView){if(layer){relatedView.paper.getLayerView(layer).insertSortedNode(el,z)}else{relatedView.el.appendChild(el)}}return this}});var index$2={Graph:Graph,attributes:attributes,LayersNames:LayersNames,PaperLayer:PaperLayer,Cell:Cell,CellView:CellView,Element:Element$1,ElementView:ElementView,Link:Link,LinkView:LinkView,Paper:Paper,ToolView:ToolView,ToolsView:ToolsView,HighlighterView:HighlighterView};var DirectedGraph={exportElement:function(element){return element.size()},exportLink:function(link){var labelSize=link.get("labelSize")||{};var edge={minLen:link.get("minLen")||1,weight:link.get("weight")||1,labelpos:link.get("labelPosition")||"c",labeloffset:link.get("labelOffset")||0,width:labelSize.width||0,height:labelSize.height||0};return edge},importElement:function(opt,v,gl){var element=this.getCell(v);var glNode=gl.node(v);if(opt.setPosition){opt.setPosition(element,glNode)}else{element.set("position",{x:glNode.x-glNode.width/2,y:glNode.y-glNode.height/2})}},importLink:function(opt,edgeObj,gl){var SIMPLIFY_THRESHOLD=.001;var link=this.getCell(edgeObj.name);var glEdge=gl.edge(edgeObj);var points=glEdge.points||[];var polyline=new Polyline(points);if(opt.setVertices||opt.setLinkVertices){if(isFunction(opt.setVertices)){opt.setVertices(link,points)}else{polyline.simplify({threshold:SIMPLIFY_THRESHOLD});var polylinePoints=polyline.points.map(function(point){return point.toJSON()});var numPolylinePoints=polylinePoints.length;link.set("vertices",polylinePoints.slice(1,numPolylinePoints-1))}}if(opt.setLabels&&"x"in glEdge&&"y"in glEdge){var labelPosition={x:glEdge.x,y:glEdge.y};if(isFunction(opt.setLabels)){opt.setLabels(link,labelPosition,points)}else{var length=polyline.closestPointLength(labelPosition);var closestPoint=polyline.pointAtLength(length);var distance=length/polyline.length();var offset=new Point(labelPosition).difference(closestPoint).toJSON();link.label(0,{position:{distance:distance,offset:offset}})}}},layout:function(graphOrCells,opt){var graph;if(graphOrCells instanceof Graph){graph=graphOrCells}else{graph=(new Graph).resetCells(graphOrCells,{dry:true,sort:false})}graphOrCells=null;opt=defaults(opt||{},{resizeClusters:true,clusterPadding:10,exportElement:this.exportElement,exportLink:this.exportLink});var dagreUtil=opt.dagre||(typeof dagre!=="undefined"?dagre:undefined);if(dagreUtil===undefined){throw new Error('The the "dagre" utility is a mandatory dependency.')}var glGraph=DirectedGraph.toGraphLib(graph,{graphlib:opt.graphlib,directed:true,multigraph:true,compound:true,setNodeLabel:opt.exportElement,setEdgeLabel:opt.exportLink,setEdgeName:function(link){return link.id}});var glLabel={};var marginX=opt.marginX||0;var marginY=opt.marginY||0;if(opt.rankDir){glLabel.rankdir=opt.rankDir}if(opt.align){glLabel.align=opt.align}if(opt.nodeSep){glLabel.nodesep=opt.nodeSep}if(opt.edgeSep){glLabel.edgesep=opt.edgeSep}if(opt.rankSep){glLabel.ranksep=opt.rankSep}if(opt.ranker){glLabel.ranker=opt.ranker}if(marginX){glLabel.marginx=marginX}if(marginY){glLabel.marginy=marginY}glGraph.setGraph(glLabel);dagreUtil.layout(glGraph,{debugTiming:!!opt.debugTiming});graph.startBatch("layout");DirectedGraph.fromGraphLib(glGraph,{importNode:this.importElement.bind(graph,opt),importEdge:this.importLink.bind(graph,opt)});if(opt.resizeClusters){var clusters=glGraph.nodes().filter(function(v){return glGraph.children(v).length>0}).map(graph.getCell.bind(graph)).sort(function(aCluster,bCluster){return bCluster.getAncestors().length-aCluster.getAncestors().length});invoke(clusters,"fitEmbeds",{padding:opt.clusterPadding})}graph.stopBatch("layout");var glSize=glGraph.graph();return new Rect(marginX,marginY,Math.abs(glSize.width-2*marginX),Math.abs(glSize.height-2*marginY))},fromGraphLib:function(glGraph,opt){opt=opt||{};var importNode=opt.importNode||noop;var importEdge=opt.importEdge||noop;var graph=this instanceof Graph?this:new Graph;glGraph.nodes().forEach(function(node){importNode.call(graph,node,glGraph,graph,opt)});glGraph.edges().forEach(function(edge){importEdge.call(graph,edge,glGraph,graph,opt)});return graph},toGraphLib:function(graph,opt){opt=opt||{};var graphlibUtil=opt.graphlib||(typeof graphlib!=="undefined"?graphlib:undefined);if(graphlibUtil===undefined){throw new Error('The the "graphlib" utility is a mandatory dependency.')}var glGraphType=pick(opt,"directed","compound","multigraph");var glGraph=new graphlibUtil.Graph(glGraphType);var setNodeLabel=opt.setNodeLabel||noop;var setEdgeLabel=opt.setEdgeLabel||noop;var setEdgeName=opt.setEdgeName||noop;var collection=graph.get("cells");for(var i=0,n=collection.length;i<n;i++){var cell=collection.at(i);if(cell.isLink()){var source=cell.get("source");var target=cell.get("target");if(!source.id||!target.id){break}glGraph.setEdge(source.id,target.id,setEdgeLabel(cell),setEdgeName(cell))}else{glGraph.setNode(cell.id,setNodeLabel(cell));if(glGraph.isCompound()&&cell.has("parent")){var parentId=cell.get("parent");if(collection.has(parentId)){glGraph.setParent(cell.id,parentId)}}}}return glGraph}};Graph.prototype.toGraphLib=function(opt){return DirectedGraph.toGraphLib(this,opt)};Graph.prototype.fromGraphLib=function(glGraph,opt){return DirectedGraph.fromGraphLib.call(this,glGraph,opt)};var env={_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))}},addTest:function(name,fn){return this._tests[name]=fn},test:function(name){var fn=this._tests[name];if(!fn){throw new Error('Test not defined ("'+name+'"). Use `joint.env.addTest(name, fn) to add a new test.`')}var result=this._results[name];if(typeof result!=="undefined"){return result}try{result=fn()}catch(error){result=false}this._results[name]=result;return result}};var Generic=Element$1.define("basic.Generic",{attrs:{".":{fill:"#ffffff",stroke:"none"}}});var Rect$1=Generic.define("basic.Rect",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:100,height:60},text:{fill:"#000000",text:"","font-size":14,"ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>'});var TextView=ElementView.extend({presentationAttributes:ElementView.addPresentationAttributes({attrs:["SCALE"]}),confirmUpdate:function(){var flags=ElementView.prototype.confirmUpdate.apply(this,arguments);if(this.hasFlag(flags,"SCALE")){this.resize();flags=this.removeFlag(flags,"SCALE")}return flags}});var Text=Generic.define("basic.Text",{attrs:{text:{"font-size":18,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><text/></g></g>'});var Circle=Generic.define("basic.Circle",{size:{width:60,height:60},attrs:{circle:{fill:"#ffffff",stroke:"#000000",r:30,cx:30,cy:30},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>'});var Ellipse$1=Generic.define("basic.Ellipse",{size:{width:60,height:40},attrs:{ellipse:{fill:"#ffffff",stroke:"#000000",rx:30,ry:20,cx:30,cy:20},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse/></g><text/></g>'});var Polygon$1=Generic.define("basic.Polygon",{size:{width:60,height:40},attrs:{polygon:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'});var Polyline$1=Generic.define("basic.Polyline",{size:{width:60,height:40},attrs:{polyline:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><polyline/></g><text/></g>'});var Image=Generic.define("basic.Image",{attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>'});var Path$1=Generic.define("basic.Path",{size:{width:60,height:60},attrs:{path:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle",ref:"path","ref-x":.5,"ref-dy":10,fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},{markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>'});var Rhombus=Path$1.define("basic.Rhombus",{attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":.5,"ref-dy":null,"y-alignment":"middle"}}});var svgForeignObjectSupported=env.test("svgforeignobject");var TextBlock=Generic.define("basic.TextBlock",{attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},{markup:['<g class="rotatable">','<g class="scalable"><rect/></g>',svgForeignObjectSupported?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>',"</g>"].join(""),initialize:function(){this.listenTo(this,"change:size",this.updateSize);this.listenTo(this,"change:content",this.updateContent);this.updateSize(this,this.get("size"));this.updateContent(this,this.get("content"));Generic.prototype.initialize.apply(this,arguments)},updateSize:function(cell,size){this.attr({".fobj":assign({},size),div:{style:assign({},size)}})},updateContent:function(cell,content){if(svgForeignObjectSupported){this.attr({".content":{html:sanitizeHTML(content)}})}else{this.attr({".content":{text:content}})}},setForeignObjectSize:function(){this.updateSize.apply(this,arguments)},setDivContent:function(){this.updateContent.apply(this,arguments)}});var TextBlockView=ElementView.extend({presentationAttributes:svgForeignObjectSupported?ElementView.prototype.presentationAttributes:ElementView.addPresentationAttributes({content:["CONTENT"],size:["CONTENT"]}),initFlag:["RENDER","CONTENT"],confirmUpdate:function(){var flags=ElementView.prototype.confirmUpdate.apply(this,arguments);if(this.hasFlag(flags,"CONTENT")){this.updateContent(this.model);flags=this.removeFlag(flags,"CONTENT")}return flags},update:function(_,renderingOnlyAttrs){var model=this.model;if(!svgForeignObjectSupported){var noTextAttrs=omit(renderingOnlyAttrs||model.get("attrs"),".content");ElementView.prototype.update.call(this,model,noTextAttrs);if(!renderingOnlyAttrs||has$2(renderingOnlyAttrs,".content")){this.updateContent(model,renderingOnlyAttrs)}}else{ElementView.prototype.update.call(this,model,renderingOnlyAttrs)}},updateContent:function(cell,renderingOnlyAttrs){var textAttrs=merge({},(renderingOnlyAttrs||cell.get("attrs"))[".content"]);textAttrs=omit(textAttrs,"text");var text=breakText(cell.get("content"),cell.get("size"),textAttrs,{svgDocument:this.paper.svg});var attrs=setByPath({},".content",textAttrs,"/");attrs[".content"].text=text;ElementView.prototype.update.call(this,cell,attrs)}});var basic={Generic:Generic,Rect:Rect$1,TextView:TextView,Text:Text,Circle:Circle,Ellipse:Ellipse$1,Polygon:Polygon$1,Polyline:Polyline$1,Image:Image,Path:Path$1,Rhombus:Rhombus,TextBlock:TextBlock,TextBlockView:TextBlockView};var Rectangle=Element$1.define("standard.Rectangle",{attrs:{body:{refWidth:"100%",refHeight:"100%",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}]});var Circle$1=Element$1.define("standard.Circle",{attrs:{body:{refCx:"50%",refCy:"50%",refR:"50%",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}]});var Ellipse$2=Element$1.define("standard.Ellipse",{attrs:{body:{refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"body"},{tagName:"text",selector:"label"}]});var Path$2=Element$1.define("standard.Path",{attrs:{body:{refD:"M 0 0 L 10 0 10 10 0 10 Z",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}]});var Polygon$2=Element$1.define("standard.Polygon",{attrs:{body:{refPoints:"0 0 10 0 10 10 0 10",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"}]});var Polyline$2=Element$1.define("standard.Polyline",{attrs:{body:{refPoints:"0 0 10 0 10 10 0 10 0 0",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polyline",selector:"body"},{tagName:"text",selector:"label"}]});var Image$1=Element$1.define("standard.Image",{attrs:{image:{refWidth:"100%",refHeight:"100%"},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]});var BorderedImage=Element$1.define("standard.BorderedImage",{attrs:{border:{refWidth:"100%",refHeight:"100%",stroke:"#333333",strokeWidth:2},background:{refWidth:-1,refHeight:-1,x:.5,y:.5,fill:"#FFFFFF"},image:{refWidth:-1,refHeight:-1,x:.5,y:.5},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"background",attributes:{stroke:"none"}},{tagName:"image",selector:"image"},{tagName:"rect",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]});var EmbeddedImage=Element$1.define("standard.EmbeddedImage",{attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#333333",fill:"#FFFFFF",strokeWidth:2},image:{refWidth:"30%",refHeight:-20,x:10,y:10,preserveAspectRatio:"xMidYMin"},label:{textVerticalAnchor:"top",textAnchor:"left",refX:"30%",refX2:20,refY:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]});var InscribedImage=Element$1.define("standard.InscribedImage",{attrs:{border:{refRx:"50%",refRy:"50%",refCx:"50%",refCy:"50%",stroke:"#333333",strokeWidth:2},background:{refRx:"50%",refRy:"50%",refCx:"50%",refCy:"50%",fill:"#FFFFFF"},image:{refWidth:"68%",refHeight:"68%",refX:"16%",refY:"16%",preserveAspectRatio:"xMidYMid"},label:{textVerticalAnchor:"top",textAnchor:"middle",refX:"50%",refY:"100%",refY2:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"background"},{tagName:"image",selector:"image"},{tagName:"ellipse",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]});var HeaderedRectangle=Element$1.define("standard.HeaderedRectangle",{attrs:{body:{refWidth:"100%",refHeight:"100%",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},header:{refWidth:"100%",height:30,strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},headerText:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:15,fontSize:16,fill:"#333333"},bodyText:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",refY2:15,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerText"},{tagName:"text",selector:"bodyText"}]});var CYLINDER_TILT=10;var Cylinder=Element$1.define("standard.Cylinder",{attrs:{body:{lateralArea:CYLINDER_TILT,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},top:{refCx:"50%",cy:CYLINDER_TILT,refRx:"50%",ry:CYLINDER_TILT,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},label:{textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"100%",refY2:15,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"ellipse",selector:"top"},{tagName:"text",selector:"label"}],topRy:function(t,opt){if(t===undefined){return this.attr("body/lateralArea")}var isPercentageSetter=isPercentage(t);var bodyAttrs={lateralArea:t};var topAttrs=isPercentageSetter?{refCy:t,refRy:t,cy:null,ry:null}:{refCy:null,refRy:null,cy:t,ry:t};return this.attr({body:bodyAttrs,top:topAttrs},opt)}},{attributes:{lateralArea:{set:function(t,refBBox){var isPercentageSetter=isPercentage(t);if(isPercentageSetter){t=parseFloat(t)/100}var x=refBBox.x;var y=refBBox.y;var w=refBBox.width;var h=refBBox.height;var rx=w/2;var ry=isPercentageSetter?h*t:t;var kappa=V.KAPPA;var cx=kappa*rx;var cy=kappa*(isPercentageSetter?h*t:t);var xLeft=x;var xCenter=x+w/2;var xRight=x+w;var ySideTop=y+ry;var yCurveTop=ySideTop-ry;var ySideBottom=y+h-ry;var yCurveBottom=y+h;var data=["M",xLeft,ySideTop,"L",xLeft,ySideBottom,"C",x,ySideBottom+cy,xCenter-cx,yCurveBottom,xCenter,yCurveBottom,"C",xCenter+cx,yCurveBottom,xRight,ySideBottom+cy,xRight,ySideBottom,"L",xRight,ySideTop,"C",xRight,ySideTop-cy,xCenter+cx,yCurveTop,xCenter,yCurveTop,"C",xCenter-cx,yCurveTop,xLeft,ySideTop-cy,xLeft,ySideTop,"Z"];return{d:data.join(" ")}}}}});var foLabelMarkup={tagName:"foreignObject",selector:"foreignObject",attributes:{overflow:"hidden"},children:[{tagName:"div",namespaceURI:"http://www.w3.org/1999/xhtml",selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]};var svgLabelMarkup={tagName:"text",selector:"label",attributes:{"text-anchor":"middle"}};var labelMarkup=env.test("svgforeignobject")?foLabelMarkup:svgLabelMarkup;var TextBlock$1=Element$1.define("standard.TextBlock",{attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#333333",fill:"#ffffff",strokeWidth:2},foreignObject:{refWidth:"100%",refHeight:"100%"},label:{style:{fontSize:14}}}},{markup:[{tagName:"rect",selector:"body"},labelMarkup]},{attributes:{text:{set:function(text,refBBox,node,attrs){if(node instanceof HTMLElement){node.textContent=text}else{var style=attrs.style||{};var wrapValue={text:text,width:-5,height:"100%"};var wrapAttrs=assign({textVerticalAnchor:"middle"},style);attributes.textWrap.set.call(this,wrapValue,refBBox,node,wrapAttrs);return{fill:style.color||null}}},position:function(text,refBBox,node){if(node instanceof SVGElement){return refBBox.center()}}}}});var Link$1=Link.define("standard.Link",{attrs:{line:{connection:true,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 10 -5 0 0 10 5 z"}},wrapper:{connection:true,strokeWidth:10,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]});var DoubleLink=Link.define("standard.DoubleLink",{attrs:{line:{connection:true,stroke:"#DDDDDD",strokeWidth:4,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"#000000",d:"M 10 -3 10 -10 -2 0 10 10 10 3"}},outline:{connection:true,stroke:"#000000",strokeWidth:6,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"outline",attributes:{fill:"none"}},{tagName:"path",selector:"line",attributes:{fill:"none"}}]});var ShadowLink=Link.define("standard.ShadowLink",{attrs:{line:{connection:true,stroke:"#FF0000",strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"none",d:"M 0 -10 -10 0 0 10 z"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}},shadow:{connection:true,refX:3,refY:6,stroke:"#000000",strokeOpacity:.2,strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 0 -10 -10 0 0 10 z",stroke:"none"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}}}},{markup:[{tagName:"path",selector:"shadow",attributes:{fill:"none"}},{tagName:"path",selector:"line",attributes:{fill:"none"}}]});var standard={Rectangle:Rectangle,Circle:Circle$1,Ellipse:Ellipse$2,Path:Path$2,Polygon:Polygon$2,Polyline:Polyline$2,Image:Image$1,BorderedImage:BorderedImage,EmbeddedImage:EmbeddedImage,InscribedImage:InscribedImage,HeaderedRectangle:HeaderedRectangle,Cylinder:Cylinder,TextBlock:TextBlock$1,Link:Link$1,DoubleLink:DoubleLink,ShadowLink:ShadowLink};var Model=Generic.define("devs.Model",{inPorts:[],outPorts:[],size:{width:80,height:80},attrs:{".":{magnet:false},".label":{text:"Model","ref-x":.5,"ref-y":10,"font-size":18,"text-anchor":"middle",fill:"#000"},".body":{"ref-width":"100%","ref-height":"100%",stroke:"#000"}},ports:{groups:{in:{position:{name:"left"},attrs:{".port-label":{fill:"#000"},".port-body":{fill:"#fff",stroke:"#000",r:10,magnet:true}},label:{position:{name:"left",args:{y:10}}}},out:{position:{name:"right"},attrs:{".port-label":{fill:"#000"},".port-body":{fill:"#fff",stroke:"#000",r:10,magnet:true}},label:{position:{name:"right",args:{y:10}}}}}}},{markup:'<g class="rotatable"><rect class="body"/><text class="label"/></g>',portMarkup:'<circle class="port-body"/>',portLabelMarkup:'<text class="port-label"/>',initialize:function(){Generic.prototype.initialize.apply(this,arguments);this.on("change:inPorts change:outPorts",this.updatePortItems,this);this.updatePortItems()},updatePortItems:function(model,changed,opt){var inPorts=uniq(this.get("inPorts"));var outPorts=difference(uniq(this.get("outPorts")),inPorts);var inPortItems=this.createPortItems("in",inPorts);var outPortItems=this.createPortItems("out",outPorts);this.prop("ports/items",inPortItems.concat(outPortItems),assign({rewrite:true},opt))},createPortItem:function(group,port){return{id:port,group:group,attrs:{".port-label":{text:port}}}},createPortItems:function(group,ports){return toArray(ports).map(this.createPortItem.bind(this,group))},_addGroupPort:function(port,group,opt){var ports=this.get(group);return this.set(group,Array.isArray(ports)?ports.concat(port):[port],opt)},addOutPort:function(port,opt){return this._addGroupPort(port,"outPorts",opt)},addInPort:function(port,opt){return this._addGroupPort(port,"inPorts",opt)},_removeGroupPort:function(port,group,opt){return this.set(group,without(this.get(group),port),opt)},removeOutPort:function(port,opt){return this._removeGroupPort(port,"outPorts",opt)},removeInPort:function(port,opt){return this._removeGroupPort(port,"inPorts",opt)},_changeGroup:function(group,properties,opt){return this.prop("ports/groups/"+group,isObject$1(properties)?properties:{},opt)},changeInGroup:function(properties,opt){return this._changeGroup("in",properties,opt)},changeOutGroup:function(properties,opt){return this._changeGroup("out",properties,opt)}});var Atomic=Model.define("devs.Atomic",{size:{width:80,height:80},attrs:{".label":{text:"Atomic"}}});var Coupled=Model.define("devs.Coupled",{size:{width:200,height:300},attrs:{".label":{text:"Coupled"}}});var Link$2=Link.define("devs.Link",{attrs:{".connection":{"stroke-width":2}}});var devs={Model:Model,Atomic:Atomic,Coupled:Coupled,Link:Link$2};var Gate=Generic.define("logic.Gate",{size:{width:80,height:40},attrs:{".":{magnet:false},".body":{width:100,height:50},circle:{r:7,stroke:"black",fill:"transparent","stroke-width":2}}},{operation:function(){return true}});var IO=Gate.define("logic.IO",{size:{width:60,height:30},attrs:{".body":{fill:"white",stroke:"black","stroke-width":2},".wire":{ref:".body","ref-y":.5,stroke:"black"},text:{fill:"black",ref:".body","ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle","font-weight":"bold","font-variant":"small-caps","text-transform":"capitalize","font-size":"14px"}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><path class="wire"/><circle/><text/></g>'});var Input=IO.define("logic.Input",{attrs:{".wire":{"ref-dx":0,d:"M 0 0 L 23 0"},circle:{ref:".body","ref-dx":30,"ref-y":.5,magnet:true,class:"output",port:"out"},text:{text:"input"}}});var Output=IO.define("logic.Output",{attrs:{".wire":{"ref-x":0,d:"M 0 0 L -23 0"},circle:{ref:".body","ref-x":-30,"ref-y":.5,magnet:"passive",class:"input",port:"in"},text:{text:"output"}}});var Gate11=Gate.define("logic.Gate11",{attrs:{".input":{ref:".body","ref-x":-2,"ref-y":.5,magnet:"passive",port:"in"},".output":{ref:".body","ref-dx":2,"ref-y":.5,magnet:true,port:"out"}}},{markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input"/><circle class="output"/></g>'});var Gate21=Gate.define("logic.Gate21",{attrs:{".input1":{ref:".body","ref-x":-2,"ref-y":.3,magnet:"passive",port:"in1"},".input2":{ref:".body","ref-x":-2,"ref-y":.7,magnet:"passive",port:"in2"},".output":{ref:".body","ref-dx":2,"ref-y":.5,magnet:true,port:"out"}}},{markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input input1"/><circle  class="input input2"/><circle class="output"/></g>'});var Repeater=Gate11.define("logic.Repeater",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzIuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICA8L2c+Cjwvc3ZnPgo="}}},{operation:function(input){return input}});var Not=Gate11.define("logic.Not",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzkuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDI2NzEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzYiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA4MCwyNSBBIDQsNCAwIDEgMSA3MiwyNSBBIDQsNCAwIDEgMSA4MCwyNSB6IgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEsMCkiIC8+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(input){return!input}});var Or=Gate21.define("logic.Or",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik9SIEFOU0kuc3ZnIgogICBpbmtzY2FwZTpvdXRwdXRfZXh0ZW5zaW9uPSJvcmcuaW5rc2NhcGUub3V0cHV0LnN2Zy5pbmtzY2FwZSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTAgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjcxNCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iMSA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMC41IDogMC4zMzMzMzMzMyA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODA2IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODE5IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjM3Mi4wNDcyNCA6IDM1MC43ODczOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI3NDQuMDk0NDggOiA1MjYuMTgxMDkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzc3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49Ijc1IDogNDAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTUwIDogNjAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDYwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTMyNzUiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNTAgOiAzMy4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTAwIDogNTAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTU1MzMiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzIgOiAyMS4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNjQgOiAzMiA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMzIgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjU1NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDE2LjY2NjY2NyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDI1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAyNSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iNCIKICAgICBpbmtzY2FwZTpjeD0iMTEzLjAwMDM5IgogICAgIGlua3NjYXBlOmN5PSIxMi44OTM3MzEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImcyNTYwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpncmlkLWJib3g9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1wb2ludHM9InRydWUiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAwMDAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMzk5IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijg3NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMzciCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii00IgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNzAsMjUgYyAyMCwwIDI1LDAgMjUsMCIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMSwxNSA1LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzIsMzUgNSwzNSIKICAgICAgIGlkPSJwYXRoMzk0NCIgLz4KICAgIDxnCiAgICAgICBpZD0iZzI1NjAiCiAgICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2LjUsLTM5LjUpIj4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo="}}},{operation:function(input1,input2){return input1||input2}});var And=Gate21.define("logic.And",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IkFORCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI4IgogICAgIGlua3NjYXBlOmN4PSI1Ni42OTgzNDgiCiAgICAgaW5rc2NhcGU6Y3k9IjI1LjMyNjg5OSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTptZWRpdW07Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7bGluZS1oZWlnaHQ6bm9ybWFsO2xldHRlci1zcGFjaW5nOm5vcm1hbDt3b3JkLXNwYWNpbmc6bm9ybWFsO3RleHQtdHJhbnNmb3JtOm5vbmU7ZGlyZWN0aW9uOmx0cjtibG9jay1wcm9ncmVzc2lvbjp0Yjt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6c3RhcnQ7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDozO21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGU7Zm9udC1mYW1pbHk6Qml0c3RyZWFtIFZlcmEgU2FuczstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkJpdHN0cmVhbSBWZXJhIFNhbnMiCiAgICAgICBkPSJNIDMwLDUgTCAzMCw2LjQyODU3MTQgTCAzMCw0My41NzE0MjkgTCAzMCw0NSBMIDMxLjQyODU3MSw0NSBMIDUwLjQ3NjE5LDQ1IEMgNjEuNzQ0MDk4LDQ1IDcwLjQ3NjE5LDM1Ljk5OTk1NSA3MC40NzYxOSwyNSBDIDcwLjQ3NjE5LDE0LjAwMDA0NSA2MS43NDQwOTksNS4wMDAwMDAyIDUwLjQ3NjE5LDUgQyA1MC40NzYxOSw1IDUwLjQ3NjE5LDUgMzEuNDI4NTcxLDUgTCAzMCw1IHogTSAzMi44NTcxNDMsNy44NTcxNDI5IEMgNDAuODM0MjY0LDcuODU3MTQyOSA0NS45MTgzNjgsNy44NTcxNDI5IDQ4LjA5NTIzOCw3Ljg1NzE0MjkgQyA0OS4yODU3MTQsNy44NTcxNDI5IDQ5Ljg4MDk1Miw3Ljg1NzE0MjkgNTAuMTc4NTcxLDcuODU3MTQyOSBDIDUwLjMyNzM4MSw3Ljg1NzE0MjkgNTAuNDA5MjI3LDcuODU3MTQyOSA1MC40NDY0MjksNy44NTcxNDI5IEMgNTAuNDY1MDI5LDcuODU3MTQyOSA1MC40NzE1NDMsNy44NTcxNDI5IDUwLjQ3NjE5LDcuODU3MTQyOSBDIDYwLjIzNjg1Myw3Ljg1NzE0MyA2Ny4xNDI4NTcsMTUuNDk3MDk4IDY3LjE0Mjg1NywyNSBDIDY3LjE0Mjg1NywzNC41MDI5MDIgNTkuNzYwNjYyLDQyLjE0Mjg1NyA1MCw0Mi4xNDI4NTcgTCAzMi44NTcxNDMsNDIuMTQyODU3IEwgMzIuODU3MTQzLDcuODU3MTQyOSB6IgogICAgICAgaWQ9InBhdGgyODg0IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NzY2NjY3Nzc3NzY2NjIiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(input1,input2){return input1&&input2}});var Nor=Gate21.define("logic.Nor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjEiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjY3NzY0NCIKICAgICBpbmtzY2FwZTpjeT0iMjIuMTAyMzQ0IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjM3IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItNCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc5LDI1IEMgOTksMjUgOTUsMjUgOTUsMjUiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgICBpZD0icGF0aDI2MDQiCiAgICAgICAgIHNvZGlwb2RpOmN4PSI3NSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjI1IgogICAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgICAgc29kaXBvZGk6cnk9IjQiCiAgICAgICAgIGQ9Ik0gNzksMjUgQSA0LDQgMCAxIDEgNzEsMjUgQSA0LDQgMCAxIDEgNzksMjUgeiIKICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI2LjUsMzkuNSkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(input1,input2){return!(input1||input2)}});var Nand=Gate21.define("logic.Nand",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5BTkQgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMTYiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjI4MzMwNyIKICAgICBpbmtzY2FwZTpjeT0iMTYuNDQyODQzIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzksMjUgQyA5MS44LDI1IDk1LDI1IDk1LDI1IgogICAgICAgaWQ9InBhdGgzMDU5IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMxLDE1IDUsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMiwzNSA1LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmb250LXNpemU6bWVkaXVtO2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1pbmRlbnQ6MDt0ZXh0LWFsaWduOnN0YXJ0O3RleHQtZGVjb3JhdGlvbjpub25lO2xpbmUtaGVpZ2h0Om5vcm1hbDtsZXR0ZXItc3BhY2luZzpub3JtYWw7d29yZC1zcGFjaW5nOm5vcm1hbDt0ZXh0LXRyYW5zZm9ybTpub25lO2RpcmVjdGlvbjpsdHI7YmxvY2stcHJvZ3Jlc3Npb246dGI7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOnN0YXJ0O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MzttYXJrZXI6bm9uZTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlO2ZvbnQtZmFtaWx5OkJpdHN0cmVhbSBWZXJhIFNhbnM7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpCaXRzdHJlYW0gVmVyYSBTYW5zIgogICAgICAgZD0iTSAzMCw1IEwgMzAsNi40Mjg1NzE0IEwgMzAsNDMuNTcxNDI5IEwgMzAsNDUgTCAzMS40Mjg1NzEsNDUgTCA1MC40NzYxOSw0NSBDIDYxLjc0NDA5OCw0NSA3MC40NzYxOSwzNS45OTk5NTUgNzAuNDc2MTksMjUgQyA3MC40NzYxOSwxNC4wMDAwNDUgNjEuNzQ0MDk5LDUuMDAwMDAwMiA1MC40NzYxOSw1IEMgNTAuNDc2MTksNSA1MC40NzYxOSw1IDMxLjQyODU3MSw1IEwgMzAsNSB6IE0gMzIuODU3MTQzLDcuODU3MTQyOSBDIDQwLjgzNDI2NCw3Ljg1NzE0MjkgNDUuOTE4MzY4LDcuODU3MTQyOSA0OC4wOTUyMzgsNy44NTcxNDI5IEMgNDkuMjg1NzE0LDcuODU3MTQyOSA0OS44ODA5NTIsNy44NTcxNDI5IDUwLjE3ODU3MSw3Ljg1NzE0MjkgQyA1MC4zMjczODEsNy44NTcxNDI5IDUwLjQwOTIyNyw3Ljg1NzE0MjkgNTAuNDQ2NDI5LDcuODU3MTQyOSBDIDUwLjQ2NTAyOSw3Ljg1NzE0MjkgNTAuNDcxNTQzLDcuODU3MTQyOSA1MC40NzYxOSw3Ljg1NzE0MjkgQyA2MC4yMzY4NTMsNy44NTcxNDMgNjcuMTQyODU3LDE1LjQ5NzA5OCA2Ny4xNDI4NTcsMjUgQyA2Ny4xNDI4NTcsMzQuNTAyOTAyIDU5Ljc2MDY2Miw0Mi4xNDI4NTcgNTAsNDIuMTQyODU3IEwgMzIuODU3MTQzLDQyLjE0Mjg1NyBMIDMyLjg1NzE0Myw3Ljg1NzE0MjkgeiIKICAgICAgIGlkPSJwYXRoMjg4NCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2Njc2NjY2Nzc3Nzc2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDQwMDgiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(input1,input2){return!(input1&&input2)}});var Xor=Gate21.define("logic.Xor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhPUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjUuNjU2ODU0MiIKICAgICBpbmtzY2FwZTpjeD0iMjUuOTM4MTE2IgogICAgIGlua3NjYXBlOmN5PSIxNy4yMzAwNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzAuMzg1NzE3LDE1IEwgNC45OTk5OTk4LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5NzY7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEuMzYyMDkxLDM1IEwgNC45OTk5OTk4LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPGcKICAgICAgIGlkPSJnMjU2MCIKICAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjYuNSwtMzkuNSkiPgogICAgICA8cGF0aAogICAgICAgICBpZD0icGF0aDM1MTYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi4yNSw4MS41MDAwMDUgQyAtMy44NDczNzQsODQuMTQ0NDA1IC00LjUsODQuNTAwMDA1IC00LjUsODQuNTAwMDA1IEwgLTguMTU2MjUsODQuNTAwMDA1IEwgLTYuMTU2MjUsODIuMDYyNTA1IEMgLTYuMTU2MjUsODIuMDYyNTA1IC0wLjUsNzUuMDYyNDUxIC0wLjUsNjQuNSBDIC0wLjUsNTMuOTM3NTQ5IC02LjE1NjI1LDQ2LjkzNzUgLTYuMTU2MjUsNDYuOTM3NSBMIC04LjE1NjI1LDQ0LjUgTCAtNC41LDQ0LjUgQyAtMy43MTg3NSw0NS40Mzc1IC0zLjA3ODEyNSw0Ni4xNTYyNSAtMi4yODEyNSw0Ny41IEMgLTAuNDA4NTMxLDUwLjU5OTgxNSAyLjUsNTYuNTI2NjQ2IDIuNSw2NC41IEMgMi41LDcyLjQ1MDY1IC0wLjM5NjY5Nyw3OC4zNzk0MjUgLTIuMjUsODEuNTAwMDA1IHoiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},{operation:function(input1,input2){return(!input1||input2)&&(input1||!input2)}});var Xnor=Gate21.define("logic.Xnor",{attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhOT1IgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNTU3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTYuNjY2NjY3IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDI1IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI0IgogICAgIGlua3NjYXBlOmN4PSI5NS43MjM2NiIKICAgICBpbmtzY2FwZTpjeT0iLTI2Ljc3NTAyMyIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjAwMDAwMDI0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc4LjMzMzMzMiwyNSBDIDkxLjY2NjY2NiwyNSA5NSwyNSA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMC4zODU3MTcsMTUgTCA0Ljk5OTk5OTgsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk3NjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMS4zNjIwOTEsMzUgTCA0Ljk5OTk5OTgsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGlkPSJwYXRoMzUxNiIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjI1LDgxLjUwMDAwNSBDIC0zLjg0NzM3NCw4NC4xNDQ0MDUgLTQuNSw4NC41MDAwMDUgLTQuNSw4NC41MDAwMDUgTCAtOC4xNTYyNSw4NC41MDAwMDUgTCAtNi4xNTYyNSw4Mi4wNjI1MDUgQyAtNi4xNTYyNSw4Mi4wNjI1MDUgLTAuNSw3NS4wNjI0NTEgLTAuNSw2NC41IEMgLTAuNSw1My45Mzc1NDkgLTYuMTU2MjUsNDYuOTM3NSAtNi4xNTYyNSw0Ni45Mzc1IEwgLTguMTU2MjUsNDQuNSBMIC00LjUsNDQuNSBDIC0zLjcxODc1LDQ1LjQzNzUgLTMuMDc4MTI1LDQ2LjE1NjI1IC0yLjI4MTI1LDQ3LjUgQyAtMC40MDg1MzEsNTAuNTk5ODE1IDIuNSw1Ni41MjY2NDYgMi41LDY0LjUgQyAyLjUsNzIuNDUwNjUgLTAuMzk2Njk3LDc4LjM3OTQyNSAtMi4yNSw4MS41MDAwMDUgeiIKICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY2NzYyIgLz4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDM1NTEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},{operation:function(input1,input2){return(!input1||!input2)&&(input1||input2)}});var Wire=Link.define("logic.Wire",{attrs:{".connection":{"stroke-width":2},".marker-vertex":{r:7}},router:{name:"orthogonal"},connector:{name:"rounded",args:{radius:10}}},{arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<circle class="marker-arrowhead" end="<%= end %>" r="7"/>',"</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<g class="marker-vertex-remove-group">','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>","</g>"].join("")});var logic={Gate:Gate,IO:IO,Input:Input,Output:Output,Gate11:Gate11,Gate21:Gate21,Repeater:Repeater,Not:Not,Or:Or,And:And,Nor:Nor,Nand:Nand,Xor:Xor,Xnor:Xnor,Wire:Wire};var KingWhite=Generic.define("chess.KingWhite",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;"><path      d="M 22.5,11.63 L 22.5,6"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 20,8 L 25,8"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"      style="fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 11.5,30 C 17,27 27,27 32.5,30"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,37 C 17,34 27,34 32.5,37"      style="fill:none; stroke:#000000;" />  </g></g></g>'});var KingBlack=Generic.define("chess.KingBlack",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path       d="M 22.5,11.63 L 22.5,6"       style="fill:none; stroke:#000000; stroke-linejoin:miter;"       id="path6570" />    <path       d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"       style="fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;" />    <path       d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "       style="fill:#000000; stroke:#000000;" />    <path       d="M 20,8 L 25,8"       style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path       d="M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37"       style="fill:none; stroke:#ffffff;" />  </g></g></g>'});var QueenWhite=Generic.define("chess.QueenWhite",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(-1,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(15.5,-5.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(32,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(7,-4.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(24,-4)" />    <path      d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 11.5,30 C 15,29 30,29 33.5,30"      style="fill:none;" />    <path      d="M 12,33.5 C 18,32.5 27,32.5 33,33.5"      style="fill:none;" />  </g></g></g>'});var QueenBlack=Generic.define("chess.QueenBlack",{size:{width:42,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:none;">      <circle cx="6"    cy="12" r="2.75" />      <circle cx="14"   cy="9"  r="2.75" />      <circle cx="22.5" cy="8"  r="2.75" />      <circle cx="31"   cy="9"  r="2.75" />      <circle cx="39"   cy="12" r="2.75" />    </g>    <path       d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z"       style="stroke-linecap:butt; stroke:#000000;" />    <path       d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z"       style="stroke-linecap:butt;" />    <path       d="M 11,38.5 A 35,35 1 0 0 34,38.5"       style="fill:none; stroke:#000000; stroke-linecap:butt;" />    <path       d="M 11,29 A 35,35 1 0 1 34,29"       style="fill:none; stroke:#ffffff;" />    <path       d="M 12.5,31.5 L 32.5,31.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,34.5 A 35,35 1 0 0 33.5,34.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 10.5,37.5 A 35,35 1 0 0 34.5,37.5"       style="fill:none; stroke:#ffffff;" />  </g></g></g>'});var RookWhite=Generic.define("chess.RookWhite",{size:{width:32,height:34}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14"      style="stroke-linecap:butt;" />    <path      d="M 34,14 L 31,17 L 14,17 L 11,14" />    <path      d="M 31,17 L 31,29.5 L 14,29.5 L 14,17"      style="stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>'});var RookBlack=Generic.define("chess.RookBlack",{size:{width:32,height:34}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z "      style="stroke-linecap:butt;stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z "      style="stroke-linecap:butt;" />    <path      d="M 12,35.5 L 33,35.5 L 33,35.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 13,31.5 L 32,31.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,29.5 L 31,29.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 31,16.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />  </g></g></g>'});var BishopWhite=Generic.define("chess.BishopWhite",{size:{width:38,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#ffffff; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path      d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>'});var BishopBlack=Generic.define("chess.BishopBlack",{size:{width:38,height:38}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path       d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"       style="fill:none; stroke:#ffffff; stroke-linejoin:miter;" />  </g></g></g>'});var KnightWhite=Generic.define("chess.KnightWhite",{size:{width:38,height:37}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#000000; stroke:#000000;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#000000; stroke:#000000;" />  </g></g></g>'});var KnightBlack=Generic.define("chess.KnightBlack",{size:{width:38,height:37}},{markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#000000; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#000000; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z "      style="fill:#ffffff; stroke:none;" />  </g></g></g>'});var PawnWhite=Generic.define("chess.PawnWhite",{size:{width:28,height:33}},{markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>'});var PawnBlack=Generic.define("chess.PawnBlack",{size:{width:28,height:33}},{markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>'});var chess={KingWhite:KingWhite,KingBlack:KingBlack,QueenWhite:QueenWhite,QueenBlack:QueenBlack,RookWhite:RookWhite,RookBlack:RookBlack,BishopWhite:BishopWhite,BishopBlack:BishopBlack,KnightWhite:KnightWhite,KnightBlack:KnightBlack,PawnWhite:PawnWhite,PawnBlack:PawnBlack};var Entity=Element$1.define("erd.Entity",{size:{width:150,height:60},attrs:{".outer":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"100,0 100,60 0,60 0,0"},".inner":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"95,5 95,55 5,55 5,5",display:"none"},text:{text:"Entity","font-family":"Arial","font-size":14,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>'});var WeakEntity=Entity.define("erd.WeakEntity",{attrs:{".inner":{display:"auto"},text:{text:"Weak Entity"}}});var Relationship=Element$1.define("erd.Relationship",{size:{width:80,height:80},attrs:{".outer":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,0 80,40 40,80 0,40"},".inner":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,5 75,40 40,75 5,40",display:"none"},text:{text:"Relationship","font-family":"Arial","font-size":12,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>'});var IdentifyingRelationship=Relationship.define("erd.IdentifyingRelationship",{attrs:{".inner":{display:"auto"},text:{text:"Identifying"}}});var Attribute=Element$1.define("erd.Attribute",{size:{width:100,height:50},attrs:{ellipse:{transform:"translate(50, 25)"},".outer":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:50,ry:25,fill:"#E67E22"},".inner":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:45,ry:20,fill:"#E67E22",display:"none"},text:{"font-family":"Arial","font-size":14,"ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><ellipse class="outer"/><ellipse class="inner"/></g><text/></g>'});var Multivalued=Attribute.define("erd.Multivalued",{attrs:{".inner":{display:"block"},text:{text:"multivalued"}}});var Derived=Attribute.define("erd.Derived",{attrs:{".outer":{"stroke-dasharray":"3,5"},text:{text:"derived"}}});var Key=Attribute.define("erd.Key",{attrs:{ellipse:{"stroke-width":4},text:{text:"key","font-weight":"800","text-decoration":"underline"}}});var Normal=Attribute.define("erd.Normal",{attrs:{text:{text:"Normal"}}});var ISA=Element$1.define("erd.ISA",{type:"erd.ISA",size:{width:100,height:50},attrs:{polygon:{points:"0,0 50,50 100,0",fill:"#F1C40F",stroke:"#F39C12","stroke-width":2},text:{text:"ISA","font-size":18,"ref-x":.5,"ref-y":.3,"y-alignment":"middle","text-anchor":"middle"}}},{markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>'});var Line$1=Link.define("erd.Line",{},{cardinality:function(value){this.set("labels",[{position:-20,attrs:{text:{dy:-8,text:value}}}])}});var erd={Entity:Entity,WeakEntity:WeakEntity,Relationship:Relationship,IdentifyingRelationship:IdentifyingRelationship,Attribute:Attribute,Multivalued:Multivalued,Derived:Derived,Key:Key,Normal:Normal,ISA:ISA,Line:Line$1};var State=Circle.define("fsa.State",{attrs:{circle:{"stroke-width":3},text:{"font-weight":"800"}}});var StartState=Element$1.define("fsa.StartState",{size:{width:20,height:20},attrs:{circle:{transform:"translate(10, 10)",r:10,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle/></g></g>'});var EndState=Element$1.define("fsa.EndState",{size:{width:20,height:20},attrs:{".outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#000000"},".inner":{transform:"translate(10, 10)",r:6,fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>'});var Arrow=Link.define("fsa.Arrow",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}},smooth:true});var fsa={State:State,StartState:StartState,EndState:EndState,Arrow:Arrow};var Member=Element$1.define("org.Member",{size:{width:180,height:70},attrs:{rect:{width:170,height:60},".card":{fill:"#FFFFFF",stroke:"#000000","stroke-width":2,"pointer-events":"visiblePainted",rx:10,ry:10},image:{width:48,height:48,ref:".card","ref-x":10,"ref-y":5},".rank":{"text-decoration":"underline",ref:".card","ref-x":.9,"ref-y":.2,"font-family":"Courier New","font-size":14,"text-anchor":"end"},".name":{"font-weight":"800",ref:".card","ref-x":.9,"ref-y":.6,"font-family":"Courier New","font-size":14,"text-anchor":"end"}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="card"/><image/></g><text class="rank"/><text class="name"/></g>'});var Arrow$1=Link.define("org.Arrow",{source:{selector:".card"},target:{selector:".card"},attrs:{".connection":{stroke:"#585858","stroke-width":3}},z:-1});var org={Member:Member,Arrow:Arrow$1};var Place=Generic.define("pn.Place",{size:{width:50,height:50},attrs:{".root":{r:25,fill:"#ffffff",stroke:"#000000",transform:"translate(25, 25)"},".label":{"text-anchor":"middle","ref-x":.5,"ref-y":-20,ref:".root",fill:"#000000","font-size":12},".tokens > circle":{fill:"#000000",r:5},".tokens.one > circle":{transform:"translate(25, 25)"},".tokens.two > circle:nth-child(1)":{transform:"translate(19, 25)"},".tokens.two > circle:nth-child(2)":{transform:"translate(31, 25)"},".tokens.three > circle:nth-child(1)":{transform:"translate(18, 29)"},".tokens.three > circle:nth-child(2)":{transform:"translate(25, 19)"},".tokens.three > circle:nth-child(3)":{transform:"translate(32, 29)"},".tokens.alot > text":{transform:"translate(25, 18)","text-anchor":"middle",fill:"#000000"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="root"/><g class="tokens" /></g><text class="label"/></g>'});var PlaceView=ElementView.extend({presentationAttributes:ElementView.addPresentationAttributes({tokens:["TOKENS"]}),initFlag:ElementView.prototype.initFlag.concat(["TOKENS"]),confirmUpdate:function(){var ref;var args=[],len=arguments.length;while(len--)args[len]=arguments[len];var flags=(ref=ElementView.prototype.confirmUpdate).call.apply(ref,[this].concat(args));if(this.hasFlag(flags,"TOKENS")){this.renderTokens();this.update();flags=this.removeFlag(flags,"TOKENS")}return flags},renderTokens:function(){var vTokens=this.vel.findOne(".tokens").empty();["one","two","three","alot"].forEach(function(className){vTokens.removeClass(className)});var tokens=this.model.get("tokens");if(!tokens){return}switch(tokens){case 1:vTokens.addClass("one");vTokens.append(V("circle"));break;case 2:vTokens.addClass("two");vTokens.append([V("circle"),V("circle")]);break;case 3:vTokens.addClass("three");vTokens.append([V("circle"),V("circle"),V("circle")]);break;default:vTokens.addClass("alot");vTokens.append(V("text").text(tokens+""));break}}});var Transition=Generic.define("pn.Transition",{size:{width:12,height:50},attrs:{rect:{width:12,height:50,fill:"#000000",stroke:"#000000"},".label":{"text-anchor":"middle","ref-x":.5,"ref-y":-20,ref:"rect",fill:"#000000","font-size":12}}},{markup:'<g class="rotatable"><g class="scalable"><rect class="root"/></g></g><text class="label"/>'});var Link$3=Link.define("pn.Link",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}}});var pn={Place:Place,PlaceView:PlaceView,Transition:Transition,Link:Link$3};var Class=Generic.define("uml.Class",{attrs:{rect:{width:200},".uml-class-name-rect":{stroke:"black","stroke-width":2,fill:"#3498db"},".uml-class-attrs-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-methods-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-name-text":{ref:".uml-class-name-rect","ref-y":.5,"ref-x":.5,"text-anchor":"middle","y-alignment":"middle","font-weight":"bold",fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-attrs-text":{ref:".uml-class-attrs-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-methods-text":{ref:".uml-class-methods-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"}},name:[],attributes:[],methods:[]},{markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-class-name-rect"/><rect class="uml-class-attrs-rect"/><rect class="uml-class-methods-rect"/>',"</g>",'<text class="uml-class-name-text"/><text class="uml-class-attrs-text"/><text class="uml-class-methods-text"/>',"</g>"].join(""),initialize:function(){this.on("change:name change:attributes change:methods",function(){this.updateRectangles();this.trigger("uml-update")},this);this.updateRectangles();Generic.prototype.initialize.apply(this,arguments)},getClassName:function(){return this.get("name")},updateRectangles:function(){var attrs=this.get("attrs");var rects=[{type:"name",text:this.getClassName()},{type:"attrs",text:this.get("attributes")},{type:"methods",text:this.get("methods")}];var offsetY=0;rects.forEach(function(rect){var lines=Array.isArray(rect.text)?rect.text:[rect.text];var rectHeight=lines.length*20+20;attrs[".uml-class-"+rect.type+"-text"].text=lines.join("\n");attrs[".uml-class-"+rect.type+"-rect"].height=rectHeight;attrs[".uml-class-"+rect.type+"-rect"].transform="translate(0,"+offsetY+")";offsetY+=rectHeight})}});var ClassView=ElementView.extend({initialize:function(){ElementView.prototype.initialize.apply(this,arguments);this.listenTo(this.model,"uml-update",function(){this.update();this.resize()})}});var Abstract=Class.define("uml.Abstract",{attrs:{".uml-class-name-rect":{fill:"#e74c3c"},".uml-class-attrs-rect":{fill:"#c0392b"},".uml-class-methods-rect":{fill:"#c0392b"}}},{getClassName:function(){return["<<Abstract>>",this.get("name")]}});var AbstractView=ClassView;var Interface=Class.define("uml.Interface",{attrs:{".uml-class-name-rect":{fill:"#f1c40f"},".uml-class-attrs-rect":{fill:"#f39c12"},".uml-class-methods-rect":{fill:"#f39c12"}}},{getClassName:function(){return["<<Interface>>",this.get("name")]}});var InterfaceView=ClassView;var Generalization=Link.define("uml.Generalization",{attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"}}});var Implementation=Link.define("uml.Implementation",{attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"},".connection":{"stroke-dasharray":"3,3"}}});var Aggregation=Link.define("uml.Aggregation",{attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"white"}}});var Composition=Link.define("uml.Composition",{attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"black"}}});var Association=Link.define("uml.Association");var State$1=Generic.define("uml.State",{attrs:{".uml-state-body":{width:200,height:200,rx:10,ry:10,fill:"#ecf0f1",stroke:"#bdc3c7","stroke-width":3},".uml-state-separator":{stroke:"#bdc3c7","stroke-width":2},".uml-state-name":{ref:".uml-state-body","ref-x":.5,"ref-y":5,"text-anchor":"middle",fill:"#000000","font-family":"Courier New","font-size":14},".uml-state-events":{ref:".uml-state-separator","ref-x":5,"ref-y":5,fill:"#000000","font-family":"Courier New","font-size":14}},name:"State",events:[]},{markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-state-body"/>',"</g>",'<path class="uml-state-separator"/>','<text class="uml-state-name"/>','<text class="uml-state-events"/>',"</g>"].join(""),initialize:function(){this.on({"change:name":this.updateName,"change:events":this.updateEvents,"change:size":this.updatePath},this);this.updateName();this.updateEvents();this.updatePath();Generic.prototype.initialize.apply(this,arguments)},updateName:function(){this.attr(".uml-state-name/text",this.get("name"))},updateEvents:function(){this.attr(".uml-state-events/text",this.get("events").join("\n"))},updatePath:function(){var d="M 0 20 L "+this.get("size").width+" 20";this.attr(".uml-state-separator/d",d,{silent:true})}});var StartState$1=Circle.define("uml.StartState",{type:"uml.StartState",attrs:{circle:{fill:"#34495e",stroke:"#2c3e50","stroke-width":2,rx:1}}});var EndState$1=Generic.define("uml.EndState",{size:{width:20,height:20},attrs:{"circle.outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#2c3e50"},"circle.inner":{transform:"translate(10, 10)",r:6,fill:"#34495e"}}},{markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>'});var Transition$1=Link.define("uml.Transition",{attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#34495e",stroke:"#2c3e50"},".connection":{stroke:"#2c3e50"}}});var uml={Class:Class,ClassView:ClassView,Abstract:Abstract,AbstractView:AbstractView,Interface:Interface,InterfaceView:InterfaceView,Generalization:Generalization,Implementation:Implementation,Aggregation:Aggregation,Composition:Composition,Association:Association,State:State$1,StartState:StartState$1,EndState:EndState$1,Transition:Transition$1};var index$3={basic:basic,standard:standard,devs:devs,logic:logic,chess:chess,erd:erd,fsa:fsa,org:org,pn:pn,uml:uml};function abs2rel(absolute,max){if(max===0){return"0%"}var dp=1e3;var relative=Math.round(absolute/max*100*dp)/dp;return relative+"%"}function pin(relative){return function(end,view,magnet,coords){var fn=view.isNodeConnection(magnet)?pinnedLinkEnd:pinnedElementEnd;return fn(relative,end,view,magnet,coords)}}function pinnedElementEnd(relative,end,view,magnet,coords){var angle=view.model.angle();var bbox=view.getNodeUnrotatedBBox(magnet);var origin=view.model.getBBox().center();coords.rotate(origin,angle);var dx=coords.x-bbox.x;var dy=coords.y-bbox.y;if(relative){dx=abs2rel(dx,bbox.width);dy=abs2rel(dy,bbox.height)}end.anchor={name:"topLeft",args:{dx:dx,dy:dy,rotate:true}};return end}function pinnedLinkEnd(relative,end,view,_magnet,coords){var connection=view.getConnection();if(!connection){return end}var length=connection.closestPointLength(coords);if(relative){var totalLength=connection.length();end.anchor={name:"connectionRatio",args:{ratio:length/totalLength}}}else{end.anchor={name:"connectionLength",args:{length:length}}}return end}var useDefaults=noop;var pinAbsolute=pin(false);var pinRelative=pin(true);var index$4={useDefaults:useDefaults,pinAbsolute:pinAbsolute,pinRelative:pinRelative};var VertexHandle=View.extend({tagName:"circle",svgElement:true,className:"marker-vertex",events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onDoubleClick",dbltap:"onDoubleClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},attributes:{r:6,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move"},position:function(x,y){var ref=this;var vel=ref.vel;var options=ref.options;var scale=options.scale;var matrix=V.createSVGMatrix().translate(x,y);if(scale){matrix=matrix.scale(scale)}vel.transform(matrix,{absolute:true})},onPointerDown:function(evt){if(this.options.guard(evt)){return}evt.stopPropagation();evt.preventDefault();this.options.paper.undelegateEvents();this.delegateDocumentEvents(null,evt.data);this.trigger("will-change",this,evt)},onPointerMove:function(evt){this.trigger("changing",this,evt)},onDoubleClick:function(evt){this.trigger("remove",this,evt)},onPointerUp:function(evt){this.trigger("changed",this,evt);this.undelegateDocumentEvents();this.options.paper.delegateEvents()}});var Vertices=ToolView.extend({name:"vertices",options:{handleClass:VertexHandle,snapRadius:20,redundancyRemoval:true,vertexAdding:true,stopPropagation:true,scale:null},children:[{tagName:"path",selector:"connection",className:"joint-vertices-path",attributes:{fill:"none",stroke:"transparent","stroke-width":10,cursor:"cell"}}],handles:null,events:{"mousedown .joint-vertices-path":"onPathPointerDown","touchstart .joint-vertices-path":"onPathPointerDown"},onRender:function(){if(this.options.vertexAdding){this.renderChildren();this.updatePath()}this.resetHandles();this.renderHandles();return this},update:function(){var relatedView=this.relatedView;var vertices=relatedView.model.vertices();if(vertices.length===this.handles.length){this.updateHandles()}else{this.resetHandles();this.renderHandles()}if(this.options.vertexAdding){this.updatePath()}return this},resetHandles:function(){var handles=this.handles;this.handles=[];this.stopListening();if(!Array.isArray(handles)){return}for(var i=0,n=handles.length;i<n;i++){handles[i].remove()}},renderHandles:function(){var this$1=this;var relatedView=this.relatedView;var vertices=relatedView.model.vertices();for(var i=0,n=vertices.length;i<n;i++){var vertex=vertices[i];var handle=new this.options.handleClass({index:i,paper:this.paper,scale:this.options.scale,guard:function(evt){return this$1.guard(evt)}});handle.render();handle.position(vertex.x,vertex.y);this.simulateRelatedView(handle.el);handle.vel.appendTo(this.el);this.handles.push(handle);this.startHandleListening(handle)}},updateHandles:function(){var relatedView=this.relatedView;var vertices=relatedView.model.vertices();for(var i=0,n=vertices.length;i<n;i++){var vertex=vertices[i];var handle=this.handles[i];if(!handle){return}handle.position(vertex.x,vertex.y)}},updatePath:function(){var connection=this.childNodes.connection;if(connection){connection.setAttribute("d",this.relatedView.getSerializedConnection())}},startHandleListening:function(handle){var relatedView=this.relatedView;if(relatedView.can("vertexMove")){this.listenTo(handle,"will-change",this.onHandleWillChange);this.listenTo(handle,"changing",this.onHandleChanging);this.listenTo(handle,"changed",this.onHandleChanged)}if(relatedView.can("vertexRemove")){this.listenTo(handle,"remove",this.onHandleRemove)}},getNeighborPoints:function(index){var linkView=this.relatedView;var vertices=linkView.model.vertices();var prev=index>0?vertices[index-1]:linkView.sourceAnchor;var next=index<vertices.length-1?vertices[index+1]:linkView.targetAnchor;return{prev:new Point(prev),next:new Point(next)}},onHandleWillChange:function(_handle,evt){this.focus();var ref=this;var relatedView=ref.relatedView;var options=ref.options;relatedView.model.startBatch("vertex-move",{ui:true,tool:this.cid});if(!options.stopPropagation){relatedView.notifyPointerdown.apply(relatedView,relatedView.paper.getPointerArgs(evt))}},onHandleChanging:function(handle,evt){var ref=this;var options=ref.options;var linkView=ref.relatedView;var index=handle.options.index;var ref$1=linkView.paper.getPointerArgs(evt);var normalizedEvent=ref$1[0];var x=ref$1[1];var y=ref$1[2];var vertex={x:x,y:y};this.snapVertex(vertex,index);linkView.model.vertex(index,vertex,{ui:true,tool:this.cid});handle.position(vertex.x,vertex.y);if(!options.stopPropagation){linkView.notifyPointermove(normalizedEvent,x,y)}},onHandleChanged:function(_handle,evt){var ref=this;var options=ref.options;var linkView=ref.relatedView;if(options.vertexAdding){this.updatePath()}if(!options.redundancyRemoval){return}var verticesRemoved=linkView.removeRedundantLinearVertices({ui:true,tool:this.cid});if(verticesRemoved){this.render()}this.blur();linkView.model.stopBatch("vertex-move",{ui:true,tool:this.cid});if(this.eventData(evt).vertexAdded){linkView.model.stopBatch("vertex-add",{ui:true,tool:this.cid})}var ref$1=linkView.paper.getPointerArgs(evt);var normalizedEvt=ref$1[0];var x=ref$1[1];var y=ref$1[2];if(!options.stopPropagation){linkView.notifyPointerup(normalizedEvt,x,y)}linkView.checkMouseleave(normalizedEvt)},snapVertex:function(vertex,index){var snapRadius=this.options.snapRadius;if(snapRadius>0){var neighbors=this.getNeighborPoints(index);var prev=neighbors.prev;var next=neighbors.next;if(Math.abs(vertex.x-prev.x)<snapRadius){vertex.x=prev.x}else if(Math.abs(vertex.x-next.x)<snapRadius){vertex.x=next.x}if(Math.abs(vertex.y-prev.y)<snapRadius){vertex.y=neighbors.prev.y}else if(Math.abs(vertex.y-next.y)<snapRadius){vertex.y=next.y}}},onHandleRemove:function(handle,evt){var index$1=handle.options.index;var linkView=this.relatedView;linkView.model.removeVertex(index$1,{ui:true});if(this.options.vertexAdding){this.updatePath()}linkView.checkMouseleave(normalizeEvent(evt))},onPathPointerDown:function(evt){if(this.guard(evt)){return}evt.stopPropagation();evt.preventDefault();var normalizedEvent=normalizeEvent(evt);var vertex=this.paper.snapToGrid(normalizedEvent.clientX,normalizedEvent.clientY).toJSON();var relatedView=this.relatedView;relatedView.model.startBatch("vertex-add",{ui:true,tool:this.cid});var index$1=relatedView.getVertexIndex(vertex.x,vertex.y);this.snapVertex(vertex,index$1);relatedView.model.insertVertex(index$1,vertex,{ui:true,tool:this.cid});this.update();var handle=this.handles[index$1];this.eventData(normalizedEvent,{vertexAdded:true});handle.onPointerDown(normalizedEvent)},onRemove:function(){this.resetHandles()}},{VertexHandle:VertexHandle});function getViewBBox(view,useModelGeometry){var model=view.model;if(useModelGeometry){return model.getBBox()}return model.isLink()?view.getConnection().bbox():view.getNodeUnrotatedBBox(view.el)}function getAnchor(coords,view,magnet){var end=pinRelative.call(this.paper,{},view,magnet,coords,this.model);return end.anchor}function snapAnchor(coords,view,magnet,type,relatedView,toolView){var snapRadius=toolView.options.snapRadius;var isSource=type==="source";var refIndex=isSource?0:-1;var ref=this.model.vertex(refIndex)||this.getEndAnchor(isSource?"target":"source");if(ref){if(Math.abs(ref.x-coords.x)<snapRadius){coords.x=ref.x}if(Math.abs(ref.y-coords.y)<snapRadius){coords.y=ref.y}}return coords}var SegmentHandle=View.extend({tagName:"g",svgElement:true,className:"marker-segment",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},children:[{tagName:"line",selector:"line",attributes:{stroke:"#33334F","stroke-width":2,fill:"none","pointer-events":"none"}},{tagName:"rect",selector:"handle",attributes:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2}}],onRender:function(){this.renderChildren()},position:function(x,y,angle,view){var ref=this.options;var scale=ref.scale;var matrix=V.createSVGMatrix().translate(x,y).rotate(angle);if(scale){matrix=matrix.scale(scale)}var handle=this.childNodes.handle;handle.setAttribute("transform",V.matrixToTransformString(matrix));handle.setAttribute("cursor",angle%180===0?"row-resize":"col-resize");var viewPoint=view.getClosestPoint(new Point(x,y));var line=this.childNodes.line;line.setAttribute("x1",x);line.setAttribute("y1",y);line.setAttribute("x2",viewPoint.x);line.setAttribute("y2",viewPoint.y)},onPointerDown:function(evt){if(this.options.guard(evt)){return}this.trigger("change:start",this,evt);evt.stopPropagation();evt.preventDefault();this.options.paper.undelegateEvents();this.delegateDocumentEvents(null,evt.data)},onPointerMove:function(evt){this.trigger("changing",this,evt)},onPointerUp:function(evt){this.undelegateDocumentEvents();this.options.paper.delegateEvents();this.trigger("change:end",this,evt)},show:function(){this.el.style.display=""},hide:function(){this.el.style.display="none"}});var Segments=ToolView.extend({name:"segments",precision:.5,options:{handleClass:SegmentHandle,segmentLengthThreshold:40,redundancyRemoval:true,anchor:getAnchor,snapRadius:10,snapHandle:true,stopPropagation:true},handles:null,onRender:function(){this.resetHandles();var relatedView=this.relatedView;var vertices=relatedView.model.vertices();vertices.unshift(relatedView.sourcePoint);vertices.push(relatedView.targetPoint);for(var i=0,n=vertices.length;i<n-1;i++){var vertex=vertices[i];var nextVertex=vertices[i+1];var handle=this.renderHandle(vertex,nextVertex);this.simulateRelatedView(handle.el);this.handles.push(handle);handle.options.index=i}return this},renderHandle:function(vertex,nextVertex){var this$1=this;var handle=new this.options.handleClass({paper:this.paper,scale:this.options.scale,guard:function(evt){return this$1.guard(evt)}});handle.render();this.updateHandle(handle,vertex,nextVertex);handle.vel.appendTo(this.el);this.startHandleListening(handle);return handle},update:function(){this.render();return this},startHandleListening:function(handle){this.listenTo(handle,"change:start",this.onHandleChangeStart);this.listenTo(handle,"changing",this.onHandleChanging);this.listenTo(handle,"change:end",this.onHandleChangeEnd)},resetHandles:function(){var handles=this.handles;this.handles=[];this.stopListening();if(!Array.isArray(handles)){return}for(var i=0,n=handles.length;i<n;i++){handles[i].remove()}},shiftHandleIndexes:function(value){var handles=this.handles;for(var i=0,n=handles.length;i<n;i++){handles[i].options.index+=value}},resetAnchor:function(type,anchor){var relatedModel=this.relatedView.model;if(anchor){relatedModel.prop([type,"anchor"],anchor,{rewrite:true,ui:true,tool:this.cid})}else{relatedModel.removeProp([type,"anchor"],{ui:true,tool:this.cid})}},snapHandle:function(handle,position,data){var index=handle.options.index;var linkView=this.relatedView;var link=linkView.model;var vertices=link.vertices();var axis=handle.options.axis;var prev=vertices[index-2]||data.sourceAnchor;var next=vertices[index+1]||data.targetAnchor;var snapRadius=this.options.snapRadius;if(Math.abs(position[axis]-prev[axis])<snapRadius){position[axis]=prev[axis]}else if(Math.abs(position[axis]-next[axis])<snapRadius){position[axis]=next[axis]}return position},onHandleChanging:function(handle,evt){var ref=this;var options=ref.options;var data=this.eventData(evt);var relatedView=this.relatedView;var paper=relatedView.paper;var index$1=handle.options.index-1;var normalizedEvent=normalizeEvent(evt);var coords=paper.snapToGrid(normalizedEvent.clientX,normalizedEvent.clientY);var position=this.snapHandle(handle,coords.clone(),data);var axis=handle.options.axis;var offset=this.options.snapHandle?0:coords[axis]-position[axis];var link=relatedView.model;var vertices=cloneDeep(link.vertices());var anchorFn=this.options.anchor;if(typeof anchorFn!=="function"){anchorFn=null}var handleIndex=handle.options.index;var vertexPoints=[relatedView.sourcePoint.clone()].concat(vertices,[relatedView.targetPoint.clone()]);var indexOffset=0;if(handleIndex-1>=0){var v1=vertexPoints[handleIndex-1];var v2=vertexPoints[handleIndex];var theta=new Line(v1,v2).vector().theta();if(theta%90!==0){vertices.splice(handleIndex-1,0,data.originalVertices[handleIndex-1]);indexOffset++;this.shiftHandleIndexes(1)}}var vertex=vertices[index$1+indexOffset];var nextVertex=vertices[index$1+1+indexOffset];if(handleIndex+2<vertexPoints.length){var v1$1=vertexPoints[handleIndex+1];var v2$1=vertexPoints[handleIndex+2];var theta$1=new Line(v1$1,v2$1).vector().theta();if(theta$1%90!==0){var isSingleVertex=data.originalVertices.length===1;var origVIndex=isSingleVertex?0:handleIndex;var additionalOffset=data.firstHandleShifted&&!isSingleVertex?1:0;var nextVIndex=1+indexOffset;vertices.splice(handleIndex+nextVIndex,0,data.originalVertices[origVIndex-additionalOffset])}}var sourceView=relatedView.sourceView;var sourceBBox=relatedView.sourceBBox;var changeSourceAnchor=false;var deleteSourceAnchor=false;if(!vertex){vertex=relatedView.sourceAnchor.toJSON();vertex[axis]=position[axis];if(sourceBBox.containsPoint(vertex)){vertex[axis]=position[axis];changeSourceAnchor=true}else{vertices.unshift(vertex);this.shiftHandleIndexes(1);data.firstHandleShifted=true;deleteSourceAnchor=true}}else if(index$1===0){if(sourceBBox.containsPoint(vertex)){vertices.shift();this.shiftHandleIndexes(-1);changeSourceAnchor=true}else{vertex[axis]=position[axis];deleteSourceAnchor=true}}else{vertex[axis]=position[axis]}if(anchorFn&&sourceView){if(changeSourceAnchor){var sourceAnchorPosition=data.sourceAnchor.clone();sourceAnchorPosition[axis]=position[axis];var sourceAnchor=anchorFn.call(relatedView,sourceAnchorPosition,sourceView,relatedView.sourceMagnet||sourceView.el,"source",relatedView);this.resetAnchor("source",sourceAnchor)}if(deleteSourceAnchor){this.resetAnchor("source",data.sourceAnchorDef)}}var targetView=relatedView.targetView;var targetBBox=relatedView.targetBBox;var changeTargetAnchor=false;var deleteTargetAnchor=false;if(!nextVertex){nextVertex=relatedView.targetAnchor.toJSON();nextVertex[axis]=position[axis];if(targetBBox.containsPoint(nextVertex)){changeTargetAnchor=true}else{vertices.push(nextVertex);deleteTargetAnchor=true}}else if(index$1===vertices.length-2){if(targetBBox.containsPoint(nextVertex)){vertices.pop();changeTargetAnchor=true}else{nextVertex[axis]=position[axis];deleteTargetAnchor=true}}else{nextVertex[axis]=position[axis]}if(anchorFn&&targetView){if(changeTargetAnchor){var targetAnchorPosition=data.targetAnchor.clone();targetAnchorPosition[axis]=position[axis];var targetAnchor=anchorFn.call(relatedView,targetAnchorPosition,targetView,relatedView.targetMagnet||targetView.el,"target",relatedView);this.resetAnchor("target",targetAnchor)}if(deleteTargetAnchor){this.resetAnchor("target",data.targetAnchorDef)}}link.vertices(vertices,{ui:true,tool:this.cid});this.updateHandle(handle,vertex,nextVertex,offset);if(!options.stopPropagation){relatedView.notifyPointermove(normalizedEvent,coords.x,coords.y)}},onHandleChangeStart:function(handle,evt){var ref=this;var options=ref.options;var handles=ref.handles;var linkView=ref.relatedView;var model=linkView.model;var paper=linkView.paper;var index$1=handle.options.index;if(!Array.isArray(handles)){return}for(var i=0,n=handles.length;i<n;i++){if(i!==index$1){handles[i].hide()}}this.focus();this.eventData(evt,{sourceAnchor:linkView.sourceAnchor.clone(),targetAnchor:linkView.targetAnchor.clone(),sourceAnchorDef:clone(model.prop(["source","anchor"])),targetAnchorDef:clone(model.prop(["target","anchor"])),originalVertices:cloneDeep(model.vertices()),firstHandleShifted:false});model.startBatch("segment-move",{ui:true,tool:this.cid});if(!options.stopPropagation){linkView.notifyPointerdown.apply(linkView,paper.getPointerArgs(evt))}},onHandleChangeEnd:function(_handle,evt){var ref=this;var options=ref.options;var linkView=ref.relatedView;var paper=linkView.paper;var model=linkView.model;if(options.redundancyRemoval){linkView.removeRedundantLinearVertices({ui:true,tool:this.cid})}var normalizedEvent=normalizeEvent(evt);var coords=paper.snapToGrid(normalizedEvent.clientX,normalizedEvent.clientY);this.render();this.blur();model.stopBatch("segment-move",{ui:true,tool:this.cid});if(!options.stopPropagation){linkView.notifyPointerup(normalizedEvent,coords.x,coords.y)}linkView.checkMouseleave(normalizedEvent)},updateHandle:function(handle,vertex,nextVertex,offset){var vertical=Math.abs(vertex.x-nextVertex.x)<this.precision;var horizontal=Math.abs(vertex.y-nextVertex.y)<this.precision;if(vertical||horizontal){var segmentLine=new Line(vertex,nextVertex);var length=segmentLine.length();if(length<this.options.segmentLengthThreshold){handle.hide()}else{var position=segmentLine.midpoint();var axis=vertical?"x":"y";position[axis]+=offset||0;var angle=segmentLine.vector().vectorAngle(new Point(1,0));handle.position(position.x,position.y,angle,this.relatedView);handle.show();handle.options.axis=axis}}else{handle.hide()}},onRemove:function(){this.resetHandles()}},{SegmentHandle:SegmentHandle});var Arrowhead=ToolView.extend({tagName:"path",xAxisVector:new Point(1,0),events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{scale:null},onRender:function(){this.update()},update:function(){var ratio=this.ratio;var view=this.relatedView;var tangent=view.getTangentAtRatio(ratio);var position,angle;if(tangent){position=tangent.start;angle=tangent.vector().vectorAngle(this.xAxisVector)||0}else{position=view.getPointAtRatio(ratio);angle=0}if(!position){return this}var matrix=V.createSVGMatrix().translate(position.x,position.y).rotate(angle);var ref=this.options;var scale=ref.scale;if(scale){matrix=matrix.scale(scale)}this.vel.transform(matrix,{absolute:true});return this},onPointerDown:function(evt){if(this.guard(evt)){return}evt.stopPropagation();evt.preventDefault();var relatedView=this.relatedView;relatedView.model.startBatch("arrowhead-move",{ui:true,tool:this.cid});if(relatedView.can("arrowheadMove")){relatedView.startArrowheadMove(this.arrowheadType);this.delegateDocumentEvents();relatedView.paper.undelegateEvents()}this.focus();this.el.style.pointerEvents="none"},onPointerMove:function(evt){var normalizedEvent=normalizeEvent(evt);var coords=this.paper.snapToGrid(normalizedEvent.clientX,normalizedEvent.clientY);this.relatedView.pointermove(normalizedEvent,coords.x,coords.y)},onPointerUp:function(evt){this.undelegateDocumentEvents();var relatedView=this.relatedView;var paper=relatedView.paper;var normalizedEvent=normalizeEvent(evt);var coords=paper.snapToGrid(normalizedEvent.clientX,normalizedEvent.clientY);relatedView.pointerup(normalizedEvent,coords.x,coords.y);paper.delegateEvents();this.blur();this.el.style.pointerEvents="";relatedView.model.stopBatch("arrowhead-move",{ui:true,tool:this.cid})}});var TargetArrowhead=Arrowhead.extend({name:"target-arrowhead",ratio:1,arrowheadType:"target",attributes:{d:"M -10 -8 10 0 -10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"target-arrowhead"}});var SourceArrowhead=Arrowhead.extend({name:"source-arrowhead",ratio:0,arrowheadType:"source",attributes:{d:"M 10 -8 -10 0 10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"source-arrowhead"}});var Boundary=ToolView.extend({name:"boundary",tagName:"rect",options:{padding:10,useModelGeometry:false},attributes:{fill:"none",stroke:"#33334F","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"},onRender:function(){this.update()},update:function(){var ref=this;var view=ref.relatedView;var options=ref.options;var vel=ref.vel;var useModelGeometry=options.useModelGeometry;var rotate=options.rotate;var padding=normalizeSides(options.padding);var bbox=getViewBBox(view,useModelGeometry).moveAndExpand({x:-padding.left,y:-padding.top,width:padding.left+padding.right,height:padding.top+padding.bottom});var model=view.model;if(model.isElement()){var angle=model.angle();if(angle){if(rotate){var origin=model.getBBox().center();vel.rotate(angle,origin.x,origin.y,{absolute:true})}else{bbox=bbox.bbox(angle)}}}vel.attr(bbox.toJSON());return this}});var Anchor=ToolView.extend({tagName:"g",type:null,children:[{tagName:"circle",selector:"anchor",attributes:{cursor:"pointer"}},{tagName:"rect",selector:"area",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick",dbltap:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{snap:snapAnchor,anchor:getAnchor,scale:null,resetAnchor:true,customAnchorAttributes:{"stroke-width":4,stroke:"#33334F",fill:"#FFFFFF",r:5},defaultAnchorAttributes:{"stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6},areaPadding:6,snapRadius:10,restrictArea:true,redundancyRemoval:true},onRender:function(){this.renderChildren();this.toggleArea(false);this.update()},update:function(){var type=this.type;var relatedView=this.relatedView;var view=relatedView.getEndView(type);if(view){this.updateAnchor();this.updateArea();this.el.style.display=""}else{this.el.style.display="none"}return this},updateAnchor:function(){var childNodes=this.childNodes;if(!childNodes){return}var anchorNode=childNodes.anchor;if(!anchorNode){return}var relatedView=this.relatedView;var type=this.type;var position=relatedView.getEndAnchor(type);var options=this.options;var customAnchor=relatedView.model.prop([type,"anchor"]);var transformString="translate("+position.x+","+position.y+")";if(options.scale){transformString+=" scale("+options.scale+")"}anchorNode.setAttribute("transform",transformString);var anchorAttributes=customAnchor?options.customAnchorAttributes:options.defaultAnchorAttributes;for(var attrName in anchorAttributes){anchorNode.setAttribute(attrName,anchorAttributes[attrName])}},updateArea:function(){var childNodes=this.childNodes;if(!childNodes){return}var areaNode=childNodes.area;if(!areaNode){return}var relatedView=this.relatedView;var type=this.type;var view=relatedView.getEndView(type);var model=view.model;var magnet=relatedView.getEndMagnet(type);var padding=this.options.areaPadding;if(!isFinite(padding)){padding=0}var bbox,angle,center;if(view.isNodeConnection(magnet)){bbox=view.getNodeBBox(magnet);angle=0;center=bbox.center()}else{bbox=view.getNodeUnrotatedBBox(magnet);angle=model.angle();center=bbox.center();if(angle){center.rotate(model.getBBox().center(),-angle)}}bbox.inflate(padding);areaNode.setAttribute("x",-bbox.width/2);areaNode.setAttribute("y",-bbox.height/2);areaNode.setAttribute("width",bbox.width);areaNode.setAttribute("height",bbox.height);areaNode.setAttribute("transform","translate("+center.x+","+center.y+") rotate("+angle+")")},toggleArea:function(visible){var childNodes=this.childNodes;if(!childNodes){return}var areaNode=childNodes.area;if(!areaNode){return}areaNode.style.display=visible?"":"none"},onPointerDown:function(evt){if(this.guard(evt)){return}evt.stopPropagation();evt.preventDefault();this.paper.undelegateEvents();this.delegateDocumentEvents();this.focus();this.toggleArea(this.options.restrictArea);this.relatedView.model.startBatch("anchor-move",{ui:true,tool:this.cid})},resetAnchor:function(anchor){var type=this.type;var relatedModel=this.relatedView.model;if(anchor){relatedModel.prop([type,"anchor"],anchor,{rewrite:true,ui:true,tool:this.cid})}else{relatedModel.removeProp([type,"anchor"],{ui:true,tool:this.cid})}},onPointerMove:function(evt){var relatedView=this.relatedView;var type=this.type;var view=relatedView.getEndView(type);var model=view.model;var magnet=relatedView.getEndMagnet(type);var normalizedEvent=normalizeEvent(evt);var coords=this.paper.clientToLocalPoint(normalizedEvent.clientX,normalizedEvent.clientY);var snapFn=this.options.snap;if(typeof snapFn==="function"){coords=snapFn.call(relatedView,coords,view,magnet,type,relatedView,this);coords=new Point(coords)}if(this.options.restrictArea){if(view.isNodeConnection(magnet)){var pointAtConnection=view.getClosestPoint(coords);if(pointAtConnection){coords=pointAtConnection}}else{var bbox=view.getNodeUnrotatedBBox(magnet);var angle=model.angle();var origin=model.getBBox().center();var rotatedCoords=coords.clone().rotate(origin,angle);if(!bbox.containsPoint(rotatedCoords)){coords=bbox.pointNearestToPoint(rotatedCoords).rotate(origin,-angle)}}}var anchor;var anchorFn=this.options.anchor;if(typeof anchorFn==="function"){anchor=anchorFn.call(relatedView,coords,view,magnet,type,relatedView)}this.resetAnchor(anchor);this.update()},onPointerUp:function(evt){this.paper.delegateEvents();this.undelegateDocumentEvents();this.blur();this.toggleArea(false);var linkView=this.relatedView;if(this.options.redundancyRemoval){linkView.removeRedundantLinearVertices({ui:true,tool:this.cid})}linkView.model.stopBatch("anchor-move",{ui:true,tool:this.cid})},onPointerDblClick:function(){var anchor=this.options.resetAnchor;if(anchor===false){return}if(anchor===true){anchor=null}this.resetAnchor(cloneDeep(anchor));this.update()}});var SourceAnchor=Anchor.extend({name:"source-anchor",type:"source"});var TargetAnchor=Anchor.extend({name:"target-anchor",type:"target"});var Button=ToolView.extend({name:"button",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},options:{distance:0,offset:0,scale:null,rotate:false},onRender:function(){this.renderChildren(this.options.markup);this.update()},update:function(){this.position();return this},position:function(){var ref=this;var vel=ref.vel;vel.transform(this.getCellMatrix(),{absolute:true})},getCellMatrix:function getCellMatrix(){return this.relatedView.model.isLink()?this.getLinkMatrix():this.getElementMatrix()},getElementMatrix:function getElementMatrix(){var ref=this;var view=ref.relatedView;var options=ref.options;var x=options.x;if(x===void 0)x=0;var y=options.y;if(y===void 0)y=0;var offset=options.offset;if(offset===void 0)offset={};var useModelGeometry=options.useModelGeometry;var rotate=options.rotate;var scale=options.scale;var bbox=getViewBBox(view,useModelGeometry);var angle=view.model.angle();if(!rotate){bbox=bbox.bbox(angle)}var offsetX=offset.x;if(offsetX===void 0)offsetX=0;var offsetY=offset.y;if(offsetY===void 0)offsetY=0;if(isPercentage(x)){x=parseFloat(x)/100*bbox.width}else if(isCalcAttribute(x)){x=Number(evalCalcAttribute(x,bbox))}if(isPercentage(y)){y=parseFloat(y)/100*bbox.height}else if(isCalcAttribute(y)){y=Number(evalCalcAttribute(y,bbox))}var matrix=V.createSVGMatrix().translate(bbox.x+bbox.width/2,bbox.y+bbox.height/2);if(rotate){matrix=matrix.rotate(angle)}matrix=matrix.translate(x+offsetX-bbox.width/2,y+offsetY-bbox.height/2);if(scale){matrix=matrix.scale(scale)}return matrix},getLinkMatrix:function getLinkMatrix(){var ref=this;var view=ref.relatedView;var options=ref.options;var offset=options.offset;if(offset===void 0)offset=0;var distance=options.distance;if(distance===void 0)distance=0;var rotate=options.rotate;var scale=options.scale;var tangent,position,angle;if(isPercentage(distance)){tangent=view.getTangentAtRatio(parseFloat(distance)/100)}else{tangent=view.getTangentAtLength(distance)}if(tangent){position=tangent.start;angle=tangent.vector().vectorAngle(new Point(1,0))||0}else{position=view.getConnection().start;angle=0}var matrix=V.createSVGMatrix().translate(position.x,position.y).rotate(angle).translate(0,offset);if(!rotate){matrix=matrix.rotate(-angle)}if(scale){matrix=matrix.scale(scale)}return matrix},onPointerDown:function(evt){if(this.guard(evt)){return}evt.stopPropagation();evt.preventDefault();var actionFn=this.options.action;if(typeof actionFn==="function"){actionFn.call(this.relatedView,evt,this.relatedView,this)}}});var Remove=Button.extend({children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],options:{distance:60,offset:0,action:function(evt,view,tool){view.model.remove({ui:true,tool:tool.cid})}}});var Connect=Button.extend({name:"connect",documentEvents:{mousemove:"drag",touchmove:"drag",mouseup:"dragend",touchend:"dragend",touchcancel:"dragend"},children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#333333",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -4 -1 L 0 -1 L 0 -4 L 4 0 L 0 4 0 1 -4 1 z",fill:"#FFFFFF",stroke:"none","stroke-width":2,"pointer-events":"none"}}],options:{distance:80,offset:0,magnet:function(view){return view.el},action:function(evt,_view,tool){return tool.dragstart(evt)}},getMagnetNode:function(){var assign;var ref=this;var options=ref.options;var relatedView=ref.relatedView;var magnet=options.magnet;var magnetNode;switch(typeof magnet){case"function":{magnetNode=magnet.call(this,relatedView,this);break}case"string":{assign=relatedView.findBySelector(magnet),magnetNode=assign[0];break}default:{magnetNode=magnet;break}}if(!magnetNode){magnetNode=relatedView.el}if(magnetNode instanceof SVGElement){return magnetNode}throw new Error("Connect: magnet must be an SVGElement")},dragstart:function(evt){var ref=this;var paper=ref.paper;var relatedView=ref.relatedView;var normalizedEvent=normalizeEvent(evt);var ref$1=paper.clientToLocalPoint(normalizedEvent.clientX,normalizedEvent.clientY);var x=ref$1.x;var y=ref$1.y;relatedView.dragLinkStart(normalizedEvent,this.getMagnetNode(),x,y);paper.undelegateEvents();this.delegateDocumentEvents(null,normalizedEvent.data);this.focus()},drag:function(evt){var ref=this;var paper=ref.paper;var relatedView=ref.relatedView;var normalizedEvent=normalizeEvent(evt);var ref$1=paper.snapToGrid(normalizedEvent.clientX,normalizedEvent.clientY);var x=ref$1.x;var y=ref$1.y;relatedView.dragLink(normalizedEvent,x,y)},dragend:function(evt){var ref=this;var paper=ref.paper;var relatedView=ref.relatedView;var normalizedEvent=normalizeEvent(evt);var ref$1=paper.snapToGrid(normalizedEvent.clientX,normalizedEvent.clientY);var x=ref$1.x;var y=ref$1.y;relatedView.dragLinkEnd(normalizedEvent,x,y);this.undelegateDocumentEvents();paper.delegateEvents();this.blur();relatedView.checkMouseleave(normalizedEvent)}});var HoverConnect=Connect.extend({name:"hover-connect",defaultMarkup:[{tagName:"circle",attributes:{r:7,fill:"#333333",cursor:"pointer"}},{tagName:"path",attributes:{d:"M -4 -1 L 0 -1 L 0 -4 L 4 0 L 0 4 0 1 -4 1 z",fill:"#FFFFFF",stroke:"none","stroke-width":2}}],children:function children(){var ref=this;var options=ref.options;var defaultMarkup=ref.defaultMarkup;return[{tagName:"path",selector:"track",attributes:{fill:"none",stroke:"transparent","stroke-width":options.trackWidth||15,cursor:"pointer"}},{tagName:"g",selector:"button",attributes:{"pointer-events":"none",display:"none"},children:options.markup||defaultMarkup}]},events:Object.assign({mousemove:"onMousemove",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},Connect.prototype.events),onRender:function(){this.renderChildren();this.update()},trackPath:null,update:function update(){var ref=this;var childNodes=ref.childNodes;this.trackPath=this.getTrackPath();Connect.prototype.update.apply(this,arguments);childNodes.track.setAttribute("d",this.trackPath.serialize())},position:function position(){var ref=this;var el=ref.el;var childNodes=ref.childNodes;childNodes.button.setAttribute("transform",V.matrixToTransformString(this.getButtonMatrix()));el.setAttribute("transform",V.matrixToTransformString(this.getTrackMatrix()))},getButtonMatrix:function getButtonMatrix(){var ref=this;var options=ref.options;var trackPath=ref.trackPath;var offset=options.offset;if(offset===void 0)offset=0;var distance=options.distance;if(distance===void 0)distance=0;var rotate=options.rotate;var scale=options.scale;var tangent,position,angle;if(isPercentage(distance)){tangent=trackPath.tangentAtRatio(parseFloat(distance)/100)}else{tangent=trackPath.tangentAtLength(distance)}if(tangent){position=tangent.start;angle=tangent.vector().vectorAngle(new Point(1,0))||0}else{position=trackPath.start;angle=0}var matrix=V.createSVGMatrix().translate(position.x,position.y).rotate(angle).translate(0,offset);if(!rotate){matrix=matrix.rotate(-angle)}if(scale){matrix=matrix.scale(scale)}return matrix},getTrackPath:function getTrackPath(){return this.relatedView.getConnection()},getTrackMatrix:function getTrackMatrix(){return V.createSVGMatrix()},getTrackRatioFromEvent:function getTrackRatioFromEvent(evt){var ref=this;var relatedView=ref.relatedView;var trackPath=ref.trackPath;var localPoint=relatedView.paper.clientToLocalPoint(evt.clientX,evt.clientY);var trackPoint=V.transformPoint(localPoint,this.getTrackMatrix().inverse());return trackPath.closestPointLength(trackPoint)},canShowButton:function canShowButton(){return $._data(this.paper.el,"events")},showButton:function showButton(){this.childNodes.button.style.display="block"},hideButton:function hideButton(){this.childNodes.button.style.display=""},onMousemove:function onMousemove(evt){var ref=this;var trackPath=ref.trackPath;if(!trackPath){return}var ref$1=this;var options=ref$1.options;options.distance=this.getTrackRatioFromEvent(evt);this.position()},onMouseenter:function onMouseenter(){if(!this.canShowButton()){return}this.showButton()},onMouseleave:function onMouseleave(){this.hideButton()}});var index$5={Vertices:Vertices,Segments:Segments,TargetArrowhead:TargetArrowhead,SourceArrowhead:SourceArrowhead,Boundary:Boundary,SourceAnchor:SourceAnchor,TargetAnchor:TargetAnchor,Button:Button,Remove:Remove,Connect:Connect,HoverConnect:HoverConnect};var Control=ToolView.extend({tagName:"g",children:[{tagName:"circle",selector:"handle",attributes:{cursor:"pointer","stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6}},{tagName:"rect",selector:"extras",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick",dbltap:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{handleAttributes:null,selector:"root",padding:6,scale:null},getPosition:function(){},setPosition:function(){},resetPosition:function(){},onRender:function(){this.renderChildren();this.toggleExtras(false);this.update()},update:function(){var ref=this.childNodes;var handle=ref.handle;var extras=ref.extras;if(handle){this.updateHandle(handle)}else{throw new Error("Control: markup selector `handle` is required")}if(extras){this.updateExtras(extras)}return this},updateHandle:function(handleNode){var ref=this;var relatedView=ref.relatedView;var options=ref.options;var model=relatedView.model;var relativePos=this.getPosition(relatedView,this);var absolutePos=model.getAbsolutePointFromRelative(relativePos);var handleAttributes=options.handleAttributes;var scale=options.scale;var transformString="translate("+absolutePos.x+","+absolutePos.y+")";if(scale){transformString+=" scale("+scale+")"}handleNode.setAttribute("transform",transformString);if(handleAttributes){for(var attrName in handleAttributes){handleNode.setAttribute(attrName,handleAttributes[attrName])}}},updateExtras:function(extrasNode){var ref=this;var relatedView=ref.relatedView;var options=ref.options;var ref$1=this.options;var selector=ref$1.selector;if(!selector){this.toggleExtras(false);return}var ref$2=relatedView.findBySelector(selector);var magnet=ref$2[0];if(!magnet){throw new Error("Control: invalid selector.")}var padding=options.padding;if(!isFinite(padding)){padding=0}var bbox=relatedView.getNodeUnrotatedBBox(magnet);var model=relatedView.model;var angle=model.angle();var center=bbox.center();if(angle){center.rotate(model.getBBox().center(),-angle)}bbox.inflate(padding);extrasNode.setAttribute("x",-bbox.width/2);extrasNode.setAttribute("y",-bbox.height/2);extrasNode.setAttribute("width",bbox.width);extrasNode.setAttribute("height",bbox.height);extrasNode.setAttribute("transform","translate("+center.x+","+center.y+") rotate("+angle+")")},toggleExtras:function(visible){var ref=this.childNodes;var extras=ref.extras;if(!extras){return}extras.style.display=visible?"":"none"},onPointerDown:function(evt){var ref=this;var relatedView=ref.relatedView;var paper=ref.paper;if(this.guard(evt)){return}evt.stopPropagation();evt.preventDefault();paper.undelegateEvents();this.delegateDocumentEvents();this.focus();this.toggleExtras(true);relatedView.model.startBatch("control-move",{ui:true,tool:this.cid})},onPointerMove:function(evt){var ref=this;var relatedView=ref.relatedView;var paper=ref.paper;var model=relatedView.model;var ref$1=normalizeEvent(evt);var clientX=ref$1.clientX;var clientY=ref$1.clientY;var coords=paper.clientToLocalPoint(clientX,clientY);var relativeCoords=model.getRelativePointFromAbsolute(coords);this.setPosition(relatedView,relativeCoords,this);this.update()},onPointerUp:function(_evt){var ref=this;var relatedView=ref.relatedView;var paper=ref.paper;paper.delegateEvents();this.undelegateDocumentEvents();this.blur();this.toggleExtras(false);relatedView.model.stopBatch("control-move",{ui:true,tool:this.cid})},onPointerDblClick:function(){var ref=this;var relatedView=ref.relatedView;this.resetPosition(relatedView,this);this.update()}});var HoverConnect$1=HoverConnect.extend({getTrackPath:function getTrackPath(){var ref=this;var view=ref.relatedView;var options=ref.options;var useModelGeometry=options.useModelGeometry;var trackPath=options.trackPath;if(trackPath===void 0)trackPath="M 0 0 H calc(w) V calc(h) H 0 Z";if(typeof trackPath==="function"){trackPath=trackPath.call(this,view)}if(isCalcAttribute(trackPath)){var bbox=getViewBBox(view,useModelGeometry);trackPath=evalCalcAttribute(trackPath,bbox)}return new Path(V.normalizePathData(trackPath))},getTrackMatrix:function getTrackMatrix(){var ref=this;var view=ref.relatedView;var options=ref.options;var useModelGeometry=options.useModelGeometry;var rotate=options.rotate;var bbox=getViewBBox(view,useModelGeometry);var angle=view.model.angle();if(!rotate){bbox=bbox.bbox(angle)}var matrix=V.createSVGMatrix().translate(bbox.x+bbox.width/2,bbox.y+bbox.height/2);if(rotate){matrix=matrix.rotate(angle)}matrix=matrix.translate(-bbox.width/2,-bbox.height/2);return matrix}});var index$6={Button:Button,Remove:Remove,Connect:Connect,Boundary:Boundary,HoverConnect:HoverConnect$1,Control:Control};var version="3.6.5";var Vectorizer=V;var layout={PortLabel:PortLabel,Port:Port};var setTheme=function(theme,opt){opt=opt||{};invoke(views,"setTheme",theme,opt);View.prototype.defaultTheme=theme};var layout$1={DirectedGraph:DirectedGraph,PortLabel:PortLabel,Port:Port};var format$1={};var ui={};exports.V=V;exports.Vectorizer=Vectorizer;exports.anchors=anchors;exports.config=config;exports.connectionPoints=connectionPoints;exports.connectionStrategies=index$4;exports.connectors=connectors;exports.dia=index$2;exports.elementTools=index$6;exports.env=env;exports.format=format$1;exports.g=g;exports.highlighters=highlighters;exports.layout=layout$1;exports.linkAnchors=linkAnchors;exports.linkTools=index$5;exports.mvc=index$1;exports.routers=routers;exports.setTheme=setTheme;exports.shapes=index$3;exports.ui=ui;exports.util=index;exports.version=version;Object.defineProperty(exports,"__esModule",{value:true})});if(typeof joint!=="undefined"){var g=joint.g,V=joint.V,Vectorizer=joint.V}(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory(require("rgbcolor"),require("stackblur-canvas"),require("canvas")):typeof define==="function"&&define.amd?define(["rgbcolor","stackblur-canvas","canvas"],factory):global.canvg=factory(global.RGBColor,global.StackBlur,global.Canvas)})(this,function(rgbcolor,stackblurCanvas,canvas){"use strict";rgbcolor=rgbcolor&&rgbcolor.hasOwnProperty("default")?rgbcolor["default"]:rgbcolor;stackblurCanvas=stackblurCanvas&&stackblurCanvas.hasOwnProperty("default")?stackblurCanvas["default"]:stackblurCanvas;canvas=canvas&&canvas.hasOwnProperty("default")?canvas["default"]:canvas;function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var canvg_1=createCommonjsModule(function(module){var isNode=module.exports&&typeof window==="undefined",nodeEnv=false;var windowEnv;{windowEnv=window;windowEnv.DOMParser=window.DOMParser}var defaultClientWidth=800,defaultClientHeight=600;function createCanvas(width,height){var c;{c=document.createElement("canvas");c.width=width;c.height=height}return c}var canvg=function(target,s,opts){if(target==null&&s==null&&opts==null){var svgTags=document.querySelectorAll("svg");for(var i=0;i<svgTags.length;i++){var svgTag=svgTags[i];var c=document.createElement("canvas");if(typeof svgTag.clientWidth!=="undefined"&&typeof svgTag.clientHeight!=="undefined"){c.width=svgTag.clientWidth;c.height=svgTag.clientHeight}else{var rect=svgTag.getBoundingClientRect();c.width=rect.width;c.height=rect.height}svgTag.parentNode.insertBefore(c,svgTag);svgTag.parentNode.removeChild(svgTag);var div=document.createElement("div");div.appendChild(svgTag);canvg(c,div.innerHTML)}return}var svg=build(opts||{});if(typeof target=="string"){target=document.getElementById(target)}if(target.svg!=null)target.svg.stop();if(!(target.childNodes&&target.childNodes.length==1&&target.childNodes[0].nodeName=="OBJECT"))target.svg=svg;var ctx=target.getContext("2d");if(typeof s.documentElement!="undefined"){svg.loadXmlDoc(ctx,s)}else if(s.substr(0,1)=="<"){svg.loadXml(ctx,s)}else{svg.load(ctx,s)}};var matchesSelector;{if(typeof Element=="undefined");else if(typeof Element.prototype.matches!="undefined"){matchesSelector=function(node,selector){return node.matches(selector)}}else if(typeof Element.prototype.webkitMatchesSelector!="undefined"){matchesSelector=function(node,selector){return node.webkitMatchesSelector(selector)}}else if(typeof Element.prototype.mozMatchesSelector!="undefined"){matchesSelector=function(node,selector){return node.mozMatchesSelector(selector)}}else if(typeof Element.prototype.msMatchesSelector!="undefined"){matchesSelector=function(node,selector){return node.msMatchesSelector(selector)}}else if(typeof Element.prototype.oMatchesSelector!="undefined"){matchesSelector=function(node,selector){return node.oMatchesSelector(selector)}}else{if(typeof jQuery==="function"||typeof Zepto==="function"){matchesSelector=function(node,selector){return $(node).is(selector)}}if(typeof matchesSelector==="undefined"&&typeof Sizzle!=="undefined"){matchesSelector=Sizzle.matchesSelector}}}var attributeRegex=/(\[[^\]]+\])/g;var idRegex=/(#[^\s\+>~\.\[:]+)/g;var classRegex=/(\.[^\s\+>~\.\[:]+)/g;var pseudoElementRegex=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi;var pseudoClassWithBracketsRegex=/(:[\w-]+\([^\)]*\))/gi;var pseudoClassRegex=/(:[^\s\+>~\.\[:]+)/g;var elementRegex=/([^\s\+>~\.\[:]+)/g;function getSelectorSpecificity(selector){var typeCount=[0,0,0];var findMatch=function(regex,type){var matches=selector.match(regex);if(matches==null){return}typeCount[type]+=matches.length;selector=selector.replace(regex," ")};selector=selector.replace(/:not\(([^\)]*)\)/g,"     $1 ");selector=selector.replace(/{[\s\S]*/gm," ");findMatch(attributeRegex,1);findMatch(idRegex,0);findMatch(classRegex,1);findMatch(pseudoElementRegex,2);findMatch(pseudoClassWithBracketsRegex,1);findMatch(pseudoClassRegex,1);selector=selector.replace(/[\*\s\+>~]/g," ");selector=selector.replace(/[#\.]/g," ");findMatch(elementRegex,2);return typeCount.join("")}function build(opts){var svg={opts:opts};svg.FRAMERATE=30;svg.MAX_VIRTUAL_PIXELS=3e4;svg.rootEmSize=12;svg.emSize=12;svg.log=function(msg){};if(svg.opts["log"]==true&&typeof console!="undefined"){svg.log=function(msg){console.log(msg)}}svg.init=function(ctx){var uniqueId=0;svg.UniqueId=function(){uniqueId++;return"canvg"+uniqueId};svg.Definitions={};svg.Styles={};svg.StylesSpecificity={};svg.Animations=[];svg.Images=[];svg.ctx=ctx;svg.ViewPort=new function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(width,height){this.viewPorts.push({width:width,height:height})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(d){if(d!=null&&typeof d=="number")return d;if(d=="x")return this.width();if(d=="y")return this.height();return Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}};svg.init();svg.ImagesLoaded=function(){for(var i=0;i<svg.Images.length;i++){if(!svg.Images[i].loaded)return false}return true};svg.trim=function(s){return s.replace(/^\s+|\s+$/g,"")};svg.compressSpaces=function(s){return s.replace(/(?!\u3000)\s+/gm," ")};svg.ajax=function(url){var AJAX;if(windowEnv.XMLHttpRequest){AJAX=new windowEnv.XMLHttpRequest}else{AJAX=new ActiveXObject("Microsoft.XMLHTTP")}if(AJAX){AJAX.open("GET",url,false);AJAX.send(null);return AJAX.responseText}return null};svg.parseXml=function(xml){if(typeof Windows!="undefined"&&typeof Windows.Data!="undefined"&&typeof Windows.Data.Xml!="undefined"){var xmlDoc=new Windows.Data.Xml.Dom.XmlDocument;var settings=new Windows.Data.Xml.Dom.XmlLoadSettings;settings.prohibitDtd=false;xmlDoc.loadXml(xml,settings);return xmlDoc}else if(windowEnv.DOMParser){try{var parser=opts.xmldom?new windowEnv.DOMParser(opts.xmldom):new windowEnv.DOMParser;return parser.parseFromString(xml,"image/svg+xml")}catch(e){parser=opts.xmldom?new windowEnv.DOMParser(opts.xmldom):new windowEnv.DOMParser;return parser.parseFromString(xml,"text/xml")}}else{xml=xml.replace(/<!DOCTYPE svg[^>]*>/,"");var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xml);return xmlDoc}};svg.Property=function(name,value){this.name=name;this.value=value};svg.Property.prototype.getValue=function(){return this.value};svg.Property.prototype.hasValue=function(){return this.value!=null&&this.value!==""};svg.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var n=parseFloat(this.value);if((this.value+"").match(/%$/)){n=n/100}return n};svg.Property.prototype.valueOrDefault=function(def){if(this.hasValue())return this.value;return def};svg.Property.prototype.numValueOrDefault=function(def){if(this.hasValue())return this.numValue();return def};svg.Property.prototype.addOpacity=function(opacityProp){var newValue=this.value;if(opacityProp.value!=null&&opacityProp.value!=""&&typeof this.value=="string"){var color=new rgbcolor(this.value);if(color.ok){newValue="rgba("+color.r+", "+color.g+", "+color.b+", "+opacityProp.numValue()+")"}}return new svg.Property(this.name,newValue)};svg.Property.prototype.getDefinition=function(){var name=this.value.match(/#([^\)'"]+)/);if(name){name=name[1]}if(!name){name=this.value}return svg.Definitions[name]};svg.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0};svg.Property.prototype.getFillStyleDefinition=function(e,opacityProp){var def=this.getDefinition();if(def!=null&&def.createGradient){return def.createGradient(svg.ctx,e,opacityProp)}if(def!=null&&def.createPattern){if(def.getHrefAttribute().hasValue()){var pt=def.attribute("patternTransform");def=def.getHrefAttribute().getDefinition();if(pt.hasValue()){def.attribute("patternTransform",true).value=pt.value}}return def.createPattern(svg.ctx,e)}return null};svg.Property.prototype.getDPI=function(viewPort){return 96};svg.Property.prototype.getREM=function(viewPort){return svg.rootEmSize};svg.Property.prototype.getEM=function(viewPort){return svg.emSize};svg.Property.prototype.getUnits=function(){var s=this.value+"";return s.replace(/[0-9\.\-]/g,"")};svg.Property.prototype.isPixels=function(){if(!this.hasValue())return false;var s=this.value+"";if(s.match(/px$/))return true;if(s.match(/^[0-9]+$/))return true;return false};svg.Property.prototype.toPixels=function(viewPort,processPercent){if(!this.hasValue())return 0;var s=this.value+"";if(s.match(/rem$/))return this.numValue()*this.getREM(viewPort);if(s.match(/em$/))return this.numValue()*this.getEM(viewPort);if(s.match(/ex$/))return this.numValue()*this.getEM(viewPort)/2;if(s.match(/px$/))return this.numValue();if(s.match(/pt$/))return this.numValue()*this.getDPI(viewPort)*(1/72);if(s.match(/pc$/))return this.numValue()*15;if(s.match(/cm$/))return this.numValue()*this.getDPI(viewPort)/2.54;if(s.match(/mm$/))return this.numValue()*this.getDPI(viewPort)/25.4;if(s.match(/in$/))return this.numValue()*this.getDPI(viewPort);if(s.match(/%$/))return this.numValue()*svg.ViewPort.ComputeSize(viewPort);var n=this.numValue();if(processPercent&&n<1)return n*svg.ViewPort.ComputeSize(viewPort);return n};svg.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var s=this.value+"";if(s.match(/s$/))return this.numValue()*1e3;if(s.match(/ms$/))return this.numValue();return this.numValue()};svg.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var s=this.value+"";if(s.match(/deg$/))return this.numValue()*(Math.PI/180);if(s.match(/grad$/))return this.numValue()*(Math.PI/200);if(s.match(/rad$/))return this.numValue();return this.numValue()*(Math.PI/180)};var textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};svg.Property.prototype.toTextBaseline=function(){if(!this.hasValue())return null;return textBaselineMapping[this.value]};svg.Font=new function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(fontStyle,fontVariant,fontWeight,fontSize,fontFamily,inherit){var f=inherit!=null?this.Parse(inherit):this.CreateFont("","","","","",svg.ctx.font);var fontFamily=fontFamily||f.fontFamily;return{fontFamily:fontFamily,fontSize:fontSize||f.fontSize,fontStyle:fontStyle||f.fontStyle,fontWeight:fontWeight||f.fontWeight,fontVariant:fontVariant||f.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var that=this;this.Parse=function(s){var f={};var d=svg.trim(svg.compressSpaces(s||"")).split(" ");var set={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};var ff="";for(var i=0;i<d.length;i++){if(!set.fontStyle&&that.Styles.indexOf(d[i])!=-1){if(d[i]!="inherit")f.fontStyle=d[i];set.fontStyle=true}else if(!set.fontVariant&&that.Variants.indexOf(d[i])!=-1){if(d[i]!="inherit")f.fontVariant=d[i];set.fontStyle=set.fontVariant=true}else if(!set.fontWeight&&that.Weights.indexOf(d[i])!=-1){if(d[i]!="inherit")f.fontWeight=d[i];set.fontStyle=set.fontVariant=set.fontWeight=true}else if(!set.fontSize){if(d[i]!="inherit")f.fontSize=d[i].split("/")[0];set.fontStyle=set.fontVariant=set.fontWeight=set.fontSize=true}else{if(d[i]!="inherit")ff+=d[i]}}if(ff!="")f.fontFamily=ff;return f}};svg.ToNumberArray=function(s){var a=svg.trim(svg.compressSpaces((s||"").replace(/,/g," "))).split(" ");for(var i=0;i<a.length;i++){a[i]=parseFloat(a[i])}return a};svg.Point=function(x,y){this.x=x;this.y=y};svg.Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x)};svg.Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4];var yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp;this.y=yp};svg.CreatePoint=function(s){var a=svg.ToNumberArray(s);return new svg.Point(a[0],a[1])};svg.CreatePath=function(s){var a=svg.ToNumberArray(s);var path=[];for(var i=0;i<a.length;i+=2){path.push(new svg.Point(a[i],a[i+1]))}return path};svg.BoundingBox=function(x1,y1,x2,y2){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=function(x,y){if(x!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=x;this.x2=x}if(x<this.x1)this.x1=x;if(x>this.x2)this.x2=x}if(y!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=y;this.y2=y}if(y<this.y1)this.y1=y;if(y>this.y2)this.y2=y}};this.addX=function(x){this.addPoint(x,null)};this.addY=function(y){this.addPoint(null,y)};this.addBoundingBox=function(bb){this.addPoint(bb.x1,bb.y1);this.addPoint(bb.x2,bb.y2)};this.addQuadraticCurve=function(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x);var cp1y=p0y+2/3*(p1y-p0y);var cp2x=cp1x+1/3*(p2x-p0x);var cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y)};this.addBezierCurve=function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];this.addPoint(p0[0],p0[1]);this.addPoint(p3[0],p3[1]);for(var i=0;i<=1;i++){var f=function(t){return Math.pow(1-t,3)*p0[i]+3*Math.pow(1-t,2)*t*p1[i]+3*(1-t)*Math.pow(t,2)*p2[i]+Math.pow(t,3)*p3[i]};var b=6*p0[i]-12*p1[i]+6*p2[i];var a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i];var c=3*p1[i]-3*p0[i];if(a==0){if(b==0)continue;var t=-c/b;if(0<t&&t<1){if(i==0)this.addX(f(t));if(i==1)this.addY(f(t))}continue}var b2ac=Math.pow(b,2)-4*c*a;if(b2ac<0)continue;var t1=(-b+Math.sqrt(b2ac))/(2*a);if(0<t1&&t1<1){if(i==0)this.addX(f(t1));if(i==1)this.addY(f(t1))}var t2=(-b-Math.sqrt(b2ac))/(2*a);if(0<t2&&t2<1){if(i==0)this.addX(f(t2));if(i==1)this.addY(f(t2))}}};this.isPointInBox=function(x,y){return this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2};this.addPoint(x1,y1);this.addPoint(x2,y2)};svg.Transform=function(v){var that=this;this.Type={};this.Type.translate=function(s){this.p=svg.CreatePoint(s);this.apply=function(ctx){ctx.translate(this.p.x||0,this.p.y||0)};this.unapply=function(ctx){ctx.translate(-1*this.p.x||0,-1*this.p.y||0)};this.applyToPoint=function(p){p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(s){var a=svg.ToNumberArray(s);this.angle=new svg.Property("angle",a[0]);this.cx=a[1]||0;this.cy=a[2]||0;this.apply=function(ctx){ctx.translate(this.cx,this.cy);ctx.rotate(this.angle.toRadians());ctx.translate(-this.cx,-this.cy)};this.unapply=function(ctx){ctx.translate(this.cx,this.cy);ctx.rotate(-1*this.angle.toRadians());ctx.translate(-this.cx,-this.cy)};this.applyToPoint=function(p){var a=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);p.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]);p.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(s){this.p=svg.CreatePoint(s);this.apply=function(ctx){ctx.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(ctx){ctx.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(p){p.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(s){this.m=svg.ToNumberArray(s);this.apply=function(ctx){ctx.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(ctx){var a=this.m[0];var b=this.m[2];var c=this.m[4];var d=this.m[1];var e=this.m[3];var f=this.m[5];var g=0;var h=0;var i=1;var det=1/(a*(e*i-f*h)-b*(d*i-f*g)+c*(d*h-e*g));ctx.transform(det*(e*i-f*h),det*(f*g-d*i),det*(c*h-b*i),det*(a*i-c*g),det*(b*f-c*e),det*(c*d-a*f))};this.applyToPoint=function(p){p.applyTransform(this.m)}};this.Type.SkewBase=function(s){this.base=that.Type.matrix;this.base(s);this.angle=new svg.Property("angle",s)};this.Type.SkewBase.prototype=new this.Type.matrix;this.Type.skewX=function(s){this.base=that.Type.SkewBase;this.base(s);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(s){this.base=that.Type.SkewBase;this.base(s);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(ctx){for(var i=0;i<this.transforms.length;i++){this.transforms[i].apply(ctx)}};this.unapply=function(ctx){for(var i=this.transforms.length-1;i>=0;i--){this.transforms[i].unapply(ctx)}};this.applyToPoint=function(p){for(var i=0;i<this.transforms.length;i++){this.transforms[i].applyToPoint(p)}};var data=svg.trim(svg.compressSpaces(v)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var i=0;i<data.length;i++){if(data[i]==="none"){continue}var type=svg.trim(data[i].split("(")[0]);var s=data[i].split("(")[1].replace(")","");var transformType=this.Type[type];if(typeof transformType!="undefined"){var transform=new transformType(s);transform.type=type;this.transforms.push(transform)}}};svg.AspectRatio=function(ctx,aspectRatio,width,desiredWidth,height,desiredHeight,minX,minY,refX,refY){aspectRatio=svg.compressSpaces(aspectRatio);aspectRatio=aspectRatio.replace(/^defer\s/,"");var align=aspectRatio.split(" ")[0]||"xMidYMid";var meetOrSlice=aspectRatio.split(" ")[1]||"meet";var scaleX=width/desiredWidth;var scaleY=height/desiredHeight;var scaleMin=Math.min(scaleX,scaleY);var scaleMax=Math.max(scaleX,scaleY);if(meetOrSlice=="meet"){desiredWidth*=scaleMin;desiredHeight*=scaleMin}if(meetOrSlice=="slice"){desiredWidth*=scaleMax;desiredHeight*=scaleMax}refX=new svg.Property("refX",refX);refY=new svg.Property("refY",refY);if(refX.hasValue()&&refY.hasValue()){ctx.translate(-scaleMin*refX.toPixels("x"),-scaleMin*refY.toPixels("y"))}else{if(align.match(/^xMid/)&&(meetOrSlice=="meet"&&scaleMin==scaleY||meetOrSlice=="slice"&&scaleMax==scaleY))ctx.translate(width/2-desiredWidth/2,0);if(align.match(/YMid$/)&&(meetOrSlice=="meet"&&scaleMin==scaleX||meetOrSlice=="slice"&&scaleMax==scaleX))ctx.translate(0,height/2-desiredHeight/2);if(align.match(/^xMax/)&&(meetOrSlice=="meet"&&scaleMin==scaleY||meetOrSlice=="slice"&&scaleMax==scaleY))ctx.translate(width-desiredWidth,0);if(align.match(/YMax$/)&&(meetOrSlice=="meet"&&scaleMin==scaleX||meetOrSlice=="slice"&&scaleMax==scaleX))ctx.translate(0,height-desiredHeight)}if(align=="none")ctx.scale(scaleX,scaleY);else if(meetOrSlice=="meet")ctx.scale(scaleMin,scaleMin);else if(meetOrSlice=="slice")ctx.scale(scaleMax,scaleMax);ctx.translate(minX==null?0:-minX,minY==null?0:-minY)};svg.Element={};svg.EmptyProperty=new svg.Property("EMPTY","");svg.Element.ElementBase=function(node){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(name,createIfNotExists){var a=this.attributes[name];if(a!=null)return a;if(createIfNotExists==true){a=new svg.Property(name,"");this.attributes[name]=a}return a||svg.EmptyProperty};this.getHrefAttribute=function(){for(var a in this.attributes){if(a=="href"||a.match(/:href$/)){return this.attributes[a]}}return svg.EmptyProperty};this.style=function(name,createIfNotExists,skipAncestors){var s=this.styles[name];if(s!=null)return s;var a=this.attribute(name);if(a!=null&&a.hasValue()){this.styles[name]=a;return a}if(skipAncestors!=true){var p=this.parent;if(p!=null){var ps=p.style(name);if(ps!=null&&ps.hasValue()){return ps}}}if(createIfNotExists==true){s=new svg.Property(name,"");this.styles[name]=s}return s||svg.EmptyProperty};this.render=function(ctx){if(this.style("display").value=="none")return;if(this.style("visibility").value=="hidden")return;ctx.save();if(this.style("mask").hasValue()){var mask=this.style("mask").getDefinition();if(mask!=null)mask.apply(ctx,this)}else if(this.style("filter").hasValue()){var filter=this.style("filter").getDefinition();if(filter!=null)filter.apply(ctx,this)}else{this.setContext(ctx);this.renderChildren(ctx);this.clearContext(ctx)}ctx.restore()};this.setContext=function(ctx){};this.clearContext=function(ctx){};this.renderChildren=function(ctx){for(var i=0;i<this.children.length;i++){this.children[i].render(ctx)}};this.addChild=function(childNode,create){var child=childNode;if(create)child=svg.CreateElement(childNode);child.parent=this;if(child.type!="title"){this.children.push(child)}};this.addStylesFromStyleDefinition=function(){for(var selector in svg.Styles){if(selector[0]!="@"&&matchesSelector(node,selector)){var styles=svg.Styles[selector];var specificity=svg.StylesSpecificity[selector];if(styles!=null){for(var name in styles){var existingSpecificity=this.stylesSpecificity[name];if(typeof existingSpecificity=="undefined"){existingSpecificity="000"}if(specificity>=existingSpecificity){this.styles[name]=styles[name];this.stylesSpecificity[name]=specificity}}}}}};var allUppercase=new RegExp("^[A-Z-]+$");var normalizeAttributeName=function(name){if(allUppercase.test(name)){return name.toLowerCase()}return name};if(node!=null&&node.nodeType==1){for(var i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];var nodeName=normalizeAttributeName(attribute.nodeName);this.attributes[nodeName]=new svg.Property(nodeName,attribute.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue()){var styles=this.attribute("style").value.split(";");for(var i=0;i<styles.length;i++){if(svg.trim(styles[i])!=""){var style=styles[i].split(":");var name=svg.trim(style[0]);var value=svg.trim(style[1]);this.styles[name]=new svg.Property(name,value)}}}if(this.attribute("id").hasValue()){if(svg.Definitions[this.attribute("id").value]==null){svg.Definitions[this.attribute("id").value]=this}}for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];if(childNode.nodeType==1)this.addChild(childNode,true);if(this.captureTextNodes&&(childNode.nodeType==3||childNode.nodeType==4)){var text=childNode.value||childNode.text||childNode.textContent||"";if(svg.compressSpaces(text)!=""){this.addChild(new svg.Element.tspan(childNode),false)}}}}};svg.Element.RenderedElementBase=function(node){this.base=svg.Element.ElementBase;this.base(node);this.calculateOpacity=function(){var opacity=1;var el=this;while(el!=null){var opacityStyle=el.style("opacity",false,true);if(opacityStyle.hasValue()){opacity=opacity*opacityStyle.numValue()}el=el.parent}return opacity};this.setContext=function(ctx,fromMeasure){if(!fromMeasure){if(this.style("fill").isUrlDefinition()){var fs=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));if(fs!=null)ctx.fillStyle=fs}else if(this.style("fill").hasValue()){var fillStyle=this.style("fill");if(fillStyle.value=="currentColor")fillStyle.value=this.style("color").value;if(fillStyle.value!="inherit")ctx.fillStyle=fillStyle.value=="none"?"rgba(0,0,0,0)":fillStyle.value}if(this.style("fill-opacity").hasValue()){var fillStyle=new svg.Property("fill",ctx.fillStyle);fillStyle=fillStyle.addOpacity(this.style("fill-opacity"));ctx.fillStyle=fillStyle.value}if(this.style("stroke").isUrlDefinition()){var fs=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));if(fs!=null)ctx.strokeStyle=fs}else if(this.style("stroke").hasValue()){var strokeStyle=this.style("stroke");if(strokeStyle.value=="currentColor")strokeStyle.value=this.style("color").value;if(strokeStyle.value!="inherit")ctx.strokeStyle=strokeStyle.value=="none"?"rgba(0,0,0,0)":strokeStyle.value}if(this.style("stroke-opacity").hasValue()){var strokeStyle=new svg.Property("stroke",ctx.strokeStyle);strokeStyle=strokeStyle.addOpacity(this.style("stroke-opacity"));ctx.strokeStyle=strokeStyle.value}if(this.style("stroke-width").hasValue()){var newLineWidth=this.style("stroke-width").toPixels();ctx.lineWidth=newLineWidth==0?.001:newLineWidth}if(this.style("stroke-linecap").hasValue())ctx.lineCap=this.style("stroke-linecap").value;if(this.style("stroke-linejoin").hasValue())ctx.lineJoin=this.style("stroke-linejoin").value;if(this.style("stroke-miterlimit").hasValue())ctx.miterLimit=this.style("stroke-miterlimit").value;if(this.style("paint-order").hasValue())ctx.paintOrder=this.style("paint-order").value;if(this.style("stroke-dasharray").hasValue()&&this.style("stroke-dasharray").value!="none"){var gaps=svg.ToNumberArray(this.style("stroke-dasharray").value);if(typeof ctx.setLineDash!="undefined"){ctx.setLineDash(gaps)}else if(typeof ctx.webkitLineDash!="undefined"){ctx.webkitLineDash=gaps}else if(typeof ctx.mozDash!="undefined"&&!(gaps.length==1&&gaps[0]==0)){ctx.mozDash=gaps}var offset=this.style("stroke-dashoffset").toPixels();if(typeof ctx.lineDashOffset!="undefined"){ctx.lineDashOffset=offset}else if(typeof ctx.webkitLineDashOffset!="undefined"){ctx.webkitLineDashOffset=offset}else if(typeof ctx.mozDashOffset!="undefined"){ctx.mozDashOffset=offset}}}if(typeof ctx.font!="undefined"){ctx.font=svg.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString();var currentFontSize=this.style("font-size",false,false);if(currentFontSize.isPixels()){svg.emSize=currentFontSize.toPixels()}}if(this.style("transform",false,true).hasValue()){var transform=new svg.Transform(this.style("transform",false,true).value);transform.apply(ctx)}if(this.style("clip-path",false,true).hasValue()){var clip=this.style("clip-path",false,true).getDefinition();if(clip!=null)clip.apply(ctx)}ctx.globalAlpha=this.calculateOpacity()}};svg.Element.RenderedElementBase.prototype=new svg.Element.ElementBase;svg.Element.PathElementBase=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.path=function(ctx){if(ctx!=null)ctx.beginPath();return new svg.BoundingBox};this.renderChildren=function(ctx){this.path(ctx);svg.Mouse.checkPath(this,ctx);if(ctx.fillStyle!=""){if(this.style("fill-rule").valueOrDefault("inherit")!="inherit"){ctx.fill(this.style("fill-rule").value)}else{ctx.fill()}}if(ctx.strokeStyle!="")ctx.stroke();var markers=this.getMarkers();if(markers!=null){if(this.style("marker-start").isUrlDefinition()){var marker=this.style("marker-start").getDefinition();marker.render(ctx,markers[0][0],markers[0][1])}if(this.style("marker-mid").isUrlDefinition()){var marker=this.style("marker-mid").getDefinition();for(var i=1;i<markers.length-1;i++){marker.render(ctx,markers[i][0],markers[i][1])}}if(this.style("marker-end").isUrlDefinition()){var marker=this.style("marker-end").getDefinition();marker.render(ctx,markers[markers.length-1][0],markers[markers.length-1][1])}}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};svg.Element.PathElementBase.prototype=new svg.Element.RenderedElementBase;svg.Element.svg=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.baseClearContext=this.clearContext;this.clearContext=function(ctx){this.baseClearContext(ctx);svg.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(ctx){ctx.strokeStyle="rgba(0,0,0,0)";ctx.lineCap="butt";ctx.lineJoin="miter";ctx.miterLimit=4;if(ctx.canvas.style&&typeof ctx.font!="undefined"&&typeof windowEnv.getComputedStyle!="undefined"){ctx.font=windowEnv.getComputedStyle(ctx.canvas).getPropertyValue("font");var fontSize=new svg.Property("fontSize",svg.Font.Parse(ctx.font).fontSize);if(fontSize.hasValue())svg.rootEmSize=svg.emSize=fontSize.toPixels("y")}this.baseSetContext(ctx);if(!this.attribute("x").hasValue())this.attribute("x",true).value=0;if(!this.attribute("y").hasValue())this.attribute("y",true).value=0;ctx.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var width=svg.ViewPort.width();var height=svg.ViewPort.height();if(!this.attribute("width").hasValue())this.attribute("width",true).value="100%";if(!this.attribute("height").hasValue())this.attribute("height",true).value="100%";if(typeof this.root=="undefined"){width=this.attribute("width").toPixels("x");height=this.attribute("height").toPixels("y");var x=0;var y=0;if(this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()){x=-this.attribute("refX").toPixels("x");y=-this.attribute("refY").toPixels("y")}if(this.attribute("overflow").valueOrDefault("hidden")!="visible"){ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(width,y);ctx.lineTo(width,height);ctx.lineTo(x,height);ctx.closePath();ctx.clip()}}svg.ViewPort.SetCurrent(width,height);if(this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value);var minX=viewBox[0];var minY=viewBox[1];width=viewBox[2];height=viewBox[3];svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,svg.ViewPort.width(),width,svg.ViewPort.height(),height,minX,minY,this.attribute("refX").value,this.attribute("refY").value);svg.ViewPort.RemoveCurrent();svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}};svg.Element.svg.prototype=new svg.Element.RenderedElementBase;svg.Element.rect=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var x=this.attribute("x").toPixels("x");var y=this.attribute("y").toPixels("y");var width=this.attribute("width").toPixels("x");var height=this.attribute("height").toPixels("y");var rx=this.attribute("rx").toPixels("x");var ry=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue())ry=rx;if(this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue())rx=ry;rx=Math.min(rx,width/2);ry=Math.min(ry,height/2);if(ctx!=null){var KAPPA=4*((Math.sqrt(2)-1)/3);ctx.beginPath();ctx.moveTo(x+rx,y);ctx.lineTo(x+width-rx,y);ctx.bezierCurveTo(x+width-rx+KAPPA*rx,y,x+width,y+ry-KAPPA*ry,x+width,y+ry);ctx.lineTo(x+width,y+height-ry);ctx.bezierCurveTo(x+width,y+height-ry+KAPPA*ry,x+width-rx+KAPPA*rx,y+height,x+width-rx,y+height);ctx.lineTo(x+rx,y+height);ctx.bezierCurveTo(x+rx-KAPPA*rx,y+height,x,y+height-ry+KAPPA*ry,x,y+height-ry);ctx.lineTo(x,y+ry);ctx.bezierCurveTo(x,y+ry-KAPPA*ry,x+rx-KAPPA*rx,y,x+rx,y);ctx.closePath()}return new svg.BoundingBox(x,y,x+width,y+height)}};svg.Element.rect.prototype=new svg.Element.PathElementBase;svg.Element.circle=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var cx=this.attribute("cx").toPixels("x");var cy=this.attribute("cy").toPixels("y");var r=this.attribute("r").toPixels();if(ctx!=null){ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2,false);ctx.closePath()}return new svg.BoundingBox(cx-r,cy-r,cx+r,cy+r)}};svg.Element.circle.prototype=new svg.Element.PathElementBase;svg.Element.ellipse=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var KAPPA=4*((Math.sqrt(2)-1)/3);var rx=this.attribute("rx").toPixels("x");var ry=this.attribute("ry").toPixels("y");var cx=this.attribute("cx").toPixels("x");var cy=this.attribute("cy").toPixels("y");if(ctx!=null){ctx.beginPath();ctx.moveTo(cx+rx,cy);ctx.bezierCurveTo(cx+rx,cy+KAPPA*ry,cx+KAPPA*rx,cy+ry,cx,cy+ry);ctx.bezierCurveTo(cx-KAPPA*rx,cy+ry,cx-rx,cy+KAPPA*ry,cx-rx,cy);ctx.bezierCurveTo(cx-rx,cy-KAPPA*ry,cx-KAPPA*rx,cy-ry,cx,cy-ry);ctx.bezierCurveTo(cx+KAPPA*rx,cy-ry,cx+rx,cy-KAPPA*ry,cx+rx,cy);ctx.closePath()}return new svg.BoundingBox(cx-rx,cy-ry,cx+rx,cy+ry)}};svg.Element.ellipse.prototype=new svg.Element.PathElementBase;svg.Element.line=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.getPoints=function(){return[new svg.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new svg.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(ctx){var points=this.getPoints();if(ctx!=null){ctx.beginPath();ctx.moveTo(points[0].x,points[0].y);ctx.lineTo(points[1].x,points[1].y)}return new svg.BoundingBox(points[0].x,points[0].y,points[1].x,points[1].y)};this.getMarkers=function(){var points=this.getPoints();var a=points[0].angleTo(points[1]);return[[points[0],a],[points[1],a]]}};svg.Element.line.prototype=new svg.Element.PathElementBase;svg.Element.polyline=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.points=svg.CreatePath(this.attribute("points").value);this.path=function(ctx){var bb=new svg.BoundingBox(this.points[0].x,this.points[0].y);if(ctx!=null){ctx.beginPath();ctx.moveTo(this.points[0].x,this.points[0].y)}for(var i=1;i<this.points.length;i++){bb.addPoint(this.points[i].x,this.points[i].y);if(ctx!=null)ctx.lineTo(this.points[i].x,this.points[i].y)}return bb};this.getMarkers=function(){var markers=[];for(var i=0;i<this.points.length-1;i++){markers.push([this.points[i],this.points[i].angleTo(this.points[i+1])])}if(markers.length>0){markers.push([this.points[this.points.length-1],markers[markers.length-1][1]])}return markers}};svg.Element.polyline.prototype=new svg.Element.PathElementBase;svg.Element.polygon=function(node){this.base=svg.Element.polyline;this.base(node);this.basePath=this.path;this.path=function(ctx){var bb=this.basePath(ctx);if(ctx!=null){ctx.lineTo(this.points[0].x,this.points[0].y);ctx.closePath()}return bb}};svg.Element.polygon.prototype=new svg.Element.polyline;svg.Element.path=function(node){this.base=svg.Element.PathElementBase;this.base(node);var d=this.attribute("d").value;d=d.replace(/,/gm," ");for(var i=0;i<2;i++)d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");d=d.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");d=d.replace(/([0-9])([+\-])/gm,"$1 $2");for(var i=0;i<2;i++)d=d.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");d=d.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");d=svg.compressSpaces(d);d=svg.trim(d);this.PathParser=new function(d){this.tokens=d.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new svg.Point(0,0);this.control=new svg.Point(0,0);this.current=new svg.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){if(this.isEnd())return true;return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var p=new svg.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p)};this.getAsControlPoint=function(){var p=this.getPoint();this.control=p;return p};this.getAsCurrentPoint=function(){var p=this.getPoint();this.current=p;return p};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current}var p=new svg.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return p};this.makeAbsolute=function(p){if(this.isRelativeCommand()){p.x+=this.current.x;p.y+=this.current.y}return p};this.addMarker=function(p,from,priorTo){if(priorTo!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo)}this.addMarkerAngle(p,from==null?null:from.angleTo(p))};this.addMarkerAngle=function(p,a){this.points.push(p);this.angles.push(a)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++){if(this.angles[i]==null){for(var j=i+1;j<this.angles.length;j++){if(this.angles[j]!=null){this.angles[i]=this.angles[j];break}}}}return this.angles}}(d);this.path=function(ctx){var pp=this.PathParser;pp.reset();var bb=new svg.BoundingBox;if(ctx!=null)ctx.beginPath();while(!pp.isEnd()){pp.nextCommand();switch(pp.command){case"M":case"m":var p=pp.getAsCurrentPoint();pp.addMarker(p);bb.addPoint(p.x,p.y);if(ctx!=null)ctx.moveTo(p.x,p.y);pp.start=pp.current;while(!pp.isCommandOrEnd()){var p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start);bb.addPoint(p.x,p.y);if(ctx!=null)ctx.lineTo(p.x,p.y)}break;case"L":case"l":while(!pp.isCommandOrEnd()){var c=pp.current;var p=pp.getAsCurrentPoint();pp.addMarker(p,c);bb.addPoint(p.x,p.y);if(ctx!=null)ctx.lineTo(p.x,p.y)}break;case"H":case"h":while(!pp.isCommandOrEnd()){var newP=new svg.Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current);pp.current=newP;bb.addPoint(pp.current.x,pp.current.y);if(ctx!=null)ctx.lineTo(pp.current.x,pp.current.y)}break;case"V":case"v":while(!pp.isCommandOrEnd()){var newP=new svg.Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current);pp.current=newP;bb.addPoint(pp.current.x,pp.current.y);if(ctx!=null)ctx.lineTo(pp.current.x,pp.current.y)}break;case"C":case"c":while(!pp.isCommandOrEnd()){var curr=pp.current;var p1=pp.getPoint();var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null)ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"S":case"s":while(!pp.isCommandOrEnd()){var curr=pp.current;var p1=pp.getReflectedControlPoint();var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null)ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"Q":case"q":while(!pp.isCommandOrEnd()){var curr=pp.current;var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null)ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"T":case"t":while(!pp.isCommandOrEnd()){var curr=pp.current;var cntrl=pp.getReflectedControlPoint();pp.control=cntrl;var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null)ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y)}break;case"A":case"a":while(!pp.isCommandOrEnd()){var curr=pp.current;var rx=pp.getScalar();var ry=pp.getScalar();var xAxisRotation=pp.getScalar()*(Math.PI/180);var largeArcFlag=pp.getScalar();var sweepFlag=pp.getScalar();var cp=pp.getAsCurrentPoint();var currp=new svg.Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2);var l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);if(l>1){rx*=Math.sqrt(l);ry*=Math.sqrt(l)}var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt((Math.pow(rx,2)*Math.pow(ry,2)-Math.pow(rx,2)*Math.pow(currp.y,2)-Math.pow(ry,2)*Math.pow(currp.x,2))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));if(isNaN(s))s=0;var cpp=new svg.Point(s*rx*currp.y/ry,s*-ry*currp.x/rx);var centp=new svg.Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y);var m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))};var r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))};var a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v))};var a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]);var u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry];var v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry];var ad=a(u,v);if(r(u,v)<=-1)ad=Math.PI;if(r(u,v)>=1)ad=0;var dir=1-sweepFlag?1:-1;var ah=a1+dir*(ad/2);var halfWay=new svg.Point(centp.x+rx*Math.cos(ah),centp.y+ry*Math.sin(ah));pp.addMarkerAngle(halfWay,ah-dir*Math.PI/2);pp.addMarkerAngle(cp,ah-dir*Math.PI);bb.addPoint(cp.x,cp.y);if(ctx!=null){var r=rx>ry?rx:ry;var sx=rx>ry?1:rx/ry;var sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y);ctx.rotate(xAxisRotation);ctx.scale(sx,sy);ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag);ctx.scale(1/sx,1/sy);ctx.rotate(-xAxisRotation);ctx.translate(-centp.x,-centp.y)}}break;case"Z":case"z":if(ctx!=null){if(bb.x1!==bb.x2&&bb.y1!==bb.y2){ctx.closePath()}}pp.current=pp.start}}return bb};this.getMarkers=function(){var points=this.PathParser.getMarkerPoints();var angles=this.PathParser.getMarkerAngles();var markers=[];for(var i=0;i<points.length;i++){markers.push([points[i],angles[i]])}return markers}};svg.Element.path.prototype=new svg.Element.PathElementBase;svg.Element.pattern=function(node){this.base=svg.Element.ElementBase;this.base(node);this.createPattern=function(ctx,element){var width=this.attribute("width").toPixels("x",true);var height=this.attribute("height").toPixels("y",true);var tempSvg=new svg.Element.svg;tempSvg.attributes["viewBox"]=new svg.Property("viewBox",this.attribute("viewBox").value);tempSvg.attributes["width"]=new svg.Property("width",width+"px");tempSvg.attributes["height"]=new svg.Property("height",height+"px");tempSvg.attributes["transform"]=new svg.Property("transform",this.attribute("patternTransform").value);tempSvg.children=this.children;var c=createCanvas(width,height);var cctx=c.getContext("2d");if(this.attribute("x").hasValue()&&this.attribute("y").hasValue()){cctx.translate(this.attribute("x").toPixels("x",true),this.attribute("y").toPixels("y",true))}for(var x=-1;x<=1;x++){for(var y=-1;y<=1;y++){cctx.save();tempSvg.attributes["x"]=new svg.Property("x",x*c.width);tempSvg.attributes["y"]=new svg.Property("y",y*c.height);tempSvg.render(cctx);cctx.restore()}}var pattern=ctx.createPattern(c,"repeat");return pattern}};svg.Element.pattern.prototype=new svg.Element.ElementBase;svg.Element.marker=function(node){this.base=svg.Element.ElementBase;this.base(node);this.baseRender=this.render;this.render=function(ctx,point,angle){if(!point){return}ctx.translate(point.x,point.y);if(this.attribute("orient").valueOrDefault("auto")=="auto")ctx.rotate(angle);if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth")ctx.scale(ctx.lineWidth,ctx.lineWidth);ctx.save();var tempSvg=new svg.Element.svg;tempSvg.attributes["viewBox"]=new svg.Property("viewBox",this.attribute("viewBox").value);tempSvg.attributes["refX"]=new svg.Property("refX",this.attribute("refX").value);tempSvg.attributes["refY"]=new svg.Property("refY",this.attribute("refY").value);tempSvg.attributes["width"]=new svg.Property("width",this.attribute("markerWidth").value);tempSvg.attributes["height"]=new svg.Property("height",this.attribute("markerHeight").value);tempSvg.attributes["fill"]=new svg.Property("fill",this.attribute("fill").valueOrDefault("black"));tempSvg.attributes["stroke"]=new svg.Property("stroke",this.attribute("stroke").valueOrDefault("none"));tempSvg.children=this.children;tempSvg.render(ctx);ctx.restore();if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth")ctx.scale(1/ctx.lineWidth,1/ctx.lineWidth);if(this.attribute("orient").valueOrDefault("auto")=="auto")ctx.rotate(-angle);ctx.translate(-point.x,-point.y)}};svg.Element.marker.prototype=new svg.Element.ElementBase;svg.Element.defs=function(node){this.base=svg.Element.ElementBase;this.base(node);this.render=function(ctx){}};svg.Element.defs.prototype=new svg.Element.ElementBase;svg.Element.GradientBase=function(node){this.base=svg.Element.ElementBase;this.base(node);this.stops=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.type=="stop")this.stops.push(child)}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(stopsContainer){for(var i=0;i<this.attributesToInherit.length;i++){var attributeToInherit=this.attributesToInherit[i];if(!this.attribute(attributeToInherit).hasValue()&&stopsContainer.attribute(attributeToInherit).hasValue()){this.attribute(attributeToInherit,true).value=stopsContainer.attribute(attributeToInherit).value}}};this.createGradient=function(ctx,element,parentOpacityProp){var stopsContainer=this;if(this.getHrefAttribute().hasValue()){stopsContainer=this.getHrefAttribute().getDefinition();this.inheritStopContainer(stopsContainer)}var addParentOpacity=function(color){if(parentOpacityProp.hasValue()){var p=new svg.Property("color",color);return p.addOpacity(parentOpacityProp).value}return color};var g=this.getGradient(ctx,element);if(g==null)return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length-1].color);for(var i=0;i<stopsContainer.stops.length;i++){g.addColorStop(stopsContainer.stops[i].offset,addParentOpacity(stopsContainer.stops[i].color))}if(this.attribute("gradientTransform").hasValue()){var rootView=svg.ViewPort.viewPorts[0];var rect=new svg.Element.rect;rect.attributes["x"]=new svg.Property("x",-svg.MAX_VIRTUAL_PIXELS/3);rect.attributes["y"]=new svg.Property("y",-svg.MAX_VIRTUAL_PIXELS/3);rect.attributes["width"]=new svg.Property("width",svg.MAX_VIRTUAL_PIXELS);rect.attributes["height"]=new svg.Property("height",svg.MAX_VIRTUAL_PIXELS);var group=new svg.Element.g;group.attributes["transform"]=new svg.Property("transform",this.attribute("gradientTransform").value);group.children=[rect];var tempSvg=new svg.Element.svg;tempSvg.attributes["x"]=new svg.Property("x",0);tempSvg.attributes["y"]=new svg.Property("y",0);tempSvg.attributes["width"]=new svg.Property("width",rootView.width);tempSvg.attributes["height"]=new svg.Property("height",rootView.height);tempSvg.children=[group];var c=createCanvas(rootView.width,rootView.height);var tempCtx=c.getContext("2d");tempCtx.fillStyle=g;tempSvg.render(tempCtx);return tempCtx.createPattern(c,"no-repeat")}return g}};svg.Element.GradientBase.prototype=new svg.Element.ElementBase;svg.Element.linearGradient=function(node){this.base=svg.Element.GradientBase;this.base(node);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");this.attributesToInherit.push("y2");this.getGradient=function(ctx,element){var bb=this.gradientUnits()=="objectBoundingBox"?element.getBoundingBox(ctx):null;if(!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()){this.attribute("x1",true).value=0;this.attribute("y1",true).value=0;this.attribute("x2",true).value=1;this.attribute("y2",true).value=0}var x1=this.gradientUnits()=="objectBoundingBox"?bb.x()+bb.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x");var y1=this.gradientUnits()=="objectBoundingBox"?bb.y()+bb.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y");var x2=this.gradientUnits()=="objectBoundingBox"?bb.x()+bb.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x");var y2=this.gradientUnits()=="objectBoundingBox"?bb.y()+bb.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");if(x1==x2&&y1==y2)return null;return ctx.createLinearGradient(x1,y1,x2,y2)}};svg.Element.linearGradient.prototype=new svg.Element.GradientBase;svg.Element.radialGradient=function(node){this.base=svg.Element.GradientBase;this.base(node);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(ctx,element){var bb=element.getBoundingBox(ctx);if(!this.attribute("cx").hasValue())this.attribute("cx",true).value="50%";if(!this.attribute("cy").hasValue())this.attribute("cy",true).value="50%";if(!this.attribute("r").hasValue())this.attribute("r",true).value="50%";var cx=this.gradientUnits()=="objectBoundingBox"?bb.x()+bb.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x");var cy=this.gradientUnits()=="objectBoundingBox"?bb.y()+bb.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y");var fx=cx;var fy=cy;if(this.attribute("fx").hasValue()){fx=this.gradientUnits()=="objectBoundingBox"?bb.x()+bb.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")}if(this.attribute("fy").hasValue()){fy=this.gradientUnits()=="objectBoundingBox"?bb.y()+bb.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y")}var r=this.gradientUnits()=="objectBoundingBox"?(bb.width()+bb.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return ctx.createRadialGradient(fx,fy,0,cx,cy,r)}};svg.Element.radialGradient.prototype=new svg.Element.GradientBase;svg.Element.stop=function(node){this.base=svg.Element.ElementBase;this.base(node);this.offset=this.attribute("offset").numValue();if(this.offset<0)this.offset=0;if(this.offset>1)this.offset=1;var stopColor=this.style("stop-color",true);if(stopColor.value==="")stopColor.value="#000";if(this.style("stop-opacity").hasValue())stopColor=stopColor.addOpacity(this.style("stop-opacity"));this.color=stopColor.value};svg.Element.stop.prototype=new svg.Element.ElementBase;svg.Element.AnimateBase=function(node){this.base=svg.Element.ElementBase;this.base(node);svg.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var attributeType=this.attribute("attributeType").value;var attributeName=this.attribute("attributeName").value;if(attributeType=="CSS"){return this.parent.style(attributeName,true)}return this.parent.attribute(attributeName,true)};this.initialValue=null;this.initialUnits="";this.removed=false;this.calcValue=function(){return""};this.update=function(delta){if(this.initialValue==null){this.initialValue=this.getProperty().value;this.initialUnits=this.getProperty().getUnits()}if(this.duration>this.maxDuration){if(this.attribute("repeatCount").value=="indefinite"||this.attribute("repeatDur").value=="indefinite"){this.duration=0}else if(this.attribute("fill").valueOrDefault("remove")=="freeze"&&!this.frozen){this.frozen=true;this.parent.animationFrozen=true;this.parent.animationFrozenValue=this.getProperty().value}else if(this.attribute("fill").valueOrDefault("remove")=="remove"&&!this.removed){this.removed=true;this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue;return true}return false}this.duration=this.duration+delta;var updated=false;if(this.begin<this.duration){var newValue=this.calcValue();if(this.attribute("type").hasValue()){var type=this.attribute("type").value;newValue=type+"("+newValue+")"}this.getProperty().value=newValue;updated=true}return updated};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");if(this.values.hasValue())this.values.value=this.values.value.split(";");this.progress=function(){var ret={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var p=ret.progress*(this.values.value.length-1);var lb=Math.floor(p),ub=Math.ceil(p);ret.from=new svg.Property("from",parseFloat(this.values.value[lb]));ret.to=new svg.Property("to",parseFloat(this.values.value[ub]));ret.progress=(p-lb)/(ub-lb)}else{ret.from=this.from;ret.to=this.to}return ret}};svg.Element.AnimateBase.prototype=new svg.Element.ElementBase;svg.Element.animate=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var newValue=p.from.numValue()+(p.to.numValue()-p.from.numValue())*p.progress;return newValue+this.initialUnits}};svg.Element.animate.prototype=new svg.Element.AnimateBase;svg.Element.animateColor=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var from=new rgbcolor(p.from.value);var to=new rgbcolor(p.to.value);if(from.ok&&to.ok){var r=from.r+(to.r-from.r)*p.progress;var g=from.g+(to.g-from.g)*p.progress;var b=from.b+(to.b-from.b)*p.progress;return"rgb("+parseInt(r,10)+","+parseInt(g,10)+","+parseInt(b,10)+")"}return this.attribute("from").value}};svg.Element.animateColor.prototype=new svg.Element.AnimateBase;svg.Element.animateTransform=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var from=svg.ToNumberArray(p.from.value);var to=svg.ToNumberArray(p.to.value);var newValue="";for(var i=0;i<from.length;i++){newValue+=from[i]+(to[i]-from[i])*p.progress+" "}return newValue}};svg.Element.animateTransform.prototype=new svg.Element.animate;svg.Element.font=function(node){this.base=svg.Element.ElementBase;this.base(node);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isRTL=false;this.isArabic=false;this.fontFace=null;this.missingGlyph=null;this.glyphs=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.type=="font-face"){this.fontFace=child;if(child.style("font-family").hasValue()){svg.Definitions[child.style("font-family").value]=this}}else if(child.type=="missing-glyph")this.missingGlyph=child;else if(child.type=="glyph"){if(child.arabicForm!=""){this.isRTL=true;this.isArabic=true;if(typeof this.glyphs[child.unicode]=="undefined")this.glyphs[child.unicode]=[];this.glyphs[child.unicode][child.arabicForm]=child}else{this.glyphs[child.unicode]=child}}}this.render=function(ctx){}};svg.Element.font.prototype=new svg.Element.ElementBase;svg.Element.fontface=function(node){this.base=svg.Element.ElementBase;this.base(node);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;this.unitsPerEm=this.attribute("units-per-em").numValue()};svg.Element.fontface.prototype=new svg.Element.ElementBase;svg.Element.missingglyph=function(node){this.base=svg.Element.path;this.base(node);this.horizAdvX=0};svg.Element.missingglyph.prototype=new svg.Element.path;svg.Element.glyph=function(node){this.base=svg.Element.path;this.base(node);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};svg.Element.glyph.prototype=new svg.Element.path;svg.Element.text=function(node){this.captureTextNodes=true;this.base=svg.Element.RenderedElementBase;this.base(node);this.baseSetContext=this.setContext;this.setContext=function(ctx){this.baseSetContext(ctx);var textBaseline=this.style("dominant-baseline").toTextBaseline();if(textBaseline==null)textBaseline=this.style("alignment-baseline").toTextBaseline();if(textBaseline!=null)ctx.textBaseline=textBaseline};this.initializeCoordinates=function(ctx){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");if(this.attribute("dx").hasValue())this.x+=this.attribute("dx").toPixels("x");if(this.attribute("dy").hasValue())this.y+=this.attribute("dy").toPixels("y");this.x+=this.getAnchorDelta(ctx,this,0)};this.getBoundingBox=function(ctx){this.initializeCoordinates(ctx);var bb=null;for(var i=0;i<this.children.length;i++){var childBB=this.getChildBoundingBox(ctx,this,this,i);if(bb==null)bb=childBB;else bb.addBoundingBox(childBB)}return bb};this.renderChildren=function(ctx){this.initializeCoordinates(ctx);for(var i=0;i<this.children.length;i++){this.renderChild(ctx,this,this,i)}};this.getAnchorDelta=function(ctx,parent,startI){var textAnchor=this.style("text-anchor").valueOrDefault("start");if(textAnchor!="start"){var width=0;for(var i=startI;i<parent.children.length;i++){var child=parent.children[i];if(i>startI&&child.attribute("x").hasValue())break;width+=child.measureTextRecursive(ctx)}return-1*(textAnchor=="end"?width:width/2)}return 0};this.adjustChildCoordinates=function(ctx,textParent,parent,i){var child=parent.children[i];if(child.attribute("x").hasValue()){child.x=child.attribute("x").toPixels("x")+textParent.getAnchorDelta(ctx,parent,i);if(child.attribute("dx").hasValue())child.x+=child.attribute("dx").toPixels("x")}else{if(child.attribute("dx").hasValue())textParent.x+=child.attribute("dx").toPixels("x");child.x=textParent.x}textParent.x=child.x+child.measureText(ctx);if(child.attribute("y").hasValue()){child.y=child.attribute("y").toPixels("y");if(child.attribute("dy").hasValue())child.y+=child.attribute("dy").toPixels("y")}else{if(child.attribute("dy").hasValue())textParent.y+=child.attribute("dy").toPixels("y");child.y=textParent.y}textParent.y=child.y;return child};this.getChildBoundingBox=function(ctx,textParent,parent,i){var child=this.adjustChildCoordinates(ctx,textParent,parent,i);var bb=child.getBoundingBox(ctx);for(var i=0;i<child.children.length;i++){var childBB=textParent.getChildBoundingBox(ctx,textParent,child,i);bb.addBoundingBox(childBB)}return bb};this.renderChild=function(ctx,textParent,parent,i){var child=this.adjustChildCoordinates(ctx,textParent,parent,i);child.render(ctx);for(var i=0;i<child.children.length;i++){textParent.renderChild(ctx,textParent,child,i)}}};svg.Element.text.prototype=new svg.Element.RenderedElementBase;svg.Element.TextElementBase=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.getGlyph=function(font,text,i){var c=text[i];var glyph=null;if(font.isArabic){var arabicForm="isolated";if((i==0||text[i-1]==" ")&&i<text.length-2&&text[i+1]!=" ")arabicForm="terminal";if(i>0&&text[i-1]!=" "&&i<text.length-2&&text[i+1]!=" ")arabicForm="medial";if(i>0&&text[i-1]!=" "&&(i==text.length-1||text[i+1]==" "))arabicForm="initial";if(typeof font.glyphs[c]!="undefined"){glyph=font.glyphs[c][arabicForm];if(glyph==null&&font.glyphs[c].type=="glyph")glyph=font.glyphs[c]}}else{glyph=font.glyphs[c]}if(glyph==null)glyph=font.missingGlyph;return glyph};this.renderChildren=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(customFont!=null){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);var fontStyle=this.parent.style("font-style").valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle);var text=this.getText();if(customFont.isRTL)text=text.split("").reverse().join("");var dx=svg.ToNumberArray(this.parent.attribute("dx").value);for(var i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i);var scale=fontSize/customFont.fontFace.unitsPerEm;ctx.translate(this.x,this.y);ctx.scale(scale,-scale);var lw=ctx.lineWidth;ctx.lineWidth=ctx.lineWidth*customFont.fontFace.unitsPerEm/fontSize;if(fontStyle=="italic")ctx.transform(1,0,.4,1,0,0);glyph.render(ctx);if(fontStyle=="italic")ctx.transform(1,0,-.4,1,0,0);ctx.lineWidth=lw;ctx.scale(1/scale,-1/scale);ctx.translate(-this.x,-this.y);this.x+=fontSize*(glyph.horizAdvX||customFont.horizAdvX)/customFont.fontFace.unitsPerEm;if(typeof dx[i]!="undefined"&&!isNaN(dx[i])){this.x+=dx[i]}}return}if(ctx.paintOrder=="stroke"){if(ctx.strokeStyle!="")ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y);if(ctx.fillStyle!="")ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y)}else{if(ctx.fillStyle!="")ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y);if(ctx.strokeStyle!="")ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y)}};this.getText=function(){};this.measureTextRecursive=function(ctx){var width=this.measureText(ctx);for(var i=0;i<this.children.length;i++){width+=this.children[i].measureTextRecursive(ctx)}return width};this.measureText=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(customFont!=null){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);var measure=0;var text=this.getText();if(customFont.isRTL)text=text.split("").reverse().join("");var dx=svg.ToNumberArray(this.parent.attribute("dx").value);for(var i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i);measure+=(glyph.horizAdvX||customFont.horizAdvX)*fontSize/customFont.fontFace.unitsPerEm;if(typeof dx[i]!="undefined"&&!isNaN(dx[i])){measure+=dx[i]}}return measure}var textToMeasure=svg.compressSpaces(this.getText());if(!ctx.measureText)return textToMeasure.length*10;ctx.save();this.setContext(ctx,true);var width=ctx.measureText(textToMeasure).width;ctx.restore();return width};this.getBoundingBox=function(ctx){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);return new svg.BoundingBox(this.x,this.y-fontSize,this.x+this.measureText(ctx),this.y)}};svg.Element.TextElementBase.prototype=new svg.Element.RenderedElementBase;svg.Element.tspan=function(node){this.captureTextNodes=true;this.base=svg.Element.TextElementBase;this.base(node);this.text=svg.compressSpaces(node.value||node.text||node.textContent||"");this.getText=function(){if(this.children.length>0){return""}return this.text}};svg.Element.tspan.prototype=new svg.Element.TextElementBase;svg.Element.tref=function(node){this.base=svg.Element.TextElementBase;this.base(node);this.getText=function(){var element=this.getHrefAttribute().getDefinition();if(element!=null)return element.children[0].getText()}};svg.Element.tref.prototype=new svg.Element.TextElementBase;svg.Element.a=function(node){this.base=svg.Element.TextElementBase;this.base(node);this.hasText=node.childNodes.length>0;for(var i=0;i<node.childNodes.length;i++){if(node.childNodes[i].nodeType!=3)this.hasText=false}this.text=this.hasText?node.childNodes[0].value||node.childNodes[0].data:"";this.getText=function(){return this.text};this.baseRenderChildren=this.renderChildren;this.renderChildren=function(ctx){if(this.hasText){this.baseRenderChildren(ctx);var fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);svg.Mouse.checkBoundingBox(this,new svg.BoundingBox(this.x,this.y-fontSize.toPixels("y"),this.x+this.measureText(ctx),this.y))}else if(this.children.length>0){var g=new svg.Element.g;g.children=this.children;g.parent=this;g.render(ctx)}};this.onclick=function(){windowEnv.open(this.getHrefAttribute().value)};this.onmousemove=function(){svg.ctx.canvas.style.cursor="pointer"}};svg.Element.a.prototype=new svg.Element.TextElementBase;svg.Element.image=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);var href=this.getHrefAttribute().value;if(href==""){return}var isSvg=href.match(/\.svg$/);svg.Images.push(this);this.loaded=false;if(!isSvg){this.img=document.createElement("img");if(svg.opts["useCORS"]==true){this.img.crossOrigin="Anonymous"}var self=this;this.img.onload=function(){self.loaded=true};this.img.onerror=function(){svg.log('ERROR: image "'+href+'" not found');self.loaded=true};this.img.src=href}else{this.img=svg.ajax(href);this.loaded=true}this.renderChildren=function(ctx){var x=this.attribute("x").toPixels("x");var y=this.attribute("y").toPixels("y");var width=this.attribute("width").toPixels("x");var height=this.attribute("height").toPixels("y");if(width==0||height==0)return;ctx.save();if(isSvg){ctx.drawSvg(this.img,x,y,width,height)}else{ctx.translate(x,y);svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,width,this.img.width,height,this.img.height,0,0);if(self.loaded){if(this.img.complete===undefined||this.img.complete){ctx.drawImage(this.img,0,0)}}}ctx.restore()};this.getBoundingBox=function(){var x=this.attribute("x").toPixels("x");var y=this.attribute("y").toPixels("y");var width=this.attribute("width").toPixels("x");var height=this.attribute("height").toPixels("y");return new svg.BoundingBox(x,y,x+width,y+height)}};svg.Element.image.prototype=new svg.Element.RenderedElementBase;svg.Element.g=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.getBoundingBox=function(ctx){var bb=new svg.BoundingBox;for(var i=0;i<this.children.length;i++){bb.addBoundingBox(this.children[i].getBoundingBox(ctx))}return bb}};svg.Element.g.prototype=new svg.Element.RenderedElementBase;svg.Element.symbol=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.render=function(ctx){}};svg.Element.symbol.prototype=new svg.Element.RenderedElementBase;svg.Element.style=function(node){this.base=svg.Element.ElementBase;this.base(node);var css="";for(var i=0;i<node.childNodes.length;i++){css+=node.childNodes[i].data}css=css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");css=svg.compressSpaces(css);var cssDefs=css.split("}");for(var i=0;i<cssDefs.length;i++){if(svg.trim(cssDefs[i])!=""){var cssDef=cssDefs[i].split("{");var cssClasses=cssDef[0].split(",");var cssProps=cssDef[1].split(";");for(var j=0;j<cssClasses.length;j++){var cssClass=svg.trim(cssClasses[j]);if(cssClass!=""){var props=svg.Styles[cssClass]||{};for(var k=0;k<cssProps.length;k++){var prop=cssProps[k].indexOf(":");var name=cssProps[k].substr(0,prop);var value=cssProps[k].substr(prop+1,cssProps[k].length-prop);if(name!=null&&value!=null){props[svg.trim(name)]=new svg.Property(svg.trim(name),svg.trim(value))}}svg.Styles[cssClass]=props;svg.StylesSpecificity[cssClass]=getSelectorSpecificity(cssClass);if(cssClass=="@font-face"&&!nodeEnv){var fontFamily=props["font-family"].value.replace(/"/g,"");var srcs=props["src"].value.split(",");for(var s=0;s<srcs.length;s++){if(srcs[s].indexOf('format("svg")')>0){var urlStart=srcs[s].indexOf("url");var urlEnd=srcs[s].indexOf(")",urlStart);var url=srcs[s].substr(urlStart+5,urlEnd-urlStart-6);var doc=svg.parseXml(svg.ajax(url));var fonts=doc.getElementsByTagName("font");for(var f=0;f<fonts.length;f++){var font=svg.CreateElement(fonts[f]);svg.Definitions[fontFamily]=font}}}}}}}}};svg.Element.style.prototype=new svg.Element.ElementBase;svg.Element.use=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.baseSetContext=this.setContext;this.setContext=function(ctx){this.baseSetContext(ctx);if(this.attribute("x").hasValue())ctx.translate(this.attribute("x").toPixels("x"),0);if(this.attribute("y").hasValue())ctx.translate(0,this.attribute("y").toPixels("y"))};var element=this.getHrefAttribute().getDefinition();this.path=function(ctx){if(element!=null)element.path(ctx)};this.elementTransform=function(){if(element!=null&&element.style("transform",false,true).hasValue()){return new svg.Transform(element.style("transform",false,true).value)}};this.getBoundingBox=function(ctx){if(element!=null)return element.getBoundingBox(ctx)};this.renderChildren=function(ctx){if(element!=null){var tempSvg=element;if(element.type=="symbol"){tempSvg=new svg.Element.svg;tempSvg.type="svg";tempSvg.attributes["viewBox"]=new svg.Property("viewBox",element.attribute("viewBox").value);tempSvg.attributes["preserveAspectRatio"]=new svg.Property("preserveAspectRatio",element.attribute("preserveAspectRatio").value);tempSvg.attributes["overflow"]=new svg.Property("overflow",element.attribute("overflow").value);tempSvg.children=element.children}if(tempSvg.type=="svg"){if(this.attribute("width").hasValue())tempSvg.attributes["width"]=new svg.Property("width",this.attribute("width").value);if(this.attribute("height").hasValue())tempSvg.attributes["height"]=new svg.Property("height",this.attribute("height").value)}var oldParent=tempSvg.parent;tempSvg.parent=null;tempSvg.render(ctx);tempSvg.parent=oldParent}}};svg.Element.use.prototype=new svg.Element.RenderedElementBase;svg.Element.mask=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,element){var x=this.attribute("x").toPixels("x");var y=this.attribute("y").toPixels("y");var width=this.attribute("width").toPixels("x");var height=this.attribute("height").toPixels("y");if(width==0&&height==0){var bb=new svg.BoundingBox;for(var i=0;i<this.children.length;i++){bb.addBoundingBox(this.children[i].getBoundingBox(ctx))}var x=Math.floor(bb.x1);var y=Math.floor(bb.y1);var width=Math.floor(bb.width());var height=Math.floor(bb.height())}var mask=element.style("mask").value;element.style("mask").value="";var cMask=createCanvas(x+width,y+height);var maskCtx=cMask.getContext("2d");this.renderChildren(maskCtx);var c=createCanvas(x+width,y+height);var tempCtx=c.getContext("2d");element.render(tempCtx);tempCtx.globalCompositeOperation="destination-in";tempCtx.fillStyle=maskCtx.createPattern(cMask,"no-repeat");tempCtx.fillRect(0,0,x+width,y+height);ctx.fillStyle=tempCtx.createPattern(c,"no-repeat");ctx.fillRect(0,0,x+width,y+height);element.style("mask").value=mask};this.render=function(ctx){}};svg.Element.mask.prototype=new svg.Element.ElementBase;svg.Element.clipPath=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx){var hasContext2D=typeof CanvasRenderingContext2D!=="undefined";var oldBeginPath=ctx.beginPath;var oldClosePath=ctx.closePath;if(hasContext2D){CanvasRenderingContext2D.prototype.beginPath=function(){};CanvasRenderingContext2D.prototype.closePath=function(){}}oldBeginPath.call(ctx);for(var i=0;i<this.children.length;i++){var child=this.children[i];if(typeof child.path!="undefined"){var transform=typeof child.elementTransform!="undefined"&&child.elementTransform();if(!transform&&child.style("transform",false,true).hasValue()){transform=new svg.Transform(child.style("transform",false,true).value)}if(transform){transform.apply(ctx)}child.path(ctx);if(hasContext2D){CanvasRenderingContext2D.prototype.closePath=oldClosePath}if(transform){transform.unapply(ctx)}}}oldClosePath.call(ctx);ctx.clip();if(hasContext2D){CanvasRenderingContext2D.prototype.beginPath=oldBeginPath;CanvasRenderingContext2D.prototype.closePath=oldClosePath}};this.render=function(ctx){}};svg.Element.clipPath.prototype=new svg.Element.ElementBase;svg.Element.filter=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,element){var bb=element.getBoundingBox(ctx);var x=Math.floor(bb.x1);var y=Math.floor(bb.y1);var width=Math.floor(bb.width());var height=Math.floor(bb.height());var filter=element.style("filter").value;element.style("filter").value="";var px=0,py=0;for(var i=0;i<this.children.length;i++){var efd=this.children[i].extraFilterDistance||0;px=Math.max(px,efd);py=Math.max(py,efd)}var c=createCanvas(width+2*px,height+2*py);var tempCtx=c.getContext("2d");tempCtx.translate(-x+px,-y+py);element.render(tempCtx);for(var i=0;i<this.children.length;i++){if(typeof this.children[i].apply=="function"){this.children[i].apply(tempCtx,0,0,width+2*px,height+2*py)}}ctx.drawImage(c,0,0,width+2*px,height+2*py,x-px,y-py,width+2*px,height+2*py);element.style("filter",true).value=filter};this.render=function(ctx){}};svg.Element.filter.prototype=new svg.Element.ElementBase;svg.Element.feDropShadow=function(node){this.base=svg.Element.ElementBase;this.base(node);this.addStylesFromStyleDefinition();this.apply=function(ctx,x,y,width,height){}};svg.Element.feDropShadow.prototype=new svg.Element.ElementBase;svg.Element.feMorphology=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,x,y,width,height){}};svg.Element.feMorphology.prototype=new svg.Element.ElementBase;svg.Element.feComposite=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,x,y,width,height){}};svg.Element.feComposite.prototype=new svg.Element.ElementBase;svg.Element.feColorMatrix=function(node){this.base=svg.Element.ElementBase;this.base(node);var matrix=svg.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var s=matrix[0];matrix=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var a=matrix[0]*Math.PI/180;var c=function(m1,m2,m3){return m1+Math.cos(a)*m2+Math.sin(a)*m3};matrix=[c(.213,.787,-.213),c(.715,-.715,-.715),c(.072,-.072,.928),0,0,c(.213,-.213,.143),c(.715,.285,.14),c(.072,-.072,-.283),0,0,c(.213,-.213,-.787),c(.715,-.715,.715),c(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":matrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}function imGet(img,x,y,width,height,rgba){return img[y*width*4+x*4+rgba]}function imSet(img,x,y,width,height,rgba,val){img[y*width*4+x*4+rgba]=val}function m(i,v){var mi=matrix[i];return mi*(mi<0?v-255:v)}this.apply=function(ctx,x,y,width,height){var srcData=ctx.getImageData(0,0,width,height);for(var y=0;y<height;y++){for(var x=0;x<width;x++){var r=imGet(srcData.data,x,y,width,height,0);var g=imGet(srcData.data,x,y,width,height,1);var b=imGet(srcData.data,x,y,width,height,2);var a=imGet(srcData.data,x,y,width,height,3);imSet(srcData.data,x,y,width,height,0,m(0,r)+m(1,g)+m(2,b)+m(3,a)+m(4,1));imSet(srcData.data,x,y,width,height,1,m(5,r)+m(6,g)+m(7,b)+m(8,a)+m(9,1));imSet(srcData.data,x,y,width,height,2,m(10,r)+m(11,g)+m(12,b)+m(13,a)+m(14,1));imSet(srcData.data,x,y,width,height,3,m(15,r)+m(16,g)+m(17,b)+m(18,a)+m(19,1))}}ctx.clearRect(0,0,width,height);ctx.putImageData(srcData,0,0)}};svg.Element.feColorMatrix.prototype=new svg.Element.ElementBase;svg.Element.feGaussianBlur=function(node){this.base=svg.Element.ElementBase;this.base(node);this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.extraFilterDistance=this.blurRadius;this.apply=function(ctx,x,y,width,height){if(!stackblurCanvas||typeof stackblurCanvas.canvasRGBA==="undefined"){svg.log("ERROR: StackBlur.js must be included for blur to work");return}ctx.canvas.id=svg.UniqueId();{ctx.canvas.style.display="none";document.body.appendChild(ctx.canvas)}stackblurCanvas.canvasRGBA(ctx.canvas,x,y,width,height,this.blurRadius);{document.body.removeChild(ctx.canvas)}}};svg.Element.feGaussianBlur.prototype=new svg.Element.ElementBase;svg.Element.title=function(node){};svg.Element.title.prototype=new svg.Element.ElementBase;svg.Element.desc=function(node){};svg.Element.desc.prototype=new svg.Element.ElementBase;svg.Element.MISSING=function(node){svg.log("ERROR: Element '"+node.nodeName+"' not yet implemented.")};svg.Element.MISSING.prototype=new svg.Element.ElementBase;svg.CreateElement=function(node){var className=node.nodeName.replace(/^[^:]+:/,"");className=className.replace(/\-/g,"");var e=null;if(typeof svg.Element[className]!="undefined"){e=new svg.Element[className](node)}else{e=new svg.Element.MISSING(node)}e.type=node.nodeName;return e};svg.load=function(ctx,url){svg.loadXml(ctx,svg.ajax(url))};svg.loadXml=function(ctx,xml){svg.loadXmlDoc(ctx,svg.parseXml(xml))};svg.loadXmlDoc=function(ctx,dom){svg.init(ctx);var mapXY=function(p){var e=ctx.canvas;while(e){p.x-=e.offsetLeft;p.y-=e.offsetTop;e=e.offsetParent}if(windowEnv.scrollX)p.x+=windowEnv.scrollX;if(windowEnv.scrollY)p.y+=windowEnv.scrollY;return p};if(svg.opts["ignoreMouse"]!=true){ctx.canvas.onclick=function(e){var p=mapXY(new svg.Point(e!=null?e.clientX:event.clientX,e!=null?e.clientY:event.clientY));svg.Mouse.onclick(p.x,p.y)};ctx.canvas.onmousemove=function(e){var p=mapXY(new svg.Point(e!=null?e.clientX:event.clientX,e!=null?e.clientY:event.clientY));svg.Mouse.onmousemove(p.x,p.y)}}var e=svg.CreateElement(dom.documentElement);e.root=true;e.addStylesFromStyleDefinition();var isFirstRender=true;var draw=function(){svg.ViewPort.Clear();if(ctx.canvas.parentNode){svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth,ctx.canvas.parentNode.clientHeight)}else{svg.ViewPort.SetCurrent(defaultClientWidth,defaultClientHeight)}if(svg.opts["ignoreDimensions"]!=true){if(e.style("width").hasValue()){ctx.canvas.width=e.style("width").toPixels("x");if(ctx.canvas.style){ctx.canvas.style.width=ctx.canvas.width+"px"}}if(e.style("height").hasValue()){ctx.canvas.height=e.style("height").toPixels("y");if(ctx.canvas.style){ctx.canvas.style.height=ctx.canvas.height+"px"}}}var cWidth=ctx.canvas.clientWidth||ctx.canvas.width;var cHeight=ctx.canvas.clientHeight||ctx.canvas.height;if(svg.opts["ignoreDimensions"]==true&&e.style("width").hasValue()&&e.style("height").hasValue()){cWidth=e.style("width").toPixels("x");cHeight=e.style("height").toPixels("y")}svg.ViewPort.SetCurrent(cWidth,cHeight);if(svg.opts["offsetX"]!=null)e.attribute("x",true).value=svg.opts["offsetX"];if(svg.opts["offsetY"]!=null)e.attribute("y",true).value=svg.opts["offsetY"];if(svg.opts["scaleWidth"]!=null||svg.opts["scaleHeight"]!=null){var xRatio=null,yRatio=null,viewBox=svg.ToNumberArray(e.attribute("viewBox").value);if(svg.opts["scaleWidth"]!=null){if(e.attribute("width").hasValue())xRatio=e.attribute("width").toPixels("x")/svg.opts["scaleWidth"];else if(!isNaN(viewBox[2]))xRatio=viewBox[2]/svg.opts["scaleWidth"]}if(svg.opts["scaleHeight"]!=null){if(e.attribute("height").hasValue())yRatio=e.attribute("height").toPixels("y")/svg.opts["scaleHeight"];else if(!isNaN(viewBox[3]))yRatio=viewBox[3]/svg.opts["scaleHeight"]}if(xRatio==null){xRatio=yRatio}if(yRatio==null){yRatio=xRatio}e.attribute("width",true).value=svg.opts["scaleWidth"];e.attribute("height",true).value=svg.opts["scaleHeight"];e.style("transform",true,true).value+=" scale("+1/xRatio+","+1/yRatio+")"}if(svg.opts["ignoreClear"]!=true){ctx.clearRect(0,0,cWidth,cHeight)}e.render(ctx);if(isFirstRender){isFirstRender=false;if(typeof svg.opts["renderCallback"]=="function")svg.opts["renderCallback"](dom)}};var waitingForImages=true;if(svg.ImagesLoaded()){waitingForImages=false;draw()}{svg.intervalID=setInterval(function(){var needUpdate=false;if(waitingForImages&&svg.ImagesLoaded()){waitingForImages=false;needUpdate=true}if(svg.opts["ignoreMouse"]!=true){needUpdate=needUpdate|svg.Mouse.hasEvents()}if(svg.opts["ignoreAnimation"]!=true){for(var i=0;i<svg.Animations.length;i++){needUpdate=needUpdate|svg.Animations[i].update(1e3/svg.FRAMERATE)}}if(typeof svg.opts["forceRedraw"]=="function"){if(svg.opts["forceRedraw"]()==true)needUpdate=true}if(needUpdate){draw();svg.Mouse.runEvents()}},1e3/svg.FRAMERATE)}};svg.stop=function(){if(svg.intervalID){clearInterval(svg.intervalID)}};svg.Mouse=new function(){this.events=[];this.hasEvents=function(){return this.events.length!=0};this.onclick=function(x,y){this.events.push({type:"onclick",x:x,y:y,run:function(e){if(e.onclick)e.onclick()}})};this.onmousemove=function(x,y){this.events.push({type:"onmousemove",x:x,y:y,run:function(e){if(e.onmousemove)e.onmousemove()}})};this.eventElements=[];this.checkPath=function(element,ctx){for(var i=0;i<this.events.length;i++){var e=this.events[i];if(ctx.isPointInPath&&ctx.isPointInPath(e.x,e.y))this.eventElements[i]=element}};this.checkBoundingBox=function(element,bb){for(var i=0;i<this.events.length;i++){var e=this.events[i];if(bb.isPointInBox(e.x,e.y))this.eventElements[i]=element}};this.runEvents=function(){svg.ctx.canvas.style.cursor="";for(var i=0;i<this.events.length;i++){var e=this.events[i];var element=this.eventElements[i];while(element){e.run(element);element=element.parent}}this.events=[];this.eventElements=[]}};return svg}if(typeof CanvasRenderingContext2D!="undefined"){CanvasRenderingContext2D.prototype.drawSvg=function(s,dx,dy,dw,dh,opts){var cOpts={ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:dx,offsetY:dy,scaleWidth:dw,scaleHeight:dh};for(var prop in opts){if(opts.hasOwnProperty(prop)){cOpts[prop]=opts[prop]}}canvg(this.canvas,s,cOpts)}}module.exports=canvg});return canvg_1});var structurizr=structurizr||{io:{},ui:{},util:{},constants:{CUSTOM_ELEMENT_TYPE:"Custom",PERSON_ELEMENT_TYPE:"Person",SOFTWARE_SYSTEM_ELEMENT_TYPE:"SoftwareSystem",CONTAINER_ELEMENT_TYPE:"Container",COMPONENT_ELEMENT_TYPE:"Component",DEPLOYMENT_NODE_ELEMENT_TYPE:"DeploymentNode",INFRASTRUCTURE_NODE_ELEMENT_TYPE:"InfrastructureNode",SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE:"SoftwareSystemInstance",CONTAINER_INSTANCE_ELEMENT_TYPE:"ContainerInstance",CUSTOM_VIEW_TYPE:"Custom",SYSTEM_LANDSCAPE_VIEW_TYPE:"SystemLandscape",SYSTEM_CONTEXT_VIEW_TYPE:"SystemContext",CONTAINER_VIEW_TYPE:"Container",COMPONENT_VIEW_TYPE:"Component",DYNAMIC_VIEW_TYPE:"Dynamic",DEPLOYMENT_VIEW_TYPE:"Deployment",FILTERED_VIEW_TYPE:"Filtered",IMAGE_VIEW_TYPE:"Image",DEFAULT_DEPLOYMENT_ENVIRONMENT_NAME:"Default",CONTENT_TYPE_IMAGE_SVG:"image/svg+xml",CONTENT_TYPE_IMAGE_PNG:"image/png",CONTENT_TYPE_IMAGE_JPG:"image/jpeg",WORKSPACE_URL_PREFIX:"{workspace}"}};structurizr.util.Stack=class Stack{#stack=[];pop(){return this.#stack.pop()}push(item){this.#stack.push(item)}peek(){if(this.isEmpty()){return undefined}else{return this.#stack[this.#stack.length-1]}}isEmpty(){return this.#stack.length===0}count(){return this.#stack.length}};structurizr.util.selectText=function(id){if(window.getSelection()){var range=document.createRange();range.selectNode(document.getElementById(id));window.getSelection().removeAllRanges();window.getSelection().addRange(range)}};structurizr.util.dataURIToBlob=function(dataURI){var binaryString=atob(dataURI.split(",")[1]);var length=binaryString.length;var array=new Uint8Array(length);var mimeType=dataURI.split(",")[0].split(":")[1].split(";")[0];for(var i=0;i<length;i++){array[i]=binaryString.charCodeAt(i)}return new Blob([array],{type:mimeType})};structurizr.util.downloadFile=function(content,contentType,filename){var blob=new Blob([content],{type:contentType});var url=URL.createObjectURL(blob);var link=document.createElement("a");link.download=filename;link.href=url;document.body.appendChild(link);link.click();link.remove()};structurizr.util.toBlob=function(content,contentType){return new Blob([content],{type:contentType})};structurizr.util.escapeHtml=function(html){return html.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};structurizr.util.trim=function(s){if(s===undefined||s===null){return""}else{return s.trim()}};structurizr.util.btoa=function(plain){return CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(plain))};structurizr.util.atob=function(encoded){return CryptoJS.enc.Utf8.stringify(CryptoJS.enc.Base64.parse(encoded))};structurizr.util.exportWorkspace=function(id,json){const jsonAsString=JSON.stringify(json,null,"    ");const filename="structurizr-"+id+"-workspace.json";structurizr.util.downloadFile(jsonAsString,"text/plain;charset=utf-8",filename)};structurizr.util.copyAttributeIfSpecified=function(source,destination,name){if(source.hasOwnProperty(name)){destination[name]=source[name]}};structurizr.util.shadeColor=function(color,percentAsInteger,darkMode){if(darkMode===true){percentAsInteger=-percentAsInteger}var percent=0;if(percentAsInteger===0){percent=0}else{if(percentAsInteger>90){percent=.9}else{percent=percentAsInteger/100}}const f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?percent*-1:percent,R=f>>16,G=f>>8&255,B=f&255;return"#"+(16777216+(Math.round((t-R)*p)+R)*65536+(Math.round((t-G)*p)+G)*256+(Math.round((t-B)*p)+B)).toString(16).slice(1)};if(!String.prototype.startsWith){String.prototype.startsWith=function(searchString,position){return this.substr(position||0,searchString.length)===searchString}}structurizr.ui.DEFAULT_FONT_NAME="Arial";structurizr.ui.DEFAULT_FONT_URL=undefined;structurizr.ui.themes=[];structurizr.ui.ignoredImages=[];structurizr.ui.getBranding=function(){const branding={};structurizr.ui.themes.forEach(function(theme){if(theme.logo!==undefined){branding.logo=theme.logo}if(theme.font!==undefined){branding.font=theme.font}});if(structurizr.workspace.views.configuration.branding.logo!==undefined){branding.logo=structurizr.workspace.views.configuration.branding.logo}if(structurizr.workspace.views.configuration.branding.font!==undefined){branding.font=structurizr.workspace.views.configuration.branding.font}if(branding.font===undefined){branding.font={name:structurizr.ui.DEFAULT_FONT_NAME,url:structurizr.ui.DEFAULT_FONT_URL}}return branding};structurizr.ui.applyBranding=function(){var branding=structurizr.ui.getBranding();if(branding.font.url){const head=document.head;const link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=branding.font.url;head.appendChild(link)}var fontNames="";branding.font.name.split(",").forEach(function(fontName){fontNames+='"'+structurizr.util.escapeHtml(fontName.trim())+'", '});const brandingStyles=$("#brandingStyles");brandingStyles.append("#documentationPanel { font-family: "+fontNames.substr(0,fontNames.length-2)+" }");if(branding.logo){const brandingLogo=$(".brandingLogo");brandingLogo.attr("src",branding.logo);brandingLogo.removeClass("hidden")}};structurizr.ui.loadThemes=function(callback){structurizr.workspace.views.configuration.themes.forEach(function(theme){structurizr.ui.loadTheme(theme)});setTimeout(function(){structurizr.ui.waitForThemesToLoad(callback)},100)};structurizr.ui.waitForThemesToLoad=function(callback){if(structurizr.ui.themes.length<structurizr.workspace.views.configuration.themes.length){setTimeout(function(){structurizr.ui.waitForThemesToLoad(callback)},100)}else{callback()}};structurizr.ui.loadTheme=function(url){$.get(url,undefined,function(data){try{const theme=JSON.parse(data);if(theme!==undefined){const baseUrl=url.substring(0,url.lastIndexOf("/")+1);if(theme.elements===undefined){theme.elements=[]}if(theme.relationships===undefined){theme.relationships=[]}for(var i=0;i<theme.elements.length;i++){const style=theme.elements[i];if(style.icon){if(style.icon.indexOf("http")>-1){}else if(style.icon.indexOf("data:image")>-1){}else{style.icon=baseUrl+style.icon}}}}structurizr.ui.themes.push({elements:theme.elements,relationships:theme.relationships,logo:theme.logo,font:theme.font})}catch(e){console.log("Could not load theme from "+url);console.log(e)}},"text").fail(function(xhr,textStatus,errorThrown){const errorMessage="Could not load theme from "+url+"; error "+xhr.status+" ("+xhr.statusText+")";console.log(errorMessage);alert(errorMessage);structurizr.ui.themes.push({elements:[],relationships:[]})})};structurizr.ui.ElementStyle=function(width,height,background,color,fontSize,shape,icon,border,stroke,strokeWidth,opacity,metadata,description){this.width=width;this.height=height;this.background=background;this.stroke=stroke;this.strokeWidth=strokeWidth;this.color=color;this.fontSize=fontSize;this.shape=shape;this.icon=icon;this.border=border;this.opacity=opacity;this.metadata=metadata;this.description=description;this.tag="Element";this.copyStyleAttributeIfSpecified=function(source,name){structurizr.util.copyAttributeIfSpecified(source,this,name)};this.toString=function(){return"".concat(this.tag,",",this.width,",",this.height,",",this.background,",",this.stroke,",",this.color,",",this.fontSize,",",this.shape,",",this.icon,",",this.border,",",this.opacity,",",this.metadata,",",this.description)}};structurizr.ui.RelationshipStyle=function(thickness,color,dashed,routing,fontSize,width,position,opacity){this.thickness=thickness;this.color=color;this.dashed=dashed;this.routing=routing;this.fontSize=fontSize;this.width=width;this.position=position;this.opacity=opacity;this.tag="Relationship";this.copyStyleAttributeIfSpecified=function(source,name){structurizr.util.copyAttributeIfSpecified(source,this,name)};this.toString=function(){return"".concat(this.tag,",",this.thickness,",",this.color,",",this.dashed,",",this.routing,",",this.fontSize,",",this.width,",",this.position,",",this.opacity)}};structurizr.ui.findElementStyle=function(element,darkMode){const defaultElementStyle=new structurizr.ui.ElementStyle(450,300,"#dddddd","#000000",24,"Box",undefined,"Solid",undefined,2,100,true,true);const defaultElementStyleForDeploymentNode=new structurizr.ui.ElementStyle(450,300,"#ffffff","#000000",24,"Box",undefined,"Solid","#888888",1,100,true,true);const defaultBoundaryStyle=new structurizr.ui.ElementStyle(undefined,undefined,undefined,undefined,24,undefined,undefined,undefined,undefined,1,100,true,true);var defaultStyle;var defaultSizeInUse=true;if(darkMode===undefined){darkMode=false}if(element.type===structurizr.constants.DEPLOYMENT_NODE_ELEMENT_TYPE){defaultStyle=defaultElementStyleForDeploymentNode;if(darkMode===true){defaultStyle.color="#ffffff"}else{defaultStyle.color="#000000"}}else if(element.type==="Boundary"){defaultStyle=defaultBoundaryStyle}else{defaultStyle=defaultElementStyle}var elementStylesMap={};if(structurizr.ui.themes.length>0){structurizr.ui.themes.forEach(function(theme){theme.elements.forEach(function(elementStyle){elementStylesMap[elementStyle.tag]=elementStyle})});structurizr.workspace.views.configuration.styles.elements.forEach(function(elementStyleFromWorkspace){const tag=elementStyleFromWorkspace.tag;var elementStyle=elementStylesMap[tag];if(elementStyle===undefined){elementStylesMap[tag]=elementStyleFromWorkspace}else{structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"width");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"height");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"background");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"stroke");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"color");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"fontSize");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"shape");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"icon");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"border");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"opacity");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"metadata");structurizr.util.copyAttributeIfSpecified(elementStyleFromWorkspace,elementStyle,"description")}})}else{structurizr.workspace.views.configuration.styles.elements.forEach(function(elementStyleFromWorkspace){const tag=elementStyleFromWorkspace.tag;elementStylesMap[tag]=elementStyleFromWorkspace})}var style=new structurizr.ui.ElementStyle(defaultStyle.width,defaultStyle.height,defaultStyle.background,defaultStyle.color,defaultStyle.fontSize,defaultStyle.shape,defaultStyle.icon,defaultStyle.border,defaultStyle.stroke,defaultStyle.strokeWidth,defaultStyle.opacity,defaultStyle.metadata,defaultStyle.description);style.tags=["Element"];const tags=structurizr.workspace.getAllTagsForElement(element);for(var i=0;i<tags.length;i++){const tag=tags[i].trim();var elementStyle=elementStylesMap[tag];if(elementStyle){if(elementStyle.width!==undefined||elementStyle.height!==undefined){defaultSizeInUse=false}style.copyStyleAttributeIfSpecified(elementStyle,"width");style.copyStyleAttributeIfSpecified(elementStyle,"height");style.copyStyleAttributeIfSpecified(elementStyle,"background");style.copyStyleAttributeIfSpecified(elementStyle,"stroke");style.copyStyleAttributeIfSpecified(elementStyle,"strokeWidth");style.copyStyleAttributeIfSpecified(elementStyle,"color");style.copyStyleAttributeIfSpecified(elementStyle,"fontSize");style.copyStyleAttributeIfSpecified(elementStyle,"shape");style.copyStyleAttributeIfSpecified(elementStyle,"icon");style.copyStyleAttributeIfSpecified(elementStyle,"border");style.copyStyleAttributeIfSpecified(elementStyle,"opacity");style.copyStyleAttributeIfSpecified(elementStyle,"metadata");style.copyStyleAttributeIfSpecified(elementStyle,"description");style.tag=tag;if(style.tags.indexOf(tag)===-1){style.tags.push(tag)}}}if(style.stroke===undefined&&style.background){style.stroke=structurizr.util.shadeColor(style.background,-10)}if(style.strokeWidth!==undefined){if(style.strokeWidth<1){style.strokeWidth=1}else if(style.strokeWidth>10){style.strokeWidth=10}}if(style.shape==="MobileDevicePortrait"){if(style.height<style.width){var width=style.width;var height=style.height;style.width=height;style.height=width}}if(style.shape==="MobileDeviceLandscape"){if(style.height>style.width){var width=style.width;var height=style.height;style.width=height;style.height=width}}if(defaultSizeInUse===true&&(style.shape==="Person"||style.shape==="Robot")){style.width=400;style.height=400}if(style.icon&&structurizr.ui.ignoredImages.indexOf(style.icon)>-1){style.icon=undefined}return style};structurizr.ui.findRelationshipStyle=function(relationship,darkMode){const defaultRelationshipStyle=new structurizr.ui.RelationshipStyle(2,"#707070",true,"Direct",24,200,50,100);if(darkMode===undefined){darkMode=false}var defaultStyle=defaultRelationshipStyle;if(darkMode===true){defaultStyle.color="#aaaaaa"}else{defaultStyle.color="#707070"}var relationshipStylesMap={};if(structurizr.ui.themes.length>0){structurizr.ui.themes.forEach(function(theme){theme.relationships.forEach(function(relationshipStyle){relationshipStylesMap[relationshipStyle.tag]=relationshipStyle})});structurizr.workspace.views.configuration.styles.relationships.forEach(function(relationshipStyleFromWorkspace){const tag=relationshipStyleFromWorkspace.tag;var relationshipStyle=relationshipStylesMap[tag];if(relationshipStyle===undefined){relationshipStylesMap[tag]=relationshipStyleFromWorkspace}else{structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"thickness");structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"color");structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"dashed");structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"style");structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"routing");structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"fontSize");structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"width");structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"position");structurizr.util.copyAttributeIfSpecified(relationshipStyleFromWorkspace,relationshipStyle,"opacity")}})}else{structurizr.workspace.views.configuration.styles.relationships.forEach(function(relationshipStyleFromWorkspace){const tag=relationshipStyleFromWorkspace.tag;relationshipStylesMap[tag]=relationshipStyleFromWorkspace})}var style=new structurizr.ui.RelationshipStyle(defaultStyle.thickness,defaultStyle.color,defaultStyle.dashed,defaultStyle.routing,defaultStyle.fontSize,defaultStyle.width,defaultStyle.position,defaultStyle.opacity);style.tags=["Relationship"];const tags=structurizr.workspace.getAllTagsForRelationship(relationship);for(var i=0;i<tags.length;i++){var relationshipStyle=relationshipStylesMap[tags[i].trim()];if(relationshipStyle){style.copyStyleAttributeIfSpecified(relationshipStyle,"thickness");style.copyStyleAttributeIfSpecified(relationshipStyle,"color");style.copyStyleAttributeIfSpecified(relationshipStyle,"dashed");style.copyStyleAttributeIfSpecified(relationshipStyle,"style");style.copyStyleAttributeIfSpecified(relationshipStyle,"routing");style.copyStyleAttributeIfSpecified(relationshipStyle,"fontSize");style.copyStyleAttributeIfSpecified(relationshipStyle,"width");style.copyStyleAttributeIfSpecified(relationshipStyle,"position");style.copyStyleAttributeIfSpecified(relationshipStyle,"opacity");style.tag=tags[i].trim();if(style.tags.indexOf(tags[i].trim())===-1){style.tags.push(tags[i].trim())}}}if(style.style===undefined){if(style.dashed===false){style.style="Solid"}else{style.style="Dashed"}}return style};structurizr.ui.getTitleForView=function(view){if(view&&view.title&&view.title.trim().length>0){return view.title}if(view.type===structurizr.constants.FILTERED_VIEW_TYPE){var baseView=structurizr.workspace.findViewByKey(view.baseViewKey);return this.getTitleForView(baseView)}return this.getDefaultViewName(view)};structurizr.ui.getDefaultViewName=function(view){if(view.type===structurizr.constants.FILTERED_VIEW_TYPE){view=structurizr.workspace.findViewByKey(view.baseViewKey)}if(view.type===structurizr.constants.CUSTOM_VIEW_TYPE){return"[Custom] "+(view.title&&view.title.trim().length>0?view.title:"Untitled")}else if(view.type===structurizr.constants.SYSTEM_LANDSCAPE_VIEW_TYPE){const enterprise=structurizr.workspace.model.enterprise;return"[System Landscape]"+(enterprise?" "+enterprise.name:"")}else if(view.type===structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE){const softwareSystem=structurizr.workspace.findElementById(view.softwareSystemId);return"[System Context] "+softwareSystem.name}else if(view.type===structurizr.constants.CONTAINER_VIEW_TYPE){const softwareSystem=structurizr.workspace.findElementById(view.softwareSystemId);return"[Container] "+softwareSystem.name}else if(view.type===structurizr.constants.COMPONENT_VIEW_TYPE){const container=structurizr.workspace.findElementById(view.containerId);const softwareSystem=structurizr.workspace.findElementById(container.parentId);return"[Component] "+softwareSystem.name+" - "+container.name}else if(view.type===structurizr.constants.DYNAMIC_VIEW_TYPE){var element=structurizr.workspace.findElementById(view.elementId);if(!element){element=structurizr.workspace.findElementById(view.softwareSystemId)}if(element){if(element.type===structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE){return"[Dynamic] "+element.name}else if(element.type===structurizr.constants.CONTAINER_ELEMENT_TYPE){const softwareSystem=structurizr.workspace.findElementById(element.parentId);return"[Dynamic] "+softwareSystem.name+" - "+element.name}}else{return"[Dynamic]"}}else if(view.type===structurizr.constants.DEPLOYMENT_VIEW_TYPE){if(view.softwareSystemId){const softwareSystem=structurizr.workspace.findElementById(view.softwareSystemId);return"[Deployment] "+softwareSystem.name+" - "+view.environment}else{return"[Deployment] "+view.environment}}else if(view.type===structurizr.constants.IMAGE_VIEW_TYPE){return"[Image] "+view.key}return""};structurizr.ui.openingMetadataSymbols={SquareBrackets:"[",RoundBrackets:"(",CurlyBrackets:"{",AngleBrackets:"<",DoubleAngleBrackets:"<<",None:""};structurizr.ui.closingMetadataSymbols={SquareBrackets:"]",RoundBrackets:")",CurlyBrackets:"}",AngleBrackets:">",DoubleAngleBrackets:">>",None:""};structurizr.ui.getMetadataForElement=function(element,includeTechnology){const openingSymbol=structurizr.ui.openingMetadataSymbols[structurizr.workspace.views.configuration.metadataSymbols];const closingSymbol=structurizr.ui.closingMetadataSymbols[structurizr.workspace.views.configuration.metadataSymbols];if(element.type===structurizr.constants.CUSTOM_ELEMENT_TYPE){if(element.metadata&&element.metadata.length>0){return openingSymbol+element.metadata+closingSymbol}else{return""}}else{if(includeTechnology===true&&element.technology){return openingSymbol+structurizr.workspace.getTerminologyFor(element)+": "+element.technology+closingSymbol}return openingSymbol+structurizr.workspace.getTerminologyFor(element)+closingSymbol}};structurizr.ui.getMetadataForRelationship=function(relationship){if(relationship.technology){const openingSymbol=structurizr.ui.openingMetadataSymbols[structurizr.workspace.views.configuration.metadataSymbols];const closingSymbol=structurizr.ui.closingMetadataSymbols[structurizr.workspace.views.configuration.metadataSymbols];return openingSymbol+relationship.technology+closingSymbol}else{return""}};structurizr.ui.isFullScreenEnabled=function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled};structurizr.ui.isFullScreen=function(){return document.enterFullScreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};structurizr.ui.enterFullScreen=function(domId){if(domId===undefined){domId="content"}if(this.isFullScreenEnabled()){var content=document.getElementById(domId);if(content.requestFullscreen){content.requestFullscreen()}else if(content.webkitRequestFullscreen){content.webkitRequestFullscreen()}else if(content.mozRequestFullScreen){content.mozRequestFullScreen()}else if(content.msRequestFullscreen){content.msRequestFullscreen()}}};structurizr.ui.exitFullScreen=function(){if(document.exitFullscreen){document.exitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}};structurizr.Workspace=class Workspace{#json;id;name;description;properties;lastModifiedDate;model;documentation;views;#workspace;#elementsById={};#relationshipsById={};#allViews=[];#views=[];constructor(json){this.#json=json;this.#workspace=JSON.parse(JSON.stringify(json));this.#initWorkspace();this.id=this.#workspace.id;this.name=this.#workspace.name;this.description=this.#workspace.description;this.lastModifiedDate=this.#workspace.lastModifiedDate;this.version=this.#workspace.version;this.#initDocumentation(this.#workspace);this.documentation=this.#workspace.documentation;this.#initModel();this.model=this.#workspace.model;this.#initViews();this.views=this.#workspace.views}getJson(){return JSON.parse(JSON.stringify(this.#json))}getProperty(name){return this.#workspace.properties[name]}#initWorkspace(){if(this.#workspace.id===undefined){this.#workspace.id=-1}if(this.#workspace.name===undefined){this.#workspace.name=""}if(this.#workspace.description===undefined){this.#workspace.description=""}if(this.#workspace.properties===undefined){this.#workspace.properties={}}if(this.#workspace.lastModifiedDate===undefined){this.#workspace.lastModifiedDate=(new Date).toISOString()}}#initDocumentation(workspaceOrElement){if(workspaceOrElement.documentation===undefined){workspaceOrElement.documentation={}}if(workspaceOrElement.documentation.sections===undefined){workspaceOrElement.documentation.sections=[]}if(workspaceOrElement.documentation.decisions===undefined){workspaceOrElement.documentation.decisions=[]}if(workspaceOrElement.documentation.images===undefined){workspaceOrElement.documentation.images=[]}}hasDocumentation(){if(this.#workspace.documentation.sections.length>0){return true}var result=false;this.#workspace.model.softwareSystems.forEach(function(softwareSystem){if(softwareSystem.documentation.sections.length>0){result=true}if(result===false){if(softwareSystem.containers){softwareSystem.containers.forEach(function(container){if(container.documentation.sections.length>0){result=true}if(result===false){if(container.components){container.components.forEach(function(component){if(component.documentation.sections.length>0){result=true}})}}})}}});return result}hasDecisions(){if(this.#workspace.documentation.decisions.length>0){return true}var result=false;this.#workspace.model.softwareSystems.forEach(function(softwareSystem){if(softwareSystem.documentation.decisions.length>0){result=true}if(result===false){if(softwareSystem.containers){softwareSystem.containers.forEach(function(container){if(container.documentation.decisions.length>0){result=true}if(result===false){if(container.components){container.components.forEach(function(component){if(component.documentation.decisions.length>0){result=true}})}}})}}});return result}#initModel(){if(this.#workspace.model===undefined){this.#workspace.model={}}if(this.#workspace.model.properties===undefined){this.#workspace.model.properties={}}var model=this.#workspace.model;if(model.customElements){this.#sortArrayByNameAscending(model.customElements);for(i=0;i<model.customElements.length;i++){var customElement=model.customElements[i];customElement.parentId=undefined;this.#registerElement(customElement,structurizr.constants.CUSTOM_ELEMENT_TYPE)}}else{model.customElements=[]}if(model.people){this.#sortArrayByNameAscending(model.people);for(i=0;i<model.people.length;i++){var person=model.people[i];person.parentId=undefined;this.#registerElement(person,structurizr.constants.PERSON_ELEMENT_TYPE)}}else{model.people=[]}if(model.softwareSystems){this.#sortArrayByNameAscending(model.softwareSystems);for(i=0;i<model.softwareSystems.length;i++){var softwareSystem=model.softwareSystems[i];softwareSystem.parentId=undefined;this.#registerElement(softwareSystem,structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE);if(softwareSystem.containers){this.#sortArrayByNameAscending(softwareSystem.containers);for(var j=0;j<softwareSystem.containers.length;j++){var container=softwareSystem.containers[j];container.parentId=softwareSystem.id;this.#registerElement(container,structurizr.constants.CONTAINER_ELEMENT_TYPE);if(container.components){this.#sortArrayByNameAscending(container.components);for(var k=0;k<container.components.length;k++){var component=container.components[k];component.parentId=container.id;this.#registerElement(component,structurizr.constants.COMPONENT_ELEMENT_TYPE);this.#initDocumentation(component)}}this.#initDocumentation(container)}}this.#initDocumentation(softwareSystem)}}else{model.softwareSystems=[]}if(model.deploymentNodes){this.#sortArrayByNameAscending(model.deploymentNodes);for(var i=0;i<model.deploymentNodes.length;i++){const deploymentNode=model.deploymentNodes[i];this.#registerDeploymentNode(deploymentNode,undefined)}}else{model.deploymentNodes=[]}}#registerDeploymentNode(deploymentNode,parent){if(parent===undefined){deploymentNode.parentId=undefined}else{deploymentNode.parentId=parent.id}if(deploymentNode.environment===undefined){deploymentNode.environment=structurizr.constants.DEFAULT_DEPLOYMENT_ENVIRONMENT_NAME}this.#registerElement(deploymentNode,structurizr.constants.DEPLOYMENT_NODE_ELEMENT_TYPE);if(deploymentNode.children){this.#sortArrayByNameAscending(deploymentNode.children);for(var i=0;i<deploymentNode.children.length;i++){const child=deploymentNode.children[i];this.#registerDeploymentNode(child,deploymentNode)}}else{deploymentNode.children=[]}if(deploymentNode.softwareSystemInstances){for(var i=0;i<deploymentNode.softwareSystemInstances.length;i++){const softwareSystemInstance=deploymentNode.softwareSystemInstances[i];const softwareSystem=this.findElementById(softwareSystemInstance.softwareSystemId);softwareSystemInstance.name=softwareSystem.name;softwareSystemInstance.description=softwareSystem.description;if(softwareSystemInstance.url===undefined){softwareSystemInstance.url=softwareSystem.url}softwareSystemInstance.parentId=deploymentNode.id;if(softwareSystemInstance.environment===undefined){softwareSystemInstance.environment=deploymentNode.environment}this.#registerElement(softwareSystemInstance,structurizr.constants.SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE)}}else{deploymentNode.softwareSystemInstances=[]}if(deploymentNode.containerInstances){for(var i=0;i<deploymentNode.containerInstances.length;i++){const containerInstance=deploymentNode.containerInstances[i];const container=this.findElementById(containerInstance.containerId);containerInstance.name=container.name;containerInstance.description=container.description;containerInstance.technology=container.technology;if(containerInstance.url===undefined){containerInstance.url=container.url}containerInstance.parentId=deploymentNode.id;if(containerInstance.environment===undefined){containerInstance.environment=deploymentNode.environment}this.#registerElement(containerInstance,structurizr.constants.CONTAINER_INSTANCE_ELEMENT_TYPE)}}else{deploymentNode.containerInstances=[]}if(deploymentNode.infrastructureNodes){for(var i=0;i<deploymentNode.infrastructureNodes.length;i++){const infrastructureNode=deploymentNode.infrastructureNodes[i];infrastructureNode.parentId=deploymentNode.id;if(infrastructureNode.environment===undefined){infrastructureNode.environment=deploymentNode.environment}this.#registerElement(infrastructureNode,structurizr.constants.INFRASTRUCTURE_NODE_ELEMENT_TYPE)}}else{deploymentNode.infrastructureNodes=[]}}#registerElement(element,type){if(element){element.type=type;this.#elementsById[element.id]=element;if(element.relationships){for(var i=0;i<element.relationships.length;i++){this.#registerRelationship(element.relationships[i])}}if(element.url&&element.url.trim().length===0){element.url=undefined}if(element.properties===undefined){element.properties={}}else{this.#sortProperties(element)}if(element.perspectives===undefined){element.perspectives=[]}}}hasElements(){return Object.keys(this.#elementsById).length>0}getElements(){return Object.values(this.#elementsById)}findElementById(id){return this.#elementsById[id]}getTags(){const self=this;const tags=[];Object.keys(this.#elementsById).forEach(function(id){const element=self.#elementsById[id];if(element.tags){element.tags.split(",").forEach(function(tag){tag=structurizr.util.trim(tag);if(tag.length>0&&tags.indexOf(tag)===-1){tags.push(tag)}})}});Object.keys(this.#relationshipsById).forEach(function(id){const relationship=self.#relationshipsById[id];if(relationship.tags){relationship.tags.split(",").forEach(function(tag){tag=structurizr.util.trim(tag);if(tag.length>0&&tags.indexOf(tag)===-1){tags.push(tag)}})}});tags.sort();return tags}getAllTagsForElement(element){var tags=element.tags?element.tags:"";if(element.type===structurizr.constants.SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE){const softwareSystem=this.findElementById(element.softwareSystemId);if(softwareSystem&&softwareSystem.tags){tags=softwareSystem.tags+","+tags}}else if(element.type===structurizr.constants.CONTAINER_INSTANCE_ELEMENT_TYPE){const container=this.findElementById(element.containerId);if(container&&container.tags){tags=container.tags+","+tags}}return tags.split(",")}getAllPropertiesForElement(element){var properties={};if(element.properties){properties=element.properties}if(element.type===structurizr.constants.SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE){var softwareSystem=this.findElementById(element.softwareSystemId);if(softwareSystem&&softwareSystem.properties){Object.keys(softwareSystem.properties).forEach(function(key){if(!properties[key]){properties[key]=softwareSystem.properties[key]}})}}else if(element.type===structurizr.constants.CONTAINER_INSTANCE_ELEMENT_TYPE){var container=this.findElementById(element.containerId);if(container&&container.properties){Object.keys(container.properties).forEach(function(key){if(!properties[key]){properties[key]=container.properties[key]}})}}return properties}getAllTagsForRelationship(relationship){var tags="";if(relationship.tags){tags=relationship.tags}var linkedRelationshipId=relationship.linkedRelationshipId;while(linkedRelationshipId!==undefined){var linkedRelationship=this.findRelationshipById(linkedRelationshipId);if(linkedRelationship&&linkedRelationship.tags){tags=linkedRelationship.tags+","+tags}linkedRelationshipId=linkedRelationship.linkedRelationshipId}return tags.split(",")}getAllPropertiesForRelationship(relationship){var properties={};if(relationship.properties){properties=relationship.properties}var linkedRelationshipId=relationship.linkedRelationshipId;while(linkedRelationshipId!==undefined){var linkedRelationship=this.findRelationshipById(linkedRelationshipId);if(linkedRelationship&&linkedRelationship.properties){Object.keys(linkedRelationship.properties).forEach(function(key){if(!properties[key]){properties[key]=linkedRelationship.properties[key]}})}linkedRelationshipId=linkedRelationship.linkedRelationshipId}return properties}#registerRelationship(relationship){this.#relationshipsById[relationship.id]=relationship;var linkedRelationshipId=relationship.linkedRelationshipId;while((relationship.url===undefined||relationship.url.trim().length===0)&&linkedRelationshipId!==undefined){var linkedRelationship=this.findRelationshipById(linkedRelationshipId);if(linkedRelationship){relationship.url=linkedRelationship.url;linkedRelationshipId=linkedRelationship.linkedRelationshipId}else{linkedRelationshipId=undefined}}if(relationship.url&&relationship.url.trim().length===0){relationship.url=undefined}if(relationship.properties===undefined){relationship.properties={}}else{this.#sortProperties(relationship)}if(relationship.perspectives===undefined){relationship.perspectives=[]}}findRelationshipById(id){return this.#relationshipsById[id]}getPerspectiveNames(){const self=this;const names=[];Object.keys(this.#elementsById).forEach(function(id){const element=self.#elementsById[id];element.perspectives.forEach(function(perspective){const name=structurizr.util.trim(perspective.name);if(names.indexOf(name)===-1){names.push(name)}})});Object.keys(this.#relationshipsById).forEach(function(id){const relationship=self.#relationshipsById[id];relationship.perspectives.forEach(function(perspective){const name=structurizr.util.trim(perspective.name);if(names.indexOf(name)===-1){names.push(name)}})});names.sort();return names}#initViews(){const self=this;if(this.#workspace.views===undefined){this.#workspace.views={}}if(this.#workspace.views.customViews===undefined){this.#workspace.views.customViews=[]}this.#workspace.views.customViews.forEach(function(view){view.type=structurizr.constants.CUSTOM_VIEW_TYPE;self.#registerView(view)});if(this.#workspace.views.systemLandscapeViews===undefined){this.#workspace.views.systemLandscapeViews=[]}this.#workspace.views.systemLandscapeViews.forEach(function(view){view.type=structurizr.constants.SYSTEM_LANDSCAPE_VIEW_TYPE;self.#registerView(view)});if(this.#workspace.views.systemContextViews===undefined){this.#workspace.views.systemContextViews=[]}this.#workspace.views.systemContextViews.forEach(function(view){view.type=structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE;self.#registerView(view)});if(this.#workspace.views.containerViews===undefined){this.#workspace.views.containerViews=[]}this.#workspace.views.containerViews.forEach(function(view){view.type=structurizr.constants.CONTAINER_VIEW_TYPE;self.#registerView(view)});if(this.#workspace.views.componentViews===undefined){this.#workspace.views.componentViews=[]}this.#workspace.views.componentViews.forEach(function(view){view.type=structurizr.constants.COMPONENT_VIEW_TYPE;self.#registerView(view)});if(this.#workspace.views.dynamicViews===undefined){this.#workspace.views.dynamicViews=[]}this.#workspace.views.dynamicViews.forEach(function(view){view.type=structurizr.constants.DYNAMIC_VIEW_TYPE;self.#registerView(view);view.relationships.sort(function(a,b){if(a.order===b.order){return a.id-b.id}else{return a.order-b.order}})});if(this.#workspace.views.deploymentViews===undefined){this.#workspace.views.deploymentViews=[]}this.#workspace.views.deploymentViews.forEach(function(view){if(view.environment===undefined||view.environment.trim().length===0){view.environment=structurizr.constants.DEFAULT_DEPLOYMENT_ENVIRONMENT_NAME}view.type=structurizr.constants.DEPLOYMENT_VIEW_TYPE;self.#registerView(view)});if(this.#workspace.views.filteredViews===undefined){this.#workspace.views.filteredViews=[]}this.#workspace.views.filteredViews.forEach(function(view){view.type=structurizr.constants.FILTERED_VIEW_TYPE;self.#registerView(view)});if(this.#workspace.views.imageViews===undefined){this.#workspace.views.imageViews=[]}this.#workspace.views.imageViews.forEach(function(view){view.type=structurizr.constants.IMAGE_VIEW_TYPE;self.#registerView(view)});if(this.#workspace.views.configuration===undefined){this.#workspace.views.configuration={}}if(this.#workspace.views.configuration.properties===undefined){this.#workspace.views.configuration.properties={}}if(this.#workspace.views.configuration.styles===undefined){this.#workspace.views.configuration.styles={}}if(this.#workspace.views.configuration.styles.elements===undefined){this.#workspace.views.configuration.styles.elements=[]}if(this.#workspace.views.configuration.styles.relationships===undefined){this.#workspace.views.configuration.styles.relationships=[]}if(this.#workspace.views.configuration.metadataSymbols===undefined){this.#workspace.views.configuration.metadataSymbols="SquareBrackets"}if(this.#workspace.views.configuration.branding===undefined){this.#workspace.views.configuration.branding={}}if(this.#workspace.views.configuration.terminology===undefined){this.#workspace.views.configuration.terminology={}}if(this.#workspace.views.configuration.themes===undefined){this.#workspace.views.configuration.themes=[]}this.#sortViews()}#registerView(view){this.#allViews.push(view);if(view.description===undefined){view.description=""}if(view.type!==structurizr.constants.IMAGE_VIEW_TYPE){if(view.elements===undefined){view.elements=[]}if(view.relationships===undefined){view.relationships=[]}if(view.type!==structurizr.constants.DYNAMIC_VIEW_TYPE){if(view.animations===undefined){view.animations=[]}view.animations.forEach(function(animationStep){if(animationStep.elements===undefined){animationStep.elements=[]}if(animationStep.relationships===undefined){animationStep.relationships=[]}})}}}hasViews(){return this.#views.length>0}getViews(){return this.#views}findSystemContextViewsForSoftwareSystem(softwareSystemId){const views=[];for(var i=0;i<this.#views.length;i++){var view=this.#views[i];if(view.type===structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE&&view.softwareSystemId===softwareSystemId){views.push(view)}else if(view.type===structurizr.constants.FILTERED_VIEW_TYPE){var baseView=this.findViewByKey(view.baseViewKey);if(baseView.type===structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE&&baseView.softwareSystemId===softwareSystemId){views.push(view)}}}return views}findContainerViewsForSoftwareSystem(softwareSystemId){const views=[];for(var i=0;i<this.#views.length;i++){var view=this.#views[i];if(view.type===structurizr.constants.CONTAINER_VIEW_TYPE&&view.softwareSystemId===softwareSystemId){views.push(view)}else if(view.type===structurizr.constants.FILTERED_VIEW_TYPE){var baseView=this.findViewByKey(view.baseViewKey);if(baseView.type===structurizr.constants.CONTAINER_VIEW_TYPE&&baseView.softwareSystemId===softwareSystemId){views.push(view)}}}return views}findComponentViewsForContainer(containerId){const views=[];for(var i=0;i<this.#views.length;i++){var view=this.#views[i];if(view.type===structurizr.constants.COMPONENT_VIEW_TYPE&&view.containerId===containerId){views.push(view)}else if(view.type===structurizr.constants.FILTERED_VIEW_TYPE){var baseView=this.findViewByKey(view.baseViewKey);if(baseView.type===structurizr.constants.COMPONENT_VIEW_TYPE&&baseView.containerId===containerId){views.push(view)}}}return views}findImageViewsForElement(elementId){const views=[];for(var i=0;i<this.views.imageViews.length;i++){var view=this.views.imageViews[i];if(view.elementId===elementId){views.push(view)}}return views}#sortViews(){var listOfViews=[];var filters=[];var viewTypeOrders=["SystemLandscape","SystemContext","Container","Component","Code","Dynamic","Deployment","Image"];var elementTypeOrders=["*","SoftwareSystem","Container","Component"];this.#allViews.forEach(function(view){if(view.type===structurizr.constants.FILTERED_VIEW_TYPE){filters.push(view.baseViewKey)}});for(var i=0;i<this.#allViews.length;i++){const view=this.#allViews[i];if(filters.indexOf(view.key)===-1){var obj={view:view,key:view.key};if(view.type==="Filtered"){var baseView=this.findViewByKey(view.baseViewKey);obj.viewTypeOrder=viewTypeOrders.indexOf(baseView.type);obj.element=this.#findElementForView(baseView)}else{obj.viewTypeOrder=viewTypeOrders.indexOf(view.type);obj.element=this.#findElementForView(view)}if(obj.element){obj.scope=obj.element.canonicalName;if(obj.element.type===structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE){obj.elementTypeOrder=elementTypeOrders.indexOf(structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE);obj.softwareSystem=obj.element}else if(obj.element.type===structurizr.constants.CONTAINER_ELEMENT_TYPE){obj.elementTypeOrder=elementTypeOrders.indexOf(structurizr.constants.CONTAINER_ELEMENT_TYPE);obj.softwareSystem=this.findElementById(obj.element.parentId)}else if(obj.element.type===structurizr.constants.COMPONENT_ELEMENT_TYPE){obj.elementTypeOrder=elementTypeOrders.indexOf(structurizr.constants.COMPONENT_ELEMENT_TYPE);obj.viewTypeOrder=viewTypeOrders.indexOf("Code");const container=this.findElementById(obj.element.parentId);obj.softwareSystem=this.findElementById(container.parentId)}}else{obj.elementTypeOrder=elementTypeOrders.indexOf("*");obj.scope="/"}listOfViews.push(obj)}}try{if(this.#workspace.views.configuration.viewSortOrder==="Key"||this.#workspace.views.configuration.properties&&this.#workspace.views.configuration.properties["structurizr.sort"]==="key"){listOfViews.sort(function(a,b){return a.key.localeCompare(b.key)})}else if(this.#workspace.views.configuration.viewSortOrder==="Type"||this.#workspace.views.configuration.properties&&this.#workspace.views.configuration.properties["structurizr.sort"]==="type"){listOfViews.sort(function(a,b){return(a.viewTypeOrder+a.scope+a.key).localeCompare(b.viewTypeOrder+b.scope+b.key)})}else if(this.#workspace.views.configuration.properties&&this.#workspace.views.configuration.properties["structurizr.sort"]==="created"){listOfViews.sort(function(a,b){return a.view.order-b.view.order})}else{listOfViews.sort(function(a,b){if(a.softwareSystem===undefined&&b.softwareSystem!==undefined){return-1}if(b.softwareSystem===undefined&&a.softwareSystem!==undefined){return 1}if(a.softwareSystem===undefined&&b.softwareSystem===undefined){return(a.viewTypeOrder+a.key).localeCompare(b.viewTypeOrder+b.key)}if(a.softwareSystem.name.localeCompare(b.softwareSystem.name)===0){return(a.viewTypeOrder+"."+a.elementTypeOrder+"."+a.scope+a.key).localeCompare(b.viewTypeOrder+"."+b.elementTypeOrder+"."+b.scope+b.key)}else{return a.softwareSystem.name.localeCompare(b.softwareSystem.name)}})}}catch(err){console.log(err)}this.#views=listOfViews.map(function(v){return v.view})}#findElementForView(view){if(view.type===structurizr.constants.CUSTOM_VIEW_TYPE){return undefined}else if(view.type===structurizr.constants.SYSTEM_LANDSCAPE_VIEW_TYPE){return undefined}else if(view.type===structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE){return this.findElementById(view.softwareSystemId)}else if(view.type===structurizr.constants.CONTAINER_VIEW_TYPE){return this.findElementById(view.softwareSystemId)}else if(view.type===structurizr.constants.COMPONENT_VIEW_TYPE){return this.findElementById(view.containerId)}else if(view.type===structurizr.constants.DYNAMIC_VIEW_TYPE){if(view.elementId!==undefined){return this.findElementById(view.elementId)}else{return undefined}}else if(view.type===structurizr.constants.DEPLOYMENT_VIEW_TYPE){if(view.softwareSystemId!==undefined){return this.findElementById(view.softwareSystemId)}else{return undefined}}else if(view.type===structurizr.constants.IMAGE_VIEW_TYPE){if(view.elementId!==undefined){return this.findElementById(view.elementId)}else{return undefined}}}copyLayoutFrom(views,viewKey){if(views===undefined){return}this.#copyLayoutFromViews(views.customViews,viewKey);this.#copyLayoutFromViews(views.systemLandscapeViews,viewKey);this.#copyLayoutFromViews(views.systemContextViews,viewKey);this.#copyLayoutFromViews(views.containerViews,viewKey);this.#copyLayoutFromViews(views.componentViews,viewKey);this.#copyLayoutFromViews(views.dynamicViews,viewKey);this.#copyLayoutFromViews(views.deploymentViews,viewKey)}#copyLayoutFromViews(views,viewKey){if(views!==undefined){for(var i=0;i<views.length;i++){const v=views[i];if(viewKey===undefined||viewKey===v.key){var view=this.findViewByKey(v.key);view.elements=v.elements;view.relationships=v.relationships;if(view.elements===undefined){view.elements=[]}if(view.relationships===undefined){view.relationships=[]}if(v.paperSize){view.paperSize=v.paperSize}if(v.dimensions){view.dimensions=v.dimensions}}}}}hasStyles(){return this.#workspace.views.configuration.styles.elements.length>0||this.#workspace.views.configuration.styles.relationships.length>0}findElementStyleByTag(tag){var style=undefined;this.#workspace.views.configuration.styles.elements.forEach(function(elementStyle){if(elementStyle.tag===tag){style=elementStyle}});return style}findViewByKey(key){var view=undefined;this.#allViews.forEach(function(v){if(v.key===key){view=v}});return view}#getTerminology(key,defaultValue){if(this.#workspace.views.configuration.terminology.hasOwnProperty(key)){return this.#workspace.views.configuration.terminology[key]}else{return defaultValue}}getTerminologyFor(item){if(item.type==="Person"){return this.#getTerminology("person","Person")}else if(item.type==="SoftwareSystem"||item.type==="SoftwareSystemInstance"){return this.#getTerminology("softwareSystem","Software System")}else if(item.type==="Container"||item.type==="ContainerInstance"){return this.#getTerminology("container","Container")}else if(item.type==="Component"){return this.#getTerminology("component","Component")}else if(item.type==="DeploymentNode"){return this.#getTerminology("deploymentNode","Deployment Node")}else if(item.type==="InfrastructureNode"){return this.#getTerminology("infrastructureNode","Infrastructure Node")}else if(item.type==="Enterprise"){return this.#getTerminology("enterprise","Enterprise")}else if(item.sourceId&&item.destinationId){return this.#getTerminology("relationship","Relationship")}return""}#sortArrayByNameAscending(array){array.sort(function(a,b){return a.name.localeCompare(b.name)})}#sortProperties(modelItem){if(modelItem.properties){var orderedProperties={};Object.keys(modelItem.properties).sort().forEach(function(key){orderedProperties[key]=modelItem.properties[key]});modelItem.properties=orderedProperties}}};structurizr.ui.Diagram=function(id,diagramIsEditable,constructionCompleteCallback){const self=this;const font=structurizr.ui.getBranding().font;const gridSize=5;const DEFAULT_ICON_HEIGHT=60;const ICON_PADDING=5;const nameFontSizeDifference=+10;const metaDataFontSizeDifference=-7;const darkenPercentage=-10;const borderStyles={Solid:"",Dashed:"10,10",Dotted:"2,2"};const borderStylesForKey={Solid:"",Dashed:"15,15",Dotted:"4,4"};const defaultBoundaryColoursLight={Enterprise:"#444444",Group:"#444444"};const defaultBoundaryColoursDark={Enterprise:"#cccccc",Group:"#cccccc"};var scale=.5;var minZoomScale=.1;const DEFAULT_MAX_ZOOM_SCALE=2;var maxZoomScale=DEFAULT_MAX_ZOOM_SCALE;const zoomSteps=40;var zoomDelta=(maxZoomScale-minZoomScale)/zoomSteps;var pageSizeDelta=100;const thumbnailWidth=400;var diagramWidth=0;var diagramHeight=0;var scrollBarWidth=0;var lineHeight="1.2em";var diagramKey;var totalWidthOfKey;var totalHeightOfKey;var tooltip;var lasso;var editable=diagramIsEditable;var embedded=false;var keyboardShortcutsEnabled=true;var navigationEnabled=false;var metadataEnabled=true;var descriptionEnabled=true;var darkMode=false;var canvasColor="#ffffff";const canvasColorDarkMode="#111111";var diagramTitle;var diagramDescription;var diagramMetadata;var diagramMetadataWidth=0;var brandingLogo;var enterpriseBoundary;var boundariesByElementId={};var groupsByName={};var mapOfIdToBox={};var mapOfIdToLine={};var cells;var cellsByElementId;var lines;var linesByRelationshipId;var selectedElements=[];var highlightedElement=undefined;var highlightedLink=undefined;var currentX;var currentY;var animationStarted=false;var linesToAnimate;var animationSteps;var animationIndex;const animationDelay=2e3;var currentView;var currentFilter;var currentPerspective;var currentTags=[];var lassoStart;var lassoEnd;var dragStartPosition;var scrollStartPosition;var previousPositions=[];var undoStack;var viewChangedEventHandler;var workspaceChangedEventHandler;var elementsSelectedEventHandler;var elementDoubleClickedHandler;var relationshipDoubleClickedHandler;var animationStartedEventHandler;var animationStoppedEventHandler;var onKeyDownEventHandler;var onKeyPressEventHandler;var imageMetadata=undefined;var imagePreloadAttempts=0;var diagramRendered=false;var parentElement=$("#"+id);const viewportId=id+"-viewport";const canvasId=id+"-canvas";parentElement.append('<div id="'+viewportId+'" class="structurizrDiagramViewport"><div id="'+canvasId+'" class=structurizrDiagramCanvas"></div></div>');const viewport=$("#"+viewportId);const canvas=$("#"+canvasId);const graph=new joint.dia.Graph;const paper=new joint.dia.Paper({el:canvas,width:diagramWidth,height:diagramHeight,background:{color:canvasColor},model:graph,gridSize:gridSize,scale:scale,interactive:editable,linkView:joint.dia.LinkView.extend({pointerclick:function(evt,x,y){if(editable){if(evt.altKey){}else{if(V(evt.target).hasClass("connection")||V(evt.target).hasClass("connection-wrap")){self.addVertex({x:x,y:y})}}}}}),linkConnectionPoint:editable?undefined:shapePerimeterConnectionPoint,clickThreshold:1});addPaperEventHandlers();preloadImages();function getImagesToPreload(){var images=[];const tags=structurizr.workspace.getTags();tags.push("Boundary");tags.push("Boundary:Enterprise");tags.push("Boundary:SoftwareSystem");tags.push("Boundary:Container");tags.push("Group");structurizr.workspace.views.configuration.styles.elements.forEach(function(elementStyle){if(elementStyle.tag.indexOf("Group:")>-1){tags.push(elementStyle.tag)}});structurizr.ui.themes.forEach(function(theme){theme.elements.forEach(function(elementStyle){if(elementStyle.tag.indexOf("Group:")>-1){tags.push(elementStyle.tag)}})});tags.forEach(function(tag){var icon=undefined;structurizr.ui.themes.forEach(function(theme){theme.elements.forEach(function(elementStyle){if(elementStyle.tag===tag&&elementStyle.icon){icon=elementStyle.icon}})});structurizr.workspace.views.configuration.styles.elements.forEach(function(elementStyle){if(elementStyle.tag===tag&&elementStyle.icon){icon=elementStyle.icon}});if(icon!==undefined){images.push(icon)}});const branding=structurizr.ui.getBranding();if(branding.logo){images.push(branding.logo)}structurizr.workspace.views.imageViews.forEach(function(view){images.push(view.content)});return images}function preloadImages(){if(imageMetadata===undefined){imageMetadata=[];getImagesToPreload().forEach(function(url){if(getImageMetadata(url)===undefined){imageMetadata.push({src:url,loaded:false,error:false})}});imageMetadata.forEach(function(im){const image=new Image;image.setAttribute("crossorigin","anonymous");image.addEventListener("load",function(){im.width=this.naturalWidth;im.height=this.naturalHeight;im.ratio=this.naturalWidth/this.naturalHeight;im.loaded=true;im.error=false});image.addEventListener("error",function(error){console.log("There was an error loading the image "+im.src+" - please check that the image exists, and that the Access-Control-Allow-Origin header is set to allow cross-origin requests.");im.loaded=true;im.error=true;structurizr.ui.ignoredImages.push(this.src)});image.src=im.src})}else{imagePreloadAttempts++}if(imageMetadata.length>0&&imageMetadata.filter(function(im){return im.loaded===false}).length>0&&imagePreloadAttempts<50){setTimeout(preloadImages,100)}else{imageMetadata.forEach(function(im){if(im.loaded===false){console.log("Failed to preload "+im.src);im.error=true}});if(constructionCompleteCallback){setTimeout(constructionCompleteCallback,10)}}}this.isRendered=function(){return diagramRendered};this.isExportable=function(){return true};this.setTooltip=function(t){tooltip=t};this.setLasso=function(l){lasso=l};function shapePerimeterConnectionPoint(linkView,view,magnet,reference){var bbox;var spot;if(linkView.model.get("router")===undefined){var type=view.model.get("type");if(type==="structurizr.box"||type==="structurizr.ellipse"||type==="structurizr.hexagon"||type==="structurizr.webBrowser"||type==="structurizr.window"||type==="structurizr.mobileDevice"){magnet=view.$(".structurizrHighlightableElement")[0]}else if(type==="structurizr.person"||type==="structurizr.robot"){var shapeBBox=view.model.getBBox();var centrePointX=shapeBBox.x+shapeBBox.width/2;var centrePointY=shapeBBox.y+shapeBBox.height/2;var radians=Math.atan2(centrePointY-reference.y,reference.x-centrePointX);var degrees=radians*180/Math.PI;if(degrees>45&&degrees<135){if(type==="structurizr.person"){magnet=view.$(".structurizrPersonHead")[0]}else{magnet=view.$(".structurizrRobotHead")[0]}}else{}}}if(magnet){spot=V(magnet).findIntersection(reference,linkView.paper.viewport);if(!spot){bbox=g.rect(V(magnet).bbox(false,linkView.paper.viewport))}}else{bbox=view.model.getBBox();spot=bbox.intersectionWithLineFromCenterToPoint(reference)}return spot||bbox.center()}function fireWorkspaceChangedEvent(){if(workspaceChangedEventHandler!==undefined){workspaceChangedEventHandler()}}this.onWorkspaceChanged=function(f){workspaceChangedEventHandler=f};function fireViewChangedEvent(view){if(viewChangedEventHandler!==undefined){viewChangedEventHandler(view.key)}}this.onViewChanged=function(f){viewChangedEventHandler=f};this.changeView=function(key,callback){const view=structurizr.workspace.findViewByKey(key);if(view===undefined){console.log("A view must be specified.");if(callback!==undefined){callback()}return}if(currentView!==undefined&&view.key===currentView.key){if(callback!==undefined){callback()}return}if(view.type==="Filtered"){currentFilter=view;currentView=structurizr.workspace.findViewByKey(view.baseViewKey)}else{currentFilter=undefined;currentView=view}renderView(callback);fireViewChangedEvent(view);disableCanvasDragging();if(editable===false||view.automaticLayout!==undefined){enableCanvasDragging()}};this.refresh=function(){renderView()};function renderView(callback){var view=currentView;graph.stopListening();graph.clear();diagramRendered=false;mapOfIdToBox={};cells=[];cellsByElementId={};lines=[];linesByRelationshipId={};diagramMetadataWidth=0;selectedElements=[];enterpriseBoundary=undefined;boundariesByElementId={};groupsByName={};linesToAnimate=undefined;animationSteps=undefined;animationStarted=false;undoStack=new structurizr.util.Stack;if(view===undefined){return}if(view.automaticLayout!==undefined){editable=false}else{editable=diagramIsEditable}paper.setInteractivity(function(cellView){if(cellView.model.isLink()){return{vertexAdd:false,vertexMove:true}}return editable});if(tooltip){tooltip.hide()}if(view.type===structurizr.constants.IMAGE_VIEW_TYPE){var content=view.content;editable=false;const imageMetadata=getImageMetadata(content);if(imageMetadata.error){content="/static/img/image-not-available.png";imageMetadata.contentType=structurizr.constants.CONTENT_TYPE_IMAGE_PNG;imageMetadata.width=200;imageMetadata.height=100;imageMetadata.ratio=2}else{imageMetadata.contentType=view.contentType}const image=new structurizr.shapes.ImageView({size:{width:imageMetadata.width,height:imageMetadata.height},attrs:{image:{"xlink:href":content,width:imageMetadata.width,height:imageMetadata.height}}});graph.addCell(image);image.toBack();var cellView=paper.findViewByModel(image);const domElement=$("#"+cellView.id);domElement.attr("style","cursor: default !important");view.dimensions={width:imageMetadata.width,height:imageMetadata.height};self.setPaperSize(view);if(embedded){self.zoomFitWidth();minZoomScale=scale;zoomDelta=(maxZoomScale-minZoomScale)/zoomSteps}else{if(imageMetadata.contentType===structurizr.constants.CONTENT_TYPE_IMAGE_SVG){maxZoomScale=10}self.zoomToWidthOrHeight()}addGraphEventHandlers();diagramRendered=true;if(callback!==undefined){callback()}return}self.setPaperSize(view);removeIllegalElements();if(view.elements){for(var i=0;i<view.elements.length;i++){var positionX;var positionY;var element=structurizr.workspace.findElementById(view.elements[i].id);if(!includeElementOnDiagram(element)||element.type===structurizr.constants.DEPLOYMENT_NODE_ELEMENT_TYPE){continue}var elementStyle=structurizr.ui.findElementStyle(element);var box;if(view.elements[i].x!==undefined){positionX=Math.floor(view.elements[i].x)}else{positionX=Math.floor(Math.random()*400+1);view.elements[i].x=positionX}if(view.elements[i].y!==undefined){positionY=Math.floor(view.elements[i].y)}else{positionY=Math.floor(Math.random()*400+1);view.elements[i].y=positionY}if(elementStyle.shape==="Cylinder"){box=createCylinder(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="Person"){box=createPerson(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="Robot"){box=createRobot(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="RoundedBox"){box=createBox(view,element,elementStyle,positionX,positionY,20)}else if(elementStyle.shape==="Folder"){box=createFolder(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="Circle"){box=createEllipse(view,element,elementStyle,positionX,positionY,true)}else if(elementStyle.shape==="Ellipse"){box=createEllipse(view,element,elementStyle,positionX,positionY,false)}else if(elementStyle.shape==="Hexagon"){box=createHexagon(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="Diamond"){box=createDiamond(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="Pipe"){box=createPipe(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="WebBrowser"){box=createWebBrowser(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="Window"){box=createWindow(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="MobileDevicePortrait"){box=createMobileDevicePortrait(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="MobileDeviceLandscape"){box=createMobileDeviceLandscape(view,element,elementStyle,positionX,positionY)}else if(elementStyle.shape==="Component"){box=createComponent(view,element,elementStyle,positionX,positionY)}else{box=createBox(view,element,elementStyle,positionX,positionY,1)}cells.push(box);cellsByElementId[element.id]=box;box.elementInView=view.elements[i];box.positionCalculated=false;if(includeGroup(element,view)===true){if(element.group!==undefined){var scope=element.parentId;if(scope===undefined){scope=element.location==="Internal"?"Internal":"External"}const group=findOrCreateGroup(element.group,scope);group.embed(box);box.toFront()}}if(view.type===structurizr.constants.SYSTEM_LANDSCAPE_VIEW_TYPE||view.type===structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE||view.type===structurizr.constants.DYNAMIC_VIEW_TYPE&&view.elementId===undefined){var includeEnterpriseBoundary=view.enterpriseBoundaryVisible===true;if(view.properties&&view.properties["structurizr.enterpriseBoundary"]){includeEnterpriseBoundary=view.properties["structurizr.enterpriseBoundary"]==="true"}if(element.location&&element.location==="Internal"&&includeEnterpriseBoundary){if(!enterpriseBoundary){var enterprise=structurizr.workspace.model.enterprise;var boundaryName=enterprise&&enterprise.name?enterprise.name:"Enterprise";enterpriseBoundary=createBoundary(boundaryName,structurizr.ui.getMetadataForElement({type:"Enterprise"}),"Enterprise")}if(element.group!==undefined){const rootGroup=findRootGroup(element.group,"Internal");if(rootGroup){enterpriseBoundary.embed(rootGroup)}else{enterpriseBoundary.embed(box)}}else{enterpriseBoundary.embed(box)}}}if(view.type===structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE&&element.id===view.softwareSystemId){if(!view.elements[i].x){centreCell(box)}}if(view.type===structurizr.constants.CONTAINER_VIEW_TYPE&&element.type===structurizr.constants.CONTAINER_ELEMENT_TYPE){const includeParentBoundary=false;addElementToBoundary(element,box,includeParentBoundary)}if(view.type===structurizr.constants.COMPONENT_VIEW_TYPE&&element.type===structurizr.constants.COMPONENT_ELEMENT_TYPE){const includeParentBoundary=view.properties&&view.properties["structurizr.softwareSystemBoundaries"]==="true";addElementToBoundary(element,box,includeParentBoundary)}if(view.type===structurizr.constants.DYNAMIC_VIEW_TYPE&&view.elementId){var scopedElement=structurizr.workspace.findElementById(view.elementId);if(scopedElement.type===structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE&&element.type===structurizr.constants.CONTAINER_ELEMENT_TYPE||scopedElement.type===structurizr.constants.CONTAINER_ELEMENT_TYPE&&element.type===structurizr.constants.COMPONENT_ELEMENT_TYPE){const includeParentBoundary=element.type===structurizr.constants.COMPONENT_ELEMENT_TYPE&&(view.properties&&view.properties["structurizr.softwareSystemBoundaries"]==="true");addElementToBoundary(element,box,includeParentBoundary)}}var cellView=paper.findViewByModel(box);const domElement=$("#"+cellView.id);if(editable===true){domElement.attr("style","cursor: move !important")}else{domElement.attr("style","cursor: default !important")}if(navigationEnabled){addDoubleClickHandlerForElement(cellView,element)}}}if(view.type===structurizr.constants.DEPLOYMENT_VIEW_TYPE){var unusedDeploymentNodeCells=[];if(view.elements){view.elements.forEach(function(elementView){var element=structurizr.workspace.findElementById(elementView.id);if(element.type===structurizr.constants.DEPLOYMENT_NODE_ELEMENT_TYPE){var deploymentNodeCell=createDeploymentNode(element);deploymentNodeCell.elementInView=elementView;deploymentNodeCell.positionCalculated=true;unusedDeploymentNodeCells.push(deploymentNodeCell);cellsByElementId[element.id]=deploymentNodeCell;if(includeGroup(element,view)===true){if(element.group!==undefined){var scope=element.parentId;if(scope===undefined){scope=element.environment}const group=findOrCreateGroup(element.group,scope);group.embed(deploymentNodeCell)}}if(element.softwareSystemInstances&&element.softwareSystemInstances.length>0){element.softwareSystemInstances.forEach(function(softwareSystemInstance){var softwareSystemBox=cellsByElementId[softwareSystemInstance.id];if(softwareSystemBox!==undefined){if(softwareSystemInstance.group!==undefined){const rootGroup=findRootGroup(softwareSystemInstance.group,softwareSystemInstance.parentId);if(rootGroup){deploymentNodeCell.embed(rootGroup)}else{deploymentNodeCell.embed(softwareSystemBox)}}else{deploymentNodeCell.embed(softwareSystemBox)}}})}if(element.containerInstances&&element.containerInstances.length>0){element.containerInstances.forEach(function(containerInstance){var containerBox=cellsByElementId[containerInstance.id];if(containerBox!==undefined){if(containerInstance.group!==undefined){const rootGroup=findRootGroup(containerInstance.group,containerInstance.parentId);if(rootGroup){deploymentNodeCell.embed(rootGroup)}else{deploymentNodeCell.embed(containerBox)}}else{deploymentNodeCell.embed(containerBox)}}})}if(element.infrastructureNodes&&element.infrastructureNodes.length>0){element.infrastructureNodes.forEach(function(infrastructureNode){var infrastructureBox=cellsByElementId[infrastructureNode.id];if(infrastructureBox!==undefined){if(infrastructureNode.group!==undefined){const rootGroup=findRootGroup(infrastructureNode.group,infrastructureNode.parentId);if(rootGroup){deploymentNodeCell.embed(rootGroup)}else{deploymentNodeCell.embed(infrastructureBox)}}else{deploymentNodeCell.embed(infrastructureBox)}}})}}});view.elements.forEach(function(elementView){var element=structurizr.workspace.findElementById(elementView.id);var cell=cellsByElementId[element.id];if(element.type===structurizr.constants.DEPLOYMENT_NODE_ELEMENT_TYPE){if(element.parentId!==undefined){var parentBox=cellsByElementId[element.parentId];if(element.group!==undefined){var scope=element.parentId;if(scope===undefined){scope=element.environment}const rootGroup=findRootGroup(element.group,scope);if(rootGroup){parentBox.embed(rootGroup)}else{parentBox.embed(cell)}}else{parentBox.embed(cell)}}}});view.elements.forEach(function(elementView){var element=structurizr.workspace.findElementById(elementView.id);var cell=cellsByElementId[element.id];if(element.type===structurizr.constants.SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE||element.type===structurizr.constants.CONTAINER_INSTANCE_ELEMENT_TYPE||element.type===structurizr.constants.INFRASTRUCTURE_NODE_ELEMENT_TYPE){var parentId=cell.get("parent");while(parentId){var parentCell=graph.getCell(parentId);var index=unusedDeploymentNodeCells.indexOf(parentCell);if(index>-1){unusedDeploymentNodeCells.splice(index,1)}parentId=parentCell.get("parent")}}});unusedDeploymentNodeCells.forEach(function(deploymentNodeCell){deploymentNodeCell.remove();delete cellsByElementId[deploymentNodeCell.elementInView.id]})}}var relationships=view.relationships;if(relationships===undefined){relationships=[]}for(var i=0;i<relationships.length;i++){var line=createArrow(relationships[i]);if(line!==undefined){lines.push(line);linesByRelationshipId[relationships[i].id]=line}}if(!editable){$(".connection-wrap").css({"pointer-events":"visiblePainted",cursor:"auto"});$(".marker-vertices").css("display","none")}diagramKey=createDiagramKey();view.elements.forEach(function(elementView){var element=structurizr.workspace.findElementById(elementView.id);var cell=cellsByElementId[element.id];if(element.type===structurizr.constants.CUSTOM_ELEMENT_TYPE||element.type===structurizr.constants.PERSON_ELEMENT_TYPE||element.type===structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE||element.type===structurizr.constants.CONTAINER_ELEMENT_TYPE||element.type===structurizr.constants.COMPONENT_ELEMENT_TYPE||element.type===structurizr.constants.SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE||element.type===structurizr.constants.CONTAINER_INSTANCE_ELEMENT_TYPE||element.type===structurizr.constants.INFRASTRUCTURE_NODE_ELEMENT_TYPE){if(cell){var parentId=cell.get("parent");while(parentId){const parentCell=graph.getCell(parentId);reposition(parentCell);parentId=parentCell.get("parent")}}}});graph.getElements().forEach(function(element){if(element.get("parent")===undefined){element.toFront();const embeddedCells=element.getEmbeddedCells({deep:true,breadthFirst:true});embeddedCells.forEach(function(embeddedCell){embeddedCell.toFront()})}});addGraphEventHandlers();if(embedded){self.zoomFitWidth();minZoomScale=scale;zoomDelta=(maxZoomScale-minZoomScale)/zoomSteps}else{maxZoomScale=DEFAULT_MAX_ZOOM_SCALE;self.zoomToWidthOrHeight()}createDiagramMetadata();self.renderPerspectiveOrTagsFilter();lines.forEach(function(line){try{adjustVertices(graph,line);line.toFront()}catch(e){console.log(e)}});diagramRendered=true;if(callback!==undefined){callback()}}function includeGroup(element,view){var renderGroupForElement=false;if(view.properties&&view.properties["structurizr.groups"]==="false"){return false}if(view.type===structurizr.constants.SYSTEM_LANDSCAPE_VIEW_TYPE||view.type===structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE){renderGroupForElement=element.type===structurizr.constants.PERSON_ELEMENT_TYPE||element.type===structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE||element.type===structurizr.constants.CUSTOM_ELEMENT_TYPE}else if(view.type===structurizr.constants.CONTAINER_VIEW_TYPE){renderGroupForElement=element.type===structurizr.constants.CONTAINER_ELEMENT_TYPE}else if(view.type===structurizr.constants.COMPONENT_VIEW_TYPE){renderGroupForElement=element.type===structurizr.constants.COMPONENT_ELEMENT_TYPE}else if(view.type===structurizr.constants.DYNAMIC_VIEW_TYPE){if(view.elementId===undefined){renderGroupForElement=element.type===structurizr.constants.PERSON_ELEMENT_TYPE||element.type===structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE||element.type===structurizr.constants.CUSTOM_ELEMENT_TYPE}else{var scopedElement=structurizr.workspace.findElementById(view.elementId);if(scopedElement.type===structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE){renderGroupForElement=element.type===structurizr.constants.CONTAINER_ELEMENT_TYPE}else if(scopedElement.type===structurizr.constants.CONTAINER_ELEMENT_TYPE){renderGroupForElement=element.type===structurizr.constants.COMPONENT_ELEMENT_TYPE}}}else if(view.type===structurizr.constants.DEPLOYMENT_VIEW_TYPE){renderGroupForElement=element.type===structurizr.constants.DEPLOYMENT_NODE_ELEMENT_TYPE||element.type===structurizr.constants.INFRASTRUCTURE_NODE_ELEMENT_TYPE||element.type===structurizr.constants.SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE||element.type===structurizr.constants.CONTAINER_INSTANCE_ELEMENT_TYPE}return renderGroupForElement}function addElementToBoundary(element,cell,includeParentBoundary){var boundary=boundariesByElementId[element.parentId];if(boundary===undefined){var boundaryElement=structurizr.workspace.findElementById(element.parentId);if(boundaryElement){boundary=createBoundary(boundaryElement.name,structurizr.ui.getMetadataForElement(boundaryElement),undefined,boundaryElement);boundary.elementInView=boundaryElement;boundariesByElementId[element.parentId]=boundary}if(includeParentBoundary&&boundaryElement.parentId){var parentBoundary=boundariesByElementId[boundaryElement.parentId];var parentBoundary=boundariesByElementId[boundaryElement.parentId];if(parentBoundary===undefined){var parentBoundaryElement=structurizr.workspace.findElementById(boundaryElement.parentId);if(parentBoundaryElement){parentBoundary=createBoundary(parentBoundaryElement.name,structurizr.ui.getMetadataForElement(parentBoundaryElement),undefined,parentBoundaryElement);parentBoundary.elementInView=parentBoundaryElement;boundariesByElementId[boundaryElement.parentId]=parentBoundary}}parentBoundary.embed(boundary)}}if(element.group!==undefined){const rootGroup=findRootGroup(element.group,element.parentId);if(rootGroup){boundary.embed(rootGroup)}else{boundary.embed(cell)}}else{boundary.embed(cell)}boundary.toFront({deep:true})}function findRootGroup(name,scope){if(useNestedGroups()){const separator=getGroupSeparator();if(name.indexOf(separator)>-1){return findGroup(name.substring(0,name.indexOf(separator)),scope)}else{return findGroup(name,scope)}}else{return findGroup(name,scope)}}function findGroup(name,scope){if(scope===undefined){scope=""}const identifier=scope+"_"+name;return groupsByName[identifier]}function registerGroup(name,scope,boundary){if(scope===undefined){scope=""}const identifier=scope+"_"+name;groupsByName[identifier]=boundary}function getGroupSeparator(){return structurizr.workspace.model.properties["structurizr.groupSeparator"]}function useNestedGroups(){return getGroupSeparator()!==undefined}function findOrCreateGroup(name,scope){if(useNestedGroups()){const separator=getGroupSeparator();var group=findGroup(name,scope);if(group===undefined){if(name.indexOf(separator)>-1){var parentGroupName=name.substring(0,name.lastIndexOf(separator));var groupName=name.substring(name.lastIndexOf(separator)+separator.length);var parentGroup=findOrCreateGroup(parentGroupName,scope);group=createBoundaryForGroup(name);parentGroup.embed(group);group._name=groupName;registerGroup(name,scope,group)}else{group=createBoundaryForGroup(name);group._name=name;registerGroup(name,scope,group)}}return group}else{var group=findGroup(name,scope);if(group===undefined){group=createBoundaryForGroup(name);group._name=name;registerGroup(name,scope,group)}return group}}function addDoubleClickHandlerForElement(cellView,element){var domElement=$("#"+cellView.id);var views=[];var documentation=false;var decisions=false;var url=element.url;const elementDoubleClicked=element;if(element.type===structurizr.constants.SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE){element=structurizr.workspace.findElementById(element.softwareSystemId)}else if(element.type===structurizr.constants.CONTAINER_INSTANCE_ELEMENT_TYPE){element=structurizr.workspace.findElementById(element.containerId)}if(element.type===structurizr.constants.SOFTWARE_SYSTEM_ELEMENT_TYPE){if(currentView.type===structurizr.constants.SYSTEM_LANDSCAPE_VIEW_TYPE||currentView.softwareSystemId!==element.id){views=structurizr.workspace.findSystemContextViewsForSoftwareSystem(element.id)}else if(currentView.type===structurizr.constants.SYSTEM_CONTEXT_VIEW_TYPE){views=structurizr.workspace.findContainerViewsForSoftwareSystem(element.id)}}else if(element.type===structurizr.constants.CONTAINER_ELEMENT_TYPE){views=structurizr.workspace.findComponentViewsForContainer(element.id)}views=views.concat(structurizr.workspace.findImageViewsForElement(element.id));documentation=element.documentation&&element.documentation.sections&&element.documentation.sections.length>0;decisions=element.documentation&&element.documentation.decisions&&element.documentation.decisions.length>0;if(url!==undefined){domElement.attr("style","cursor: pointer !important")}var translateX=5;var translateXDelta=25;if(views.length>0){const svg='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">'+'<path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>'+'<path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>'+'<path fill-rule="evenodd" d="M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"/>'+"</svg>";$("#"+cellView.id+" .structurizrZoom").html(svg);$("#"+cellView.id+" .structurizrZoom").attr("transform","translate("+translateX+" 0)");translateX+=translateXDelta}if(documentation){const svg='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">'+'<path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>'+"</svg>";$("#"+cellView.id+" .structurizrDocumentation").html(svg);$("#"+cellView.id+" .structurizrDocumentation").attr("transform","translate("+translateX+" 0)");translateX+=translateXDelta}if(decisions){const svg='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">'+'<path d="M5 10.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>'+'<path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/>'+'<path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/>'+"</svg>";$("#"+cellView.id+" .structurizrDecisions").html(svg);$("#"+cellView.id+" .structurizrDecisions").attr("transform","translate("+translateX+" 0)");translateX+=translateXDelta}if(url){const svg='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">'+'<path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>'+'<path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>'+"</svg>";$("#"+cellView.id+" .structurizrLink").html(svg);$("#"+cellView.id+" .structurizrLink").attr("transform","translate("+translateX+" 0)");translateX+=translateXDelta}if(views.length>0||documentation||decisions){domElement.attr("style","cursor: zoom-in !important")}const width=cellView.model._computedStyle.width;const navigationRefX=(width-translateX)/2/width;cellView.model.attr(".structurizrNavigation/ref-x",navigationRefX);domElement.dblclick(function(event){if(elementDoubleClickedHandler!==undefined){elementDoubleClickedHandler(event,elementDoubleClicked.id)}})}function addDoubleClickHandlerForRelationship(linkView,relationship){const url=relationship.url;if(url){const domElement=$("#"+linkView.id);const svg='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="structurizrNavigation" viewBox="0 0 16 16">'+'<path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>'+'<path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>'+"</svg>";$("#"+linkView.id+" .structurizrNavigation").parent().css("color",linkView.model._computedStyle.color);$("#"+linkView.id+" .structurizrNavigation").parent().html(svg);$("#"+linkView.id+" .connection-wrap").css("cursor","pointer");$("#"+linkView.id+" .label").css("cursor","pointer");domElement.dblclick(function(event){if(relationshipDoubleClickedHandler!==undefined){relationshipDoubleClickedHandler(event,relationship.id)}})}else{$("#"+linkView.id+" .connection-wrap").css("cursor","default");$("#"+linkView.id+" .label").css("cursor","default")}}function elementHasPerspective(element){return getPerspectiveForElement(element)!==undefined}function getPerspectiveForElement(element){var p=undefined;if(element.perspectives){element.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){p=perspective}})}if(p===undefined){if(element.type===structurizr.constants.SOFTWARE_SYSTEM_INSTANCE_ELEMENT_TYPE){var softwareSystem=structurizr.workspace.findElementById(element.softwareSystemId);if(softwareSystem.perspectives){softwareSystem.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){p=perspective}})}}else if(element.type===structurizr.constants.CONTAINER_INSTANCE_ELEMENT_TYPE){var container=structurizr.workspace.findElementById(element.containerId);if(container.perspectives){container.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){p=perspective}})}}}return p}function relationshipHasPerspective(relationship){var result=false;if(relationship.perspectives){relationship.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){result=true}})}if(result===false){if(relationship.linkedRelationshipId){return relationshipHasPerspective(structurizr.workspace.findRelationshipById(relationship.linkedRelationshipId))}}return result}function hasTags(tags){var result=false;currentTags.forEach(function(tag){result=result||tags.indexOf(tag)>-1});return result}this.renderPerspectiveOrTagsFilter=function(){if(currentPerspective===undefined&&currentTags.length===0){Object.keys(cellsByElementId).forEach(function(elementId){var cell=cellsByElementId[elementId];changeColourOfCell(cell,cell._computedStyle.background,cell._computedStyle.color,cell._computedStyle.stroke);showElement(elementId)});lines.forEach(function(line){showLine(line.relationshipInView.id)});return}if(currentPerspective!==undefined){Object.keys(cellsByElementId).forEach(function(elementId){var cell=cellsByElementId[elementId];var element=structurizr.workspace.findElementById(cell.elementInView.id);var perspective=getPerspectiveForElement(element);changeColourOfCell(cell,cell._computedStyle.background,cell._computedStyle.color,cell._computedStyle.stroke);if(perspective===undefined){hideElement(element.id,"0.2")}else{showElement(element.id);var usedElementStyle=false;var elementStyles=structurizr.workspace.views.configuration.styles.elements;elementStyles.forEach(function(elementStyle){if(elementStyle.tag.indexOf("Perspective:"+currentPerspective)===0){var useElementStyle=false;var expression=elementStyle.tag.substring(elementStyle.tag.indexOf("[")+1,elementStyle.tag.length-1);if(expression.indexOf("value==")===0){var testValue=expression.substring("value==".length);if(perspective.description===testValue){useElementStyle=true}}else if(expression.indexOf("value<=")===0){var testValue=expression.substring("value<=".length);if(!isNaN(perspective.description)&&!isNaN(testValue)){useElementStyle=Number(perspective.description)<Number(testValue)}else{useElementStyle=perspective.description<=testValue}}if(useElementStyle===true&&usedElementStyle===false){var background=elementStyle.background;var color=elementStyle.color;var stroke=elementStyle.stroke;if(background===undefined){background=cell._computedStyle.background}if(color===undefined){color=cell._computedStyle.color}if(stroke===undefined){stroke=structurizr.util.shadeColor(background,darkenPercentage,darkMode)}changeColourOfCell(cell,background,color,stroke);usedElementStyle=true}}})}});lines.forEach(function(line){var relationship=structurizr.workspace.findRelationshipById(line.relationshipInView.id);if(relationshipHasPerspective(relationship)===false){hideLine(relationship.id,"0.2")}else{showLine(relationship.id)}})}if(currentTags.length>0){Object.keys(cellsByElementId).forEach(function(elementId){var cell=cellsByElementId[elementId];var element=structurizr.workspace.findElementById(cell.elementInView.id);const tags=structurizr.workspace.getAllTagsForElement(element);if(hasTags(tags)===false){hideElement(element.id,"0.2")}else{showElement(element.id)}});lines.forEach(function(line){var relationship=structurizr.workspace.findRelationshipById(line.relationshipInView.id);const tags=structurizr.workspace.getAllTagsForRelationship(relationship);if(hasTags(tags)===false){hideLine(relationship.id,"0.2")}else{showLine(relationship.id)}})}};this.getCurrentView=function(){return currentView};this.getCurrentViewOrFilter=function(){if(currentFilter){return currentFilter}else{return currentView}};this.changePerspective=function(perspective){currentPerspective=perspective};this.hasPerspective=function(){return currentPerspective!==undefined};this.clearPerspective=function(){currentPerspective=undefined};this.changeTags=function(tags){currentTags=tags};this.clearTags=function(){currentTags=[]};this.hasTags=function(){return currentTags!==undefined};this.isEditable=function(){return editable};this.setEmbedded=function(bool){embedded=bool};this.isEmbedded=function(){return embedded};this.setNavigationEnabled=function(bool){navigationEnabled=bool};this.isNavigationEnabled=function(){return navigationEnabled};this.setDarkMode=function(bool){darkMode=bool===true;if(darkMode===true){canvasColor=canvasColorDarkMode}else{canvasColor="#ffffff"}paper.drawBackground({color:canvasColor});renderView()};this.isDarkMode=function(){return darkMode};this.setPageSize=function(width,height){width=Math.round(width);height=Math.round(height);diagramWidth=width;diagramHeight=height;currentView.dimensions={width:width,height:height};paper.setDimensions(width,height);this.resize();repositionDiagramMetadata();this.zoomToWidthOrHeight();if(typeof postDiagramAspectRatioToParentWindow==="function"){postDiagramAspectRatioToParentWindow(true)}};function setZoomAndMargins(){minZoomScale=scale;if(currentView.type===structurizr.constants.IMAGE_VIEW_TYPE){const imageMetadata=getImageMetadata(currentView.content);if(imageMetadata.contentType===structurizr.constants.CONTENT_TYPE_IMAGE_SVG){const maxWidth=self.getPossibleViewportWidth();const maxHeight=self.getPossibleViewportHeight();maxZoomScale=2*Math.max(maxWidth/imageMetadata.width,maxHeight/imageMetadata.height)}else{maxZoomScale=1}}else{maxZoomScale=DEFAULT_MAX_ZOOM_SCALE}zoomDelta=(maxZoomScale-minZoomScale)/zoomSteps;var minimumWidth=minZoomScale*diagramWidth;var minimumHeight=minZoomScale*diagramHeight;var viewportWidth=viewport.innerWidth();var viewportHeight=viewport.innerHeight();var maxMarginLeftRight=Math.max(0,(viewportWidth-minimumWidth)/2);canvas.css("margin-left",maxMarginLeftRight);canvas.css("margin-right",maxMarginLeftRight);var maxMarginTopBottom=Math.max(0,(viewportHeight-minimumHeight)/2);canvas.css("margin-top",maxMarginTopBottom);canvas.css("margin-bottom",maxMarginTopBottom)}this.decreasePageSize=function(evt){currentView.paperSize=undefined;$("#pageSize option#none").prop("selected",true);this.setPageSize(Math.max(diagramWidth-pageSizeDelta,diagramMetadataWidth),diagramHeight-pageSizeDelta);if(evt.altKey===false){centreDiagram()}};this.autoPageSize=function(){var margin=400;var contentArea=findContentArea(false,0);var contentWidth=contentArea.maxX-contentArea.minX+margin;var contentHeight=contentArea.maxY-contentArea.minY+margin;contentWidth=Math.max(contentWidth,diagramMetadataWidth);this.setPageSize(contentWidth,contentHeight);currentView.paperSize=undefined;$("#pageSize option#none").prop("selected",true);centreDiagram()};this.increasePageSize=function(evt){currentView.paperSize=undefined;$("#pageSize option#none").prop("selected",true);this.setPageSize(diagramWidth+pageSizeDelta,diagramHeight+pageSizeDelta);if(evt.altKey===false){centreDiagram()}};this.getWidth=function(){return diagramWidth};this.getHeight=function(){return diagramHeight};function calculateElementPadding(configuration){return configuration.width*.07}function renderElementInternals(element,cell,configuration,width,horizontalPadding,height,verticalOffset){var internalPadding=10;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var color=structurizr.util.shadeColor(configuration.color,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var navigationColor=color;var name=formatName(element,configuration,horizontalPadding);var metadata=formatMetaData(element,configuration,horizontalPadding);var description=formatDescription(element,configuration,horizontalPadding);var heightOfNameLabel=calculateHeight(name,configuration.fontSize,nameFontSizeDifference,false);var heightOfMetaDataLabel=calculateHeight(metadata,configuration.fontSize,metaDataFontSizeDifference,false)+internalPadding;var heightOfDescriptionLabel=calculateHeight(description,configuration.fontSize,0,false);var heightOfIcon=0;if(configuration.icon!==undefined){heightOfDescriptionLabel+=+internalPadding;heightOfIcon=DEFAULT_ICON_HEIGHT+ICON_PADDING}var totalHeightOfLabels=heightOfNameLabel+heightOfMetaDataLabel+heightOfDescriptionLabel+heightOfIcon;var nameRefY=(verticalOffset+(height-totalHeightOfLabels)/2)/height;var metaDataRefY=(verticalOffset+heightOfNameLabel+(height-totalHeightOfLabels)/2)/height;var descriptionRefY=(verticalOffset+heightOfNameLabel+heightOfMetaDataLabel+(height-totalHeightOfLabels)/2)/height;var iconRefY=(verticalOffset+heightOfNameLabel+heightOfMetaDataLabel+heightOfDescriptionLabel+(height-totalHeightOfLabels)/2)/height;var navigationRefY=(verticalOffset+heightOfNameLabel+heightOfMetaDataLabel+heightOfDescriptionLabel+heightOfIcon+internalPadding+(height-totalHeightOfLabels)/2)/height;if(configuration.icon){var iconRatio=getImageRatio(configuration.icon);var widthOfIcon=(heightOfIcon-ICON_PADDING)*iconRatio;var iconRefX=(width-widthOfIcon)/2/width;cell.attributes.attrs[".structurizrIcon"]["xlink:href"]=configuration.icon;cell.attributes.attrs[".structurizrIcon"]["width"]=widthOfIcon;cell.attributes.attrs[".structurizrIcon"]["height"]=heightOfIcon-ICON_PADDING;cell.attributes.attrs[".structurizrIcon"]["ref-x"]=iconRefX;cell.attributes.attrs[".structurizrIcon"]["ref-y"]=iconRefY;cell.attributes.attrs[".structurizrIcon"]["opacity"]=configuration.opacity/100}cell.attributes.attrs[".structurizrName"]["text"]=name;cell.attributes.attrs[".structurizrName"]["font-family"]=font.name;cell.attributes.attrs[".structurizrName"]["fill"]=color;cell.attributes.attrs[".structurizrName"]["font-size"]=configuration.fontSize+nameFontSizeDifference;cell.attributes.attrs[".structurizrName"]["ref-y"]=nameRefY;cell.attributes.attrs[".structurizrName"]["lineHeight"]=lineHeight;cell.attributes.attrs[".structurizrMetaData"]["text"]=metadata;cell.attributes.attrs[".structurizrMetaData"]["font-family"]=font.name;cell.attributes.attrs[".structurizrMetaData"]["fill"]=color;cell.attributes.attrs[".structurizrMetaData"]["font-size"]=configuration.fontSize+metaDataFontSizeDifference;cell.attributes.attrs[".structurizrMetaData"]["ref-y"]=metaDataRefY;cell.attributes.attrs[".structurizrMetaData"]["lineHeight"]=lineHeight;cell.attributes.attrs[".structurizrDescription"]["text"]=description;cell.attributes.attrs[".structurizrDescription"]["font-family"]=font.name;cell.attributes.attrs[".structurizrDescription"]["fill"]=color;cell.attributes.attrs[".structurizrDescription"]["font-size"]=configuration.fontSize;cell.attributes.attrs[".structurizrDescription"]["ref-y"]=descriptionRefY;cell.attributes.attrs[".structurizrDescription"]["lineHeight"]=lineHeight;cell.attributes.attrs[".structurizrNavigation"]["color"]=navigationColor;cell.attributes.attrs[".structurizrNavigation"]["ref-y"]=navigationRefY;cell._computedStyle={};cell._computedStyle.width=width;cell._computedStyle.height=height;cell._computedStyle.background=fill;cell._computedStyle.color=color;cell._computedStyle.borderStyle=configuration.border;cell._computedStyle.stroke=stroke;cell._computedStyle.opacity=configuration.opacity}function createBox(view,element,configuration,x,y,cornerRadius){var width=configuration.width;var height=configuration.height;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Box({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrBox":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,width:configuration.width,height:height,rx:cornerRadius,ry:cornerRadius}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrBox"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createEllipse(view,element,configuration,x,y,circle){if(circle){configuration.height=configuration.width}var width=configuration.width;var height=configuration.height;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Ellipse({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrEllipse":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,cx:configuration.width/2,cy:configuration.height/2,rx:configuration.width/2,ry:configuration.height/2}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrEllipse"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createHexagon(view,element,configuration,x,y){var width=Math.floor(configuration.width/2*Math.sqrt(3));var height=Math.floor(configuration.width/2*Math.sqrt(3));var points=configuration.width/4+",0 "+3*(configuration.width/4)+",0 "+configuration.width+","+height/2+" "+3*(configuration.width/4)+","+height+" "+configuration.width/4+","+height+" "+"0,"+height/2;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Hexagon({position:{x:x,y:y},size:{width:configuration.width,height:height},attrs:{".structurizrHexagon":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,points:points}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrHexagon"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.2,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createDiamond(view,element,configuration,x,y){var width=configuration.width;var height=configuration.height;var points=width/2+",0 "+width+","+height/2+" "+width/2+","+height+" "+"0,"+height/2;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Diamond({position:{x:x,y:y},size:{width:configuration.width,height:height},attrs:{".structurizrDiamond":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,points:points}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrDiamond"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.3,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createPerson(view,element,configuration,x,y){var width=configuration.width;var height=configuration.width-configuration.width/2.5;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Person({position:{x:x,y:y},size:{width:configuration.width,height:configuration.width},attrs:{".structurizrPersonHead":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,cx:configuration.width/2,cy:configuration.width/4.5,r:configuration.width/4.5},".structurizrPersonBody":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:0,y:configuration.width/2.5,width:configuration.width,height:height},".structurizrPersonRightArm":{stroke:stroke,"stroke-width":configuration.strokeWidth,x1:configuration.width/5,y1:configuration.width/1.5,x2:configuration.width/5,y2:configuration.width},".structurizrPersonLeftArm":{stroke:stroke,"stroke-width":configuration.strokeWidth,x1:configuration.width-configuration.width/5,y1:configuration.width/1.5,x2:configuration.width-configuration.width/5,y2:configuration.width}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrPersonHead"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrPersonBody"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrPersonRightArm"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrPersonLeftArm"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createRobot(view,element,configuration,x,y){var width=configuration.width;var height=configuration.width-configuration.width/2.5;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Robot({position:{x:x,y:y},size:{width:configuration.width,height:configuration.width},attrs:{".structurizrRobotHead":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:(configuration.width-configuration.width/2.25)/2,y:0,width:configuration.width/2.25,height:configuration.width/2.25},".structurizrRobotEars":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:(configuration.width-configuration.width/1.8)/2,y:(configuration.width/2.25-configuration.width/10)/2,width:configuration.width/1.8,height:configuration.width/10},".structurizrRobotBody":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:0,y:configuration.width/2.5,width:configuration.width,height:height},".structurizrRobotRightArm":{stroke:stroke,"stroke-width":configuration.strokeWidth,x1:configuration.width/5,y1:configuration.width/1.5,x2:configuration.width/5,y2:configuration.width},".structurizrRobotLeftArm":{stroke:stroke,"stroke-width":configuration.strokeWidth,x1:configuration.width-configuration.width/5,y1:configuration.width/1.5,x2:configuration.width-configuration.width/5,y2:configuration.width}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrRobotHead"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrRobotBody"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrRobotRightArm"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrRobotLeftArm"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createCylinder(view,element,configuration,x,y){var ry=60;var width=configuration.width;var height=configuration.height-ry/2;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var path="M 0,"+ry/2;path+=" a "+width/2+","+ry/2+" 0,0,0 "+width+" "+0;path+=" a "+width/2+","+ry/2+" 0,0,0 -"+width+" "+0;path+=" l 0,"+(configuration.height-ry);path+=" a "+width/2+","+ry/2+" 0,0,0 "+width+" "+0;path+=" l 0,-"+(configuration.height-ry);var cell=new structurizr.shapes.Cylinder({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrCylinderPath":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,d:path},".structurizrCylinderFace":{fill:"none",stroke:"none",width:configuration.width,height:configuration.height-ry/2,x:0,y:ry/2}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrCylinderPath"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,15);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createPipe(view,element,configuration,x,y){var rx=60;var width=configuration.width-rx/2;var height=configuration.height;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var path="M "+rx/2+",0";path+=" a "+rx/2+","+height/2+" 0,0,1 0 "+height;path+=" a "+rx/2+","+height/2+" 0,0,1 0 -"+height;path+=" l "+(configuration.width-rx)+",0";path+=" a "+rx/2+","+height/2+" 0,0,1 0 "+height;path+=" l -"+(configuration.width-rx)+",0";var cell=new structurizr.shapes.Pipe({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrPipePath":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,d:path},".structurizrPipeFace":{fill:"none",stroke:"none",width:configuration.width-rx/2,height:configuration.height,x:rx/2,y:0}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrPipePath"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createFolder(view,element,configuration,x,y){var tabHeight=configuration.height/8;var tabWidth=configuration.width/3;var width=configuration.width;var height=configuration.height-tabHeight;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Folder({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrFolderTab":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:10,y:0,width:tabWidth,height:tabHeight*2,rx:10,ry:10},".structurizrFolder":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:0,y:tabHeight,width:configuration.width,height:height,rx:5,ry:5}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrFolderTab"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrFolder"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createComponent(view,element,configuration,x,y){var width=configuration.width;var height=configuration.height;var blockWidth=width/6;var blockHeight=height/8;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Component({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrComponent":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:blockWidth/2,width:configuration.width-blockWidth/2,height:height,rx:10,ry:10},".structurizrComponentBlockTop":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:0,y:blockHeight*.6,width:blockWidth,height:blockHeight,rx:5,ry:5},".structurizrComponentBlockBottom":{fill:fill,stroke:stroke,"stroke-width":configuration.strokeWidth,x:0,y:blockHeight*2,width:blockWidth,height:blockHeight,rx:5,ry:5}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrComponent"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrComponentBlockTop"]["stroke-dasharray"]=borderStyles[configuration.border];cell.attributes.attrs[".structurizrComponentBlockBottom"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createWebBrowser(view,element,configuration,x,y){var width=configuration.width;var height=configuration.height;var webBrowserPanelWidth=configuration.width-20;var webBrowserPanelHeight=height-50;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.WebBrowser({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrWebBrowser":{fill:stroke,stroke:stroke,width:configuration.width,height:height,rx:10,ry:10},".structurizrWebBrowserPanel":{fill:fill,stroke:stroke,width:webBrowserPanelWidth,height:webBrowserPanelHeight,x:10,y:40,rx:10,ry:10},".structurizrWebBrowserUrlBar":{fill:fill,width:configuration.width-110,height:20,x:100,y:10,rx:10,ry:10},".structurizrWebBrowserButton1":{fill:fill,cx:20,cy:20,rx:10,ry:10},".structurizrWebBrowserButton2":{fill:fill,cx:50,cy:20,rx:10,ry:10},".structurizrWebBrowserButton3":{fill:fill,cx:80,cy:20,rx:10,ry:10}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrWebBrowser"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,webBrowserPanelWidth,webBrowserPanelWidth*.1,webBrowserPanelHeight,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createWindow(view,element,configuration,x,y){var width=configuration.width;var height=configuration.height;var windowPanelWidth=width-20;var windowPanelHeight=height-50;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var cell=new structurizr.shapes.Window({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrWindow":{fill:stroke,stroke:stroke,width:configuration.width,height:height,rx:10,ry:10},".structurizrWindowPanel":{fill:fill,stroke:stroke,width:windowPanelWidth,height:windowPanelHeight,x:10,y:40,rx:10,ry:10},".structurizrWindowButton1":{fill:fill,cx:20,cy:20,rx:10,ry:10},".structurizrWindowButton2":{fill:fill,cx:50,cy:20,rx:10,ry:10},".structurizrWindowButton3":{fill:fill,cx:80,cy:20,rx:10,ry:10}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrWindow"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,windowPanelWidth,windowPanelWidth*.1,windowPanelHeight,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createMobileDevicePortrait(view,element,configuration,x,y){var width=configuration.width;var height=configuration.height;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var speakerLength=50;var cell=new structurizr.shapes.MobileDevice({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrMobileDevice":{fill:stroke,stroke:stroke,width:configuration.width,height:height,rx:20,ry:20},".structurizrMobileDeviceDisplay":{fill:fill,stroke:stroke,width:configuration.width-20,height:configuration.height-80,x:10,y:40,rx:5,ry:5},".structurizrMobileDeviceButton":{fill:fill,cx:configuration.width/2,cy:height-20,rx:10,ry:10},".structurizrMobileDeviceSpeaker":{stroke:fill,x1:(configuration.width-speakerLength)/2,y1:20,x2:configuration.width-(configuration.width-speakerLength)/2,y2:20}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrMobileDevice"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createMobileDeviceLandscape(view,element,configuration,x,y){var width=configuration.width;var height=configuration.height;var fill=structurizr.util.shadeColor(configuration.background,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var speakerLength=50;var cell=new structurizr.shapes.MobileDevice({position:{x:x,y:y},size:{width:configuration.width,height:configuration.height},attrs:{".structurizrMobileDevice":{fill:stroke,stroke:stroke,width:configuration.width,height:height,rx:20,ry:20},".structurizrMobileDeviceDisplay":{fill:fill,stroke:stroke,width:configuration.width-80,height:height-20,x:40,y:10,rx:5,ry:5},".structurizrMobileDeviceButton":{fill:fill,cx:20,cy:height/2,rx:10,ry:10},".structurizrMobileDeviceSpeaker":{stroke:fill,x1:configuration.width-20,y1:(configuration.height-speakerLength)/2,x2:configuration.width-20,y2:configuration.height-(configuration.height-speakerLength)/2}},element:element});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrMobileDevice"]["stroke-dasharray"]=borderStyles[configuration.border]}renderElementInternals(element,cell,configuration,width,width*.1,height,0);graph.addCell(cell);mapOfIdToBox[element.id]=cell;return cell}function createDiagramMetadata(){var titleColor;var metadataColor;if(darkMode===true){titleColor="#bbbbbb";metadataColor="#777777"}else{titleColor="#000000";metadataColor="#aaaaaa"}var title=structurizr.ui.getTitleForView(currentView);diagramMetadataWidth=title.length*30;diagramTitle=new structurizr.shapes.DiagramTitle({attrs:{".structurizrDiagramTitle":{text:title,"font-family":font.name,fill:titleColor}}});graph.addCell(diagramTitle);diagramTitle.toBack();var description="";if(currentFilter&&currentFilter.description){description=currentFilter.description}else if(currentView.description){description=currentView.description}if(description!==undefined&&description.length>0){diagramDescription=new structurizr.shapes.DiagramDescription({attrs:{".structurizrDiagramDescription":{text:description,"font-family":font.name,fill:metadataColor}}});diagramMetadataWidth=Math.max(diagramMetadataWidth,description.length*20);graph.addCell(diagramDescription);diagramDescription.toBack()}else{diagramDescription=undefined}const timezone=structurizr.workspace.views.configuration.properties["structurizr.timezone"];const locale=structurizr.workspace.views.configuration.properties["structurizr.locale"];const options={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZone:timezone,timeZoneName:"long"};var metadata;if(structurizr.workspace.id===0){metadata=(new Date).toLocaleString(locale,options)}else{const lastModified=structurizr.workspace.lastModifiedDate;if(lastModified){metadata=new Date(lastModified).toLocaleString(locale,options)}const version=structurizr.workspace.version;if(version){if(metadata){metadata+=" | "}else{metadata=""}metadata+="Version: "+version}}diagramMetadata=new structurizr.shapes.DiagramMetadata({attrs:{".structurizrDiagramMetadata":{text:metadata,"font-family":font.name,fill:metadataColor}}});graph.addCell(diagramMetadata);diagramMetadata.toBack();var branding=structurizr.ui.getBranding();if(branding.logo){brandingLogo=new structurizr.shapes.BrandingImage({size:{width:getImageRatio(branding.logo)*100,height:100},attrs:{image:{"xlink:href":branding.logo,width:getImageRatio(branding.logo)*100,height:100}}});graph.addCell(brandingLogo);brandingLogo.toBack()}repositionDiagramMetadata()}function repositionDiagramMetadata(){const verticalOffset=diagramHeight-120;if(diagramTitle){var x=20;const logoPadding=40;if(brandingLogo){brandingLogo.set({position:{x:20,y:verticalOffset}});x=brandingLogo.get("size").width+logoPadding}const titleHeight=44;const metadataHeight=75;if(diagramDescription!==undefined){diagramTitle.set({position:{x:x,y:verticalOffset}});diagramDescription.set({position:{x:x,y:verticalOffset+titleHeight}})}else{diagramTitle.set({position:{x:x,y:verticalOffset+(metadataHeight-titleHeight)}})}diagramMetadata.set({position:{x:x,y:verticalOffset+metadataHeight}})}}function calculateHeight(text,fontSize,fontSizeDelta,addPadding){var lineSpacing=1.25;if(text){text=text.trim();if(text.length===0){return 0}else{var numberOfLines=text.split("\n").length;if(addPadding){numberOfLines++}return numberOfLines*((fontSize+fontSizeDelta)*lineSpacing)}}else{return 0}}function formatName(element,configuration,horizontalPadding){return breakText(element.name?element.name:"",Math.max(0,configuration.width-horizontalPadding),font.name,configuration.fontSize+nameFontSizeDifference)}function formatDescription(element,configuration,horizontalPadding){if(descriptionEnabled===false){return""}if(configuration.description!==undefined&&configuration.description===false){return""}else{return breakText(element.description?element.description:"",Math.max(0,configuration.width-horizontalPadding),font.name,configuration.fontSize)}}function formatMetaData(element,configuration,horizontalPadding){if(metadataEnabled===false){return""}if(element.type==="Custom"&&(element.metadata===undefined||element.metadata==="")){return""}if(configuration.metadata!==undefined&&configuration.metadata===false){return""}else{var metadata=breakText(structurizr.ui.getMetadataForElement(element,true),configuration.width-horizontalPadding,font.name,configuration.fontSize+metaDataFontSizeDifference);if(currentView.type==="Deployment"){if(element.type==="ContainerInstance"){var container=structurizr.workspace.findElementById(element.containerId);if(container){if(currentView.softwareSystemId===undefined||container.parentId!==currentView.softwareSystemId){var softwareSystem=structurizr.workspace.findElementById(container.parentId);metadata="from "+softwareSystem.name+"\n"+metadata}}}}return metadata}}function formatTechnologyForRelationship(relationship){if(metadataEnabled===false){return""}return structurizr.ui.getMetadataForRelationship(relationship)}function breakText(text,width,font,fontSize){var characterWidth=fontSize*.75;if(text&&text.length*characterWidth>width){return joint.util.breakText(text,{width:width},{font:font,"font-size":fontSize+"px"})}else{return text}}function calculateStrokeDashArray(thickness){return"30 30"}function calculateStrokeDottedArray(thickness){return"5 5"}function calculateArrowHead(thickness){var width=thickness*10;if(width>50){width=50}var height=width;return"M "+height+" 0 L 0 "+width/2+" L "+height+" "+width+" z"}function removeIllegalElements(){try{if(currentView.type==="Container"){const softwareSystemIdsToRemove=[];currentView.elements.forEach(function(elementInView){var element=structurizr.workspace.findElementById(elementInView.id);if(element.type==="Container"&&element.parentId!==currentView.softwareSystemId){if(softwareSystemIdsToRemove.indexOf(element.parentId)===-1){softwareSystemIdsToRemove.push(element.parentId)}}});for(var i=0;i<softwareSystemIdsToRemove.length;i++){for(var j=0;j<currentView.elements.length;j++){if(currentView.elements[j].id===softwareSystemIdsToRemove[i]){console.log("Removing software system with ID "+softwareSystemIdsToRemove[i]+" because one of it's child containers is included on the diagram");currentView.elements.splice(j,1)}}}}if(currentView.type==="Component"){const softwareSystemIdsToRemove=[];const containerIdsToRemove=[];currentView.elements.forEach(function(elementInView){var element=structurizr.workspace.findElementById(elementInView.id);if(element.type==="Component"&&element.parentId!==currentView.containerId){if(containerIdsToRemove.indexOf(element.parentId)===-1){containerIdsToRemove.push(element.parentId)}var foreignContainer=structurizr.workspace.findElementById(element.parentId);if(foreignContainer&&softwareSystemIdsToRemove.indexOf(foreignContainer.parentId)===-1){softwareSystemIdsToRemove.push(foreignContainer.parentId)}}else if(element.type==="Container"&&element.id!==currentView.containerId){if(softwareSystemIdsToRemove.indexOf(element.parentId)===-1){softwareSystemIdsToRemove.push(element.parentId)}}});for(var i=0;i<softwareSystemIdsToRemove.length;i++){for(var j=0;j<currentView.elements.length;j++){if(currentView.elements[j].id===softwareSystemIdsToRemove[i]){console.log("Removing software system with ID "+softwareSystemIdsToRemove[i]+" because one of it's child containers is included on the diagram");currentView.elements.splice(j,1)}}}for(var i=0;i<containerIdsToRemove.length;i++){for(var j=0;j<currentView.elements.length;j++){if(currentView.elements[j].id===containerIdsToRemove[i]){console.log("Removing container with ID "+containerIdsToRemove[i]+" because one of it's child components is included on the diagram");currentView.elements.splice(j,1)}}}}}catch(err){console.log(err)}}function includeElementOnDiagram(element){return includeOnDiagram(structurizr.workspace.getAllTagsForElement(element))}function includeRelationshipOnDiagram(relationship){return includeOnDiagram(structurizr.workspace.getAllTagsForRelationship(relationship))}function includeOnDiagram(tags){if(currentFilter){if(currentFilter.mode==="Include"){var include=false;if(currentFilter.tags){currentFilter.tags.forEach(function(tag){tag=tag.trim();include=include||tags.indexOf(tag)>-1})}return include}else{var exclude=false;if(currentFilter.tags){currentFilter.tags.forEach(function(tag){tag=tag.trim();exclude=exclude||tags.indexOf(tag)>-1})}return!exclude}}else{return true}}function createArrow(relationshipInView){var internalPadding=10;var relationship=structurizr.workspace.findRelationshipById(relationshipInView.id);if(!includeRelationshipOnDiagram(relationship)){return}if(mapOfIdToBox[relationship.sourceId]&&mapOfIdToBox[relationship.destinationId]){var configuration;if(currentView.type==="Dynamic"&&relationshipInView.response!==undefined&&relationshipInView.response===true){var originalTags=relationship.tags;relationship.tags=relationship.tags+",Relationship/Response";configuration=structurizr.ui.findRelationshipStyle(relationship,darkMode);relationship.tags=originalTags}else{configuration=structurizr.ui.findRelationshipStyle(relationship,darkMode)}var strokeDashArray;if(configuration.style==="Dashed"){strokeDashArray=calculateStrokeDashArray(configuration.thickness)}else if(configuration.style==="Dotted"){strokeDashArray=calculateStrokeDottedArray(configuration.thickness)}var triangle=calculateArrowHead(configuration.thickness);var description="";if(currentView.type===structurizr.constants.DYNAMIC_VIEW_TYPE){if(relationshipInView.description){description=relationshipInView.description}else if(relationship.description){description=relationship.description}if(relationshipInView.order){description=relationshipInView.order+": "+description}}else{if(relationship.description){description=relationship.description}}description=breakText(description,configuration.width,font.name,configuration.fontSize);var heightOfDescription=calculateHeight(description,configuration.fontSize,0,false);var fill=structurizr.util.shadeColor(configuration.color,100-configuration.opacity,darkMode);var routing=configuration.routing;if(relationshipInView.routing!==undefined){routing=relationshipInView.routing}var position=configuration.position;if(relationshipInView.position!==undefined){position=relationshipInView.position}var sourceBox;var destinationBox;if(relationshipInView.response!==undefined&&relationshipInView.response===true){destinationBox=mapOfIdToBox[relationship.sourceId];sourceBox=mapOfIdToBox[relationship.destinationId]}else{sourceBox=mapOfIdToBox[relationship.sourceId];destinationBox=mapOfIdToBox[relationship.destinationId]}var labels=[];var verticalOffset=0;labels.push({position:{distance:position/100,offset:{x:0,y:verticalOffset}},attrs:{rect:{fill:canvasColor,stroke:canvasColor,"stroke-width":"20px","pointer-events":"none"},text:{text:description,fill:fill,"font-family":font.name,"font-weight":"normal","font-size":configuration.fontSize+"px","pointer-events":"none",lineHeight:lineHeight}}});verticalOffset=(heightOfDescription+configuration.fontSize)/2;var technology=formatTechnologyForRelationship(relationship);if(technology&&technology.trim().length>0){labels.push({position:{distance:position/100,offset:{x:0,y:verticalOffset}},attrs:{rect:{fill:canvasColor,"pointer-events":"none"},text:{text:technology,fill:fill,"font-family":font.name,"font-weight":"normal","font-size":configuration.fontSize+metaDataFontSizeDifference+"px","pointer-events":"none",lineHeight:lineHeight}}});var heightOfTechnology=calculateHeight(technology,configuration.fontSize,metaDataFontSizeDifference,false);verticalOffset+=heightOfTechnology-configuration.fontSize/2}labels.push({position:{distance:position/100,offset:{x:-10,y:verticalOffset}},attrs:{rect:{class:"structurizrNavigation"}}});var link=new structurizr.shapes.Relationship({source:{id:sourceBox.id},target:{id:destinationBox.id},labels:labels});if(configuration.style===undefined||configuration.style==="Dashed"||configuration.style==="Dotted"){link.attr({".connection":{stroke:fill,"stroke-width":configuration.thickness,"stroke-dasharray":strokeDashArray,fill:"none"},".connection-wrap":{fill:"none"},".marker-target":{stroke:fill,fill:fill,d:triangle},".link-tools":{display:"none"},".marker-arrowheads":{display:"none"}})}else{link.attr({".connection":{stroke:fill,"stroke-width":configuration.thickness,fill:"none"},".connection-wrap":{fill:"none"},".marker-target":{stroke:fill,fill:fill,d:triangle},".link-tools":{display:"none"},".marker-arrowheads":{display:"none"}})}setRoutingAndConnector(link,routing);link.relationshipInView=relationshipInView;if(relationshipInView.vertices){link.set("vertices",relationshipInView.vertices)}link.on("change:vertices",function(event){var vertices=link.get("vertices");if(vertices){link.relationshipInView.vertices=vertices;fireWorkspaceChangedEvent()}});graph.addCell(link);link._computedStyle={};link._computedStyle.color=fill;link._computedStyle.lineStyle=configuration.style;if(relationshipInView.order){mapOfIdToLine[relationshipInView.id+"/"+relationshipInView.order]=link}else{mapOfIdToLine[relationshipInView.id]=link}if(navigationEnabled){addDoubleClickHandlerForRelationship(paper.findViewByModel(link),relationship)}return link}else{console.log("Not rendering relationship "+relationship.id+" ("+structurizr.workspace.findElementById(relationship.sourceId).name+" -> "+structurizr.workspace.findElementById(relationship.destinationId).name+") because the source and destination elements are not on the diagram.")}}function setRoutingAndConnector(link,routing){if(routing===undefined||routing==="Direct"){link.unset("router");link.set("connector",{name:"rounded"})}else if(routing==="Orthogonal"){link.set("router",{name:"orthogonal"});link.set("connector",{name:"rounded"})}else if(routing==="Curved"){link.unset("router");link.set("connector",{name:"smooth"})}}function adjustVertices(graph,link){var srcId=link.get("source").id||link.previous("source").id;var trgId=link.get("target").id||link.previous("target").id;if(!srcId||!trgId)return;var siblings=_.filter(graph.getLinks(),function(sibling){var _srcId=sibling.get("source").id;var _trgId=sibling.get("target").id;return _srcId===srcId&&_trgId===trgId||_srcId===trgId&&_trgId===srcId});switch(siblings.length){case 0:break;case 1:break;default:var numberOfSiblingsWithoutVertices=0;siblings.forEach(function(sibling){if(sibling.relationshipInView.vertices===undefined||sibling.relationshipInView.vertices.length===0){numberOfSiblingsWithoutVertices++}});if(numberOfSiblingsWithoutVertices>=2){var srcCenter=graph.getCell(srcId).getBBox().center();var trgCenter=graph.getCell(trgId).getBBox().center();var midPoint=joint.g.line(srcCenter,trgCenter).midpoint();var theta=srcCenter.theta(trgCenter);var gap=150;_.each(siblings,function(sibling,index){var offsetIndex=index;if(siblings.length%2===0){offsetIndex++}var offset=gap*Math.ceil(offsetIndex/2);var sign=index%2?1:-1;var angle=joint.g.toRad(theta+sign*90);var vertex=joint.g.point.fromPolar(offset,angle,midPoint);sibling.set("vertices",[{x:vertex.x,y:vertex.y}])})}}}function createBoundaryForGroup(name){return createBoundary(name,undefined,"Group",undefined)}function createBoundary(name,metadata,type,element){var elementStyle;var defaultColours=defaultBoundaryColoursLight;if(darkMode===true){defaultColours=defaultBoundaryColoursDark}var textColor;var stroke;var icon;var strokeWidth=2;var dashArray="20,20";var nameText=name;if(type==="Group"){dashArray="5,5";elementStyle=structurizr.ui.findElementStyle({type:"Boundary",tags:"Group, Group:"+name});icon=elementStyle.icon;strokeWidth=elementStyle.strokeWidth;if(useNestedGroups()){const separator=getGroupSeparator();nameText=name.substring(name.lastIndexOf(separator)+separator.length)}stroke=elementStyle.stroke;if(stroke===undefined){stroke=elementStyle.color}if(stroke===undefined){stroke=defaultColours[type]}textColor=elementStyle.color;if(textColor===undefined){textColor=defaultColours[type]}textColor=structurizr.util.shadeColor(textColor,100-elementStyle.opacity,darkMode);stroke=structurizr.util.shadeColor(stroke,100-elementStyle.opacity,darkMode)}else if(type==="Enterprise"){elementStyle=structurizr.ui.findElementStyle({type:"Boundary",tags:"Boundary, Boundary:Enterprise"});icon=elementStyle.icon;strokeWidth=elementStyle.strokeWidth;stroke=elementStyle.stroke;if(stroke===undefined){stroke=elementStyle.color}if(stroke===undefined){stroke=defaultColours[type]}textColor=elementStyle.color;if(textColor===undefined){textColor=defaultColours[type]}textColor=structurizr.util.shadeColor(textColor,100-elementStyle.opacity,darkMode);stroke=structurizr.util.shadeColor(stroke,100-elementStyle.opacity,darkMode)}else if(element!==undefined){elementStyle=structurizr.ui.findElementStyle({type:"Boundary",tags:"Boundary, Boundary:"+element.type});const elementStyleForBoundaryElement=structurizr.ui.findElementStyle(element);strokeWidth=elementStyle.strokeWidth;icon=elementStyle.icon;if(icon===undefined){icon=elementStyleForBoundaryElement.icon}stroke=elementStyle.stroke;if(stroke===undefined){stroke=elementStyle.color}if(stroke===undefined){stroke=elementStyleForBoundaryElement.stroke}textColor=elementStyle.color;if(textColor===undefined){textColor=elementStyleForBoundaryElement.stroke}textColor=structurizr.util.shadeColor(textColor,100-elementStyle.opacity,darkMode);stroke=structurizr.util.shadeColor(stroke,100-elementStyle.opacity,darkMode)}var heightOfIcon=elementStyle.fontSize;if(metadata!==undefined){heightOfIcon=heightOfIcon*2;if(elementStyle!==undefined&&elementStyle.metadata!==undefined&&elementStyle.metadata===false){metadata=""}}else{metadata=""}var boundary=new structurizr.shapes.Boundary({attrs:{".structurizrBoundary":{stroke:stroke,fill:canvasColor,"stroke-width":strokeWidth,"stroke-dasharray":dashArray},".structurizrName":{text:nameText,"font-family":font.name,"font-size":elementStyle.fontSize+"px",fill:textColor},".structurizrMetaData":{text:metadata,"font-family":font.name,"font-size":elementStyle.fontSize+metaDataFontSizeDifference+"px",fill:textColor}}});graph.addCell(boundary);boundary._computedStyle={};boundary._computedStyle.background=canvasColor;boundary._computedStyle.color=textColor;boundary._computedStyle.borderStyle="Dashed";boundary._computedStyle.stroke=stroke;boundary._computedStyle.fontSize=elementStyle.fontSize;if(icon){var iconRatio=getImageRatio(icon);var widthOfIcon=heightOfIcon*iconRatio;boundary.attributes.attrs[".structurizrIcon"]["xlink:href"]=icon;boundary.attributes.attrs[".structurizrIcon"]["width"]=widthOfIcon;boundary.attributes.attrs[".structurizrIcon"]["height"]=heightOfIcon;boundary.attributes.attrs[".structurizrIcon"]["opacity"]=elementStyle.opacity/100;boundary._computedStyle.icon=icon}var cellView=paper.findViewByModel(boundary);$("#"+cellView.id).attr("style","cursor: "+(editable===true?"move":"default")+" !important");return boundary}function createDeploymentNode(element){var configuration=structurizr.ui.findElementStyle(element,darkMode);var textColor=structurizr.util.shadeColor(configuration.color,100-configuration.opacity,darkMode);var stroke=structurizr.util.shadeColor(configuration.stroke,100-configuration.opacity,darkMode);var strokeWidth=configuration.strokeWidth;var instanceCount="";if(element.instances&&element.instances!=="1"){instanceCount="x"+element.instances}var metadata="";var heightOfIcon=configuration.fontSize;if(configuration.metadata!==undefined&&configuration.metadata===false){metadata=""}else{metadata=structurizr.ui.getMetadataForElement(element,true);heightOfIcon=heightOfIcon*2}var cell=new structurizr.shapes.DeploymentNode({attrs:{".structurizrDeploymentNode":{stroke:stroke,"stroke-width":strokeWidth,fill:canvasColor},".structurizrName":{text:element.name,"font-family":font.name,"font-size":configuration.fontSize+"px",fill:textColor},".structurizrMetaData":{text:metadata,"font-family":font.name,"font-size":configuration.fontSize+metaDataFontSizeDifference+"px",fill:textColor},".structurizrInstanceCount":{text:instanceCount,"font-family":font.name,fill:textColor},".structurizrIcon":{}}});if(configuration.border!=="Solid"){cell.attributes.attrs[".structurizrDeploymentNode"]["stroke-dasharray"]=borderStyles[configuration.border]}graph.addCell(cell);cell.toBack();mapOfIdToBox[element.id]=cell;cell._computedStyle={};cell._computedStyle.background=canvasColor;cell._computedStyle.color=textColor;cell._computedStyle.borderStyle=configuration.border;cell._computedStyle.stroke=stroke;cell._computedStyle.fontSize=configuration.fontSize;cell._computedStyle.opacity=configuration.opacity;if(configuration.icon){var iconRatio=getImageRatio(configuration.icon);var widthOfIcon=heightOfIcon*iconRatio;cell.attributes.attrs[".structurizrIcon"]["xlink:href"]=configuration.icon;cell.attributes.attrs[".structurizrIcon"]["width"]=widthOfIcon;cell.attributes.attrs[".structurizrIcon"]["height"]=heightOfIcon;cell.attributes.attrs[".structurizrIcon"]["opacity"]=configuration.opacity/100;cell._computedStyle.icon=configuration.icon}var cellView=paper.findViewByModel(cell);const domElement=$("#"+cellView.id);domElement.attr("style","cursor: "+(editable===true?"move":"default")+" !important");if(editable===true){domElement.attr("style","cursor: move !important")}else{domElement.attr("style","cursor: default !important")}if(navigationEnabled){addDoubleClickHandlerForElement(cellView,element)}return cell}function centreCell(cell){var width=cell.get("size").width;var height=cell.get("size").height;var x=(diagramWidth-width)/2;var y=(diagramHeight-height)/2;cell.set({position:{x:x,y:y}})}this.setPaperSize=function(view){if(view.dimensions!==undefined){if(view.paperSize!==undefined){var dimensions=(new structurizr.ui.PaperSizes).getDimensions(view.paperSize);if(dimensions.width===view.dimensions.width&&dimensions.height===view.dimensions.height){this.changePaperSize(view.paperSize)}else{$("#pageSize option#none").prop("selected",true)}}else{view.dimensions.width=Math.max(view.dimensions.width,diagramMetadataWidth);$("#pageSize option#none").prop("selected",true)}this.setPageSize(view.dimensions.width,view.dimensions.height)}else{if(view.paperSize===undefined){view.paperSize="A5_Landscape"}this.changePaperSize(view.paperSize)}};this.changePaperSize=function(paperSize){currentView.paperSize=paperSize;$("#pageSize option#"+paperSize).prop("selected",true);var dimensions=(new structurizr.ui.PaperSizes).getDimensions(paperSize);this.setPageSize(dimensions.width,dimensions.height)};function reposition(parentCell){var padding;var metadataText;var fontSize;if(parentCell&&parentCell.getEmbeddedCells().length>0){metadataText=parentCell.attr(".structurizrMetaData").text;fontSize=parentCell._computedStyle.fontSize;if(parentCell.elementInView&&parentCell.positionCalculated===false){var element=structurizr.workspace.findElementById(parentCell.elementInView.id);if(element.type==="DeploymentNode"){padding={top:50,right:50,bottom:50,left:50}}}else{padding={top:20,right:20,bottom:50,left:20}}if(metadataText&&metadataText.length>0){padding.bottom=padding.bottom+fontSize+fontSize+metaDataFontSizeDifference}else{padding.bottom=padding.bottom+fontSize}var minX=Number.MAX_VALUE;var maxX=Number.MIN_VALUE;var minY=Number.MAX_VALUE;var maxY=Number.MIN_VALUE;var embeddedCells=parentCell.getEmbeddedCells();for(var i=0;i<embeddedCells.length;i++){var cell=embeddedCells[i];var x=cell.get("position").x;var y=cell.get("position").y;var width=cell.get("size").width;var height=cell.get("size").height;minX=Math.min(minX,x);maxX=Math.max(maxX,x+width);minY=Math.min(minY,y);maxY=Math.max(maxY,y+height)}padding={top:padding.top,right:padding.right,bottom:padding.bottom,left:padding.left};var newWidth=maxX-minX+padding.left+padding.right;var newHeight=maxY-minY+padding.top+padding.bottom;var newX=minX-padding.left;var newY=minY-padding.top;var margin=15;var refX=margin/newWidth;if(parentCell._computedStyle.icon!==undefined){var iconWidth=parentCell.attr(".structurizrIcon")["width"];var iconHeight=parentCell.attr(".structurizrIcon")["height"];parentCell.attr({".structurizrIcon":{x:margin,y:newHeight-iconHeight-10}});refX=(margin+10+iconWidth)/newWidth}parentCell.position(newX,newY);parentCell.attr({rect:{width:newWidth,height:newHeight}});parentCell.resize(newWidth,newHeight);if(metadataText&&metadataText.length>0){parentCell.attr({".structurizrName":{"ref-x":refX,y:newHeight-(15+fontSize)},".structurizrMetaData":{"ref-x":refX,y:newHeight-15},".structurizrInstanceCount":{"ref-x":(newWidth-margin)/newWidth,y:newHeight-15}})}else{parentCell.attr({".structurizrName":{"ref-x":refX,y:newHeight-15},".structurizrMetaData":{"ref-x":refX,y:newHeight-15},".structurizrInstanceCount":{"ref-x":(newWidth-margin)/newWidth,y:newHeight-15}})}}}this.gatherElementsOnCanvas=function(){var previousPositions=[];for(var i=0;i<graph.getElements().length;i++){var cell=graph.getElements()[i];var x=cell.get("position").x;var y=cell.get("position").y;var width=cell.get("size").width;var height=cell.get("size").height;var maxX=diagramWidth-width;var maxY=diagramHeight-height;if(x<0||x>maxX||y<0||y>maxY){previousPositions.push(getCurrentElementPositions([paper.findViewByModel(cell)])[0])}x=Math.min(Math.max(0,x),maxX);y=Math.min(Math.max(0,y),maxY);cell.set({position:{x:x,y:y}})}var links=graph.getLinks();if(links){links.forEach(function(link){var oldVertices=link.get("vertices");var newVertices=[];var moved=false;if(oldVertices){oldVertices.forEach(function(vertex){var x=Math.min(Math.max(0,vertex.x),diagramWidth);var y=Math.min(Math.max(0,vertex.y),diagramHeight);if(x!==vertex.x||y!==vertex.y){moved=true}newVertices.push({x:x,y:y})});if(moved){previousPositions.push(getCurrentLinkPositions([link])[0]);link.set("vertices",newVertices)}}})}if(previousPositions.length>0){addToUndoBuffer(previousPositions)}};this.zoomFitWidth=function(){this.zoomTo((viewport.innerWidth()-scrollBarWidth)/diagramWidth);this.scrollToCentre()};this.zoomFitHeight=function(){this.zoomTo(viewport.innerHeight()/diagramHeight);this.scrollToCentre()};this.zoomFitContent=function(){if(!currentView.elements){this.zoomFitHeight();return}var contentArea=findContentArea(true,50);var contentWidth=contentArea.maxX-contentArea.minX;var contentHeight=contentArea.maxY-contentArea.minY;var viewportRatio=viewport.width()/viewport.height();var contentRatio=contentWidth/contentHeight;if(viewportRatio>contentRatio){this.zoomTo(viewport.height()/contentHeight)}else{this.zoomTo(viewport.width()/contentWidth)}var viewportWidth=viewport.innerWidth();var viewportHeight=viewport.innerHeight();var viewpointCentreX=viewport.offset().left+viewportWidth/2;var viewpointCentreY=viewport.offset().top+viewportHeight/2;var clientTarget={x:viewpointCentreX,y:viewpointCentreY};var centreX=contentArea.minX+(contentArea.maxX-contentArea.minX)/2;var centreY=contentArea.minY+(contentArea.maxY-contentArea.minY)/2;this.scrollToPoint(centreX,centreY,clientTarget.x,clientTarget.y)};this.zoomIn=function(evt){zoomToAndScroll(Math.min(scale+zoomDelta,maxZoomScale),evt)};this.zoomOut=function(evt){zoomToAndScroll(Math.max(scale-zoomDelta,minZoomScale),evt)};function zoomToAndScroll(zoomScale,evt){var viewportWidth=viewport.innerWidth();var viewportHeight=viewport.innerHeight();var clientTarget;if(evt!==undefined){clientTarget={x:evt.clientX,y:evt.clientY}}else{var viewpointCentreX=viewport.offset().left+viewportWidth/2;var viewpointCentreY=viewport.offset().top+viewportHeight/2;clientTarget={x:viewpointCentreX,y:viewpointCentreY}}var localPointBeforeZooming=paper.clientToLocalPoint(clientTarget.x,clientTarget.y);self.zoomTo(zoomScale);self.scrollToPoint(localPointBeforeZooming.x,localPointBeforeZooming.y,clientTarget.x,clientTarget.y)}this.scrollToCentre=function(){var viewportWidth=viewport.innerWidth();var viewportHeight=viewport.innerHeight();var viewpointCentreX=viewport.offset().left+viewportWidth/2;var viewpointCentreY=viewport.offset().top+viewportHeight/2;var clientTarget={x:viewpointCentreX,y:viewpointCentreY};var centreX=diagramWidth/2;var centreY=diagramHeight/2;this.scrollToPoint(centreX,centreY,clientTarget.x,clientTarget.y)};this.scrollToPoint=function(paperX,paperY,clientX,clientY){var clientPoint=paper.localToClientPoint(paperX,paperY);if(clientPoint.x>clientX){var diff=clientPoint.x-clientX;viewport.scrollLeft(viewport.scrollLeft()+diff)}else{var diff=clientX-clientPoint.x;viewport.scrollLeft(viewport.scrollLeft()-diff)}if(clientPoint.y>clientY){var diff=clientPoint.y-clientY;viewport.scrollTop(viewport.scrollTop()+diff)}else{var diff=clientY-clientPoint.y;viewport.scrollTop(viewport.scrollTop()-diff)}};this.zoomTo=function(zoomScale){if(zoomScale>maxZoomScale){scale=maxZoomScale}else{scale=zoomScale}var width=Math.round(diagramWidth*scale);var height=Math.round(diagramHeight*scale);canvas.width(width);canvas.height(height);var svg=$("#v-2");svg.width(width);svg.height(height);if(width>viewport.innerWidth()){viewport.css("overflow-x","scroll")}else{viewport.css("overflow-x","hidden")}if(height>viewport.innerHeight()){viewport.css("overflow-y","scroll")}else{viewport.css("overflow-y","hidden")}paper.scale(scale)};this.getPossibleViewportWidth=function(){return parentElement.innerWidth()};this.getPossibleViewportHeight=function(){return parentElement.innerHeight()};this.zoomToWidthOrHeight=function(){var viewportRatio=viewport.innerWidth()/viewport.innerHeight();var diagramRatio=diagramWidth/diagramHeight;if(diagramRatio<viewportRatio){this.zoomFitHeight()}else{this.zoomFitWidth()}setZoomAndMargins()};this.resize=function(){viewport.width(this.getPossibleViewportWidth());if(!embedded||structurizr.ui.isFullScreen()){var height=this.getPossibleViewportHeight();viewport.height(height);$("#diagramNavigationPanel").height(height)}else{var diagramRatio=diagramWidth/diagramHeight;var height=Math.floor(viewport.width()/diagramRatio);viewport.height(height);$("#diagramNavigationPanel").height(height)}};this.onElementsSelected=function(callback){elementsSelectedEventHandler=callback};this.onElementDoubleClicked=function(callback){elementDoubleClickedHandler=callback};this.onRelationshipDoubleClicked=function(callback){relationshipDoubleClickedHandler=callback};function fireElementsSelectedEvent(){if(elementsSelectedEventHandler){elementsSelectedEventHandler(selectedElements.map(function(cell){return cell.model.elementInView.id}))}}function selectElement(cellView){cellView.selected=true;var structurizrBox=$("#"+cellView.el.id+" .structurizrHighlightableElement");var classes=structurizrBox.attr("class");structurizrBox.attr("class",classes+" highlightedElement");selectedElements.push(cellView);fireElementsSelectedEvent()}this.selectElementsWithName=function(regex){var filter=new RegExp(regex);graph.getElements().forEach(function(element){if(element.elementInView&&element.positionCalculated===false){var elementInModel=structurizr.workspace.findElementById(element.elementInView.id);if(elementInModel.name.match(filter)){var cellView=paper.findViewByModel(element);selectElement(cellView)}}})};this.selectAllElements=function(){graph.getElements().forEach(function(element){if(element.elementInView&&element.positionCalculated===false){var cellView=paper.findViewByModel(element);if(cellView.selected===undefined||cellView.selected===false){selectElement(cellView)}}})};this.deselectAllElements=function(){for(var i=selectedElements.length-1;i>=0;i--){deselectElement(selectedElements[i])}};function deselectElement(cellView){cellView.selected=false;var structurizrBox=$("#"+cellView.el.id+" .structurizrHighlightableElement");var classes=structurizrBox.attr("class");var highlightedElement=classes.indexOf(" highlightedElement");if(highlightedElement>-1){structurizrBox.attr("class",classes.substring(0,highlightedElement))}var index=selectedElements.indexOf(cellView);if(index>-1){selectedElements.splice(index,1)}fireElementsSelectedEvent()}function createTagsList(style,defaultTag){var tags=undefined;if(style.tags){style.tags.forEach(function(tag){if(tag!==defaultTag){if(!tags){tags=tag}else{tags=tags+", "+tag}}})}if(!tags){tags=defaultTag}return tags}function getImageRatio(image){return getImageMetadata(image).ratio}function getImageMetadata(image){return imageMetadata.filter(function(im){return im.src===image})[0]}function createDiagramKey(){var keyElementWidth=450;var keyElementHeight=300;var fontSize="30px";var elementStylesInUse=[];var elementStylesInUseMap={};var elementsInView=currentView.elements.map(function(element){return structurizr.workspace.findElementById(element.id)});for(var i=0;i<elementsInView.length;i++){var elementInView=elementsInView[i];if(elementInView.type==="DeploymentNode"){var elementStyle=structurizr.ui.findElementStyle(elementInView,darkMode);elementStyle.background=canvasColor;elementStyle.shape="Box";var elementStyleIdentifier=createTagsList(elementStyle,"Deployment Node");if(elementStylesInUse.indexOf(elementStyleIdentifier)===-1){elementStylesInUse.push(elementStyleIdentifier);elementStylesInUseMap[elementStyleIdentifier]=elementStyle}}else{var elementStyle=structurizr.ui.findElementStyle(elementInView,darkMode);var elementStyleIdentifier=createTagsList(elementStyle,"Element");if(elementStylesInUse.indexOf(elementStyleIdentifier)===-1){elementStylesInUse.push(elementStyleIdentifier);elementStylesInUseMap[elementStyleIdentifier]=elementStyle}}}elementStylesInUse.sort(function(a,b){return a.localeCompare(b)});var relationshipStylesInUse=[];var relationshipStylesInUseMap={};var relationshipsInView=currentView.relationships.map(function(relationship){return structurizr.workspace.findRelationshipById(relationship.id)});for(var i=0;i<relationshipsInView.length;i++){var relationshipInView=relationshipsInView[i];var relationshipStyle=structurizr.ui.findRelationshipStyle(relationshipInView,darkMode);var relationshipStyleIdentifier=createTagsList(relationshipStyle,"Relationship");if(relationshipStylesInUse.indexOf(relationshipStyleIdentifier)===-1){relationshipStylesInUse.push(relationshipStyleIdentifier);relationshipStylesInUseMap[relationshipStyleIdentifier]=relationshipStyle}}relationshipStylesInUse.sort(function(a,b){return a.localeCompare(b)});var numberOfItemsInKey=elementStylesInUse.length+relationshipStylesInUse.length;if(currentView.type==="Deployment"){numberOfItemsInKey++}var columns=5;var columnWidth=500;var rowHeight=500;var rows=Math.ceil(numberOfItemsInKey/columns);totalWidthOfKey=columns*columnWidth;totalHeightOfKey=rows*rowHeight;var counter=1;var svg='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+totalWidthOfKey+'" height="'+totalHeightOfKey+'" style="padding: 10px; font-size: '+fontSize+"; font-family: "+font.name+"; background: "+canvasColor+';">';for(var i=0;i<elementStylesInUse.length;i++){elementStyle=elementStylesInUseMap[elementStylesInUse[i]];var fill=structurizr.util.shadeColor(elementStyle.background,100-elementStyle.opacity,darkMode);var stroke=elementStyle.stroke!==undefined?structurizr.util.shadeColor(elementStyle.stroke,100-elementStyle.opacity,darkMode):structurizr.util.shadeColor(fill,darkenPercentage,darkMode);var strokeWidth=elementStyle.strokeWidth;var textColor=structurizr.util.shadeColor(elementStyle.color,100-elementStyle.opacity,darkMode);if(elementStyle.shape==="RoundedBox"){var width=keyElementWidth;var height=keyElementHeight;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect width="'+width+'" height="'+height+'" rx="20" ry="20" x="0" y="0" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Cylinder"){var lidRadius=45;var uniqueKey="key"+elementStyle.tag.replace(/ /g,"")+"Cylinder";var width=keyElementWidth;var height=keyElementWidth*(elementStyle.height/elementStyle.width);var path="M 0,"+lidRadius/2;path+=" a "+width/2+","+lidRadius/2+" 0,0,0 "+width+" "+0;path+=" a "+width/2+","+lidRadius/2+" 0,0,0 -"+width+" "+0;path+=" l 0,"+(height-lidRadius);path+=" a "+width/2+","+lidRadius/2+" 0,0,0 "+width+" "+0;path+=" l 0,-"+(height-lidRadius);svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<path id="'+uniqueKey.concat("Path")+'" d="'+path+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"></path>";svg+=createTextForKey(width,height,0,lidRadius,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Pipe"){var lidRadius=45;var uniqueKey="key"+elementStyle.tag.replace(/ /g,"")+"Pipe";var width=keyElementWidth;var height=keyElementHeight;var path="M "+lidRadius/2+",0";path+=" a "+lidRadius/2+","+height/2+" 0,0,1 0 "+height;path+=" a "+lidRadius/2+","+height/2+" 0,0,1 0 -"+height;path+=" l "+(width-lidRadius)+",0";path+=" a "+lidRadius/2+","+height/2+" 0,0,1 0 "+height;path+=" l -"+(width-lidRadius)+",0";svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<path id="'+uniqueKey.concat("Path")+'" d="'+path+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"></path>";svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Person"){var width=keyElementWidth;var height=keyElementWidth;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect x="0" y="'+height/2.5+'" width="'+width+'" height="'+(height-height/2.5)+'" rx="90" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<circle cx="'+width/2+'" cy="'+height/4.5+'" r="'+height/4.5+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<line x1="'+width/5+'" y1="'+height/1.5+'" x2="'+width/5+'" y2="'+height+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<line x1="'+(width-width/5)+'" y1="'+height/1.5+'" x2="'+(width-width/5)+'" y2="'+height+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,height/4.5*2,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Robot"){var width=keyElementWidth;var height=keyElementWidth;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect x="0" y="'+height/2.5+'" width="'+width+'" height="'+(height-height/2.5)+'" rx="40" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect x="'+(width-width/1.8)/2+'" y="'+(width/2.25-width/10)/2+'" width="'+width/1.8+'" height="'+height/10+'" rx="10" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect x="'+(height-height/2.25)/2+'" y="0" width="'+width/2.25+'" height="'+height/2.25+'" rx="40" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<line x1="'+width/5+'" y1="'+height/1.5+'" x2="'+width/5+'" y2="'+height+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<line x1="'+(width-width/5)+'" y1="'+height/1.5+'" x2="'+(width-width/5)+'" y2="'+height+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,height/4.5*2,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Folder"){var width=keyElementWidth;var height=keyElementWidth*(elementStyle.height/elementStyle.width);svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect width="'+width/3+'" height="'+height/4+'" rx="15" ry="15" x="15" y="0" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect width="'+width+'" height="'+(height-height/8)+'" rx="6" ry="6" x="0" y="'+height/8+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,height/4,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Component"){var width=keyElementWidth;var height=keyElementHeight;var blockWidth=keyElementWidth/6;var blockHeight=keyElementHeight/8;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect width="'+(width-blockWidth/2)+'" height="'+height+'" rx="10" ry="10" x="'+blockWidth/2+'" y="0" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect width="'+blockWidth+'" height="'+blockHeight+'" rx="5" ry="5" x="0" y="'+blockHeight*.6+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect width="'+blockWidth+'" height="'+blockHeight+'" rx="5" ry="5" x="0" y="'+blockHeight*2+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width-blockWidth/2,height,blockWidth/2,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Circle"){var width=keyElementWidth;var height=keyElementWidth;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<ellipse cx="'+width/2+'" cy="'+height/2+'" rx="'+width/2+'" ry="'+height/2+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Ellipse"){var width=keyElementWidth;var height=keyElementWidth*(elementStyle.height/elementStyle.width);svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<ellipse cx="'+width/2+'" cy="'+height/2+'" rx="'+width/2+'" ry="'+height/2+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Hexagon"){var width=keyElementWidth;var height=Math.floor(width/2*Math.sqrt(3));var points=width/4+",0 "+3*(width/4)+",0 "+width+","+height/2+" "+3*(width/4)+","+height+" "+width/4+","+height+" "+"0,"+height/2;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<polygon points="'+points+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Diamond"){var width=keyElementWidth;var height=keyElementHeight;var points=width/2+",0 "+width+","+height/2+" "+width/2+","+height+" "+"0,"+height/2;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<polygon points="'+points+'" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="WebBrowser"){var width=keyElementWidth;var height=keyElementHeight;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect width="'+width+'" height="'+height+'" rx="10" ry="10" x="0" y="0" fill="'+stroke+'" stroke-width="5" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect width="'+(width-20)+'" height="'+(height-50)+'" rx="10" ry="10" x="10" y="40" fill="'+fill+'" stroke-width="0"/>';svg+='<rect width="'+(width-110)+'" height="20" rx="10" ry="10" x="100" y="10" fill="'+fill+'" stroke-width="0"/>';svg+='<ellipse cx="20" cy="20" rx="10" ry="10" fill="'+fill+'" stroke-width="0"/>';svg+='<ellipse cx="50" cy="20" rx="10" ry="10" fill="'+fill+'" stroke-width="0"/>';svg+='<ellipse cx="80" cy="20" rx="10" ry="10" fill="'+fill+'" stroke-width="0"/>';svg+=createTextForKey(width,height,0,40,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="Window"){var width=keyElementWidth;var height=keyElementHeight;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect width="'+width+'" height="'+height+'" rx="10" ry="10" x="0" y="0" fill="'+stroke+'" stroke-width="5" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect width="'+(width-20)+'" height="'+(height-50)+'" rx="10" ry="10" x="10" y="40" fill="'+fill+'" stroke-width="0"/>';svg+='<ellipse cx="20" cy="20" rx="10" ry="10" fill="'+fill+'" stroke-width="0"/>';svg+='<ellipse cx="50" cy="20" rx="10" ry="10" fill="'+fill+'" stroke-width="0"/>';svg+='<ellipse cx="80" cy="20" rx="10" ry="10" fill="'+fill+'" stroke-width="0"/>';svg+=createTextForKey(width,height,0,40,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="MobileDevicePortrait"){var width=keyElementHeight;var height=keyElementWidth;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect width="'+width+'" height="'+height+'" rx="20" ry="20" x="0" y="0" fill="'+stroke+'" stroke-width="5" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect width="'+(width-20)+'" height="'+(height-80)+'" rx="5" ry="5" x="10" y="40" fill="'+fill+'" stroke-width="0"/>';svg+='<ellipse cx="'+width/2+'" cy="'+(height-20)+'" rx="10" ry="10" fill="'+fill+'" stroke-width="0"/>';svg+='<line x1="'+(width-50)/2+'" y1="20" x2="'+(width-(width-50)/2)+'" y2="20" stroke-width="5" stroke="'+fill+'"/>';svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else if(elementStyle.shape==="MobileDeviceLandscape"){var width=keyElementWidth;var height=keyElementHeight;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect width="'+width+'" height="'+height+'" rx="20" ry="20" x="0" y="0" fill="'+stroke+'" stroke-width="5" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+='<rect width="'+(width-80)+'" height="'+(height-20)+'" rx="5" ry="5" x="40" y="10" fill="'+fill+'" stroke-width="0"/>';svg+='<ellipse cx="20" cy="'+height/2+'" rx="10" ry="10" fill="'+fill+'" stroke-width="0"/>';svg+='<line x1="'+(width-20)+'" y1="'+(height-50)/2+'" x2="'+(width-20)+'" y2="'+(height-(height-50)/2)+'" stroke-width="5" stroke="'+fill+'"/>';svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}else{var cornerRadius=3;if(elementStyle.tags.indexOf("Deployment Node")>-1){cornerRadius=15;fill=canvasColor}var width=keyElementWidth;var height=keyElementHeight;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<rect width="'+width+'" height="'+height+'" rx="'+cornerRadius+'" ry="'+cornerRadius+'" x="0" y="0" fill="'+fill+'" stroke-width="'+strokeWidth+'" stroke="'+stroke+'"'+(elementStyle.border!=="Solid"?' stroke-dasharray="'+borderStylesForKey[elementStyle.border]+'"':"")+"/>";svg+=createTextForKey(width,height,0,0,createTagsList(elementStyle,"Element"),undefined,textColor,elementStyle.icon,elementStyle.opacity);svg+="</g>"}counter++}for(var i=0;i<relationshipStylesInUse.length;i++){relationshipStyle=relationshipStylesInUseMap[relationshipStylesInUse[i]];var strokeDashArray;if(relationshipStyle.style==="Dashed"){strokeDashArray=calculateStrokeDashArray(relationshipStyle.thickness)}else if(relationshipStyle.style==="Dotted"){strokeDashArray=calculateStrokeDottedArray(relationshipStyle.thickness)}var fill=structurizr.util.shadeColor(relationshipStyle.color,100-relationshipStyle.opacity,darkMode);var width=keyElementWidth;var height=160;svg+=createSvgGroup(counter,columns,columnWidth,rowHeight,width,height);svg+='<path d="M'+(width-60)+",0 L"+(width-60)+",60 L"+width+",30 L "+(width-60)+',0" style="fill:'+fill+'" stroke-dasharray="" />';if(relationshipStyle.style==="Dashed"||relationshipStyle.style==="Dotted"){svg+='<path d="M0,30 L'+(width-60)+',30" style="stroke:'+fill+"; stroke-width: "+relationshipStyle.thickness*3+"; fill: none; stroke-dasharray: "+strokeDashArray+';" />'}else{svg+='<path d="M0,30 L'+(width-60)+',30" style="stroke:'+fill+"; stroke-width: "+relationshipStyle.thickness*3+'; fill: none;" />'}svg+=createTextForKey(width,height,0,60,createTagsList(relationshipStyle,"Relationship"),undefined,fill);svg+="</g>";counter++}svg+="</svg>";return svg}function createSvgGroup(index,columns,columnWidth,rowHeight,contentWidth,contentHeight){var column=(index-1)%columns+1;var row=Math.ceil(index/columns);var offsetX=(column-1)*columnWidth+(columnWidth-contentWidth)/2;var offsetY=(row-1)*rowHeight+(rowHeight-contentHeight)/2;return'<g transform="translate('+offsetX+","+offsetY+')">'}function createTextForKey(width,height,offsetX,offsetY,tag,stereotype,textColor,icon,opacity){var fontSize=30;var heightOfIcon=DEFAULT_ICON_HEIGHT;var text=breakText(structurizr.util.escapeHtml(tag),width*.8,font.name,fontSize);var heightOfText=calculateHeight(text,fontSize,0,false);offsetY=offsetY/2;var textX=offsetX+width/2;var textY;if(icon===undefined){textY=(height-offsetY)/2-heightOfText/2}else{heightOfText+=10;textY=(height-offsetY)/2-(heightOfText+heightOfIcon)/2}textY+=offsetY;var svg="";svg+='<text x="'+textX+'" y="'+textY+'" text-anchor="middle" fill="'+textColor+'" font-size="'+fontSize+'px" font-family="'+font.name+'">';text.split("\n").forEach(function(line){svg+='<tspan x="'+textX+'" dy="'+(fontSize+10)+'px">'+line+"</tspan>"});svg+="</text>";if(icon){var iconWidth=getImageRatio(icon)*heightOfIcon;svg+='<image xlink:href="'+icon+'" x="'+(offsetX+(width-iconWidth)/2)+'" y="'+(textY+heightOfText+10)+'" width="'+iconWidth+'" height="'+heightOfIcon+'" opacity="'+(opacity?opacity/100:1)+'"/>'}return svg}function getSvgOfCurrentDiagram(){var svgMarkup=canvas.html();svgMarkup=svgMarkup.substr(svgMarkup.indexOf("<svg"));return svgMarkup}function findContentArea(crop,margin){if(currentView&&(currentView.elements===undefined||currentView.elements.length===0)){return{minX:0,maxX:0,minY:0,maxY:0}}var minX=Number.MAX_VALUE;var maxX=0;var minY=Number.MAX_VALUE;var maxY=0;for(var i=0;i<graph.getElements().length;i++){var cell=graph.getElements()[i];if(cell.elementInView!==undefined||cell.attributes.type==="structurizr.boundary"){var bbox=paper.findViewByModel(cell).getBBox();minX=Math.min(minX,bbox.x);minY=Math.min(minY,bbox.y);maxX=Math.max(maxX,bbox.x+bbox.width);maxY=Math.max(maxY,bbox.y+bbox.height)}}for(var i=0;i<graph.getLinks().length;i++){var link=graph.getLinks()[i];var bbox=paper.findViewByModel(link).getBBox();minX=Math.min(minX,bbox.x);minY=Math.min(minY,bbox.y);maxX=Math.max(maxX,bbox.x+bbox.width);maxY=Math.max(maxY,bbox.y+bbox.height)}minX=minX/scale;maxX=maxX/scale;minY=minY/scale;maxY=maxY/scale;if(crop===true){minX=Math.max(minX-margin,0);maxX=Math.min(maxX+margin,diagramWidth);minY=Math.max(minY-margin,0);maxY=Math.min(maxY+margin,diagramHeight)}return{minX:minX,maxX:maxX,minY:minY,maxY:maxY}}function convertSvgToPng(includeDiagramMetadata,crop,callback){var svgMarkup=self.exportCurrentDiagramToSVG(includeDiagramMetadata);var exportedWidth=diagramWidth;var exportedHeight=diagramHeight;if(crop===true){var contentArea=findContentArea(true,50);exportedWidth=contentArea.maxX-contentArea.minX;exportedHeight=contentArea.maxY-contentArea.minY;var viewbox=' viewBox="'+contentArea.minX+" "+contentArea.minY+" "+exportedWidth+" "+exportedHeight+'"';var croppedSvgOpeningTag='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+exportedWidth+'" height="'+exportedHeight+'" style="width: '+exportedWidth+"px; height: "+exportedHeight+'px; background: #ffffff"'+viewbox+">";svgMarkup=svgMarkup.substring(svgMarkup.indexOf(">")+1,svgMarkup.length);svgMarkup=croppedSvgOpeningTag+svgMarkup}svgMarkup=svgMarkup.replace(/class="marker-vertices"/g,'class="marker-vertices" display="none"');svgMarkup=svgMarkup.replace(/&nbsp;/g," ");svgMarkup=svgMarkup.replace(/[\x00-\x19]+/g,"");var myCanvas=document.createElement("canvas");myCanvas.width=canvas.outerWidth();myCanvas.height=canvas.outerHeight();var canvasContext=myCanvas.getContext("2d");if(callback){canvg(myCanvas,svgMarkup,{useCORS:true,renderCallback:function(){canvasContext.globalCompositeOperation="destination-over";canvasContext.fillStyle=canvasColor;canvasContext.fillRect(0,0,myCanvas.width,myCanvas.height);callback(myCanvas.toDataURL(structurizr.constants.CONTENT_TYPE_IMAGE_PNG))}})}else{canvg(myCanvas,svgMarkup);canvasContext.globalCompositeOperation="destination-over";canvasContext.fillStyle=canvasColor;canvasContext.fillRect(0,0,myCanvas.width,myCanvas.height);return myCanvas.toDataURL(structurizr.constants.CONTENT_TYPE_IMAGE_PNG)}}this.exportCurrentDiagramToSVG=function(includeDiagramMetadata){var currentScale=scale;this.zoomTo(1);if(!includeDiagramMetadata){$(".structurizrMetadata").attr("display","none")}$(".structurizrNavigation").attr("display","none");var svgMarkup=getSvgOfCurrentDiagram();svgMarkup=svgMarkup.substring(svgMarkup.indexOf(">")+1);svgMarkup='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 '+diagramWidth+" "+diagramHeight+'" style="background: '+canvasColor+'">'+svgMarkup;svgMarkup=svgMarkup.replace(/cursor: move !important/g,"");svgMarkup=svgMarkup.replace(/class="marker-vertices"/g,'class="marker-vertices" display="none"');svgMarkup=svgMarkup.replace(/class="[\w -]*"/g,"");svgMarkup=svgMarkup.replace(/data-type="[\w.]*"/g,"");svgMarkup=svgMarkup.replace(/model-id="[\w\d-]*"/g,"");svgMarkup=svgMarkup.replace(/cursor: default !important/g,"");svgMarkup=svgMarkup.replace(/cursor: pointer !important/g,"");svgMarkup=svgMarkup.replace(/cursor: zoom-in !important/g,"");svgMarkup=svgMarkup.replace(/&nbsp;/g," ");this.zoomTo(currentScale);$(".structurizrNavigation").attr("display","block");$(".structurizrMetadata").attr("display","block");return svgMarkup};this.exportCurrentDiagramKeyToSVG=function(){var svgMarkup=diagramKey;var diagramKeyWidth=svgMarkup.match(/width="(\d*)"/)[1];var diagramKeyHeight=svgMarkup.match(/height="(\d*)"/)[1];svgMarkup=svgMarkup.substring(svgMarkup.indexOf(">")+1);svgMarkup='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 '+diagramKeyWidth+" "+diagramKeyHeight+'" style="background: '+canvasColor+'">'+svgMarkup;return svgMarkup};function resizeImage(url,width,height,callback){var sourceImage=new Image;sourceImage.onload=function(){var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;canvas.getContext("2d").drawImage(sourceImage,0,0,width,height);callback(canvas.toDataURL())};sourceImage.src=url}this.exportCurrentDiagramToPNG=function(includeDiagramMetadata,crop,callback){var currentScale=scale;this.zoomTo(1);$(".structurizrNavigation").attr("display","none");if(callback){convertSvgToPng(includeDiagramMetadata,crop,function(png){$(".structurizrNavigation").attr("display","block");self.zoomTo(currentScale);callback(png)})}else{var png=convertSvgToPng(includeDiagramMetadata,crop);$(".structurizrNavigation").attr("display","block");this.zoomTo(currentScale);return png}};this.exportCurrentDiagramKeyToPNG=function(callback){if(currentView.type===structurizr.constants.IMAGE_VIEW_TYPE){return callback(undefined)}var svgMarkup=diagramKey;var myCanvas=document.createElement("canvas");myCanvas.width=totalWidthOfKey;myCanvas.height=totalHeightOfKey;var canvasContext=myCanvas.getContext("2d");if(callback){canvg(myCanvas,svgMarkup,{useCORS:true,renderCallback:function(){canvasContext.globalCompositeOperation="destination-over";canvasContext.fillStyle=canvasColor;canvasContext.fillRect(0,0,myCanvas.width,myCanvas.height);callback(myCanvas.toDataURL(structurizr.constants.CONTENT_TYPE_IMAGE_PNG))}})}else{canvg(myCanvas,svgMarkup);canvasContext.globalCompositeOperation="destination-over";canvasContext.fillStyle=canvasColor;canvasContext.fillRect(0,0,myCanvas.width,myCanvas.height);return myCanvas.toDataURL(structurizr.constants.CONTENT_TYPE_IMAGE_PNG)}};this.exportCurrentThumbnailToPNG=function(callback){try{convertSvgToPng(true,false,function(exportedImage){$(".structurizrNavigation").attr("display","block");resizeImage(exportedImage,thumbnailWidth,Math.floor(diagramHeight/(diagramWidth/thumbnailWidth)),callback)})}catch(err){console.log(err)}};this.currentViewIsDynamic=function(){return currentView.type==="Dynamic"};this.currentViewHasAnimation=function(){return currentView.animations!==undefined&&currentView.animations.length>1};this.animationStarted=function(){return animationStarted};this.onAnimationStarted=function(f){animationStartedEventHandler=f};this.onAnimationStopped=function(f){animationStoppedEventHandler=f};function fireAnimationStartedEvent(){if(animationStartedEventHandler){animationStartedEventHandler()}}function fireAnimationStoppedEvent(){if(animationStoppedEventHandler){animationStoppedEventHandler()}}this.startAnimation=function(autoPlay){hideAllElements(1);hideAllLines(1);unfadeAllElements();if(this.currentViewIsDynamic()){animationStarted=true;fireAnimationStartedEvent();linesToAnimate=graph.getLinks();linesToAnimate.sort(function(a,b){return a.relationshipInView.order-b.relationshipInView.order});animationIndex=0;this.continueAnimation(autoPlay)}else if(this.currentViewHasAnimation()){animationStarted=true;fireAnimationStartedEvent();animationSteps=currentView.animations;animationSteps.sort(function(a,b){return a.order-b.order});animationIndex=0;this.continueAnimation(autoPlay)}};this.stepBackwardInAnimation=function(){if(this.currentViewIsDynamic()){if(this.animationStarted()){if(animationIndex>0){animationIndex--;var order=linesToAnimate[animationIndex].relationshipInView.order;while(animationIndex>=0&&linesToAnimate[animationIndex].relationshipInView.order===order){animationIndex--}if(animationIndex>0){order=linesToAnimate[animationIndex].relationshipInView.order;while(animationIndex>=0&&linesToAnimate[animationIndex].relationshipInView.order===order){animationIndex--}animationIndex++}}if(animationIndex>=0){this.continueAnimation(false)}else{this.stopAnimation()}}}else if(this.currentViewHasAnimation()){if(this.animationStarted()){if(animationIndex===1){this.stopAnimation()}else if(animationIndex>1){animationIndex--;var animationStep=animationSteps[animationIndex];if(animationStep){if(animationStep.elements){animationStep.elements.forEach(function(elementId){hideElement(elementId,"0.0")})}if(animationStep.relationships){animationStep.relationships.forEach(function(relationshipId){hideLine(relationshipId,"0.0")})}}animationIndex--;this.continueAnimation(false)}}}};this.stepForwardInAnimation=function(){if(!this.animationStarted()){this.startAnimation(false)}else{this.continueAnimation(false)}};this.continueAnimation=function(autoPlay){if(this.currentViewIsDynamic()){if(linesToAnimate){hideAllLines("0.2");fadeAllElements();if(animationIndex<linesToAnimate.length){var line=linesToAnimate[animationIndex];highlightLinesWithOrder(line.relationshipInView.order);if(autoPlay){setTimeout(function(){self.continueAnimation(true)},animationDelay)}}else{this.stopAnimation()}}}else if(this.currentViewHasAnimation()){if(animationIndex===0){hideAllLines("0.0");hideAllElements("0.0")}var animationStep=animationSteps[animationIndex];if(animationStep){if(animationStep.elements){animationStep.elements.forEach(function(elementId){showElement(elementId)})}if(animationStep.relationships){animationStep.relationships.forEach(function(relationshipId){showLine(relationshipId)})}}if(animationIndex<animationSteps.length-1){animationIndex++;if(autoPlay){setTimeout(function(){self.continueAnimation(true)},animationDelay)}}else{this.stopAnimation()}}};function hideAllLines(opacity){$("g .connection-wrap").attr("class","connection-wrap");$("g .connection").css("opacity",opacity);$("g .marker-target").css("opacity",opacity);$("g .label").css("opacity",opacity)}function hideAllElements(opacity){$(".structurizrElement").css("opacity",opacity)}function fadeAllElements(){var shadePercentage=80;cells.forEach(function(cell){var background=structurizr.util.shadeColor(cell._computedStyle.background,shadePercentage,darkMode);var color=structurizr.util.shadeColor(cell._computedStyle.color,shadePercentage,darkMode);var stroke=structurizr.util.shadeColor(cell._computedStyle.stroke,shadePercentage,darkMode);changeColourOfCell(cell,background,color,stroke);var domId=paper.findViewByModel(cell).id;$("#"+domId+" .structurizrIcon").css("opacity","0.2")})}function showLine(relationshipId,order){var line=mapOfIdToLine[relationshipId+(order?"/"+order:"")];if(line){var lineView=paper.findViewByModel(line);if(lineView){var connectionWrap=$("#"+lineView.el.id+" .connection-wrap");connectionWrap.attr("class","connection-wrap");$("#"+lineView.el.id+" .connection").css("opacity","1.0");$("#"+lineView.el.id+" .marker-target").css("opacity","1.0");$("#"+lineView.el.id+" .label").css("opacity","1.0")}}}function hideLine(relationshipId,opacity){var line=mapOfIdToLine[relationshipId];if(line){var lineView=paper.findViewByModel(line);if(lineView){var connectionWrap=$("#"+lineView.el.id+" .connection-wrap");connectionWrap.attr("class","connection-wrap");$("#"+lineView.el.id+" .connection").css("opacity",opacity);$("#"+lineView.el.id+" .marker-target").css("opacity",opacity);$("#"+lineView.el.id+" .label").css("opacity",opacity)}}}function showElement(elementId){var element=mapOfIdToBox[elementId];if(element){var elementView=paper.findViewByModel(element);$("#"+elementView.el.id+" .structurizrElement").css("opacity","1.0")}}function unfadeAllElements(){Object.keys(mapOfIdToBox).forEach(function(elementId){unfadeElement(elementId)})}function unfadeElement(elementId){var cell=mapOfIdToBox[elementId];if(cell){var background=cell._computedStyle.background;var foreground=cell._computedStyle.color;var stroke=cell._computedStyle.stroke;var opacity=cell._computedStyle.opacity;changeColourOfCell(cell,background,foreground,stroke);var domId=paper.findViewByModel(cell).id;$("#"+domId+" .structurizrIcon").css("opacity",opacity/100)}}this.changeColorOfElement=function(elementId,background){var cell=mapOfIdToBox[elementId];if(cell){var foreground=cell._computedStyle.color;var stroke=structurizr.util.shadeColor(background,darkenPercentage,darkMode);changeColourOfCell(cell,background,foreground,stroke)}};function changeColourOfCell(cell,background,color,stroke){var type=cell.attributes.type;var domId=paper.findViewByModel(cell).id;if(type==="structurizr.box"){var selector=$("#"+domId+" .structurizrBox");selector.css("fill",background);selector.css("stroke",stroke)}else if(type==="structurizr.person"){var selector=$("#"+domId+" .structurizrPersonHead");selector.css("fill",background);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrPersonBody");selector.css("fill",background);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrPersonLeftArm");selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrPersonRightArm");selector.css("stroke",stroke)}else if(type==="structurizr.robot"){var selector=$("#"+domId+" .structurizrRobotHead");selector.css("fill",background);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrRobotBody");selector.css("fill",background);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrRobotEars");selector.css("fill",background);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrRobotLeftArm");selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrRobotRightArm");selector.css("stroke",stroke)}else if(type==="structurizr.cylinder"){var selector=$("#"+domId+" .structurizrCylinderPath");selector.css("fill",background);selector.css("stroke",stroke)}else if(type==="structurizr.pipe"){var selector=$("#"+domId+" .structurizrPipePath");selector.css("fill",background);selector.css("stroke",stroke)}else if(type==="structurizr.folder"){var selector=$("#"+domId+" .structurizrFolder");selector.css("fill",background);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrFolderTab");selector.css("fill",background);selector.css("stroke",stroke)}else if(type==="structurizr.component"){var selector=$("#"+domId+" .structurizrComponent");selector.css("fill",background);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrComponentBlockTop");selector.css("fill",background);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrComponentBlockBottom");selector.css("fill",background);selector.css("stroke",stroke)}else if(type==="structurizr.ellipse"){var selector=$("#"+domId+" .structurizrEllipse");selector.css("fill",background);selector.css("stroke",stroke)}else if(type==="structurizr.hexagon"){var selector=$("#"+domId+" .structurizrHexagon");selector.css("fill",background);selector.css("stroke",stroke)}else if(type==="structurizr.webBrowser"){var selector=$("#"+domId+" .structurizrWebBrowser");selector.css("fill",stroke);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrWebBrowserPanel");selector.css("fill",background);selector=$("#"+domId+" .structurizrWebBrowserUrlBar");selector.css("fill",background);selector=$("#"+domId+" .structurizrWebBrowserButton1");selector.css("fill",background);selector=$("#"+domId+" .structurizrWebBrowserButton2");selector.css("fill",background);selector=$("#"+domId+" .structurizrWebBrowserButton3");selector.css("fill",background)}else if(type==="structurizr.window"){var selector=$("#"+domId+" .structurizrWindow");selector.css("fill",stroke);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrWindowPanel");selector.css("fill",background);selector=$("#"+domId+" .structurizrWindowButton1");selector.css("fill",background);selector=$("#"+domId+" .structurizrWindowButton2");selector.css("fill",background);selector=$("#"+domId+" .structurizrWindowButton3");selector.css("fill",background)}else if(type==="structurizr.mobileDevice"){var selector=$("#"+domId+" .structurizrMobileDevice");selector.css("fill",stroke);selector.css("stroke",stroke);selector=$("#"+domId+" .structurizrMobileDeviceDisplay");selector.css("fill",background);selector=$("#"+domId+" .structurizrMobileDeviceButton");selector.css("fill",background);selector=$("#"+domId+" .structurizrMobileDeviceSpeaker");selector.css("stroke",background)}else if(type==="structurizr.deploymentNode"){var selector=$("#"+domId+" .structurizrDeploymentNode");selector.css("stroke",stroke)}if(color){$("#"+domId+" .structurizrName").css("fill",color);$("#"+domId+" .structurizrDescription").css("fill",color);$("#"+domId+" .structurizrMetaData").css("fill",color);$("#"+domId+" .structurizrNavigation").css("fill",color)}}function hideElement(elementId,opacity){var element=mapOfIdToBox[elementId];if(element){var elementView=paper.findViewByModel(element);$("#"+elementView.el.id+" .structurizrElement").css("opacity",opacity)}}this.stopAnimation=function(){animationStarted=false;fireAnimationStoppedEvent();hideAllLines("1.0");hideAllElements("1.0");unfadeAllElements();if(this.currentViewIsDynamic()){linesToAnimate=undefined}else if(this.currentViewHasAnimation()){animationSteps=undefined}};function highlightLinesWithOrder(order){var line=linesToAnimate[animationIndex];while(animationIndex<linesToAnimate.length&&line.relationshipInView.order===order){showLine(line.relationshipInView.id,line.relationshipInView.order);var relationship=structurizr.workspace.findRelationshipById(line.relationshipInView.id);unfadeElement(relationship.sourceId);unfadeElement(relationship.destinationId);animationIndex++;line=linesToAnimate[animationIndex]}}this.hasElementsSelected=function(){return selectedElements.length>0};this.hasElementHighlighted=function(){return highlightedElement!==undefined};this.getHighlightedElementId=function(){return highlightedElement.model.elementInView.id};this.hasLinkHighlighted=function(){return highlightedLink!==undefined};this.getHighlightedRelationshipId=function(){return highlightedLink.model.relationshipInView.id};this.moveLabelOfHighlightedLink=function(delta){var labels=highlightedLink.model.get("labels");if(labels){if(labels[0]){var currentDistance=labels[0].position.distance;var newDistance=Math.min(1,Math.max(0,currentDistance+delta));for(i=0;i<labels.length;i++){var position=labels[i].position;highlightedLink.model.label(i,{position:{distance:newDistance,offset:{x:position.offset.x,y:position.offset.y}}})}highlightedLink.model.relationshipInView.position=Math.round(newDistance*100);fireWorkspaceChangedEvent()}}};this.toggleRoutingOfHighlightedLink=function(){if(highlightedLink.model.relationshipInView.routing===undefined){highlightedLink.model.relationshipInView.routing="Direct";setRoutingAndConnector(highlightedLink.model,"Direct")}else if(highlightedLink.model.relationshipInView.routing==="Direct"){highlightedLink.model.relationshipInView.routing="Curved";setRoutingAndConnector(highlightedLink.model,"Curved")}else if(highlightedLink.model.relationshipInView.routing==="Curved"){highlightedLink.model.set("vertices",[]);highlightedLink.model.relationshipInView.routing="Orthogonal";setRoutingAndConnector(highlightedLink.model,"Orthogonal")}else if(highlightedLink.model.relationshipInView.routing==="Orthogonal"){var relationship=structurizr.workspace.findRelationshipById(highlightedLink.model.relationshipInView.id);if(relationship){var configuration=structurizr.ui.findRelationshipStyle(relationship,darkMode);highlightedLink.model.relationshipInView.routing=undefined;setRoutingAndConnector(highlightedLink.model,configuration.routing)}}fireWorkspaceChangedEvent()};this.addVertex=function(){if(editable){highlightedLink.addVertex({x:currentX,y:currentY})}};this.moveSelectedElementsLeft=function(){addToUndoBuffer(getCurrentElementPositions(selectedElements).concat(getCurrentLinkPositions(getLinksBetweenSelectedElements())));selectedElements.forEach(function(cellView){moveElement(cellView.model,-gridSize,0)});moveLinksBetweenSelectedElements(-gridSize,0)};this.moveSelectedElementsRight=function(){addToUndoBuffer(getCurrentElementPositions(selectedElements).concat(getCurrentLinkPositions(getLinksBetweenSelectedElements())));selectedElements.forEach(function(cellView){moveElement(cellView.model,gridSize,0)});moveLinksBetweenSelectedElements(gridSize,0)};this.moveSelectedElementsUp=function(){addToUndoBuffer(getCurrentElementPositions(selectedElements).concat(getCurrentLinkPositions(getLinksBetweenSelectedElements())));selectedElements.forEach(function(cellView){moveElement(cellView.model,0,-gridSize)});moveLinksBetweenSelectedElements(0,-gridSize)};this.moveSelectedElementsDown=function(){addToUndoBuffer(getCurrentElementPositions(selectedElements).concat(getCurrentLinkPositions(getLinksBetweenSelectedElements())));selectedElements.forEach(function(cellView){moveElement(cellView.model,0,gridSize)});moveLinksBetweenSelectedElements(0,gridSize)};function moveElement(element,dx,dy){var x=element.get("position").x;var y=element.get("position").y;positionElement(element,x+dx,y+dy)}function positionElement(element,x,y){element.set({position:{x:Math.floor(x),y:Math.floor(y)}})}this.alignSelectedElementsLeft=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements));var firstSelectedElement=selectedElements[0].model;var left=firstSelectedElement.get("position").x;selectedElements.forEach(function(cellView){var y=cellView.model.get("position").y;positionElement(cellView.model,left,y)})}};this.alignSelectedElementsRight=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements));var firstSelectedElement=selectedElements[0].model;var right=firstSelectedElement.get("position").x+firstSelectedElement.get("size").width;selectedElements.forEach(function(cellView){var y=cellView.model.get("position").y;var width=cellView.model.get("size").width;positionElement(cellView.model,right-width,y)})}};this.alignSelectedElementsVerticalCentre=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements));var firstSelectedElement=selectedElements[0].model;var centre=firstSelectedElement.get("position").x+firstSelectedElement.get("size").width/2;selectedElements.forEach(function(cellView){var y=cellView.model.get("position").y;var width=cellView.model.get("size").width;positionElement(cellView.model,centre-width/2,y)})}};this.alignSelectedElementsTop=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements));var firstSelectedElement=selectedElements[0].model;var top=firstSelectedElement.get("position").y;selectedElements.forEach(function(cellView){var x=cellView.model.get("position").x;positionElement(cellView.model,x,top)})}};this.alignSelectedElementsBottom=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements));var firstSelectedElement=selectedElements[0].model;var bottom=firstSelectedElement.get("position").y+firstSelectedElement.get("size").height;selectedElements.forEach(function(cellView){var x=cellView.model.get("position").x;var height=cellView.model.get("size").height;positionElement(cellView.model,x,bottom-height)})}};this.alignSelectedElementsHorizontalCentre=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements));var firstSelectedElement=selectedElements[0].model;var centre=firstSelectedElement.get("position").y+firstSelectedElement.get("size").height/2;selectedElements.forEach(function(cellView){var x=cellView.model.get("position").x;var height=cellView.model.get("size").height;positionElement(cellView.model,x,centre-height/2)})}};this.distributeSelectedElementsHorizontally=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements));selectedElements.sort(function(a,b){var aX=a.model.get("position").x;var bX=b.model.get("position").x;return aX-bX});var firstSelectedElement=selectedElements[0];var lastSelectedElement=selectedElements[selectedElements.length-1];var totalWidth=lastSelectedElement.model.get("position").x+lastSelectedElement.model.get("size").width-firstSelectedElement.model.get("position").x;var totalWidthOfElements=0;selectedElements.forEach(function(cellView){totalWidthOfElements+=cellView.model.get("size").width});var spacingBetweenElements=Math.floor((totalWidth-totalWidthOfElements)/(selectedElements.length-1));var x=firstSelectedElement.model.get("position").x;for(var i=1;i<selectedElements.length-1;i++){var currentCellView=selectedElements[i];var previousCellView=selectedElements[i-1];x+=previousCellView.model.get("size").width+spacingBetweenElements;var y=currentCellView.model.get("position").y;positionElement(currentCellView.model,x,y)}}};this.distributeSelectedElementsVertically=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements));selectedElements.sort(function(a,b){var aY=a.model.get("position").y;var bY=b.model.get("position").y;return aY-bY});var firstSelectedElement=selectedElements[0];var lastSelectedElement=selectedElements[selectedElements.length-1];var totalHeight=lastSelectedElement.model.get("position").y+lastSelectedElement.model.get("size").height-firstSelectedElement.model.get("position").y;var totalHeightOfElements=0;selectedElements.forEach(function(cellView){totalHeightOfElements+=cellView.model.get("size").height});var spacingBetweenElements=Math.floor((totalHeight-totalHeightOfElements)/(selectedElements.length-1));var y=firstSelectedElement.model.get("position").y;for(var i=1;i<selectedElements.length-1;i++){var currentCellView=selectedElements[i];var previousCellView=selectedElements[i-1];var x=currentCellView.model.get("position").x;y+=previousCellView.model.get("size").height+spacingBetweenElements;positionElement(currentCellView.model,x,y)}}};this.centreDiagramOrSelectedElements=function(){if(selectedElements.length>0){this.centreSelectedElements()}else{centreDiagram()}};this.centreSelectedElements=function(){if(this.hasElementsSelected()){addToUndoBuffer(getCurrentElementPositions(selectedElements).concat(getCurrentLinkPositions(getLinksBetweenSelectedElements())));return this.centreElements(selectedElements)}};this.centreElements=function(elements){var minX=diagramWidth,minY=diagramHeight;var maxX=0,maxY=0;elements.forEach(function(cellView){var x=cellView.model.get("position").x;var y=cellView.model.get("position").y;var width=cellView.model.get("size").width;var height=cellView.model.get("size").height;minX=Math.min(x,minX);maxX=Math.max(x+width,maxX);minY=Math.min(y,minY);maxY=Math.max(y+height,maxY);var ancestors=cellView.model.getAncestors();if(ancestors!==undefined&&elements.length>1){ancestors.forEach(function(ancestor){var x=ancestor.get("position").x;var y=ancestor.get("position").y;var width=ancestor.get("size").width;var height=ancestor.get("size").height;minX=Math.min(x,minX);maxX=Math.max(x+width,maxX);minY=Math.min(y,minY);maxY=Math.max(y+height,maxY)})}});var dx=Math.floor((diagramWidth-maxX-minX)/2);var dy=Math.floor((diagramHeight-maxY-minY)/2);elements.forEach(function(cellView){moveElement(cellView.model,dx,dy)});moveLinksBetweenElements(elements,dx,dy)};function addGraphEventHandlers(){graph.on("change:position",function(cell,newPosition,opt){if(opt.skipParentHandler)return;var parentId=cell.get("parent");while(parentId){var parentCell=graph.getCell(parentId);reposition(parentCell);parentId=parentCell.get("parent")}});graph.on("change:position",function(cell,newPosition,opt){if(cell.elementInView&&cell.positionCalculated===false){fireWorkspaceChangedEvent();if(opt.translateBy){const translatedByCell=graph.getCell(opt.translateBy);if(translatedByCell.attributes.type==="structurizr.boundary"||translatedByCell.attributes.type==="structurizr.deploymentNode"){return}var cellViewMoved=paper.findViewByModel(cell);if(cellViewMoved.selected!=="undefined"&&cellViewMoved.selected===true){var dx=newPosition.x-cell.elementInView.x;var dy=newPosition.y-cell.elementInView.y;selectedElements.forEach(function(cellView){if(cellView!==cellViewMoved){moveElement(cellView.model,dx,dy)}});moveLinksBetweenSelectedElements(dx,dy)}}cell.elementInView.x=newPosition.x;cell.elementInView.y=newPosition.y}})}function repositionLasso(){if(lasso&&lassoStart!==undefined&&lassoEnd!==undefined){lasso.css({left:Math.min(lassoStart.clientX,lassoEnd.clientX),top:Math.min(lassoStart.clientY,lassoEnd.clientY),width:Math.abs(lassoStart.clientX-lassoEnd.clientX),height:Math.abs(lassoStart.clientY-lassoEnd.clientY)})}}function lassoElements(append){if(append===false){self.deselectAllElements()}var lassoBoundingBox={left:Math.min(lassoStart.x,lassoEnd.x),top:Math.min(lassoStart.y,lassoEnd.y),right:Math.max(lassoStart.x,lassoEnd.x),bottom:Math.max(lassoStart.y,lassoEnd.y)};graph.getElements().forEach(function(cell){if(cell.elementInView&&cell.positionCalculated===false){var elementBoundingBox=cell.getBBox();elementBoundingBox.left=elementBoundingBox.x;elementBoundingBox.top=elementBoundingBox.y;elementBoundingBox.right=elementBoundingBox.left+elementBoundingBox.width;elementBoundingBox.bottom=elementBoundingBox.top+elementBoundingBox.height;if(elementBoundingBox.right<lassoBoundingBox.left||lassoBoundingBox.right<elementBoundingBox.left||elementBoundingBox.bottom<lassoBoundingBox.top||lassoBoundingBox.bottom<elementBoundingBox.top){}else{selectElement(paper.findViewByModel(cell))}}});lassoStart=undefined;lassoEnd=undefined}function moveLinksBetweenSelectedElements(dx,dy){return moveLinksBetweenElements(selectedElements,dx,dy)}function moveLinksBetweenElements(elements,dx,dy){if(dx===0&&dy===0){return}var linksBetweenElements=getLinksBetweenElements(elements);linksBetweenElements.forEach(function(link){var oldVertices=link.get("vertices");if(oldVertices){var newVertices=[];oldVertices.forEach(function(oldVertex){var newVertex={x:oldVertex.x+dx,y:oldVertex.y+dy};newVertices.push(newVertex)});link.set("vertices",newVertices)}})}function getLinksBetweenSelectedElements(){return getLinksBetweenElements(selectedElements)}function getLinksBetweenElements(elements){var linksBetweenElements=[];var links=graph.getLinks();if(links){links.forEach(function(link){var sourceCellView=paper.findViewByModel(graph.getCell(link.get("source")));var targetCellView=paper.findViewByModel(graph.getCell(link.get("target")));if(elements.indexOf(sourceCellView)>-1&&elements.indexOf(targetCellView)>-1){linksBetweenElements.push(link)}})}return linksBetweenElements}function addPaperEventHandlers(){paper.on("cell:mouseover",function(cell,evt){if(cell.model.elementInView){highlightedElement=cell}if(cell.model.relationshipInView){highlightedLink=cell;var point=V(paper.viewport).toLocalPoint(evt.clientX,evt.clientY);currentX=point.x;currentY=point.y}const offset=parentElement.offset();const x=evt.clientX-offset.left;const y=evt.clientY-offset.top;if(evt.altKey&&tooltip.isVisible()){}else{if(tooltip&&tooltip.isEnabled()){if(cell.model.elementInView){showTooltipForElement(structurizr.workspace.findElementById(cell.model.elementInView.id),cell.model._computedStyle,x,y)}else if(cell.model.relationshipInView){showTooltipForRelationship(structurizr.workspace.findRelationshipById(cell.model.relationshipInView.id),cell.model.relationshipInView,cell.model._computedStyle,x,y)}}}});paper.on("cell:mouseout",function(cell,evt){if(evt.altKey&&tooltip&&tooltip.isVisible()){}else{if(tooltip){tooltip.hide()}highlightedElement=undefined;highlightedLink=undefined}});paper.on("cell:pointerdown",function(cell,evt,x,y){if(!cell.getConnectionLength){if(self.hasElementsSelected()){if(selectedElements.indexOf(cell)===-1){previousPositions=getCurrentElementPositions([cell])}else{previousPositions=getCurrentElementPositions(selectedElements).concat(getCurrentLinkPositions(getLinksBetweenSelectedElements()))}}else{previousPositions=getCurrentElementPositions([cell])}}else{if(editable){previousPositions=getCurrentLinkPositions([cell.model])}}});paper.on("cell:pointerup",function(cell,evt,x,y){if(previousPositions&&previousPositions.length>0){if(!cell.getConnectionLength){previousPositions.forEach(function(previousPosition){if(previousPosition.element===cell.model){if(previousPosition.x!==cell.model.position().x||previousPosition.y!==cell.model.position().y){addToUndoBuffer(previousPositions)}}})}else{addToUndoBuffer(previousPositions)}}});paper.on("blank:pointerdown",function(evt,x,y){if(evt.altKey===true){enableCanvasDragging()}else if(self.isEditable()){lassoStart={x:x,y:y,clientX:evt.clientX,clientY:evt.clientY};lassoEnd={x:x,y:y,clientX:evt.clientX,clientY:evt.clientY};repositionLasso();if(lasso){lasso.removeClass("hidden")}canvas.mousemove(lassoMouseMove);if(lasso){lasso.mousemove(lassoMouseMove)}}else{parentElement.focus()}});paper.on("blank:pointerup",function(evt,x,y){if(evt.altKey===true){if(self.isEditable()){disableCanvasDragging()}}else if(self.isEditable()){if(lasso){lasso.addClass("hidden");lassoEnd={x:x,y:y};if(lassoStart===undefined||lassoStart.x===lassoEnd.x&&lassoStart.y===lassoEnd.y){lassoStart=undefined;lassoEnd=undefined;self.deselectAllElements()}else{canvas.unbind("mousemove",lassoMouseMove);lasso.unbind("mousemove",lassoMouseMove);lassoElements(evt.shiftKey||evt.altKey)}}}});paper.on("cell:pointerclick",function(cellView,evt,x,y){if(self.isEditable()){if(cellView.model.elementInView&&cellView.model.positionCalculated===false){var cellViewIsSelected=cellView.selected;var multipleCellsAreSelected=selectedElements.length>1;if(!evt.shiftKey&&!evt.altKey){self.deselectAllElements();if(multipleCellsAreSelected){cellView.selected=true}}if(cellViewIsSelected===undefined){cellView.selected=true}else{cellView.selected=!cellViewIsSelected}if(cellView.selected===true){selectElement(cellView)}else{deselectElement(cellView)}}else{self.deselectAllElements()}}})}const lassoMouseMove=function(event){if(lassoEnd!==undefined){lassoEnd.clientX=event.pageX;lassoEnd.clientY=event.pageY;repositionLasso()}};function enableCanvasDragging(){viewport.css("cursor","grabbing");viewport.bind("mousedown",dragMouseDown);viewport.bind("mouseup",dragStop);viewport.bind("mouseleave",dragStop)}function disableCanvasDragging(){viewport.css("cursor","");viewport.unbind("mousedown",dragMouseDown);viewport.unbind("mouseup",dragStop);viewport.unbind("mouseleave",dragStop);dragStop()}function dragMouseDown(event){dragStartPosition={x:event.clientX,y:event.clientY};scrollStartPosition={x:viewport.scrollLeft(),y:viewport.scrollTop()};viewport.bind("mousemove",dragMouseMove)}function dragMouseMove(event){if(event!==undefined){var x=event.clientX;var y=event.clientY;var deltaX=dragStartPosition.x-x;var deltaY=dragStartPosition.y-y;viewport.scrollLeft(scrollStartPosition.x+deltaX*scale);viewport.scrollTop(scrollStartPosition.y+deltaY*scale)}}function dragStop(event){dragStartPosition=undefined;viewport.unbind("mousemove",dragMouseMove)}this.setKeyboardShortcutsEnabled=function(bool){keyboardShortcutsEnabled=bool};this.areKeyboardShortcutsEnabled=function(){return keyboardShortcutsEnabled};function getCurrentElementPositions(elementViews){var previousPositions=[];elementViews.forEach(function(elementView){var allElements=elementView.model.getEmbeddedCells({deep:true});allElements.push(elementView.model);allElements.forEach(function(element){previousPositions.push({type:"element",element:element,x:element.get("position").x,y:element.get("position").y})})});return previousPositions}function getCurrentLinkPositions(links){var previousPositions=[];links.forEach(function(link){previousPositions.push({type:"link",link:link,vertices:link.get("vertices")})});return previousPositions}function addToUndoBuffer(previousPositions){undoStack.push(previousPositions);fireWorkspaceChangedEvent()}this.undo=function(){if(!undoStack.isEmpty()){var previousPositions=undoStack.pop();previousPositions.forEach(function(position){if(position.type==="element"){positionElement(position.element,position.x,position.y)}else{position.link.set("vertices",position.vertices)}fireWorkspaceChangedEvent()})}};this.removeAllVertices=function(){graph.getLinks().forEach(function(link){link.set("vertices",[])})};this.runDagre=function(rankDirection,rankSeparation,nodeSeparation,edgeSeparation,linkVertices,margin,resize){try{var cellViews=[];cells.forEach(function(cell){var element=paper.findViewByModel(cell);if(element.model.positionCalculated===false){cellViews.push(element)}});addToUndoBuffer(getCurrentElementPositions(cellViews).concat(getCurrentLinkPositions(graph.getLinks())));this.removeAllVertices();joint.layout.DirectedGraph.layout(graph,{nodeSep:nodeSeparation,rankSep:rankSeparation,edgeSep:edgeSeparation,setLinkVertices:linkVertices,rankDir:rankDirection,marginX:margin,marginY:margin});if(resize===true){this.autoPageSize();this.zoomFitHeight()}else{repositionDiagramMetadata()}centreDiagram();diagramRendered=true}catch(err){console.error("There was an error applying the automatic layout: "+err);alert("The automatic layout algorithm could not be applied to this view.")}};function centreDiagram(){var cellViews=[];cells.forEach(function(cell){var element=paper.findViewByModel(cell);if(element.model.positionCalculated===false){cellViews.push(element)}});var contentArea=findContentArea(false,0);var dx=Math.floor((diagramWidth-contentArea.maxX-contentArea.minX)/2);var dy=Math.floor((diagramHeight-contentArea.maxY-contentArea.minY)/2);cellViews.forEach(function(cellView){moveElement(cellView.model,dx,dy)});moveLinksBetweenElements(cellViews,dx,dy)}this.undoStackIsEmpty=function(){return undoStack.isEmpty()};function showTooltipForElement(element,style,x,y){if(currentPerspective!==undefined&&elementHasPerspective(element)===false){return}if(tooltip===undefined){return}var additionalContent="";if(currentPerspective!==undefined){var perspectiveDetails=undefined;if(element.perspectives){element.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){perspectiveDetails=perspective}})}if(perspectiveDetails===undefined){if(element.type==="SoftwareSystemInstance"){var softwareSystem=structurizr.workspace.findElementById(element.softwareSystemId);if(softwareSystem.perspectives){softwareSystem.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){perspectiveDetails=perspective}})}}else if(element.type==="ContainerInstance"){var container=structurizr.workspace.findElementById(element.containerId);if(container.perspectives){container.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){perspectiveDetails=perspective}})}}}if(perspectiveDetails!==undefined){var perspectiveDescription=perspectiveDetails.description;if(perspectiveDescription===undefined){perspectiveDescription=""}perspectiveDescription=structurizr.util.escapeHtml(perspectiveDescription).replaceAll("\n","<br />");additionalContent+="<hr"+' style="border-color:'+style.stroke+'" />';additionalContent+="<p><b>Perspective: ";additionalContent+=structurizr.util.escapeHtml(perspectiveDetails.name);additionalContent+="</b></p>";additionalContent+="<p>";additionalContent+=perspectiveDescription;additionalContent+="</p>"}}tooltip.showTooltipForElement(element,style,x,y,additionalContent)}function showTooltipForRelationship(relationship,relationshipInView,style,x,y){if(currentPerspective!==undefined&&relationshipHasPerspective(relationship)===false){return}if(tooltip===undefined){return}var additionalContent="";if(currentPerspective!==undefined){var perspectiveDetails=undefined;if(relationship.perspectives){relationship.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){perspectiveDetails=perspective}})}if(perspectiveDetails===undefined){if(relationship.linkedRelationshipId){var linkedRelationship=structurizr.workspace.findRelationshipById(relationship.linkedRelationshipId);if(linkedRelationship&&linkedRelationship.perspectives){linkedRelationship.perspectives.forEach(function(perspective){if(perspective.name===currentPerspective){perspectiveDetails=perspective}})}}}if(perspectiveDetails!==undefined){var perspectiveDescription=perspectiveDetails.description;if(perspectiveDescription===undefined){perspectiveDescription=""}perspectiveDescription=structurizr.util.escapeHtml(perspectiveDescription).replaceAll("\n","<br />");additionalContent+="<hr"+' style="border-color:'+style.color+'" />';additionalContent+="<p><b>Perspective: ";additionalContent+=structurizr.util.escapeHtml(perspectiveDetails.name);additionalContent+="</b></p>";additionalContent+="<p>";additionalContent+=perspectiveDescription;additionalContent+="</p>"}}tooltip.showTooltipForRelationship(relationship,relationshipInView,style,x,y,additionalContent,darkMode)}this.toggleMetadata=function(){metadataEnabled=!metadataEnabled;renderView()};this.toggleDescription=function(){descriptionEnabled=!descriptionEnabled;renderView()};this.showDiagramScope=function(bool){this.stopAnimation();if(bool){hideAllElements(1);fadeAllElements();hideAllLines(.2);if(currentView.type==="SystemContext"){unfadeElement(currentView.softwareSystemId)}else if(currentView.type==="Container"){currentView.elements.forEach(function(elementInView){var element=structurizr.workspace.findElementById(elementInView.id);if(element&&element.parentId===currentView.softwareSystemId){unfadeElement(element.id)}})}else if(currentView.type==="Component"){currentView.elements.forEach(function(elementInView){var element=structurizr.workspace.findElementById(elementInView.id);if(element&&element.parentId===currentView.containerId){unfadeElement(element.id)}})}else if(currentView.type==="Dynamic"&&currentView.elementId!==undefined){currentView.elements.forEach(function(elementInView){var element=structurizr.workspace.findElementById(elementInView.id);if(element&&element.parentId===currentView.elementId){unfadeElement(element.id)}})}else if(currentView.type==="Deployment"&&currentView.softwareSystemId!==undefined){currentView.elements.forEach(function(elementInView){var element=structurizr.workspace.findElementById(elementInView.id);if(element.type==="ContainerInstance"){var container=structurizr.workspace.findElementById(element.containerId);if(container&&container.parentId===currentView.softwareSystemId){unfadeElement(element.id)}}})}}else{hideAllElements(1);unfadeAllElements();hideAllLines(1)}};this.onkeydown=function(callback){onKeyDownEventHandler=callback};this.onkeypress=function(callback){onKeyPressEventHandler=callback};$(document).keydown(function(e){if(self.areKeyboardShortcutsEnabled()){const leftArrow=37;const pageUp=33;const rightArrow=39;const pageDown=34;const upArrow=38;const downArrow=40;if(e.which===leftArrow||e.which===pageUp){if(self.hasElementsSelected()&&self.isEditable()){self.moveSelectedElementsLeft();e.preventDefault();return}else if(Math.round(canvas.innerWidth())>Math.round(viewport.innerWidth())){viewport.scrollLeft(viewport.scrollLeft()-viewport.innerWidth()/10);e.preventDefault();return}}else if(e.which===rightArrow||e.which===pageDown){if(self.hasElementsSelected()&&self.isEditable()){self.moveSelectedElementsRight();e.preventDefault();return}else if(Math.round(canvas.innerWidth())>Math.round(viewport.innerWidth())){viewport.scrollLeft(viewport.scrollLeft()+viewport.innerWidth()/10);e.preventDefault();return}}else if(e.which===upArrow){if(self.hasLinkHighlighted()&&self.isEditable()){self.moveLabelOfHighlightedLink(.05);e.preventDefault();return}else if(self.hasElementsSelected()&&self.isEditable()){self.moveSelectedElementsUp();e.preventDefault();return}else if(Math.round(canvas.innerHeight())>Math.round(viewport.innerHeight())){viewport.scrollTop(viewport.scrollTop()-viewport.innerHeight()/10);e.preventDefault();return}}else if(e.which===downArrow){if(self.hasLinkHighlighted()&&self.isEditable()){self.moveLabelOfHighlightedLink(-.05);e.preventDefault();return}else if(self.hasElementsSelected()&&self.isEditable()){self.moveSelectedElementsDown();e.preventDefault();return}else if(Math.round(canvas.innerHeight())>Math.round(viewport.innerHeight())){viewport.scrollTop(viewport.scrollTop()+viewport.innerHeight()/10);e.preventDefault();return}}if(onKeyDownEventHandler){onKeyDownEventHandler(e)}}});$(document).keypress(function(e){if(self.areKeyboardShortcutsEnabled()){var plus=43;var equals=61;var minus=45;var comma=44;var dot=46;var a=97;var c=99;var d=100;var f=102;var h=104;var m=109;var n=110;var r=114;var u=117;var v=118;var w=119;if(onKeyPressEventHandler){onKeyPressEventHandler(e)}}})};structurizr.shapes={};structurizr.shapes.Box=joint.dia.Element.extend({markup:'<g class="structurizrElement"><rect class="structurizrBox structurizrHighlightableElement"/><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.box",attrs:{rect:{rx:1,ry:1},".structurizrBox":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:"rect","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:"rect","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:"rect","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:"rect"},".structurizrIcon":{ref:"rect"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Boundary=joint.dia.Element.extend({markup:'<g><rect class="structurizrBoundary structurizrHighlightableElement"/><text class="structurizrName"/><text class="structurizrMetaData"/><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.boundary",attrs:{rect:{width:100,height:100,rx:0,ry:0},".structurizrBoundary":{fill:"#ffffff",stroke:"#444444","stroke-width":"2","stroke-dasharray":"20,20","pointer-events":"none"},".structurizrName":{"font-weight":"normal","font-size":"21px",fill:"#444444",ref:"rect","text-anchor":"start","pointer-events":"visible"},".structurizrMetaData":{"font-weight":"normal","font-size":"15px",fill:"#444444",ref:"rect","text-anchor":"start","pointer-events":"visible"},".structurizrIcon":{"pointer-events":"visible"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.DeploymentNode=joint.dia.Element.extend({markup:'<g class="structurizrElement"><rect class="structurizrDeploymentNode structurizrHighlightableElement"/><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrInstanceCount"/><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.deploymentNode",attrs:{rect:{width:100,height:100,rx:10,ry:10},".structurizrDeploymentNode":{fill:"#ffffff",stroke:"#444444","stroke-width":"1","pointer-events":"none"},".structurizrName":{"font-weight":"normal","font-size":"20px",ref:"rect","text-anchor":"start","pointer-events":"visible"},".structurizrMetaData":{"font-weight":"normal","font-size":"15px",ref:"rect","text-anchor":"start","pointer-events":"visible"},".structurizrInstanceCount":{"font-size":"40px","font-weight":"normal",fill:"#555555",ref:"rect","ref-x":.98,"text-anchor":"end","pointer-events":"visible"},".structurizrIcon":{"pointer-events":"visible"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.DiagramTitle=joint.dia.Element.extend({markup:'<g><text class="structurizrDiagramTitle structurizrMetadata"/></g>',defaults:joint.util.deepSupplement({type:"structurizr.diagramTitle",attrs:{".structurizrDiagramTitle":{"font-weight":"normal","font-size":"36px","text-anchor":"start",fill:"#000000","pointer-events":"none"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.DiagramDescription=joint.dia.Element.extend({markup:'<g><text class="structurizrDiagramDescription structurizrMetadata"/></g>',defaults:joint.util.deepSupplement({type:"structurizr.diagramDescription",attrs:{".structurizrDiagramDescription":{"font-weight":"normal","font-size":"22px","text-anchor":"start",fill:"#777777","pointer-events":"none"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.DiagramMetadata=joint.dia.Element.extend({markup:'<g><text class="structurizrDiagramMetadata structurizrMetadata"/></g>',defaults:joint.util.deepSupplement({type:"structurizr.diagramMetadata",attrs:{".structurizrDiagramMetadata":{"font-weight":"normal","font-size":"22px","text-anchor":"start",fill:"#777777","pointer-events":"none"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.BrandingImage=joint.dia.Element.extend({markup:'<g><image class="structurizrBrandingImage structurizrMetadata"/></g>',defaults:joint.util.deepSupplement({type:"structurizr.brandingImage",attrs:{".structurizrBrandingImage":{"pointer-events":"none"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.ImageView=joint.dia.Element.extend({markup:'<g><image class="structurizrImageView"/></g>',defaults:joint.util.deepSupplement({type:"structurizr.image",attrs:{".structurizrImage":{"pointer-events":"none"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Relationship=joint.dia.Link.extend();structurizr.shapes.Person=joint.dia.Element.extend({markup:'<g class="structurizrElement structurizrPerson"><rect class="structurizrPersonBody structurizrHighlightableElement" x="0" y="175" width="450" height="250" rx="70" /><circle class="structurizrPersonHead structurizrHighlightableElement" cx="225" cy="100" r="100" /><line class="structurizrPersonRightArm" x1="90" y1="300" x2="90" y2="450" /><line class="structurizrPersonLeftArm" x1="360" y1="300" x2="360" y2="450" /><text class="structurizrName"/><text class="structurizrMetaData" /><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.person",attrs:{".structurizrPersonHead":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrPersonBody":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:".structurizrPersonBody","ref-x":.5,"ref-y":.25,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:".structurizrPersonBody","ref-x":.5,"ref-y":.4,"text-anchor":"middle"},".structurizrDescription":{ref:".structurizrPersonBody","ref-x":.5,"ref-y":.6,"text-anchor":"middle"},".structurizrNavigation":{ref:".structurizrPersonBody","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:".structurizrPersonBody"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Robot=joint.dia.Element.extend({markup:'<g class="structurizrElement structurizrRobot"><rect class="structurizrRobotBody structurizrHighlightableElement" x="0" y="175" width="450" height="250" rx="30" /><rect class="structurizrRobotEars structurizrHighlightableElement" rx="10" /><rect class="structurizrRobotHead structurizrHighlightableElement" rx="30" /><line class="structurizrRobotRightArm" x1="90" y1="300" x2="90" y2="450" /><line class="structurizrRobotLeftArm" x1="360" y1="300" x2="360" y2="450" /><text class="structurizrName"/><text class="structurizrMetaData" /><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.robot",attrs:{".structurizrRobotHead":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrRobotEars":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrRobotBody":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:".structurizrRobotBody","ref-x":.5,"ref-y":.25,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:".structurizrRobotBody","ref-x":.5,"ref-y":.4,"text-anchor":"middle"},".structurizrDescription":{ref:".structurizrRobotBody","ref-x":.5,"ref-y":.6,"text-anchor":"middle"},".structurizrNavigation":{ref:".structurizrRobotBody","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:".structurizrRobotBody"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Cylinder=joint.dia.Element.extend({markup:'<g class="structurizrElement structurizrCylinder"><path class="structurizrCylinderPath structurizrHighlightableElement" d=""></path><rect class="structurizrCylinderFace"></rect><text class="structurizrName"/><text class="structurizrMetaData" /><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.cylinder",attrs:{".structurizrCylinderPath":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrCylinderFace":{"stroke-width":0,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:"rect","ref-x":.5,"ref-y":.25,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:"rect","ref-x":.5,"ref-y":.43,"text-anchor":"middle"},".structurizrDescription":{ref:"rect","ref-x":.5,"ref-y":.6,"text-anchor":"middle"},".structurizrNavigation":{ref:"rect","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:"rect"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Pipe=joint.dia.Element.extend({markup:'<g class="structurizrElement structurizrPipe"><path class="structurizrPipePath structurizrHighlightableElement" d=""></path><rect class="structurizrPipeFace"></rect><text class="structurizrName"/><text class="structurizrMetaData" /><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.pipe",attrs:{".structurizrPipePath":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrPipeFace":{"stroke-width":0,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:".structurizrPipeFace","ref-x":.5,"ref-y":.25,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:"rect","ref-x":.5,"ref-y":.43,"text-anchor":"middle"},".structurizrDescription":{ref:"rect","ref-x":.5,"ref-y":.6,"text-anchor":"middle"},".structurizrNavigation":{ref:"rect","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:"rect"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Folder=joint.dia.Element.extend({markup:'<g class="structurizrElement"><rect class="structurizrFolderTab structurizrHighlightableElement" /><rect class="structurizrFolder structurizrHighlightableElement"/><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.folder",attrs:{rect:{rx:1,ry:1},".structurizrFolderTab":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrFolder":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:".structurizrFolder","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:".structurizrFolder","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:".structurizrFolder","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:".structurizrFolder","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:".structurizrFolder"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Component=joint.dia.Element.extend({markup:'<g class="structurizrElement"><rect class="structurizrComponent structurizrHighlightableElement"/><rect class="structurizrComponentBlockTop structurizrHighlightableElement" /><rect class="structurizrComponentBlockBottom structurizrHighlightableElement" /><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.component",attrs:{rect:{rx:1,ry:1},".structurizrComponentBlockTop":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrComponentBlockBottom":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrComponent":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:".structurizrComponent","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:".structurizrComponent","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:".structurizrComponent","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:".structurizrComponent","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:".structurizrComponent"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Ellipse=joint.dia.Element.extend({markup:'<g class="structurizrElement"><ellipse class="structurizrEllipse structurizrHighlightableElement"/><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.ellipse",attrs:{ellipse:{},".structurizrEllipse":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:"ellipse","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:"ellipse","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:"ellipse","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:"ellipse","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:"ellipse"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Hexagon=joint.dia.Element.extend({markup:'<g class="structurizrElement"><polygon class="structurizrHexagon structurizrHighlightableElement"/><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.hexagon",attrs:{polygon:{},".structurizrHexagon":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:"polygon","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:"polygon","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:"polygon","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:"polygon","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:"polygon"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Diamond=joint.dia.Element.extend({markup:'<g class="structurizrElement"><polygon class="structurizrDiamond structurizrHighlightableElement"/><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.diamond",attrs:{polygon:{},".structurizrDiamond":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:"polygon","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:"polygon","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:"polygon","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:"polygon","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:"polygon"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.WebBrowser=joint.dia.Element.extend({markup:'<g class="structurizrElement"><rect class="structurizrWebBrowser structurizrHighlightableElement"/><rect class="structurizrWebBrowserPanel"/><ellipse class="structurizrWebBrowserButton1"/><ellipse class="structurizrWebBrowserButton2"/><ellipse class="structurizrWebBrowserButton3"/><rect class="structurizrWebBrowserUrlBar"/><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.webBrowser",attrs:{rect:{rx:1,ry:1},".structurizrWebBrowser":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrWebBrowserPanel":{stroke:"#444444","stroke-width":0,"pointer-events":"visiblePainted"},".structurizrWebBrowserUrlBar":{stroke:"#444444","stroke-width":0,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:".structurizrWebBrowserPanel","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:".structurizrWebBrowserPanel","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:".structurizrWebBrowserPanel","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:".structurizrWebBrowserPanel","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:".structurizrWebBrowserPanel"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.Window=joint.dia.Element.extend({markup:'<g class="structurizrElement"><rect class="structurizrWindow structurizrHighlightableElement"/><rect class="structurizrWindowPanel"/><ellipse class="structurizrWindowButton1"/><ellipse class="structurizrWindowButton2"/><ellipse class="structurizrWindowButton3"/><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.window",attrs:{rect:{rx:1,ry:1},".structurizrWindow":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrWindowPanel":{stroke:"#444444","stroke-width":0,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:".structurizrWindowPanel","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:".structurizrWindowPanel","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:".structurizrWindowPanel","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:".structurizrWindowPanel","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:".structurizrWindowPanel"}}},joint.dia.Element.prototype.defaults)});structurizr.shapes.MobileDevice=joint.dia.Element.extend({markup:'<g class="structurizrElement"><rect class="structurizrMobileDevice structurizrHighlightableElement"/><rect class="structurizrMobileDeviceDisplay"/><ellipse class="structurizrMobileDeviceButton"/><line class="structurizrMobileDeviceSpeaker" style="stroke-width:2px" /><text class="structurizrName"/><text class="structurizrMetaData"/><text class="structurizrDescription"/><g class="structurizrNavigation"><g class="structurizrZoom" /><g class="structurizrDocumentation" /><g class="structurizrDecisions" /><g class="structurizrLink" /></g><image class="structurizrIcon" /></g>',defaults:joint.util.deepSupplement({type:"structurizr.mobileDevice",attrs:{rect:{rx:1,ry:1},".structurizrMobileDevice":{stroke:"#444444","stroke-width":2,"pointer-events":"visiblePainted"},".structurizrMobileDeviceDisplay":{stroke:"#444444","stroke-width":0,"pointer-events":"visiblePainted"},".structurizrName":{"font-weight":"bold",ref:"rect","ref-x":.5,"ref-y":.15,"text-anchor":"middle","pointer-events":"visible"},".structurizrMetaData":{ref:"rect","ref-x":.5,"ref-y":.3,"text-anchor":"middle"},".structurizrDescription":{ref:"rect","ref-x":.5,"ref-y":.45,"text-anchor":"middle"},".structurizrNavigation":{ref:"rect","font-weight":"normal","ref-x":.5,"text-anchor":"middle"},".structurizrIcon":{ref:"rect"}}},joint.dia.Element.prototype.defaults)});structurizr.ui.PaperSizes=function(){const definitions={};definitions["A6_Portrait"]={width:1240,height:1748};definitions["A6_Landscape"]={width:1748,height:1240};definitions["A5_Portrait"]={width:1748,height:2480};definitions["A5_Landscape"]={width:2480,height:1748};definitions["A4_Portrait"]={width:2480,height:3508};definitions["A4_Landscape"]={width:3508,height:2480};definitions["A3_Portrait"]={width:3508,height:4961};definitions["A3_Landscape"]={width:4961,height:3508};definitions["A2_Portrait"]={width:4961,height:7016};definitions["A2_Landscape"]={width:7016,height:4961};definitions["A1_Portrait"]={width:7016,height:9933};definitions["A1_Landscape"]={width:9933,height:7016};definitions["A0_Portrait"]={width:9933,height:14043};definitions["A0_Landscape"]={width:14043,height:9933};definitions["Letter_Portrait"]={width:2550,height:3300};definitions["Letter_Landscape"]={width:3300,height:2550};definitions["Legal_Portrait"]={width:2550,height:4200};definitions["Legal_Landscape"]={width:4200,height:2550};definitions["Slide_4_3"]={width:3306,height:2480};definitions["Slide_16_9"]={width:3508,height:1973};definitions["Slide_16_10"]={width:3508,height:2193};this.getDimensions=function(paperSize){return definitions[paperSize]};this.getDimensions=function(paperSize){return definitions[paperSize]}};